(function(b,a){b(["JC.BaseMVC","JC.Panel"],function(){window.Bizs.ActionLogic=c;function c(d){d&&(d=$(d));if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}!b.amd&&JC.use&&!JC.Panel&&JC.use("Panel");c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data("ActionLogicIns",e);return d.data("ActionLogicIns")};c.isActionLogic=function(d){var e;d&&(d=$(d)).length&&(e=d.is("[baltype]"));return e};c.init=function(d){d&&$(d).find(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join()).on("click",function(f){var e=$(this);c.process(e)&&(e.prop("nodeName").toLowerCase()=="a"&&f.preventDefault())})};c.process=function(d){d=$(d);if(!(d&&d.length)){return null}if(!c.isActionLogic(d)){return}var e=c.getInstance(d);!e&&(e=new c(d));e&&e.process();return e};c.random=true;c.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var d=this;d.on("StaticPanel",function(e,f){d.trigger("ShowPanel",[JC.f.scriptContent(f)])});d.on(c.Model.SHOW_PANEL,function(f,e){var g=JC.Dialog(e);g.on("confirm",function(){if(d._model.balCallback()&&d._model.balCallback().call(d._model.selector(),g,d)){return true}return false})});d.on("AjaxPanel",function(e,f,g){if(!(f&&g)){return}d._model.balRandom()&&(g=JC.f.addUrlParams(g,{rnd:new Date().getTime()}));$.get(g).done(function(h){switch(f){case c.Model.SHOW_PANEL:d.trigger("ShowPanel",[h]);break;case c.Model.DATA_PANEL:try{h=$.parseJSON(h)}catch(i){}if(h){if(h.errorno){d.trigger("ShowError",[h.errmsg||"操作失败, 请重试!",1])}else{d.trigger("ShowPanel",[h.data])}}break}})});d.on("Go",function(e,f){if(!f){return}d._model.balRandom()&&(f=JC.f.addUrlParams(f,{rnd:new Date().getTime()}));JC.f.reloadPage(f)});d.on("AjaxAction",function(e,f){if(!f){return}d._model.balRandom()&&(f=JC.f.addUrlParams(f,{rnd:new Date().getTime()}));$.get(f).done(function(g){try{g=$.parseJSON(g)}catch(h){}if(d._model.balCallback()){d._model.balCallback().call(d.selector(),g,d)}else{if(g&&"errorno" in g){if(g.errorno){d.trigger("ShowError",[g.errmsg||"操作失败, 请重试!",1])}else{d.trigger("ShowSuccess",[g.errmsg||"操作完成",function(){d._model.balDoneUrl()&&JC.f.reloadPage(d._model.balDoneUrl()||location.href)}])}}else{JC.Dialog.alert(g,1)}}})});d.on("ShowError",function(e,i,g,f){var h;switch(d._model.balErrorPopupType()){case"alert":h=JC.alert(i,d._model.selector(),g||1);f&&h.on("confirm",function(){f()});break;case"msgbox":h=JC.msgbox(i,d._model.selector(),g||1);f&&h.on("close",function(){f()});break;case"dialog.msgbox":h=JC.Dialog.msgbox(i,g||1);f&&h.on("close",function(){f()});break;default:h=JC.Dialog.alert(i,g||1);f&&h.on("confirm",function(){f()});break}});d.on("ShowConfirm",function(e,i,g,f){var h;switch(d._model.balConfirmPopupType()){case"dialog.confirm":h=JC.Dialog.confirm(i,g||1);f&&h.on("confirm",function(){f()});break;default:h=JC.confirm(i,d._model.selector(),g||1);f&&h.on("confirm",function(){f()});break}});d.on("ShowSuccess",function(e,h,f){var g;switch(d._model.balSuccessPopupType()){case"alert":g=JC.alert(h,d._model.selector());f&&g.on("confirm",function(){f()});break;case"dialog.alert":g=JC.Dialog.alert(h);f&&g.on("confirm",function(){f()});break;case"dialog.msgbox":g=JC.Dialog.msgbox(h);f&&g.on("close",function(){f()});break;default:g=JC.msgbox(h,d.selector());f&&g.on("close",function(){f()});break}})},process:function(){var d=this;JC.hideAllPopup(1);switch(d._model.baltype()){case"panel":if(d._model.is("[balPanelTpl]")){d.trigger("StaticPanel",[d._model.balPanelTpl()])}else{if(d._model.is("[balAjaxHtml]")){d.trigger("AjaxPanel",[c.Model.SHOW_PANEL,d._model.balAjaxHtml()])}else{if(d._model.is("[balAjaxData]")){d.trigger("AjaxPanel",[c.Model.DATA_PANEL,d._model.balAjaxData()])}}}break;case"link":if(d._model.is("[balConfirmMsg]")){d.trigger("ShowConfirm",[d._model.balConfirmMsg(),2,function(){d.trigger("Go",d._model.balUrl())}])}else{d.trigger("Go",d._model.balUrl())}break;case"ajaxaction":if(d._model.is("[balConfirmMsg]")){var e=JC.confirm(d._model.balConfirmMsg(),d.selector(),2);e.on("confirm",function(){d.trigger("AjaxAction",d._model.balUrl())})}else{d.trigger("AjaxAction",d._model.balUrl())}break}return this}};JC.BaseMVC.buildModel(c);c.Model.SHOW_PANEL="ShowPanel";c.Model.DATA_PANEL="DataPanel";c.Model.prototype={init:function(){},baltype:function(){return this.stringProp("baltype")},balPanelTpl:function(){var e,d=this;e=d.selectorProp("balPanelTpl")||e;return e},balCallback:function(){var e,d=this;e=d.callbackProp("balCallback")||e;return e},balAjaxHtml:function(){return this.selector().attr("balAjaxHtml")},balAjaxData:function(){return this.selector().attr("balAjaxData")},balRandom:function(){var e=c.random,d=this;d.is("[balRandom]")&&(e=JC.f.parseBool(d.stringProp("balRandom")));return e},balUrl:function(){var e="?",d=this;d.selector().prop("nodeName").toLowerCase()=="a"&&(e=d.selector().attr("href"));d.is("[balUrl]")&&(e=d.selector().attr("balUrl"));return JC.f.urlDetect(e)},balDoneUrl:function(){var d=this.attrProp("balDoneUrl");return JC.f.urlDetect(d)},balConfirmMsg:function(){var d="确定要执行吗?";d=this.selector().attr("balConfirmMsg")||d;return d},balErrorPopupType:function(){var d=this.stringProp("balErrorPopupType")||"dialog";return d},balSuccessPopupType:function(){var d=this.stringProp("balSuccessPopupType")||"msgbox";return d},balConfirmPopupType:function(){var d=this.stringProp("balConfirmPopupType")||"confirm";return d}};JC.BaseMVC.buildView(c);c.View.prototype={init:function(){}};JC.BaseMVC.build(c);$(document).ready(function(){$(document).delegate(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join(),"click",function(e){var d=$(this);c.process(d)&&(d.prop("nodeName").toLowerCase()=="a"&&e.preventDefault())})});return Bizs.ActionLogic})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));