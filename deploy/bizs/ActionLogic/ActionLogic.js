(function(b,a){b(["JC.BaseMVC","JC.Panel"],function(){(function(d){window.Bizs=window.Bizs||{};window.Bizs.ActionLogic=c;function c(e){e&&(e=d(e));if(c.getInstance(e)){return c.getInstance(e)}c.getInstance(e,this);this._model=new c.Model(e);this._view=new c.View(this._model);this._init()}!b.amd&&JC.use&&!JC.Panel&&JC.use("Panel");c.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=d(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data("ActionLogicIns",f);return e.data("ActionLogicIns")};c.isActionLogic=function(e){var f;e&&(e=d(e)).length&&(f=e.is("[baltype]"));return f};c.init=function(e){e&&d(e).find(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join()).on("click",function(g){var f=d(this);c.process(f)&&(f.prop("nodeName").toLowerCase()=="a"&&g.preventDefault())})};c.process=function(e){e=d(e);if(!(e&&e.length)){return null}if(!c.isActionLogic(e)){return}var f=c.getInstance(e);!f&&(f=new c(e));f&&f.process();return f};c.random=true;c.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("StaticPanel",function(f,g){e.trigger("ShowPanel",[JC.f.scriptContent(g)])});e.on(c.Model.SHOW_PANEL,function(g,f){var h=JC.Dialog(f);h.on("confirm",function(){if(e._model.balCallback()&&e._model.balCallback().call(e._model.selector(),h,e)){return true}return false})});e.on("AjaxPanel",function(f,g,h){if(!(g&&h)){return}e._model.balRandom()&&(h=JC.f.addUrlParams(h,{rnd:new Date().getTime()}));d.get(h).done(function(i){switch(g){case c.Model.SHOW_PANEL:e.trigger("ShowPanel",[i]);break;case c.Model.DATA_PANEL:try{i=d.parseJSON(i)}catch(j){}if(i){if(i.errorno){e.trigger("ShowError",[i.errmsg||"操作失败, 请重试!",1])}else{e.trigger("ShowPanel",[i.data])}}break}})});e.on("Go",function(f,g){if(!g){return}e._model.balRandom()&&(g=JC.f.addUrlParams(g,{rnd:new Date().getTime()}));JC.f.reloadPage(g)});e.on("AjaxAction",function(f,g){if(!g){return}e._model.balRandom()&&(g=JC.f.addUrlParams(g,{rnd:new Date().getTime()}));d.get(g).done(function(h){try{h=d.parseJSON(h)}catch(i){}if(e._model.balCallback()){e._model.balCallback().call(e.selector(),h,e)}else{if(h&&"errorno" in h){if(h.errorno){e.trigger("ShowError",[h.errmsg||"操作失败, 请重试!",1])}else{e.trigger("ShowSuccess",[h.errmsg||"操作完成",function(){e._model.balDoneUrl()&&JC.f.reloadPage(e._model.balDoneUrl()||location.href)}])}}else{JC.Dialog.alert(h,1)}}})});e.on("ShowError",function(f,j,h,g){var i;switch(e._model.balErrorPopupType()){case"alert":i=JC.alert(j,e._model.selector(),h||1);g&&i.on("confirm",function(){g()});break;case"msgbox":i=JC.msgbox(j,e._model.selector(),h||1);g&&i.on("close",function(){g()});break;case"dialog.msgbox":i=JC.Dialog.msgbox(j,h||1);g&&i.on("close",function(){g()});break;default:i=JC.Dialog.alert(j,h||1);g&&i.on("confirm",function(){g()});break}});e.on("ShowConfirm",function(f,j,h,g){var i;switch(e._model.balConfirmPopupType()){case"dialog.confirm":i=JC.Dialog.confirm(j,h||1);g&&i.on("confirm",function(){g()});break;default:i=JC.confirm(j,e._model.selector(),h||1);g&&i.on("confirm",function(){g()});break}});e.on("ShowSuccess",function(f,i,g){var h;switch(e._model.balSuccessPopupType()){case"alert":h=JC.alert(i,e._model.selector());g&&h.on("confirm",function(){g()});break;case"dialog.alert":h=JC.Dialog.alert(i);g&&h.on("confirm",function(){g()});break;case"dialog.msgbox":h=JC.Dialog.msgbox(i);g&&h.on("close",function(){g()});break;default:h=JC.msgbox(i,e.selector());g&&h.on("close",function(){g()});break}})},process:function(){var e=this;JC.hideAllPopup(1);switch(e._model.baltype()){case"panel":if(e._model.is("[balPanelTpl]")){e.trigger("StaticPanel",[e._model.balPanelTpl()])}else{if(e._model.is("[balAjaxHtml]")){e.trigger("AjaxPanel",[c.Model.SHOW_PANEL,e._model.balAjaxHtml()])}else{if(e._model.is("[balAjaxData]")){e.trigger("AjaxPanel",[c.Model.DATA_PANEL,e._model.balAjaxData()])}}}break;case"link":if(e._model.is("[balConfirmMsg]")){e.trigger("ShowConfirm",[e._model.balConfirmMsg(),2,function(){e.trigger("Go",e._model.balUrl())}])}else{e.trigger("Go",e._model.balUrl())}break;case"ajaxaction":if(e._model.is("[balConfirmMsg]")){var f=JC.confirm(e._model.balConfirmMsg(),e.selector(),2);f.on("confirm",function(){e.trigger("AjaxAction",e._model.balUrl())})}else{e.trigger("AjaxAction",e._model.balUrl())}break}return this}};JC.BaseMVC.buildModel(c);c.Model.SHOW_PANEL="ShowPanel";c.Model.DATA_PANEL="DataPanel";c.Model.prototype={init:function(){},baltype:function(){return this.stringProp("baltype")},balPanelTpl:function(){var f,e=this;f=e.selectorProp("balPanelTpl")||f;return f},balCallback:function(){var f,e=this;f=e.callbackProp("balCallback")||f;return f},balAjaxHtml:function(){return this.selector().attr("balAjaxHtml")},balAjaxData:function(){return this.selector().attr("balAjaxData")},balRandom:function(){var f=c.random,e=this;e.is("[balRandom]")&&(f=JC.f.parseBool(e.stringProp("balRandom")));return f},balUrl:function(){var f="?",e=this;e.selector().prop("nodeName").toLowerCase()=="a"&&(f=e.selector().attr("href"));e.is("[balUrl]")&&(f=e.selector().attr("balUrl"));return JC.f.urlDetect(f)},balDoneUrl:function(){var e=this.attrProp("balDoneUrl");return JC.f.urlDetect(e)},balConfirmMsg:function(){var e="确定要执行吗?";e=this.selector().attr("balConfirmMsg")||e;return e},balErrorPopupType:function(){var e=this.stringProp("balErrorPopupType")||"dialog";return e},balSuccessPopupType:function(){var e=this.stringProp("balSuccessPopupType")||"msgbox";return e},balConfirmPopupType:function(){var e=this.stringProp("balConfirmPopupType")||"confirm";return e}};JC.BaseMVC.buildView(c);c.View.prototype={init:function(){}};JC.BaseMVC.build(c);d(document).ready(function(){d(document).delegate(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join(),"click",function(f){var e=d(this);c.process(e)&&(e.prop("nodeName").toLowerCase()=="a"&&f.preventDefault())})})}(jQuery));return Bizs.ActionLogic})}(typeof define==="function"&&define.amd?define:function(a,b){b&&b()},this));