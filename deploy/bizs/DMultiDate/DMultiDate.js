(function(b,a){b(["JC.BaseMVC","JC.Calendar"],function(){window.Bizs.DMultiDate=c;function c(d){if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.prototype={_beforeInit:function(){var d=this},_initHanlderEvent:function(){var d=this,l=c.Model._inscount++,k="Bizs.DMultiDate_update_start"+l,n="Bizs.DMultiDate_update_end"+l,m="Bizs.DMultiDate_show_start"+l,h="Bizs.DMultiDate_show_end"+l,g="Bizs.DMultiDate_hide_start"+l,p="Bizs.DMultiDate_hide_end"+l,j="Bizs.DMultiDate_layoutchange_start"+l,o="Bizs.DMultiDate_layoutchange_end"+l,f="parsedateweek",i="parsedatemonth",q="parsedateseason",e="parsedateyear";d._initDefaultData();d._model.calendarTypeEl().on("change",function(s,u){var r=$(this),t=r.val();if(t==="day"){t="date"}d._model.updatemddateElProp(t);if(u){return}setTimeout(function(){d._model.setmddate("");d._model.setHiddenStartdate("");d._model.setHiddenEnddate("");Calendar.pickDate(d._model.mddateEl().eq(0)[0])},10)});d._model.mddateEl().eq(0).attr("calendarupdate",k).attr("calendarshow",m).attr("calendarhide",g).attr("calendarlayoutchange",j);d._model.mddateEl().eq(1).attr("calendarupdate",n).attr("calendarshow",h).attr("calendarhide",p).attr("calendarlayoutchange",o);window[k]=function(s,v){var u=d._model.mddateEl(),t=d._model.calendarType(),w=s,y=u.eq(1).attr("maxvalue"),x,r=new Date();y&&(y=JC.f.dateDetect(y));switch(t){case"week":x=d._model.weekrange();x&&w.setDate(w.getDate()+(x-1)*7+6);break;case"month":x=d._model.monthrange();x&&w.setMonth(w.getMonth()+(x-1));break;case"season":x=d._model.seasonrange();x&&w.setMonth(w.getMonth()+(x)*3);break;case"year":x=d._model.yearrange();x&&w.setYear(w.getFullYear()+x);break;case"date":default:x=d._model.dayrange();x&&w.setDate(w.getDate()+x)}if(x){if(y.getTime()<=r.getTime()&&w.getTime()>r.getTime()){w=y}u.eq(1).attr("maxvalue",JC.f.formatISODate(w))}d._model.setHiddenStartdate(JC.f.formatISODate(s))};window[n]=function(r,s){var t=d._model.getRange(d._model.calendarType());if(t){}d._model.setHiddenEnddate(JC.f.formatISODate(r))};window[m]=function(){};window[h]=function(){};window[g]=function(){JC.Tips&&JC.Tips.hide();d._model.updateHiddenStartdate()};window[p]=function(){JC.Tips&&JC.Tips.hide();d._model.updateHiddenEnddate()};window[j]=function(){};window[o]=function(){};window[f]=function(r){r=$.trim(r||"");var z={start:null,end:null},w;if(r){w=r.replace(/[^\d]+/g,"");r=r.split("W");if(w.length===8){z.start=JC.f.parseISODate(w);z.end=z.start;return z}else{if(w.length===16){z.start=JC.f.parseISODate(w.slice(0,8));z.end=JC.f.parseISODate(w.slice(8,16));return z}}var u,x,t,v,s,y;u=parseInt(r[0],10);x=parseInt(r[1],10);t=JC.f.pureDate(new Date(r[0]),0,1);v=JC.f.pureDate(new Date(r[1]),0,1);s=s||JC.f.weekOfYear(r[0],JC.Calendar.weekDayOffset);$(s).each(function(B,A){if(A.week===x){z.start=new Date();z.end=new Date();z.start.setTime(A.start);z.end.setTime(A.end);return false}})}return z};window[i]=function(v){v=$.trim(v||"");var u={start:null,end:null},t;if(v){t=v.replace(/[^\d]+/g,"");v=v.replace(/[^\d]+/g,"");if(t.length===8){u.start=JC.f.parseISODate(t);u.end=u.start;return u}else{if(t.length===16){u.start=JC.f.parseISODate(t.slice(0,8));u.end=JC.f.parseISODate(t.slice(8,16));return u}}var s=v.slice(0,4),r=parseInt(v.slice(4,6),10)-1;u.start=new Date(s,r,1)}return u};window[q]=function(y){y=$.trim(y||"");var w={start:null,end:null},u;if(y){u=y.replace(/[^\d]+/g,"");y=y.split("Q");if(u.length===8){w.start=JC.f.parseISODate(u);w.end=w.start;return w}else{if(u.length===16){w.start=JC.f.parseISODate(u.slice(0,8));w.end=JC.f.parseISODate(u.slice(8,16));return w}}var t=parseInt(y[0],10),s=parseInt(y[1],10),v=JC.f.pureDate(new Date(y[0]),0,1),x=JC.f.pureDate(new Date(y[1]),0,1),r=JC.f.seasonOfYear(y[0]);$(r).each(function(A,z){if(z.season===s){w.start=new Date();w.end=new Date();w.start.setTime(z.start);w.end.setTime(z.end);return false}})}return w};window[e]=function(t){t=$.trim(t||"");var s={start:null,end:null},r;if(t){t=t.replace(/[^\d]+/g,"");r=t.slice(0,4);s.start=new Date(r,0,1)}if(!s.start){s.start=new Date();s.end=new Date()}return s};d._model.calendarTypeEl().trigger("change",[true])},_initDefaultData:function(){var d=this,f=d._model.urlStartdate(),g=d._model.urlEnddate(),e=d._model.urlCalendarType()||d._model.calendarType();d._model.updatemddateElProp(e);d._model.calendarTypeEl().val(e);setTimeout(function(){d._model.setmddate(f,g);d._model.setHiddenStartdate(f);d._model.setHiddenEnddate(g)},200)},_inited:function(){}};c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.isDMultiDate=function(d){var e;d&&(d=$(d)).length&&(e=d.is("[DMultiDatelayout]"));return e};BaseMVC.buildModel(c);c.Model._instanceName="DMultiDate";c.Model._inscount=1;c.Model.prototype={init:function(){},calendarTypeEl:function(){return this.selector().find(">select")},calendarType:function(){return this.calendarTypeEl().val()},mddateEl:function(){var d=this,e=d.attrProp("mddateEl")||".js_multidate";return JC.f.parentSelector(d.selector(),e)},setmddate:function(e,d){var f=this.mddateEl();f.eq(0).val(e);f.eq(1).val(d)},updatemddateElProp:function(e){var d=this,f=d.mddateEl();f.attr("multidate",e);if(e==="date"){f.removeAttr("dateparse").removeAttr("dateformat").removeAttr("fulldateformat")}else{f.eq(0).attr("fulldateformat","{0}");f.eq(1).attr("fulldateformat","{1}");f.attr("dateformat",d.dateformartType(e)).attr("dateparse","parsedate"+e)}},dateformartType:function(d){var e;switch(d){case"week":e="YYWWK";break;case"month":e="YY-MM";break;case"season":e="YYQYQ";break;case"year":e="YY";break;case"date":default:e=""}return e},hiddenStartdateEl:function(){var d=this,e=d.attrProp("mdstartdate")||".js_startdate";return JC.f.parentSelector(d.selector(),e)},hiddenEnddateEl:function(){var d=this,e=d.attrProp("mdenddate")||".js_enddate";return JC.f.parentSelector(d.selector(),e)},setHiddenStartdate:function(d){this.hiddenStartdateEl().val(d)},setHiddenEnddate:function(d){this.hiddenEnddateEl().val(d)},updateHiddenStartdate:function(){var d=this,e=d.mddateEl().eq(0).val();if(!e){d.setHiddenStartdate("");return}d.setHiddenStartdate(e)},updateHiddenEnddate:function(){var d=this,e=d.mddateEl().eq(1).val();if(!e){d.setHiddenEnddate("");return}d.setHiddenEnddate(e)},urlCalendarType:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.calendarTypeEl().attr("name")||"")||"").toLowerCase()},urlStartdate:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.hiddenStartdateEl().attr("name")||"")||"")},urlEnddate:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.hiddenEnddateEl().attr("name")||"")||"")},decodedata:function(d){d=d.replace(/[\+]/g," ");try{d=decodeURIComponent(d)}catch(e){}return d},getRange:function(e){var d=this,f;switch(e){case"week":f=d.weekrange();break;case"month":f=d.monthrange();break;case"season":f=d.seasonrange();break;case"year":f=d.yearrange();break;default:f=d.dayrange()}return f},dayrange:function(){return this.intProp("mddayrange")},weekrange:function(){return this.intProp("mdweekrange")},monthrange:function(){return this.intProp("mdmonthrange")},seasonrange:function(){return this.intProp("mdseasonrange")},yearrange:function(){return this.intProp("mdyearrange")}};BaseMVC.buildView(c);c.View.prototype={init:function(){return this}};BaseMVC.build(c,"Bizs");$(document).ready(function(){$(".js_autoDMultiDate").each(function(){new c($(this))})});return Bizs.DMultiDate})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));