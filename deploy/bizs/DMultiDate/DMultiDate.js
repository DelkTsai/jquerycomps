(function(b,a){b(["JC.BaseMVC","JC.Calendar"],function(){window.Bizs.DMultiDate=c;function c(d){if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.prototype={_beforeInit:function(){c.Model._defaultMaxvalue=this._model.mddateEl().eq(0).attr("maxvalue")||"";c.Model._defaultMinvalue=this._model.mddateEl().eq(1).attr("minvalue")||""},_initHanlderEvent:function(){var d=this,m=c.Model._inscount++,k="Bizs.DMultiDate_update_start"+m,p="Bizs.DMultiDate_update_end"+m,o="Bizs.DMultiDate_show_start"+m,h="Bizs.DMultiDate_show_end"+m,g="Bizs.DMultiDate_hide_start"+m,r="Bizs.DMultiDate_hide_end"+m,j="Bizs.DMultiDate_layoutchange_start"+m,q="Bizs.DMultiDate_layoutchange_end"+m,n="Bizs.DMultiDate_clear_start"+m,l="Bizs.DMultiDate_clear_end"+m,f="parsedateweek",i="parsedatemonth",s="parsedateseason",e="parsedateyear";d._initDefaultData();d._model.calendarTypeEl().on("change",function(u,w){var t=$(this),v=t.val();if(v==="day"){v="date"}d._model.updatemddateElProp(v);if(w){return}setTimeout(function(){d._model.setmddate("");d._model.setHiddenStartdate("");d._model.setHiddenEnddate("");Calendar.pickDate(d._model.mddateEl().eq(0)[0])},10)});d._model.mddateEl().eq(0).attr("calendarupdate",k).attr("calendarshow",o).attr("calendarhide",g).attr("calendarlayoutchange",j).attr("calendarclear",n);d._model.mddateEl().eq(1).attr("calendarupdate",p).attr("calendarshow",h).attr("calendarhide",r).attr("calendarlayoutchange",q).attr("calendarclear",l);window[k]=function(t,w){var v=d._model.mddateEl(),u=d._model.calendarType(),x=new Date(t.getFullYear(),t.getMonth(),t.getDate()),z=c.Model._defaultMaxvalue,y;t=JC.f.formatISODate(t);z&&(z=JC.f.dateDetect(z));switch(u){case"week":y=d._model.weekrange();y&&x.setDate(x.getDate()+(y-1)*7+6);break;case"month":y=d._model.monthrange();if(y){x.setMonth(x.getMonth()+(y-1));x.setDate(JC.f.maxDayOfMonth(x))}break;case"season":y=d._model.seasonrange();if(y){x.setMonth(x.getMonth()+(y-1)*3+2);x.setDate(JC.f.maxDayOfMonth(x))}break;case"year":y=d._model.yearrange();y&&x.setYear(x.getFullYear()+y-1);break;case"date":default:y=d._model.dayrange();y&&x.setDate(x.getDate()+y-1)}if(y){if(z&&(z.getTime()<=x.getTime())){x=z}v.eq(1).attr("maxvalue",JC.f.formatISODate(x)).attr("minvalue",t).attr("defaultdate",t)}d._model.setHiddenStartdate(t)};window[p]=function(u,x){var w=d._model.mddateEl(),v=d._model.calendarType(),y=new Date(u.getFullYear(),u.getMonth(),u.getDate()),A=c.Model._defaultMinvalue,z,t=new Date(u.getFullYear(),u.getMonth(),u.getDate());A&&(A=JC.f.dateDetect(A));switch(v){case"week":z=d._model.weekrange();z&&y.setDate(y.getDate()-(z-1)*7);break;case"month":z=d._model.monthrange();z&&(y.setMonth(y.getMonth()-(z-1))&&t.setDate(JC.f.maxDayOfMonth(u)));break;case"season":z=d._model.seasonrange();z&&(y.setMonth(y.getMonth()-(z-1)*3));break;case"year":z=d._model.yearrange();z&&(y.setYear(y.getFullYear()-z+1));break;case"date":default:z=d._model.dayrange();z&&y.setDate(y.getDate()-z+1)}if(z){if(A&&A.getTime()>y.getTime()){y=A}y=JC.f.formatISODate(y);w.eq(0).attr("maxvalue",JC.f.formatISODate(t)).attr("minvalue",y).attr("defaultdate",y)}d._model.setHiddenEnddate(JC.f.formatISODate(u))};window[o]=function(){var t=$("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))};window[h]=function(){var t=$("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))};window[g]=function(){JC.Tips&&JC.Tips.hide();d._model.updateHiddenStartdate()};window[r]=function(){JC.Tips&&JC.Tips.hide();d._model.updateHiddenEnddate()};window[j]=function(){JC.Tips&&JC.Tips.hide();var t=$("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))};window[q]=function(){JC.Tips&&JC.Tips.hide();var t=$("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))};window[n]=function(u,v){var t=d._model.mddateEl().eq(1),x=c.Model._defaultMaxvalue,w=c.Model._defaultMinvalue;if(x){t.attr("maxvalue",x).attr("defaultdate",x)}else{t.removeAttr("maxvalue").removeAttr("defaultdate")}if(w){t.attr("minvalue",w)}else{t.removeAttr("minvalue")}};window[l]=function(){var t=d._model.mddateEl().eq(0),v=c.Model._defaultMaxvalue,u=c.Model._defaultMinvalue;if(v){t.attr("maxvalue",v)}else{t.removeAttr("maxvalue")}if(u){t.attr("minvalue",u).attr("defaultdate",u)}else{t.removeAttr("minvalue").removeAttr("defaultdate")}};window[f]=function(t){t=$.trim(t||"");var B={start:null,end:null},y;if(t){y=t.replace(/[^\d]+/g,"");t=t.split("W");if(y.length===8){B.start=JC.f.parseISODate(y);B.end=B.start;return B}else{if(y.length===16){B.start=JC.f.parseISODate(y.slice(0,8));B.end=JC.f.parseISODate(y.slice(8,16));return B}}var w,z,v,x,u,A;w=parseInt(t[0],10);z=parseInt(t[1],10);v=JC.f.pureDate(new Date(t[0]),0,1);x=JC.f.pureDate(new Date(t[1]),0,1);u=u||JC.f.weekOfYear(t[0],JC.Calendar.weekDayOffset);$(u).each(function(D,C){if(C.week===z){B.start=new Date();B.end=new Date();B.start.setTime(C.start);B.end.setTime(C.end);return false}})}return B};window[i]=function(x){x=$.trim(x||"");var w={start:null,end:null},v;if(x){v=x.replace(/[^\d]+/g,"");x=x.replace(/[^\d]+/g,"");if(v.length===8){w.start=JC.f.parseISODate(v);w.end=w.start;return w}else{if(v.length===16){w.start=JC.f.parseISODate(v.slice(0,8));w.end=JC.f.parseISODate(v.slice(8,16));return w}}var u=x.slice(0,4),t=parseInt(x.slice(4,6),10)-1;w.start=new Date(u,t,1)}return w};window[s]=function(A){A=$.trim(A||"");var y={start:null,end:null},w;if(A){w=A.replace(/[^\d]+/g,"");A=A.split("Q");if(w.length===8){y.start=JC.f.parseISODate(w);y.end=y.start;return y}else{if(w.length===16){y.start=JC.f.parseISODate(w.slice(0,8));y.end=JC.f.parseISODate(w.slice(8,16));return y}}var v=parseInt(A[0],10),u=parseInt(A[1],10),x=JC.f.pureDate(new Date(A[0]),0,1),z=JC.f.pureDate(new Date(A[1]),0,1),t=JC.f.seasonOfYear(A[0]);$(t).each(function(C,B){if(B.season===u){y.start=new Date();y.end=new Date();y.start.setTime(B.start);y.end.setTime(B.end);return false}})}return y};window[e]=function(v){v=$.trim(v||"");var u={start:null,end:null},t;if(v){v=v.replace(/[^\d]+/g,"");t=v.slice(0,4);u.start=new Date(t,0,1)}if(!u.start){u.start=new Date();u.end=new Date()}return u};d._model.calendarTypeEl().trigger("change",[true])},_initDefaultData:function(){if(this._model.mcIgnoreUrlFill()){return}var d=this,f=d._model.urlStartdate()||d._model.mddateEl().eq(0).val(),g=d._model.urlEnddate()||d._model.mddateEl().eq(1).val(),e=d._model.urlCalendarType()||d._model.calendarType();d._model.updatemddateElProp(e);d._model.calendarTypeEl().val(e);setTimeout(function(){d._model.setmddate(f,g);d._model.setHiddenStartdate(f);d._model.setHiddenEnddate(g)},200)},_inited:function(){}};c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.isDMultiDate=function(d){var e;d&&(d=$(d)).length&&(e=d.is("[DMultiDatelayout]"));return e};BaseMVC.buildModel(c);c.Model._instanceName="DMultiDate";c.Model._inscount=1;c.Model._defaultMaxvalue="";c.Model._defaultMinvalue="";c.Model.prototype={init:function(){},calendarTypeEl:function(){return this.selector().find(">select")},mcIgnoreUrlFill:function(){return this.boolProp("mdIgnoreUrlFill")},calendarType:function(){return this.calendarTypeEl().val()},mddateEl:function(){var d=this,e=d.attrProp("mddateEl")||".js_multidate";return d.selector().find(e)},setmddate:function(e,d){var f=this.mddateEl();f.eq(0).val(e);f.eq(1).val(d)},updatemddateElProp:function(e){var d=this,f=d.mddateEl();f.attr("multidate",e);if(e==="date"){f.removeAttr("dateparse").removeAttr("dateformat").removeAttr("fulldateformat")}else{f.eq(0).attr("fulldateformat","{0}");f.eq(1).attr("fulldateformat","{1}");f.attr("dateformat",d.dateformartType(e)).attr("dateparse","parsedate"+e)}if(c.Model._defaultMinvalue){f.attr("minvalue",c.Model._defaultMinvalue)}else{f.removeAttr("minvalue")}if(c.Model._defaultMaxvalue){f.attr("maxvalue",c.Model._defaultMaxvalue).attr("defaultdate",c.Model._defaultMaxvalue)}else{f.removeAttr("maxvalue").removeAttr("defaultdate")}},dateformartType:function(d){var e;switch(d){case"week":e="YYWWK";break;case"month":e="YY-MM";break;case"season":e="YYQYQ";break;case"year":e="YY";break;case"date":default:e=""}return e},hiddenStartdateEl:function(){var d=this,e=d.attrProp("mdstartdate")||".js_startdate";return d.selector().find(e)},hiddenEnddateEl:function(){var d=this,e=d.attrProp("mdenddate")||".js_enddate";return d.selector().find(e)},setHiddenStartdate:function(d){this.hiddenStartdateEl().val(d)},setHiddenEnddate:function(d){this.hiddenEnddateEl().val(d)},updateHiddenStartdate:function(){var d=this,e=d.mddateEl().eq(0).val();if(!e){d.setHiddenStartdate("");return}d.setHiddenStartdate(e)},updateHiddenEnddate:function(){var d=this,e=d.mddateEl().eq(1).val();if(!e){d.setHiddenEnddate("");return}d.setHiddenEnddate(e)},urlCalendarType:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.calendarTypeEl().attr("name")||"")||"").toLowerCase()},urlStartdate:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.hiddenStartdateEl().attr("name")||"")||"")},urlEnddate:function(){var d=this;return d.decodedata(JC.f.getUrlParam(d.hiddenEnddateEl().attr("name")||"")||"")},decodedata:function(d){d=d.replace(/[\+]/g," ");try{d=decodeURIComponent(d)}catch(e){}return d},dayrange:function(){return this.intProp("mddayrange")},weekrange:function(){return this.intProp("mdweekrange")},monthrange:function(){return this.intProp("mdmonthrange")},seasonrange:function(){return this.intProp("mdseasonrange")},yearrange:function(){return this.intProp("mdyearrange")}};BaseMVC.buildView(c);c.View.prototype={init:function(){return this}};BaseMVC.build(c,"Bizs");$(document).ready(function(){JC.f.safeTimeout(function(){$(".js_autoDMultiDate").each(function(){new c($(this))})},null,"DMultiDatesdfasd",50)});return Bizs.DMultiDate})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));