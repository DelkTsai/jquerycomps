(function(b,a){b(["JC.BaseMVC","JC.Calendar"],function(){window.Bizs.DMultiDate=c;function c(d){if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var d=this;$([d._view,d._model]).on("BindEvent",function(e,g,f){d.on(g,f)});$([d._view,d._model]).on("TriggerEvent",function(e,g){var f=JC.f.sliceArgs(arguments);f.shift();f.shift();d.trigger(g,f)});d._initDefaultValue();d._initHandlerEvent();d.selector().trigger("change",[true])},_initDefaultValue:function(){var d=this,g=d._model.qstartdate(),h=d._model.qenddate(),f=d._model.mdCustomStartDate(),e=d._model.mdCustomEndDate();d._model.selector(d._model.qtype());d._model.mdstartdate(g);d._model.mdenddate(h);if(!d._model.mddate().attr("name")){if(g&&h){if(g==h){d._model.mddate(JC.f.formatISODate(JC.f.parseISODate(g)))}else{d._model.mddate(JC.f.printf("{0} è‡³ {1}",JC.f.formatISODate(JC.f.parseISODate(g)),JC.f.formatISODate(JC.f.parseISODate(h))))}}}else{d._model.mddate(d._model.qdate())}f&&f.length&&f.val(g?JC.f.formatISODate(JC.f.parseISODate(g)):g);e&&e.length&&e.val(h?JC.f.formatISODate(JC.f.parseISODate(h)):h)},_initHandlerEvent:function(){var d=this;d._model.selector().on("change",function(g,j){var e=$(this),i=e.val().trim().toLowerCase(),h=d._model.mdDefaultBox(),f=d._model.mdCustomBox();if(i=="custom"){if(h&&f&&h.length&&f.length){h.hide();h.find("input").prop("disabled",true);f.find("input").prop("disabled",false);f.show()}}else{if(h&&f&&h.length&&f.length){f.hide();f.find("input").prop("disabled",true);h.find("input").prop("disabled",false);h.show()}if(j){return}d._model.settype(i);setTimeout(function(){JC.Calendar.pickDate(d._model.mddate()[0]);d._model.mdstartdate("");d._model.mdenddate("")},10)}})},_inited:function(){}};c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.isDMultiDate=function(d){var e;d&&(d=$(d)).length&&(e=d.is("[DMultiDatelayout]"));return e};BaseMVC.buildModel(c);c.Model._instanceName="DMultiDate";c.Model._inscount=1;c.Model.prototype={init:function(){var d=this,e="Bizs.DMultiDate_Start"+(c.Model._inscount),g="Bizs.DMultiDate_End"+(c.Model._inscount),f="Bizs.DMultiDate_show_"+(c.Model._inscount),i="Bizs.DMultiDate_hide_"+(c.Model._inscount),k="Bizs.DMultiDate_hide_start_"+(c.Model._inscount),h="Bizs.DMultiDate_hide_end_"+(c.Model._inscount),j="Bizs.DMultiDate_layoutchange_"+(c.Model._inscount);c.Model._inscount++;window[e]=function(l,m,n){d.mdstartdate(JC.f.formatISODate(l,""));console.log("_startDate",l)};window[g]=function(l,m,n){d.mdenddate(JC.f.formatISODate(m,""));console.log("_endDate",m)};d.mddate().eq(0).attr("calendarupdate",e);d.mddate().eq(1).attr("calendarupdate",g);console.log("xxx");window[f]=function(){var l=$("body > div.UXCCalendar:visible");l.length&&JC.Tips&&JC.Tips.init(l.find("[title]"))};d.mddate().attr("calendarshow",f);window[k]=function(){JC.Tips&&JC.Tips.hide();d.updateHiddenDate()};window[h]=function(){JC.Tips&&JC.Tips.hide();d.updateHiddenDate()};d.mddate().eq(0).attr("calendarhide",k);d.mddate().eq(1).attr("calendarhide",h);window[j]=function(){JC.Tips&&JC.Tips.hide();var l=$("body > div.UXCCalendar:visible");l.length&&JC.Tips&&JC.Tips.init(l.find("[title]"))};d.mddate().attr("calendarlayoutchange",j);return d},mdDefaultBox:function(){return this.selectorProp("mdDefaultBox")},mdCustomBox:function(){return this.selectorProp("mdCustomBox")},mdCustomStartDate:function(){return this.selectorProp("mdCustomStartDate")},mdCustomEndDate:function(){return this.selectorProp("mdCustomEndDate")},selector:function(d){typeof d!="undefined"&&this.hastype(this.qtype())&&this._selector.val(d)&&this.settype(d);return this._selector},mddateBox:function(d){var e=JC.f.parentSelector(this.selector(),this.selector().attr("mddatebox"));return e},mddate:function(d){var e=this.mddateBox().find(this.selector().attr("mddate"));typeof d!="undefined"&&e.val(d);return e},mdstartdate:function(d){var e=JC.f.parentSelector(this.selector(),this.selector().attr("mdstartdate"));typeof d!="undefined"&&e.val(d.replace(/[^\d]/g,""));return e},mdenddate:function(d){var e=JC.f.parentSelector(this.selector(),this.selector().attr("mdenddate"));typeof d!="undefined"&&e.val(d.replace(/[^\d]/g,""));return e},qtype:function(){return this.decodedata(JC.f.getUrlParam(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(JC.f.getUrlParam(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(JC.f.getUrlParam(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(JC.f.getUrlParam(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(d){var e=false;this.selector().find("> option").each(function(){if($(this).val().trim()==d){e=true;return false}});return e},settype:function(d){var e=this.mddate();switch(d){case"date":this.selector().attr("mddatebox","/.js_multidateDateBox");break;case"week":this.selector().attr("mddatebox","/.js_multidateWeekBox");break;case"season":this.selector().attr("mddatebox","/.js_multidateSeasonBox");break;case"month":this.selector().attr("mddatebox","/.js_multidateMonthBox");break}this.mddateBox().css("display","inline-block").siblings(".js_multidateBox").hide();e.val("")},decodedata:function(d){d=d.replace(/[\+]/g," ");try{d=decodeURIComponent(d)}catch(e){}return d},updateHiddenDate:function(){var d=this;d.mddate().each(function(g){var f=$(this),e=$.trim(f.val());if(!e){g===0&&d.mdstartdate("");g===1&&d.mdenddate("");return}e=e.replace(/[^\d]+/g,"");if(g===0){d.mdstartdate(e)}if(g===2){d.mdenddate(e)}})}};BaseMVC.buildView(c);c.View.prototype={init:function(){return this}};BaseMVC.build(c,"Bizs");$(document).ready(function(){$("select.js_autoDMultiDate").each(function(){new c($(this))})});return Bizs.DMultiDate})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));