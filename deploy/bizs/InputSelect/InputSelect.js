(function(b,a){b(["JC.BaseMVC"],function(){Bizs.InputSelect=d;JC.f.addAutoInit&&JC.f.addAutoInit(d);function d(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,d)){return JC.BaseMVC.getInstance(e,d)}JC.BaseMVC.getInstance(e,d,this);this._model=new d.Model(e);this._view=new d.View(this._model);this._init()}d.init=function(e){var f=[];e=$(e||document);if(e.length){if(e.hasClass("js_bizInputSelect")){f.push(new d(e))}else{e.find(".js_bizInputSelect").each(function(){f.push(new d(this))})}}return f};BaseMVC.build(d);JC.f.extendObject(d.prototype,{_beforeInit:function(){var e=this;e._model.selector().addClass("IPTSEL-BOX").append('<span class="IPTSEL-ARROW"></span>');if(e._model.iptselbox().length){e._model.iptselbox().addClass("IPTSEL-DROPDOWN");e._model.iptselboxheight()&&e._model.iptselbox().css({height:e._model.iptselboxheight()+"px","overflow-y":"auto"})}e._model.iptseloption().length&&e._model.iptseloption().addClass("IPTSEL-ITEM")},_initHanlderEvent:function(){var e=this;e._model.selector().data("visible",0);e._model.iptselipt().on("keyup",function(h,k){var f=$(this),j=f.val().trim(),i=h.keyCode,g=f.data("IgnoreTime");if(i){switch(i){case 38:case 40:h.preventDefault();case 37:case 39:return;case 27:e._hide();return}}});e._model.iptselipt().on("click",function(){if(e.selector().data("visible")){e._hide()}else{return}});e._model.iptselarrow().on("click",function(f){f.stopPropagation();if(e._model.dataurl()&&!e._model.dataready){e._model.ajaxdata()}e[e._model.selector().data("visible")?"_hide":"_show"]()});e._model.iptselipt().on("keydown",function(l){var f=l.keyCode,k=$(this),m,j,g=e._model.iptseloption(),i;f==38&&(j=true);switch(f){case 38:case 40:if(e._model.dataurl()){e._model.iptselarrow().trigger("click")}e._show();m=e._model.nextIndex(j);if(m>=0&&m<g.length){l.preventDefault();i=$(g[m]);e._model.selectedIdentifier(i);e._model.iptselipt().val(e._model.getKeyword(i));e._model.iptselhideipt().val(i.data("value")||"");return}break;case 9:e._hide();return;case 13:var h;if(e._model.iptselbox().is(":visible")&&(h=e._model.iptselbox().find("li.active"))&&h.length){e.trigger("iptselitemselected",[h,e._model.getKeyword(h)])}e._hide();e._model.iptselprevententer()&&l.preventDefault();break}});e._model.iptselbox().on("mousedown",function(f){f.stopPropagation()});e._model.iptselbox().delegate(".IPTSEL-ITEM","mouseenter",function(g){var f=$(this);e._model.selectedIdentifier(f,true)}).delegate(".IPTSEL-ITEM","mouseleave",function(g){var f=$(this);f.removeClass("active")});e._model.iptselbox().delegate(".IPTSEL-ITEM","click",function(i){var h=$(this),g=h.data("label"),f=h.data("value")||"";e._model.iptselipt().val(g);e._model.iptselhideipt().val(f);e._hide();e.trigger("iptselitemselected",[h,g,f]);JC.f.safeTimeout(function(){e._model.iptselipt().trigger("blur")},null,"IptSelItemClick",200)});e.on("iptselitemselected",function(i,h,g,f){e._model.iptselitemselectedcallback()&&e._model.iptselitemselectedcallback().call(e,g,f)});$(document).on("mousedown",function(){e._hide()})},_inited:function(){},_show:function(){var e=this;e._view.show();e._model.selector().data("visible",1);return this},_hide:function(){var e=this;e._view.hide();e._model.selector().data("visible",0);return this}});d.Model._instanceName="InputSelectIns";JC.f.extendObject(d.Model.prototype,{init:function(){},iptselipt:function(){var e=JC.f.parentSelector(this.selector(),this.attrProp("iptselipt"));e.length&&e.addClass("IPTSEL-INPUT");return e},iptselhideipt:function(){var e=JC.f.parentSelector(this.selector(),this.attrProp("iptselhideipt"));e.length&&e.addClass("IPTSEL-HIDE");return e},iptselarrow:function(){return this.selector().find(".IPTSEL-ARROW")},iptseloption:function(){var e=this.selector();return JC.f.parentSelector(e,this.attrProp("iptseloption"))},iptselbox:function(){var f=this,e=f.attrProp("iptseldatabox");return JC.f.parentSelector(f.selector(),e)},iptselboxheight:function(){return this.intProp("iptselboxheight")},iptselprevententer:function(){var f=true,e=this.selector();e.is("[iptselprevententer]")&&(f=this.boolProp("iptselprevententer"));return f},dataurl:function(){return this.attrProp("iptseldataurl")},ajaxdata:function(){var f=this,e=this.dataurl();$.get(e).done(function(k){k=$.parseJSON(k);var h="<ul>",m='<li data-label="{0}" data-keyindex="{1}" data-value="{2}" class="IPTSEL-ITEM">{0}</li>',j=0,g;if(k.errorno){JC.f.alert("操作失败",2)}else{g=k.data.length;if(g===0){h="<li>暂无数据</li>"}else{for(j=0;j<g;j++){h+=JC.f.printf(m,k.data[j].label,j,k.data[j].value||"")}}h+="</ul>";f.iptselbox().html(h);f.dataready=1}})},nextIndex:function(g){var h=this,f=h.iptseloption(),e=f.length;if(g){if(h.keyindex<=0){h.keyindex=e-1}else{h.keyindex--}}else{if(h.keyindex>=e-1){h.keyindex=0}else{h.keyindex++}}return h.keyindex},selectedIdentifier:function(f,e){this.preSelected&&this.preSelected.removeClass("active");f.addClass("active");e&&(this.keyindex=parseInt(f.data("keyindex")));this.preSelected=f},getKeyword:function(e){var f=e.data("label");try{f=decodeURIComponent(f)}catch(g){}return f},keyindex:-1,dataready:0,iptselitemselectedcallback:function(){var e=this;e.selector().is("[iptselitemselectedcallback]")&&(e._iptselselectedcallback=e.selector().attr("iptselitemselectedcallback"));return e._iptselselectedcallback?window[e._iptselselectedcallback]:null}});JC.f.extendObject(d.View.prototype,{init:function(){},show:function(){var e=this;e._model.iptselbox().show().css("z-index",window.ZINDEX_COUNT++)},hide:function(){var e=this;e._model.iptselbox().hide()}});var c=$(document);c.ready(function(){var e=0;d.autoInit&&(e=d.init())});return Bizs.InputSelect})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));