(function(b,a){b(["JC.BaseMVC","JC.Calendar"],function(){(function(c){window.Bizs=window.Bizs||{};window.Bizs.MultiDate=d;function d(e){if(d.getInstance(e)){return d.getInstance(e)}d.getInstance(e,this);this._model=new d.Model(e);this._view=new d.View(this._model);this._init()}d.prototype={_beforeInit:function(){JC.log("MultiDate _beforeInit",new Date().getTime())},_initHanlderEvent:function(){var e=this;c([e._view,e._model]).on("BindEvent",function(f,h,g){e.on(h,g)});c([e._view,e._model]).on("TriggerEvent",function(f,h){var g=JC.f.sliceArgs(arguments);g.shift();g.shift();e.trigger(h,g)});e._initDefaultValue();e._initHandlerEvent();e.selector().trigger("change",[true])},_initDefaultValue:function(){var e=this,h=e._model.qstartdate(),i=e._model.qenddate(),g=e._model.mdCustomStartDate(),f=e._model.mdCustomEndDate();e._model.selector(e._model.qtype());e._model.mdstartdate(h);e._model.mdenddate(i);if(!e._model.mddate().attr("name")){if(h&&i){if(h==i){e._model.mddate(JC.f.formatISODate(JC.f.parseISODate(h)))}else{e._model.mddate(JC.f.printf("{0} è‡³ {1}",JC.f.formatISODate(JC.f.parseISODate(h)),JC.f.formatISODate(JC.f.parseISODate(i))))}}}else{e._model.mddate(e._model.qdate())}g&&g.length&&g.val(h?JC.f.formatISODate(JC.f.parseISODate(h)):h);f&&f.length&&f.val(i?JC.f.formatISODate(JC.f.parseISODate(i)):i)},_initHandlerEvent:function(){var e=this;e._model.selector().on("change",function(h,k){var f=c(this),j=f.val().trim().toLowerCase(),i=e._model.mdDefaultBox(),g=e._model.mdCustomBox();JC.log("type:",j);if(j=="custom"){if(i&&g&&i.length&&g.length){i.hide();i.find("input").prop("disabled",true);g.find("input").prop("disabled",false);g.show()}}else{if(i&&g&&i.length&&g.length){g.hide();g.find("input").prop("disabled",true);i.find("input").prop("disabled",false);i.show()}if(k){return}e._model.settype(j);setTimeout(function(){JC.Calendar.pickDate(e._model.mddate()[0]);e._model.mdstartdate("");e._model.mdenddate("")},10)}})},_inited:function(){JC.log("MultiDate _inited",new Date().getTime())}};d.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=c(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data(d.Model._instanceName,f);return e.data(d.Model._instanceName)};d.isMultiDate=function(e){var f;e&&(e=c(e)).length&&(f=e.is("[MultiDatelayout]"));return f};BaseMVC.buildModel(d);d.Model._instanceName="MultiDate";d.Model._inscount=1;d.Model.prototype={init:function(){var e=this,h="Bizs.MultiDate_"+(d.Model._inscount),f="Bizs.MultiDate_show_"+(d.Model._inscount),g="Bizs.MultiDate_hide_"+(d.Model._inscount),i="Bizs.MultiDate_layoutchange_"+(d.Model._inscount);d.Model._inscount++;window[h]=function(j,k,l){e.mdstartdate(JC.f.formatISODate(j,""));e.mdenddate(JC.f.formatISODate(k,""))};e.mddate().attr("calendarupdate",h);window[f]=function(){var j=c("body > div.UXCCalendar:visible");j.length&&JC.Tips&&JC.Tips.init(j.find("[title]"))};e.mddate().attr("calendarshow",f);window[g]=function(){JC.Tips&&JC.Tips.hide();e.updateHiddenDate()};e.mddate().attr("calendarhide",g);window[i]=function(){JC.Tips&&JC.Tips.hide();var j=c("body > div.UXCCalendar:visible");j.length&&JC.Tips&&JC.Tips.init(j.find("[title]"))};e.mddate().attr("calendarlayoutchange",i);return e},mdDefaultBox:function(){return this.selectorProp("mdDefaultBox")},mdCustomBox:function(){return this.selectorProp("mdCustomBox")},mdCustomStartDate:function(){return this.selectorProp("mdCustomStartDate")},mdCustomEndDate:function(){return this.selectorProp("mdCustomEndDate")},selector:function(e){typeof e!="undefined"&&this.hastype(this.qtype())&&this._selector.val(e)&&this.settype(e);return this._selector},mddate:function(e){var f=JC.f.parentSelector(this.selector(),this.selector().attr("mddate"));typeof e!="undefined"&&f.val(e);return f},mdstartdate:function(e){var f=JC.f.parentSelector(this.selector(),this.selector().attr("mdstartdate"));typeof e!="undefined"&&f.val(e.replace(/[^\d]/g,""));return f},mdenddate:function(e){var f=JC.f.parentSelector(this.selector(),this.selector().attr("mdenddate"));typeof e!="undefined"&&f.val(e.replace(/[^\d]/g,""));return f},qtype:function(){return this.decodedata(JC.f.getUrlParam(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(JC.f.getUrlParam(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(JC.f.getUrlParam(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(JC.f.getUrlParam(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(e){var f=false;this.selector().find("> option").each(function(){if(c(this).val().trim()==e){f=true;return false}});return f},settype:function(e){this.mddate().val("").attr("multidate",e)},decodedata:function(e){e=e.replace(/[\+]/g," ");try{e=decodeURIComponent(e)}catch(f){}return e},updateHiddenDate:function(){var e=c.trim(this.mddate().val());if(!e){this.mdstartdate("");this.mdenddate("");return}e=e.replace(/[^\d]+/g,"");if(e.length==8){this.mdstartdate(e);this.mdenddate(e)}if(e.length==16){this.mdstartdate(e.slice(0,8));this.mdenddate(e.slice(8))}}};BaseMVC.buildView(d);d.View.prototype={init:function(){return this},hide:function(){},show:function(){}};BaseMVC.build(d,"Bizs");c(document).ready(function(){c("select.js_autoMultidate").each(function(){new d(c(this))})})}(jQuery));return Bizs.MultiDate})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));