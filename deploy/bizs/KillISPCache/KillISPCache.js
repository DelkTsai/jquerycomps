(function(b,a){b(["JC.BaseMVC"],function(){Bizs.KillISPCache=c;function c(d){if(c._instance){return c._instance}this._model=new c.Model(d);this._init()}c.prototype={_beforeInit:function(){JC.log("KillISPCache._beforeInit",new Date().getTime());this._model.processAjax()},process:function(e,f){e&&(e=$(e));if(!(e&&e.length)){return}var d=this;d._model.ignoreSameLinkText(f);d._model.selector(e);d._model.processLink();d._model.processForm();return this},ignoreUrl:function(d){return this._model.ignoreUrl(d)},ignoreSelector:function(d){return this._model.ignoreSelector(d)}};c.getInstance=function(){!c._instance&&(c._instance=new c());return c._instance};c.ignoreSameLinkText=true;c.randName="";c.ignoreUrl=function(d){return c.getInstance().ignoreUrl(d)};c.ignoreSelector=function(d){return c.getInstance().ignoreSelector(d)};JC.BaseMVC.buildModel(c);c.Model.prototype={init:function(){this._postfix=JC.f.printf("{0}_{1}_",new Date().getTime().toString(),Math.round(Math.random()*100000));this._count=1;this._ignoreSameLinkText=true;this._randName="isp";this._ignoreUrl=[];this._ignoreSelector=[]},ignoreUrl:function(d){if(typeof d=="string"){d=d.split(",")}d&&d.length&&(this._ignoreUrl=this._ignoreUrl.concat(d));return this._ignoreUrl},ignoreSelector:function(d){if(typeof d=="string"){d=d.split(",")}d&&d.length&&(this._ignoreSelector=this._ignoreSelector.concat(d));return this._ignoreSelector},processLink:function(){var d=this;this.selector().find("a[href]").each(function(){var e=$(this),h=(e.attr("href")||"").trim(),i=e.html().trim();if(/javascript\:/.test(h)||/^[\s]*\#/.test(h)){return}if(d.ignoreSameLinkText()&&h.trim()==e.html().trim()){return}var g=d.ignoreSelector(),f=false;$.each(g,function(k,j){if(e.is(j)){f=true;return false}});if(f){return}h=JC.f.addUrlParams(h,d.keyVal());e.attr("href",h);e.html(i)})},processForm:function(){var d=this;this.selector().find("form").each(function(){var e=$(this),g=(e.prop("method")||"").toLowerCase();if(g=="post"){return}var h=d.ignoreSelector(),f=false;$.each(h,function(j,i){if(e.is(i)){f=true;return false}});if(f){return}if(!e.find("input[name="+d.randName()+"]").length){$('<input type="hidden" name="'+d.randName()+'" value="'+d.postfix()+'" >').appendTo(e)}})},processAjax:function(){var d=this;$(document).ajaxSend(function(e,g,i){if(i.type=="POST"){return}var h=d.ignoreUrl(),f=false;$.each(h,function(m,l){var j=l.length,k=i.url.slice(0,j);if(l.toLowerCase()==k.toLowerCase()){f=true}});!f&&(i.url=JC.f.addUrlParams(i.url,d.keyVal()))})},ignoreSameLinkText:function(d){typeof d!="undefined"&&(c.ignoreSameLinkText=d);return c.ignoreSameLinkText},postfix:function(){return this._postfix+(this._count++)},randName:function(){return c.randName||this._randName},keyVal:function(){var d={};d[this.randName()]=this.postfix();return d}};JC.BaseMVC.build(c,"Bizs");$(document).ready(function(){setTimeout(function(){c.autoInit&&c.getInstance().process($(document))},100)});return Bizs.KillISPCache})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));