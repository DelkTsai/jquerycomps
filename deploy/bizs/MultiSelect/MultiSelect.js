(function(b,a){b(["JC.BaseMVC"],function(){Bizs.MultiSelect=c;function c(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,c)){return JC.BaseMVC.getInstance(e,c)}JC.BaseMVC.getInstance(e,c,this);this._model=new c.Model(e);this._view=new c.View(this._model);this._init()}c.init=function(e){var f=[];e=$(e||document);if(e&&e.length){if(e.hasClass("js_bizMultiSelect")){f.push(new c(e))}else{e.find("div.js_bizMultiSelect").each(function(){f.push(new c(this))})}}return f};c.dataFilter;BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){},_inited:function(){},show:function(){this._view.show();return this},hide:function(){this._view.hide();return this}});c.Model._instanceName="MultiSelectIns";c.Model.SHOW="SHOW";JC.f.extendObject(c.Model.prototype,{init:function(){},defaultLabel:function(){return this.attrProp("defaultLabel")},dataBindBox:function(){var e=this,f=e.attrProp("dataBindBox");return JC.f.parentSelector(e.selector(),f)},listBox:function(){return this.selector().find(".SELECTListBox")},ajaxUrl:function(){return this.attrProp("ajaxUrl")},ajaxData:function(){var e=this,h=e.ajaxUrl(),f=e.attrProp("dataname"),g=[],i=e.listBox();if(!h){return}g.push('<ul><li class="SELECTIgnore"><label><input type="checkbox" value="" checktype="all" checkfor="///input[type=checkbox]">全选</label></li>');$.get(h,function(n){n=e.dataFilter($.parseJSON(n));var m=0,j=n.length,o="",k;for(m=0;m<j;m++){k=n[m].isChecked?"checked":"";o='<li><label><input type="checkbox" value="'+n[m].id+'" name="'+f+'" '+k+' data-text="'+n[m].label+'" />'+n[m].label+"</label></li>";g.push(o)}g.push("</ul>");$(g.join(" ")).prependTo(i);JC.f.jcAutoInitComps(i)})},dataFilter:function(f){var e=this,g=e.callbackProp("dataFilter")||c.dataFilter;g&&(f=g(f));return f},dataList:function(){var e=this,f=e.listBox().find(">ul>li").not(".SELECTIgnore"),g=[];(f.length===0)&&e.ajaxUrl()&&e.ajaxData();f.each(function(){var h=$(this),j="",i=h.find("input");if(i.prop("checked")){j="<li>"+i.data("text")+"</li>";g.push(j)}});return g},bindData:function(){var e=this,h=e.dataBindBox(),i=e.dataList(),f=i.length,j=e.defaultLabel(),g="";h.html("<ul>"+i.join(" ")+"</ul>");g=f?"已选择"+f+"个"+j:"请选择"+j;e.selector().find(".SELECTLabel").html(g)}});JC.f.extendObject(c.View.prototype,{init:function(){},show:function(){var e=this,f=e._model.selector();JC.f.safeTimeout(setTimeout(function(){},50),f,"SELECTListBoxUi");f.addClass("SELECTBOX-active");e._model.listBox().show().css({"z-index":ZINDEX_COUNT++})},hide:function(){var e=this,f=e._model.selector();e._model.listBox().hide();JC.f.safeTimeout(setTimeout(function(){f.removeClass("SELECTBOX-active");e._model.bindData()},50),f,"SELECTListBoxUi")}});var d=$(document);d.ready(function(){var e=0;c.autoInit&&(e=c.init())});d.delegate(".js_bizMultiSelect","click",function(){var e=$(this),f;JC.f.safeTimeout(function(){f=JC.BaseMVC.getInstance(e,c);!f&&(f=new c(e));f.show()},e,"bizMultiSelectClick",50)});d.on("mousedown",function(){JC.f.safeTimeout(function(){$(".js_bizMultiSelect").each(function(){var e=JC.BaseMVC.getInstance($(this),c);e&&e.hide()})},null,"CLOSE_MULTI_SELECT")});d.delegate(".SELECTCloseBtn","mousedown",function(){var e=JC.BaseMVC.getInstance(JC.f.getJqParent($(this),".js_bizMultiSelect"),c);e&&e.hide()});d.delegate(".js_bizMultiSelect>.SELECTListBox","mousedown",function(e){e.stopPropagation()});return Bizs.MultiSelect})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));