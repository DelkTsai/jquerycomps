(function(b,a){b(["JC.AutoComplete","JC.AutoChecked","JC.Placeholder","JC.Panel"],function(){var d=$(document),c=$(window);JC.use&&(!JC.AutoComplete&&JC.use("JC.AutoComplete"),!JC.Placeholder&&JC.use("JC.Placeholder"),!JC.Panel&&JC.use("JC.Panel"));Bizs.MultiAutoComplete=e;function e(f){f&&(f=$(f));if(JC.BaseMVC.getInstance(f,e)){return JC.BaseMVC.getInstance(f,e)}JC.BaseMVC.getInstance(f,e,this);this._model=new e.Model(f);this._view=new e.View(this._model);this._init();JC.log(e.Model._instanceName,"all inited",new Date().getTime())}Bizs.MultiAutoComplete.insCount=1;Bizs.MultiAutoComplete.AJAX_CACHE={};e.init=function(f){var g=[];f=$(f||document);if(f.length){if(f.is("[defaultMultiAutomComplete]")){g.push(new e(f))}else{f.find("input[defaultMultiAutomComplete]").each(function(){g.push(new e(this))})}}return g};e.ajaxRandom=true;JC.BaseMVC.build(e);JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var f=this;f.on("inited",function(){f.trigger("init_relationship");f.trigger("fix_id_callback");f.trigger("init_autoComplete");f.trigger("update_selector",[f.selector()]);f.trigger("init_user_input");f._model.ready(true);f.trigger("inited_done")});f.on("init_relationship",function(g){f._model.init_relationship()});f.on("fix_id_callback",function(g){f._model.fixIdCallback()});f.on("init_autoComplete",function(g){f._model.each(function(h){var i;h.hasClass("js_compAutoComplete")&&!(i=JC.BaseMVC.getInstance(h,JC.AutoComplete))&&(i=new JC.AutoComplete(h));i.on("after_inited",function(j){f.trigger("init_checked_status",[i])})})});f.on("update_selector",function(i,g,h){if(!(g&&g.length)){return}!h&&f.trigger("clear_selector",[g]);f.trigger("ajax_data",[g])});f.on("clear_selector",function(h,g){if(!f._model.ready()){return}f._model.clearData(g)});f.on("ajax_data",function(h,g,i){if(!g){return}f._model.ajax_data(g,i)});f.on("ajax_done",function(h,j,g,k,i){if(j&&j.errorno==0){f.trigger("update",[j,g,k,i])}else{f.trigger("ajax_error",[j,g,k])}});f.on("update",function(i,l,g,m,k){var j=JC.BaseMVC.getInstance(g,JC.AutoComplete),n,h;if(!j){return}h=f._model.macDefaultValue(g)||undefined;j.update(l.data,h);n=f._model.nextSelector(g);if(n&&n.length&&l.data.length){f.trigger("update_selector",[n,true])}else{!k&&f.trigger("all_updated");if(k){j._model.layoutPopup().find("span.cacMultiSelectBarTplLabel").hide()}else{j._model.layoutPopup().find("span.cacMultiSelectBarTplLabel").show()}}});f.on("all_updated",function(){f._model.checkLast()});f.on("init_user_input",function(g){f._model.each(function(h){h.on("focus",function(i){h.data("old_value",h.val())});h.on("blur",function(i){JC.f.safeTimeout(function(){var j=h.data("old_value"),l=h.val(),k;if(j!=l){k=f._model.nextSelector(h);k&&k.length&&f.trigger("update_selector",[k])}},h,"forMultiAutoCompleteSelectorBlur",200)})})});f.on("inited_done",function(){f._model.each(function(g){f.trigger("init_addtionBox",[g])})});f.on("init_addtionBox",function(h,g){var j=f._model.macAddtionBox(g),k,i;if(!(j&&j.length)){return}k=j.find(".js_macAddtionBoxList");if(!(k&&k.length)){return}i=JC.BaseMVC.getInstance(g,JC.AutoComplete);j.delegate(".js_macClearAddtionList","click",function(l){JC.confirm("是否清空内容",this,2,function(m){k.html("");j.hide()})});j.delegate(".js_macAddtionBoxItem","click",function(m){var l=$(this),n=l.attr("data-id"),o=l.attr("data-label");f._model.macAddtionItemRemoveCallback(g)&&f._model.macAddtionItemRemoveCallback(g).call(f,l,n,o,k,j);l.remove();f.trigger("update_list_box_status",[i,true])});f.trigger("update_list_box_status",[i,true])});f.on("update_list_box_status",function(h,i,j){var g=i.selector(),k=f._model.macAddtionBox(g),m;if(!(k&&k.length)){return}m=k.find(".js_macAddtionBoxList");if(!(m&&m.length)){return}var l=m.find(f._model.macAddtionBoxItemSelector(g));l.length?k.show():k.hide();!j&&f.trigger("update_checked_status",[i,true])});f.on("init_checked_status",function(h,i){var g=i.selector();if(g.is("macAddtionBox")){return}i.on("after_popup_show",function(j){});i.on("build_data",function(){f.trigger("update_checked_show_status",[i]);f.trigger("fixed_checkAll_status",[i])});i._model.layoutPopup().delegate("input[schecktype=all]","change",function(k){var j=$(this);i._model.layoutPopup().find("input[schecktype=item]").prop("checked",j.prop("checked"));f.trigger("update_checked_status",[i]);f.trigger("fixed_checkAll_status",[i])});g.on("cacItemClickHanlder",function(k,j,l){JC.f.safeTimeout(function(){var n=j.find("input[schecktype=item]"),m;if(!n.length){return}m={item:n};f.trigger("update_list_item",[n,l]);f.trigger("item_checked",[m,m.item.prop("checked")]);f.trigger("fixed_checkAll_status",[l])},l,"adfasdfasdf",50)})});f.on("fixed_checkAll_status",function(g,i){var h=true;i._model.layoutPopup().find("input[schecktype=item]").each(function(k){var j=$(this);if(!j.prop("checked")){h=false;return false}});i._model.layoutPopup().find("input[schecktype=all]").prop("checked",h)});f.on("update_list_item",function(h,o,k){var l={item:o};if(!l.item.length){return}var j=k.selector(),m=f._model.macAddtionBox(j),n,i,g;if(!(m&&m.length)){return}n=m.find(".js_macAddtionBoxList");if(!(n&&n.length)){return}if(f._model.macAddtionBoxWithId(j)){i=$(JC.f.printf("#macAddtionBoxItemId_{0}_{1}",f._model.insCount(),l.item.val()))}else{i=[];n.find(f._model.macAddtionBoxItemSelector(k.selector())+"[data-id]").each(function(){if($(this).data("id")==l.item.val()){i.push(this)}});i=jQuery(i)}if(l.item.prop("checked")){if(!i.length){f.trigger("add_list_item",[l.item,k,m,n]);g=true}}else{i.length&&i.remove()}JC.f.safeTimeout(function(){g&&f.trigger("sort_list_item",[n,k])},f,"SORT_LIST_ITEM",1000)});f.on("update_checked_status",function(g,n,p){if(!n){return}var k=n.selector(),o=f._model.macAddtionBox(k),q,n;if(!(o&&o.length)){return}q=o.find(".js_macAddtionBoxList");if(!(q&&q.length)){return}var j=n._model.layoutPopup().find("input[schecktype=item]"),l=n._model.layoutPopup().find("input[schecktype=all]"),i=q.find(f._model.macAddtionBoxItemSelector(n.selector()));if(!j.length){return}var m={},h={};i.each(function(){var r=$(this);m[r.attr("data-id")]={item:r}});j.each(function(s){var r=$(this),t;f.trigger("update_list_item",[r,n])});!p&&f.trigger("update_list_box_status",[n])});f.on("update_checked_show_status",function(g,m){if(!m){return}var k=m.selector(),n=f._model.macAddtionBox(k),p,m;if(!(n&&n.length)){return}p=n.find(".js_macAddtionBoxList");if(!(p&&p.length)){return}var j=m._model.layoutPopup().find("input[schecktype=item]"),l=m._model.layoutPopup().find("input[schecktype=all]"),i=p.find(f._model.macAddtionBoxItemSelector(m.selector()));if(!j.length){return}var o=true,h={};j.each(function(){var q=$(this);h[q.val()]={item:q}});i.each(function(){var q=$(this),r;if(q.attr("data-id") in h){f.trigger("item_checked",[h[q.attr("data-id")],true])}})});f.on("sort_list_item",function(g,j,h){var i=j.find(f._model.macAddtionBoxItemSelector(h.selector()));i.each(function(){var l=$(this),k=l.attr("data-id"),m=l.attr("data-label");i.each(function(){var p=$(this),n=p.attr("data-id"),o=p.attr("data-label");if(k==n){return}if(m.localeCompare(o)>0){p.after(l)}})})});f.on("add_list_item",function(g,p,j,k,o){var h=JC.f.getJqParent(p,"li"),i=j.selector(),l,n=f._model.macAddtionBoxItemTpl(i),m=h.attr("data-id"),q=h.attr("data-label");l=$(JC.f.printf(n,m,q,f._model.insCount()));l.appendTo(o);l.attr("data-id",m);l.attr("data-label",q);k.show()});f.on("item_checked",function(g,i,h){h?JC.f.getJqParent(i.item,"li").addClass("macDisable"):JC.f.getJqParent(i.item,"li").removeClass("macDisable");i.item.prop("checked",h)})},_inited:function(){this.trigger("inited")}});e.Model._instanceName="JCMultiAutoComplete";JC.f.extendObject(e.Model.prototype,{init:function(){this.insCount(e.insCount++)},insCount:function(f){typeof f!="undefined"&&(this._insCount=f);return this._insCount},macAddtionBoxWithId:function(f){return JC.f.parseBool(f.attr("macAddtionBoxWithId"))},macAddtionItemAddCallback:function(f){return this.callbackProp(f,"macAddtionItemAddCallback")},macAddtionItemRemoveCallback:function(f){return this.callbackProp(f,"macAddtionItemRemoveCallback")},macAddtionBoxItemSelector:function(f){return this.attrProp(f,"macAddtionBoxItemSelector")},macAddtionBoxItemTpl:function(f){return JC.f.scriptContent(this.selectorProp(f,"macAddtionBoxItemTpl"))},macAddtionBox:function(f){return this.selectorProp(f,"macAddtionBox")},ready:function(f){typeof f!="undefined"&&(this._ready=f);return this._ready},clearData:function(g){var f=this,i=f.nextSelector(g),h=JC.BaseMVC.getInstance(g,JC.AutoComplete);h&&h.clearAll();i&&f.clearData(i)},init_relationship:function(g,i){var f=this,g=g||f.selector(),h;i&&(g.data("prevSelector",i));if(g.is("[macTarget]")){h=JC.f.parentSelector(g,g.attr("macTarget"));if((h&&h.length)){g.data("nextSelector",h);f.init_relationship(h,g)}}else{f.lastSelecotr(g)}},fixIdCallback:function(){var f=this;f.each(function(g){!g.is("[macIdCallback]")&&g.attr("macIdCallback","MultiAutoCompleteIdCallback");!g.is("[cacDataFilter]")&&g.attr("cacDataFilter","MultiAutoCompleteDataFilter")})},firstSelector:function(){return this.selector()},lastSelecotr:function(f){f&&(this._lastSelecotr=f);return this._lastSelecotr},nextSelector:function(f){if(f){return $(f).data("nextSelector")}},prevSelector:function(f){if(f){return $(f).data("prevSelector")}},macAddtionUrl:function(f){return f.attr("macAddtionUrl")},checkLast:function(){var f=this,g=f.lastSelecotr(),i=f.prevSelector(g),h;while(i&&i.length){i.val()&&(h=true);if(h){break}i=f.prevSelector(i)}!h&&f.macAddtionUrl(g)&&f.ajax_data(g,true,f.macAddtionUrl(g))},ajax_data:function(h,j,l){var g=this,i=l||h.attr("macUrl"),k,f;if(!i){return}g.ajax_random(h)&&(i=JC.f.addUrlParams(i,{rnd:0}));k=g.prevSelector(h);if(k&&k.length){f=g.macDefaultValue(k);if(!f){!j&&g.trigger("all_updated");if(!j){return}}i=JC.f.printf(i,f)}if(i in e.AJAX_CACHE){g.trigger("ajax_done",[e.AJAX_CACHE[i],h,"",j])}else{$.get(i).done(function(n){var m=$.parseJSON(n);e.AJAX_CACHE[i]=m;g.trigger("ajax_done",[m,h,n,j])})}},ajax_random:function(f){var g=e.ajaxRandom;f.is("[macAjaxRandom]")&&(g=JC.f.parseBool(f.attr("macAjaxRandom")));return g},each:function(h,g){var f=this,i;g=g||f.selector();if(g&&g.length){h.call(f,g);i=f.nextSelector(g);i&&i.length&&f.each(h,i)}},macDefaultValue:function(f){var h=f.attr("macDefaultValue"),g;if(f.is("[cacIdSelector]")){g=JC.f.parentSelector(f,f.attr("cacIdSelector"));g&&g.length&&(h=g.val())}return h}});JC.f.extendObject(e.View.prototype,{init:function(){}});window.MultiAutoCompleteIdCallback=function(){};window.MultiAutoCompleteDataFilter=function(f){if(f.data&&f.data.length){f=f.data}$.each(f,function(h,g){g.length&&(f[h]={id:g[0],label:g[1]})});return f};d.ready(function(){JC.f.safeTimeout(function(){e.autoInit&&e.init()},null,"MultiAutoCompleteInit",5)});return Bizs.MultiAutoComplete})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));