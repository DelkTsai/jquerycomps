(function(b,a){b(["JC.BaseMVC","JC.Tree"],function(){Bizs.DropdownTree=c;function c(d){d&&(d=$(d));if(JC.BaseMVC.getInstance(d,c)){return JC.BaseMVC.getInstance(d,c)}JC.BaseMVC.getInstance(d,c,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init();JC.log(c.Model._instanceName,"all inited",new Date().getTime())}c.init=function(d){var e=[];d=$(d||document);if(d&&d.length){if(d.hasClass("js_bizDropdownTree")){e.push(new c(d))}else{d.find("div.js_bizDropdownTree").each(function(){e.push(new c(this))})}}return e};BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var d=this;d.on("DropdownTreeSelected",function(g,h,f,e){d.hide()});d.on("INITED",function(){d.update()});d.on("INITED_STATUS",function(e,g){var h=d._model.bdtInput().val().trim(),f;typeof g!="undefined"&&(h=g);d._model.bdtInput().is("[name]")&&(h=JC.f.getUrlParam(d._model.bdtInput().attr("name"))||h);h&&(f=d._model.treeIns().getItem(h));if(!(h&&f&&f.length)){if(d._model.is("[bdtDefaultLabel]")){d._model.bdtLabel().html(d._model.bdtDefaultLabel())}if(d._model.is("[bdtDefaultValue]")){d._model.bdtInput().val(d._model.bdtDefaultValue());h=d._model.bdtDefaultValue()}}h&&d._model.bdtLabel().html(d._model.treeIns().getItem(h).attr("dataname"))&&(d._model.bdtInput().val(h),d._model.treeIns().selectedItem(d._model.treeIns().getItem(h)))});d.on("CLEAR_STATUS",function(){d._model.bdtInput().val("");d._model.bdtLabel().html("")})},_inited:function(){this.trigger("INITED")},show:function(){this._view.show();return this},hide:function(){this._view.hide();return this},toggle:function(){this._view.toggle();return this},update:function(e,f){var d;e&&(d=true);d&&this.trigger("CLEAR_STATUS");this._view.update(e,d);this.trigger("INITED_STATUS",[f]);return this},clear:function(){var d=this;if(d._model.is("[bdtDefaultLabel]")){d._model.bdtLabel().html(d._model.bdtDefaultLabel())}else{d._model.bdtLabel().html("")}if(d._model.is("[bdtDefaultValue]")){d._model.bdtInput().val(d._model.bdtDefaultValue())}else{d._model.bdtInput().val("")}return this},label:function(){return this._model.bdtLabel()},val:function(d){typeof d!="undefined"&&this.getItem(d).trigger("click");return this._model.bdtInput().val()}});c.Model._instanceName="DropdownTreeIns";JC.f.extendObject(c.Model.prototype,{init:function(){},bdtData:function(){return this.windowProp("bdtData")||{}},bdtDefaultLabel:function(){return this.attrProp("bdtDefaultLabel")},bdtDefaultValue:function(){return this.attrProp("bdtDefaultValue")},bdtTreeBox:function(){var d=this.selector().find("> .bdtTreeBox");return d},bdtLabel:function(){var d=this.selector().find("> .bdtLabel");return d},bdtInput:function(){var d=this.selector().find("> .bdtInput");return d},treeIns:function(d){this._treeIns=d||JC.Tree.getInstance(this.bdtTreeBox());return this._treeIns}});JC.f.extendObject(c.View.prototype,{init:function(){},update:function(f,e){var d=this;f=f||d._model.bdtData();if(e){}if((!d._model.treeIns())||e){d._model.bdtTreeBox().html("");d._model.bdtTreeBox().data(JC.Tree.Model._instanceName,null);d._model.treeIns(new JC.Tree(d._model.bdtTreeBox(),f));d._model.treeIns().on("click",function(){var g=$(this),i=g.attr("dataid"),h=g.attr("dataname");d._model.bdtLabel().html(h);d._model.bdtInput().val(i);$(d).trigger("TriggerEvent",["DropdownTreeSelected",i,h,g])});d._model.treeIns().on("RenderLabel",function(h){var g=$(this);g.html(JC.f.printf('<a href="javascript:" dataid="{0}">{1}</a>',h[0],h[1]))});d._model.treeIns().init();d._model.treeIns().open()}},show:function(){var d=this;JC.f.safeTimeout(setTimeout(function(){},50),d._model.selector(),"DropdownTreeUi");d.updateZIndex();d._model.selector().addClass("bdtBox-active");d._model.bdtTreeBox().show();d._model.bdtTreeBox().css({"z-index":ZINDEX_COUNT++})},hide:function(){var d=this;d._model.bdtTreeBox().hide();JC.f.safeTimeout(setTimeout(function(){d._model.selector().removeClass("bdtBox-active")},50),d._model.selector(),"DropdownTreeUi")},toggle:function(){this.updateZIndex();if(this._model.bdtTreeBox().is(":visible")){this.hide()}else{this.show()}},updateZIndex:function(){this._model.bdtTreeBox().css({"z-index":ZINDEX_COUNT++})}});JC.Tree.dataFilter=JC.Tree.dataFilter||function(g){var h={};if(g&&g.root&&g.root.length>2){g.root.shift();h.root=g.root;h.data={};for(var d in g.data){h.data[d]=[];for(var f=0,e=g.data[d].length;f<e;f++){if(g.data[d][f].length<3){h.data[d].push(g.data[d][f]);continue}g.data[d][f].shift();h.data[d].push(g.data[d][f])}}}else{h=g}return h};$(document).ready(function(){var d=0;c.autoInit&&(d=c.init())});$(document).delegate("div.js_bizDropdownTree","click",function(e){var d=$(this),f;JC.f.safeTimeout(function(){f=JC.BaseMVC.getInstance(d,c);!f&&(f=new c(d));f.toggle();JC.log("div.js_bizDropdownTree click",new Date().getTime())},d,"DropdownTreeClick",50)});$(document).click(function(){$("div.js_bizDropdownTree").each(function(){var d=JC.BaseMVC.getInstance($(this),c);d&&d.hide()})});$(document).delegate("div.js_bizDropdownTree > .bdtTreeBox","click",function(d){d.stopPropagation()});return Bizs.DropdownTree})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));