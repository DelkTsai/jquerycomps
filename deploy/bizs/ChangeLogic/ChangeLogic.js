(function(b,a){b(["JC.BaseMVC"],function(){(function(d){window.Bizs=window.Bizs||{};window.Bizs.ChangeLogic=c;function c(g){if(c.getInstance(g)){return c.getInstance(g)}c.getInstance(g,this);JC.log("Bizs.ChangeLogic:",new Date().getTime());this._model=new f(g);this._view=new e(this._model);this._init()}c.prototype={_init:function(){var g=this,h;g._initHandlerEvent();d([g._view,g._model]).on("BindEvent",function(i,k,j){g.on(k,j)});d([g._view,g._model]).on("TriggerEvent",function(i,k){var j=JC.f.sliceArgs(arguments).slice(2);g.trigger(k,j)});g._model.init();g._view.init();g._model.bclTrigger().on("change",function(i){JC.log("bclTrigger change",new Date().getTime());g._view.change(this)});(h=g._model.bclTrigger(true))&&h.trigger("change");return g},_initHandlerEvent:function(){var g=this;g.on("DisableItem",function(i,h){g._model.bclDisableCallback()&&g._model.bclDisableCallback().call(g,h,g._model.selector())});g.on("EnableItem",function(i,h){g._model.bclEnableCallback()&&g._model.bclEnableCallback().call(g,h,g._model.selector())});g.on("ChangeDone",function(i,h){g._model.bclDoneCallback()&&g._model.bclDoneCallback().call(g,h,g._model.selector())})},selector:function(){return this._model.selector()},on:function(h,g){d(this).on(h,g);return this},trigger:function(h,g){d(this).trigger(h,g);return this}};c.getInstance=function(g,h){if(typeof g=="string"&&!/</.test(g)){g=d(g)}if(!(g&&g.length)||(typeof g=="string")){return}typeof h!="undefined"&&g.data("ChangeLogicIns",h);return g.data("ChangeLogicIns")};c.doneCallback=null;c.enableCallback=null;c.disableCallback=null;c.init=function(g){g=d(g||document);if(!(g&&g.length)){return}if(g.hasClass("js_bizChangeLogic")){new c(g)}else{g.find(["div.js_bizChangeLogic","dl.js_bizChangeLogic","table.js_bizChangeLogic"].join()).each(function(){new c(d(this))})}};function f(g){this._selector=g}f.prototype={init:function(){return this},selector:function(){return this._selector},bclTrigger:function(h){var g=this,j=JC.f.parentSelector(this.selector(),this.selector().attr("bclTrigger")),i;if(h){j.each(function(){i=d(this);if(i.prop("checked")||i.prop("selected")){j=i;return false}})}return j},bclDisableTarget:function(h){var g=this,j,i;g.selector().attr("bclDisableTarget")&&(j=JC.f.parentSelector(g.selector(),g.selector().attr("bclDisableTarget")));h&&(h=d(h)).length&&h.attr("bclTrigger")&&(j=JC.f.parentSelector(h,h.attr("bclDisableTarget")));return j},bclDisable:function(g){var i=false,h;g&&(g=d(g));if(!(g&&g.length)){return i}if(g.prop("nodeName").toLowerCase()=="select"){h=g.find(":selected");if(!h.length){return i}if(g.is("[bclDisable]")||h.is("[bclDisable]")){if(g.is("[bclDisable]")){i=g.attr("bclDisable")==g.val()}if(h.is("[bclDisable]")){i=JC.f.parseBool(h.attr("bclDisable"))}}}else{g.is("[bclDisable]")&&(i=JC.f.parseBool(g.attr("bclDisable")))}if(g.prop("nodeName").toLowerCase()=="input"&&g.attr("type").toLowerCase()=="checkbox"){i=!g.prop("checked")}return i},bclDisplay:function(g){var i=false,h;g&&(g=d(g));if(!(g&&g.length)){return i}if(g.prop("nodeName").toLowerCase()=="select"){h=g.find(":selected");if(!h.length){return i}if(!(g.is("[bclDisplay]")||h.is("[bclDisplay]"))){if(g.is("[bclDisable]")){i=g.attr("bclDisable")==g.val()}if(h.is("[bclDisable]")){i=JC.f.parseBool(h.attr("bclDisable"))}}else{if(g.is("[bclDisplay]")){i=g.attr("bclDisplay")==g.val()}if(h.is("[bclDisplay]")){i=JC.f.parseBool(h.attr("bclDisplay"))}}}else{if(!g.is("[bclDisplay]")){g.is("[bclDisable]")&&(i=!JC.f.parseBool(g.attr("bclDisable")))}else{g.is("[bclDisplay]")&&(i=JC.f.parseBool(g.attr("bclDisplay")))}}if(g.prop("nodeName").toLowerCase()=="input"&&g.attr("type").toLowerCase()=="checkbox"){i=g.prop("checked")}return i},bclHideTarget:function(h){var g=this,j,i;g.selector().attr("bclHideTarget")&&(j=JC.f.parentSelector(g.selector(),g.selector().attr("bclHideTarget")));h&&(h=d(h)).length&&h.attr("bclHideTarget")&&(j=JC.f.parentSelector(h,h.attr("bclHideTarget")));return j},bclHideToggle:function(g){var h;g&&g.is("[bclHideToggle]")&&(h=JC.f.parseBool(g.attr("bclHideToggle")));return h},bclDoneCallback:function(){var h=c.doneCallback,g;this.selector()&&(g=this.selector().attr("bclDoneCallback"))&&(g=window[g])&&(h=g);return h},bclEnableCallback:function(){var h=c.enableCallback,g;this.selector()&&(g=this.selector().attr("bclEnableCallback"))&&(g=window[g])&&(h=g);return h},bclDisableCallback:function(){var h=c.disableCallback,g;this.selector()&&(g=this.selector().attr("bclDisableCallback"))&&(g=window[g])&&(h=g);return h}};function e(g){this._model=g}e.prototype={init:function(){return this},change:function(h){h&&(h=d(h));if(!(h&&h.length&&h.is(":visible"))){return}var g=this,l=g._model.bclDisable(h),k=g._model.bclDisableTarget(h),m=g._model.bclDisplay(h),j=g._model.bclHideTarget(h);if(h.is("[bclHideTargetSub]")){var i=JC.f.parentSelector(h,h.attr("bclHideTargetSub"));if(i&&i.length){if(h.prop("checked")){i.show()}else{i.hide()}}}if(k&&k.length){k.each(function(){var o=d(this);o.attr("disabled",l);JC.Valid&&JC.Valid.setValid(o);if(o.is("[bclHideTargetSub]")){var n=JC.f.parentSelector(o,o.attr("bclHideTargetSub"));if(!(n&&n.length)){return}if(l){n.hide()}else{if(o.prop("checked")){n.show()}else{n.hide()}}}})}if(j&&j.length){j.each(function(){var n=g._model.bclHideToggle(d(this))?!m:m;n?d(this).show():d(this).hide()})}l?d(g).trigger("TriggerEvent",["DisableItem",h]):d(g).trigger("TriggerEvent",["EnableItem",h]);d(g).trigger("TriggerEvent",["ChangeDone",h]);JC.log("ChangeLogic view change",new Date().getTime(),l)}};d(document).ready(function(){setTimeout(function(){c.init()},10)})}(jQuery));return Bizs.ChangeLogic})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));