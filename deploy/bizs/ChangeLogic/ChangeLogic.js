(function(b,a){b(["JC.BaseMVC"],function(){(function(d){window.Bizs=window.Bizs||{};window.Bizs.ChangeLogic=c;function c(g){if(c.getInstance(g)){return c.getInstance(g)}c.getInstance(g,this);JC.log("Bizs.ChangeLogic:",new Date().getTime());this._model=new f(g);this._view=new e(this._model);this._init()}c.prototype={_init:function(){var g=this,h;g._initHandlerEvent();d([g._view,g._model]).on("BindEvent",function(i,k,j){g.on(k,j)});d([g._view,g._model]).on("TriggerEvent",function(i,k){var j=JC.f.sliceArgs(arguments).slice(2);g.trigger(k,j)});g._model.init();g._view.init();g._model.dltrigger().on("change",function(i){JC.log("dltrigger change",new Date().getTime());g._view.change(this)});(h=g._model.dltrigger(true))&&h.trigger("change");return g},_initHandlerEvent:function(){var g=this;g.on("DisableItem",function(i,h){g._model.dldisablecallback()&&g._model.dldisablecallback().call(g,h,g._model.selector())});g.on("EnableItem",function(i,h){g._model.dlenablecallback()&&g._model.dlenablecallback().call(g,h,g._model.selector())});g.on("ChangeDone",function(i,h){g._model.dldonecallback()&&g._model.dldonecallback().call(g,h,g._model.selector())})},selector:function(){return this._model.selector()},on:function(h,g){d(this).on(h,g);return this},trigger:function(h,g){d(this).trigger(h,g);return this}};c.getInstance=function(g,h){if(typeof g=="string"&&!/</.test(g)){g=d(g)}if(!(g&&g.length)||(typeof g=="string")){return}typeof h!="undefined"&&g.data("ChangeLogicIns",h);return g.data("ChangeLogicIns")};c.doneCallback=null;c.enableCallback=null;c.disableCallback=null;c.init=function(g){g=d(g||document);if(!(g&&g.length)){return}if(g.hasClass("js_bizChangeLogic")||g.hasClass("js_bizsDisableLogic")){new c(g)}else{g.find(["div.js_bizChangeLogic","dl.js_bizChangeLogic","table.js_bizChangeLogic","div.js_bizsDisableLogic","dl.js_bizsDisableLogic","table.js_bizsDisableLogic"].join()).each(function(){new c(d(this))})}};function f(g){this._selector=g}f.prototype={init:function(){return this},selector:function(){return this._selector},dltrigger:function(h){var g=this,j=JC.f.parentSelector(this.selector(),this.selector().attr("dltrigger")),i;if(h){j.each(function(){i=d(this);if(i.prop("checked")||i.prop("selected")){j=i;return false}})}return j},dltarget:function(h){var g=this,j,i;g.selector().attr("dltarget")&&(j=JC.f.parentSelector(g.selector(),g.selector().attr("dltarget")));h&&(h=d(h)).length&&h.attr("dltrigger")&&(j=JC.f.parentSelector(h,h.attr("dltarget")));return j},dldisable:function(g){var h=false;g&&(g=d(g)).length&&g.is("[dldisable]")&&(h=JC.f.parseBool(g.attr("dldisable")));if(g.prop("nodeName").toLowerCase()=="input"&&g.attr("type").toLowerCase()=="checkbox"){h=!g.prop("checked")}return h},dldisplay:function(g){var h=false;if(!g.is("[dldisplay]")){(g=d(g)).length&&g.is("[dldisable]")&&(h=!JC.f.parseBool(g.attr("dldisable")))}else{(g=d(g)).length&&g.is("[dldisplay]")&&(h=JC.f.parseBool(g.attr("dldisplay")))}if(g.prop("nodeName").toLowerCase()=="input"&&g.attr("type").toLowerCase()=="checkbox"){h=g.prop("checked")}return h},dlhidetarget:function(h){var g=this,j,i;g.selector().attr("dlhidetarget")&&(j=JC.f.parentSelector(g.selector(),g.selector().attr("dlhidetarget")));h&&(h=d(h)).length&&h.attr("dlhidetarget")&&(j=JC.f.parentSelector(h,h.attr("dlhidetarget")));return j},dlhidetoggle:function(g){var h;g&&g.is("[dlhidetoggle]")&&(h=JC.f.parseBool(g.attr("dlhidetoggle")));return h},dldonecallback:function(){var h=c.doneCallback,g;this.selector()&&(g=this.selector().attr("dldonecallback"))&&(g=window[g])&&(h=g);return h},dlenablecallback:function(){var h=c.enableCallback,g;this.selector()&&(g=this.selector().attr("dlenablecallback"))&&(g=window[g])&&(h=g);return h},dldisablecallback:function(){var h=c.disableCallback,g;this.selector()&&(g=this.selector().attr("dldisablecallback"))&&(g=window[g])&&(h=g);return h}};function e(g){this._model=g}e.prototype={init:function(){return this},change:function(h){h&&(h=d(h));if(!(h&&h.length&&h.is(":visible"))){return}var g=this,k=g._model.dldisable(h),m=g._model.dltarget(h),l=g._model.dldisplay(h),j=g._model.dlhidetarget(h);if(h.is("[dlhidetargetsub]")){var i=JC.f.parentSelector(h,h.attr("dlhidetargetsub"));if(i&&i.length){if(h.prop("checked")){i.show()}else{i.hide()}}}if(m&&m.length){m.each(function(){var o=d(this);o.attr("disabled",k);JC.Valid&&JC.Valid.setValid(o);if(o.is("[dlhidetargetsub]")){var n=JC.f.parentSelector(o,o.attr("dlhidetargetsub"));if(!(n&&n.length)){return}if(k){n.hide()}else{if(o.prop("checked")){n.show()}else{n.hide()}}}})}if(j&&j.length){j.each(function(){var n=g._model.dlhidetoggle(d(this))?!l:l;n?d(this).show():d(this).hide()})}k?d(g).trigger("TriggerEvent",["DisableItem",h]):d(g).trigger("TriggerEvent",["EnableItem",h]);d(g).trigger("TriggerEvent",["ChangeDone",h]);JC.log("ChangeLogic view change",new Date().getTime(),k)}};d(document).ready(function(){setTimeout(function(){c.init()},10)})}(jQuery));return Bizs.ChangeLogic})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));