(function(b,a){b(["JC.BaseMVC"],function(){window.Bizs.ChangeLogic=c;function c(f){if(c.getInstance(f)){return c.getInstance(f)}c.getInstance(f,this);JC.log("Bizs.ChangeLogic:",new Date().getTime());this._model=new e(f);this._view=new d(this._model);this._init()}c.prototype={_init:function(){var f=this,g;f._initHandlerEvent();$([f._view,f._model]).on("BindEvent",function(h,j,i){f.on(j,i)});$([f._view,f._model]).on("TriggerEvent",function(h,j){var i=JC.f.sliceArgs(arguments).slice(2);f.trigger(j,i)});f._model.init();f._view.init();f._model.bclTrigger().on("change",function(h){JC.log("bclTrigger change",new Date().getTime());f.trigger("item_change",[$(this),h])});f.on("item_change",function(i,j,h){j=$(j);f._view.change(j);f._model.bclChangeCleanTarget()&&f._model.bclChangeCleanTarget().each(function(){$(this).html("")})});(g=f._model.bclTrigger(true))&&g.trigger("change");return f},_initHandlerEvent:function(){var f=this;f.on("DisableItem",function(h,g){f._model.bclDisableCallback()&&f._model.bclDisableCallback().call(f,g,f._model.selector())});f.on("EnableItem",function(h,g){f._model.bclEnableCallback()&&f._model.bclEnableCallback().call(f,g,f._model.selector())});f.on("ChangeDone",function(h,g){f._model.bclDoneCallback()&&f._model.bclDoneCallback().call(f,g,f._model.selector())})},selector:function(){return this._model.selector()},on:function(g,f){$(this).on(g,f);return this},trigger:function(g,f){$(this).trigger(g,f);return this}};c.getInstance=function(f,g){if(typeof f=="string"&&!/</.test(f)){f=$(f)}if(!(f&&f.length)||(typeof f=="string")){return}typeof g!="undefined"&&f.data("ChangeLogicIns",g);return f.data("ChangeLogicIns")};c.doneCallback=null;c.enableCallback=null;c.disableCallback=null;c.init=function(f){f=$(f||document);if(!(f&&f.length)){return}if(f.hasClass("js_bizChangeLogic")){new c(f)}else{f.find(["div.js_bizChangeLogic","dl.js_bizChangeLogic","table.js_bizChangeLogic"].join()).each(function(){new c($(this))})}};function e(f){this._selector=f}e.prototype={init:function(){return this},selector:function(){return this._selector},bclTrigger:function(g){var f=this,i=JC.f.parentSelector(this.selector(),this.selector().attr("bclTrigger")),h;if(g){i.each(function(){h=$(this);if(h.prop("checked")||h.prop("selected")){i=h;return false}})}return i},bclChangeCleanTarget:function(){var f=this,h,g;f.selector().attr("bclChangeCleanTarget")&&(h=JC.f.parentSelector(f.selector(),f.selector().attr("bclChangeCleanTarget")));return h},bclDisableTarget:function(g){var f=this,i,h;f.selector().attr("bclDisableTarget")&&(i=JC.f.parentSelector(f.selector(),f.selector().attr("bclDisableTarget")));g&&(g=$(g)).length&&g.attr("bclTrigger")&&(i=JC.f.parentSelector(g,g.attr("bclDisableTarget")));return i},bclDisable:function(f){var h=false,g;f&&(f=$(f));if(!(f&&f.length)){return h}if(f.prop("nodeName").toLowerCase()=="select"){g=f.find(":selected");if(!g.length){return h}if(f.is("[bclDisable]")||g.is("[bclDisable]")){if(f.is("[bclDisable]")){h=f.attr("bclDisable")==f.val()}if(g.is("[bclDisable]")){h=JC.f.parseBool(g.attr("bclDisable"))}}}else{f.is("[bclDisable]")&&(h=JC.f.parseBool(f.attr("bclDisable")))}if(f.prop("nodeName").toLowerCase()=="input"&&f.attr("type").toLowerCase()=="checkbox"){h=!f.prop("checked")}return h},bclDelimiter:function(f){var g="||";this.selector().is("[bclDelimiter]")&&(g=this.selector().attr("bclDelimiter"));f&&f.is("[bclDelimiter]")&&(g=f.attr("bclDelimiter"));return g},delimiterItems:function(g,f){return g.split(this.bclDelimiter(f))},bclDisplay:function(g){var i=false,h,f=this;g&&(g=$(g));if(!(g&&g.length)){return i}if(g.prop("nodeName").toLowerCase()=="select"){h=g.find(":selected");if(!h.length){return i}if(!(g.is("[bclDisplay]")||h.is("[bclDisplay]"))){if(g.is("[bclDisable]")){i=f.delimiterItems(g.attr("bclDisable"),g).indexOf(g.val())>-1}if(h.is("[bclDisable]")){i=JC.f.parseBool(h.attr("bclDisable"))}}else{if(g.is("[bclDisplay]")){i=f.delimiterItems(g.attr("bclDisplay"),g).indexOf(g.val())>-1}if(h.is("[bclDisplay]")){i=JC.f.parseBool(h.attr("bclDisplay"))}}}else{if(!g.is("[bclDisplay]")){g.is("[bclDisable]")&&(i=!JC.f.parseBool(g.attr("bclDisable")))}else{g.is("[bclDisplay]")&&(i=JC.f.parseBool(g.attr("bclDisplay")))}}if(g.prop("nodeName").toLowerCase()=="input"&&g.attr("type").toLowerCase()=="checkbox"){i=g.prop("checked")}return i},bclHideTarget:function(g){var f=this,i,h;f.selector().attr("bclHideTarget")&&(i=JC.f.parentSelector(f.selector(),f.selector().attr("bclHideTarget")));g&&(g=$(g)).length&&g.attr("bclHideTarget")&&(i=JC.f.parentSelector(g,g.attr("bclHideTarget")));return i},bclHideToggle:function(f){var g;f&&f.is("[bclHideToggle]")&&(g=JC.f.parseBool(f.attr("bclHideToggle")));return g},bclDoneCallback:function(){var g=c.doneCallback,f;this.selector()&&(f=this.selector().attr("bclDoneCallback"))&&(f=window[f])&&(g=f);return g},bclEnableCallback:function(){var g=c.enableCallback,f;this.selector()&&(f=this.selector().attr("bclEnableCallback"))&&(f=window[f])&&(g=f);return g},bclDisableCallback:function(){var g=c.disableCallback,f;this.selector()&&(f=this.selector().attr("bclDisableCallback"))&&(f=window[f])&&(g=f);return g}};function d(f){this._model=f}d.prototype={init:function(){return this},change:function(g){g&&(g=$(g));if(!(g&&g.length&&g.is(":visible"))){return}var f=this,k=f._model.bclDisable(g),j=f._model.bclDisableTarget(g),l=f._model.bclDisplay(g),i=f._model.bclHideTarget(g);if(g.is("[bclHideTargetSub]")){var h=JC.f.parentSelector(g,g.attr("bclHideTargetSub"));if(h&&h.length){if(g.prop("checked")){h.show()}else{h.hide()}}}if(j&&j.length){j.each(function(){var n=$(this);n.attr("disabled",k);JC.Valid&&JC.Valid.setValid(n);if(n.is("[bclHideTargetSub]")){var m=JC.f.parentSelector(n,n.attr("bclHideTargetSub"));if(!(m&&m.length)){return}if(k){m.hide()}else{if(n.prop("checked")){m.show()}else{m.hide()}}}})}if(i&&i.length){i.each(function(){var m=f._model.bclHideToggle($(this))?!l:l;m?$(this).show():$(this).hide()})}k?$(f).trigger("TriggerEvent",["DisableItem",g]):$(f).trigger("TriggerEvent",["EnableItem",g]);$(f).trigger("TriggerEvent",["ChangeDone",g]);JC.log("ChangeLogic view change",new Date().getTime(),k)}};$(document).ready(function(){setTimeout(function(){c.init()},10)});return Bizs.ChangeLogic})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));