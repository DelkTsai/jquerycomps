(function(b,a){b(["JC.common","JC.Tree"],function(){JC.use&&!JC.Tree&&JC.use("JC.Tree");Bizs.MultiSelectTree=c;function c(d,g,e,f){this._tree=new JC.Tree(d,g);this._getSelected=e;this._renderTpl=f}c.prototype={expandChild:function(e){var h=$(e.target);var d=h.attr("dataid");if(this._tree._model.hasChild(d)){this._tree._view.open(d);var g=this._tree._model.child(d);for(var f=0;f<g.length;f++){this.expandChild(g[f][0])}}},foldChild:function(e){var f=$(e.target);var d=f.attr("dataid");this._tree._view.close(d)},autoCheck:function(g){if(g.attr("dataid")==this._tree._model.root()[0]){return}var d=JC.f.getJqParent(g,"ul");var f=d.find("input.js_checkbox:not(:checked)").length;var e=d.prev().find("input.js_checkbox").eq(0);if(f===0){e[0].checked=true;this.autoCheck(e)}else{e[0].checked=false;this.autoCheck(e)}},update:function(d){var g=$(d.target);if(g[0].nodeName.toLowerCase()!=="input"){return}if(g[0].checked){var h=JC.f.getJqParent(g,"div.node_ctn").next().find("input.js_checkbox");for(var e=0;e<h.length;e++){h[e].checked=true}}else{var h=JC.f.getJqParent(g,"div.node_ctn").next().find("input.js_checkbox");for(var e=0;e<h.length;e++){h[e].checked=false}}this.autoCheck(g);var f=[];this._tree._model._container.find("input.js_checkbox:checked").each(function(){f.push($(this).attr("dataid"))});this._getSelected(f,this._tree)},init:function(){var d=this;this._tree._model._container.delegate("input.js_checkbox:checked","click",this.expandChild.bind(this));this._tree._model._container.delegate("input.js_checkbox:not(:checked)","click",this.foldChild.bind(this));this._tree.on("RenderLabel",function(f){var e=$(this);e.html(JC.f.printf(d._renderTpl||'<label dataid="{0}" dataname="{1}"><input type="checkbox" class="js_checkbox" dataid="{0}">{1}</label>',f[0],f[1]))});this._tree.on("change",this.update.bind(this));this._tree.init();return this._tree},tree:function(){return this._tree}};return JC.MultiSelectTree})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));