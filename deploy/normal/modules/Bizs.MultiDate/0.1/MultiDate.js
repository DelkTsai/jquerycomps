(function(e,t){e(["JC.BaseMVC","JC.Calendar"],function(){return function(e){function t(e){if(t.getInstance(e))return t.getInstance(e);t.getInstance(e,this),this._model=new t.Model(e),this._view=new t.View(this._model),this._init()}window.Bizs=window.Bizs||{},window.Bizs.MultiDate=t,t.prototype={_beforeInit:function(){JC.log("MultiDate _beforeInit",(new Date).getTime())},_initHanlderEvent:function(){var t=this;e([t._view,t._model]).on("BindEvent",function(e,n,r){t.on(n,r)}),e([t._view,t._model]).on("TriggerEvent",function(e,n){var r=JC.f.sliceArgs(arguments);r.shift(),r.shift(),t.trigger(n,r)}),t._initDefaultValue(),t._initHandlerEvent(),t.selector().trigger("change",[!0])},_initDefaultValue:function(){var e=this,t=e._model.qstartdate(),n=e._model.qenddate(),r=e._model.mdCustomStartDate(),i=e._model.mdCustomEndDate();e._model.selector(e._model.qtype()),e._model.mdstartdate(t),e._model.mdenddate(n),e._model.mddate().attr("name")?e._model.mddate(e._model.qdate()):t&&n&&(t==n?e._model.mddate(JC.f.formatISODate(JC.f.parseISODate(t))):e._model.mddate(JC.f.printf("{0} è‡³ {1}",JC.f.formatISODate(JC.f.parseISODate(t)),JC.f.formatISODate(JC.f.parseISODate(n))))),r&&r.length&&r.val(t?JC.f.formatISODate(JC.f.parseISODate(t)):t),i&&i.length&&i.val(n?JC.f.formatISODate(JC.f.parseISODate(n)):n)},_initHandlerEvent:function(){var t=this;t._model.selector().on("change",function(n,r){var i=e(this),s=i.val().trim().toLowerCase(),o=t._model.mdDefaultBox(),u=t._model.mdCustomBox();JC.log("type:",s);if(s=="custom")o&&u&&o.length&&u.length&&(o.hide(),o.find("input").prop("disabled",!0),u.find("input").prop("disabled",!1),u.show());else{o&&u&&o.length&&u.length&&(u.hide(),u.find("input").prop("disabled",!0),o.find("input").prop("disabled",!1),o.show());if(r)return;t._model.settype(s),setTimeout(function(){JC.Calendar.pickDate(t._model.mddate()[0]),t._model.mdstartdate(""),t._model.mdenddate("")},10)}})},_inited:function(){JC.log("MultiDate _inited",(new Date).getTime())}},t.getInstance=function(n,r){typeof n=="string"&&!/</.test(n)&&(n=e(n));if(!n||!n.length||typeof n=="string")return;return typeof r!="undefined"&&n.data(t.Model._instanceName,r),n.data(t.Model._instanceName)},t.isMultiDate=function(t){var n;return t&&(t=e(t)).length&&(n=t.is("[MultiDatelayout]")),n},BaseMVC.buildModel(t),t.Model._instanceName="MultiDate",t.Model._inscount=1,t.Model.prototype={init:function(){var n=this,r="Bizs.MultiDate_"+t.Model._inscount,i="Bizs.MultiDate_show_"+t.Model._inscount,s="Bizs.MultiDate_hide_"+t.Model._inscount,o="Bizs.MultiDate_layoutchange_"+t.Model._inscount;return t.Model._inscount++,window[r]=function(e,t,r){n.mdstartdate(JC.f.formatISODate(e,"")),n.mdenddate(JC.f.formatISODate(t,""))},n.mddate().attr("calendarupdate",r),window[i]=function(){var t=e("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))},n.mddate().attr("calendarshow",i),window[s]=function(){JC.Tips&&JC.Tips.hide(),n.updateHiddenDate()},n.mddate().attr("calendarhide",s),window[o]=function(){JC.Tips&&JC.Tips.hide();var t=e("body > div.UXCCalendar:visible");t.length&&JC.Tips&&JC.Tips.init(t.find("[title]"))},n.mddate().attr("calendarlayoutchange",o),n},mdDefaultBox:function(){return this.selectorProp("mdDefaultBox")},mdCustomBox:function(){return this.selectorProp("mdCustomBox")},mdCustomStartDate:function(){return this.selectorProp("mdCustomStartDate")},mdCustomEndDate:function(){return this.selectorProp("mdCustomEndDate")},selector:function(e){return typeof e!="undefined"&&this.hastype(this.qtype())&&this._selector.val(e)&&this.settype(e),this._selector},mddate:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mddate"));return typeof e!="undefined"&&t.val(e),t},mdstartdate:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mdstartdate"));return typeof e!="undefined"&&t.val(e.replace(/[^\d]/g,"")),t},mdenddate:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mdenddate"));return typeof e!="undefined"&&t.val(e.replace(/[^\d]/g,"")),t},qtype:function(){return this.decodedata(JC.f.getUrlParam(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(JC.f.getUrlParam(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(JC.f.getUrlParam(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(JC.f.getUrlParam(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(t){var n=!1;return this.selector().find("> option").each(function(){if(e(this).val().trim()==t)return n=!0,!1}),n},settype:function(e){this.mddate().val("").attr("multidate",e)},decodedata:function(e){e=e.replace(/[\+]/g," ");try{e=decodeURIComponent(e)}catch(t){}return e},updateHiddenDate:function(){var t=e.trim(this.mddate().val());if(!t){this.mdstartdate(""),this.mdenddate("");return}t=t.replace(/[^\d]+/g,""),t.length==8&&(this.mdstartdate(t),this.mdenddate(t)),t.length==16&&(this.mdstartdate(t.slice(0,8)),this.mdenddate(t.slice(8)))}},BaseMVC.buildView(t),t.View.prototype={init:function(){return this},hide:function(){},show:function(){}},BaseMVC.build(t,"Bizs"),e(document).ready(function(){e("select.js_autoMultidate").each(function(){new t(e(this))})})}(jQuery),Bizs.MultiDate})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);