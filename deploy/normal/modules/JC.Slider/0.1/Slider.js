(function(e,t){e(["JC.common"],function(){return function(e){function t(s){s&&(s=e(s));if(t.getInstance(s))return t.getInstance(s);t.getInstance(s,this),JC.log("Slider constructor",(new Date).getTime()),this._model=new n(s);switch(this._model.direction()){case"vertical":this._view=new i(this._model,this);break;default:this._view=new r(this._model,this)}this._init()}function n(e){this._layout=e,this._moveDirection=!0,this._interval,this._timeout,this._init()}function r(e,t){this._model=e,this._slider=t,this._itemspace=(this._model.width()-Math.floor(this._model.width()/this._model.itemwidth())*this._model.itemwidth())/(this._model.totalpage()-1),this._itemspace=parseInt(this._itemspace),this._init()}function i(e,t){this._model=e,this._slider=t,this._itemspace=0,this._init()}window.JC=window.JC||{log:function(){}},window.Slider=JC.Slider=t,t.prototype={_init:function(){var e=this;return e._initControl(),e.on("cleartinterval",function(){e._model.clearInterval(),e._view.setPagePosition()}),e.on("cleartimeout",function(){e._model.clearTimeout()}),e._initAutoMove(),e._model.initedcb()&&e.on("inited",e._model.initedcb()),e.trigger("inited"),this},on:function(t,n){return e(this).on(t,n),this},trigger:function(t){return e(this).trigger(t),this},move:function(e){return this._view.move(e),this},moveTo:function(e){return this._view.moveTo(e),this},totalpage:function(){return this._model.totalpage()},pointer:function(){return this._model.pointer()},page:function(e){return this._model.page(e)},layout:function(){return this._model.layout()},find:function(e){return this._model.layout().find(e)},_initControl:function(){switch(this._model.direction()){case"vertical":this._initVerticalControl();break;default:this._initHorizontalControl()}},_initHorizontalControl:function(){var e=this;e._model.leftbutton()&&e._model.leftbutton().on("click",function(t){e.trigger("cleartimeout"),e.trigger("movetoleft"),e._view.move(1)}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")}),e._model.rightbutton()&&e._model.rightbutton().on("click",function(t){e.trigger("cleartimeout"),e.trigger("movetoright"),e._view.move()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")})},_initVerticalControl:function(){var e=this},_initAutoMove:function(){var t=this;if(!t._model.automove())return;return t.on("beforemove",function(e,n,r){t.trigger("cleartimeout")}),t.on("movedone",function(e,n,r){if(t._model.controlover())return;t.trigger("automove")}),t._model.layout().on("mouseenter",function(e){t.trigger("cleartimeout"),t.trigger("mouseenter")}),t._model.layout().on("mouseleave",function(e){t.trigger("cleartimeout"),t.trigger("mouseleave"),t._view.setPagePosition(),t.trigger("automove")}),t.on("controlover",function(){t.trigger("cleartimeout"),t._model.controlover(!0)}),t.on("controlout",function(){t.trigger("automove"),t._model.controlover(!1)}),t.on("movetoleft",function(){t._model.moveDirection(!1)}),t.on("movetoright",function(){t._model.moveDirection(!0)}),e(t).on("automove",function(){t._model.timeout(setTimeout(function(){t._view.moveTo(t._model.automoveNewPointer())},t._model.automovems()))}),t.trigger("automove"),this}},t.autoInit=!0,t.init=function(n){var r=[];n&&(n=e(n));if(n&&n.length)if(t.isSlider(n)){if(t.getInstance(n))return[t.getInstance(n)];r.push(new t(n))}else n.find("div.js_autoSlider, dl.js_autoSlider, ul.js_autoSlider, ol.js_autoSlider").each(function(){if(t.isSlider(this)){if(t.getInstance(e(this))){r.push(t.getInstance(e(this)));return}r.push(new t(e(this)))}});return r},t.getInstance=function(t,n){return n&&t&&e(t).data("SliderIns",n),t?e(t).data("SliderIns"):null},t.isSlider=function(t){return t&&(t=e(t)),t&&(t.is("[sliderwidth]")||t.is("[sliderheight]"))},n.prototype={_init:function(){return this.subitems(),this.totalpage(),JC.log(JC.f.printf("w:{0}, h:{1}, iw:{2}, ih:{3}, dr:{4}, si:{6}, hi:{5}, totalpage:{7}",this.width(),this.height(),this.itemwidth(),this.itemheight(),this.direction(),this.howmanyitem(),this.subitems().length,this.totalpage())),this},layout:function(){return this._layout},leftbutton:function(){return this._layout.is("[sliderleft]")?e(this._layout.attr("sliderleft")):null},rightbutton:function(){return this._layout.is("[sliderright]")?e(this._layout.attr("sliderright")):null},direction:function(){return this._layout.attr("sliderdirection").toLowerCase()||"horizontal"},moveDirection:function(e){return typeof e!="undefined"&&(this._moveDirection=e),JC.log("moveDirection",this._moveDirection),this._moveDirection},howmanyitem:function(){return parseInt(this._layout.attr("sliderhowmanyitem"),10)||1},width:function(){return parseInt(this._layout.attr("sliderwidth"),10)||800},height:function(){return parseInt(this._layout.attr("sliderheight"),10)||230},itemwidth:function(){return parseInt(this._layout.attr("slideritemwidth"),10)||160},itemheight:function(){return parseInt(this._layout.attr("slideritemheight"),10)||230},loop:function(){return JC.f.parseBool(this._layout.attr("sliderloop"))},stepms:function(){return parseInt(this._layout.attr("sliderstepms"),10)||10},durationms:function(){return parseInt(this._layout.attr("sliderdurationms"),10)||300},automovems:function(){return parseInt(this._layout.attr("sliderautomovems"),10)||2e3},automove:function(){return JC.f.parseBool(this._layout.attr("sliderautomove"))},defaultpage:function(){return parseInt(this._layout.attr("sliderdefaultpage"),10)||0},subitems:function(){return this._layout.is("[slidersubitems]")?this._subitems=this._layout.find(this._layout.attr("slidersubitems")):this._subitems=this._layout.children(),this._subitems},totalpage:function(){return this.subitems(),this.howmanyitem()>1?this._totalpage=Math.ceil(this._subitems.length/this.howmanyitem()):this._totalpage=this._subitems.length,this._totalpage},page:function(t){this.subitems(),!t&&(t=0),t<0&&(t=0),t>=this.totalpage()&&(t=this.totalpage()-1),t*=this.howmanyitem();var n=[];for(var r=t,i=0;i<this.howmanyitem()&&r<this._subitems.length;r++,i++)n.push(e(this._subitems[r]));return n},pointer:function(e){return typeof this._pointer=="undefined"&&(this._pointer=this.defaultpage()),typeof e!="undefined"&&(this._pointer=this.fixpointer(e)),this._pointer},newpointer:function(e){var t=this.pointer();return e&&t--,!e&&t++,t=this.fixpointer(t),t},fixpointer:function(e){var t=e;return this.loop()?(t<0&&(t=this.totalpage()-1),t>=this.totalpage()&&(t=0)):(t<0&&(t=0),t>=this.totalpage()&&(t=this.totalpage()-1)),t},automoveNewPointer:function(){var e=this.pointer();return this.moveDirection()?e++:e--,this.loop()?e>=this.totalpage()?e=0:e<0&&(e=this.totalpage()-1):e>=this.totalpage()?(e=this.totalpage()-2,this.moveDirection(!1)):e<0&&(e=1,this.moveDirection(!0)),e},interval:function(e){return typeof e!="undefined"&&(this._interval=e),this._interval},clearInterval:function(){this.interval()&&clearInterval(this.interval())},timeout:function(e){return typeof e!="undefined"&&(this._timeout=e),this._timeout},clearTimeout:function(){this.timeout()&&clearTimeout(this.timeout())},controlover:function(e){return typeof e!="undefined"&&(this._controlover=e),this._controlover},initedcb:function(){return this._layout.is("[sliderinitedcb]")&&window[this._layout.attr("sliderinitedcb")]&&(this._initedcb=window[this._layout.attr("sliderinitedcb")]),this._initedcb}},r.prototype={_init:function(){return this.setPagePosition(this._model.pointer()),this},move:function(e){var t=this;e=!!e,JC.log("HorizontalView move, is backwrad",e,this._model.pointer());var n=this._model.newpointer(e);JC.log(JC.f.printf("is backwrad: {0}, pointer:{1}, new pointer:{2}",e,this._model.pointer(),n)),this.moveTo(n)},moveTo:function(t){var n=this;if(!this._model.loop()){if(t<=this._model.pointer()&&this._model.pointer()===0){e(this._slider).trigger("outmin");return}if(t>=this._model.pointer()&&this._model.pointer()>=this._model.totalpage()-1){e(this._slider).trigger("outmax");return}}t=this._model.fixpointer(t);var r=this._model.pointer();if(t===r)return;var i=this._model.page(r),s=this._model.page(t),o=i.concat(s);this._setNewPagePosition(i,s,r,t),n._model.pointer(t)},_setNewPagePosition:function(t,n,r,i){var s=this,o,u=t.concat(n),a;e(this._slider).trigger("cleartinterval"),r<i?o=this._model.width()+this._itemspace:(o=-(this._model.width()+this._itemspace),a=!0),r===s._model.totalpage()-1&&i===0&&(o=this._model.width()+this._itemspace,a=!1),r===0&&i===s._model.totalpage()-1&&(o=-(this._model.width()+this._itemspace),a=!0),e.each(n,function(t,n){var r=e(n);r.css({left:o+s._model.itemwidth()*t+s._itemspace*t+"px"}),r.show()}),e(s._slider).trigger("beforemove",[r,i]),e.each(u,function(e,t){t.data("TMP_LEFT",t.prop("offsetLeft"))}),JC.log("zzzzzzzzzz",o,this._itemspace,this._model.moveDirection()),s._model.interval(JC.f.easyEffect(function(n,o){e(u).each(function(e,t){t.css({left:t.data("TMP_LEFT")+(a?n:-n)+"px"})}),o&&(e(t).each(function(e,t){t.hide()}),e(s._slider).trigger("movedone",[r,i]),s._model.pointer(i),s.setPagePosition())},this._model.width(),0,this._model.durationms(),this._model.stepms()))},setPagePosition:function(e){JC.log("view setPagePosition",(new Date).getTime()),typeof e=="undefined"&&(e=this._model.pointer()),this._model.subitems().hide();var t=this._model.page(e);for(var n=0,r=t.length;n<r;n++)t[n].css({left:n*this._model.itemwidth()+n*this._itemspace+"px"}).show();JC.log(t.length)}},i.prototype={_init:function(){return this.setPagePosition(this._model.pointer()),this},move:function(e){var t=this;return this},moveTo:function(e){var t=this;return this},_setNewPagePosition:function(e,t,n,r){var i=this,s,o=e.concat(t),u;return this},setPagePosition:function(e){var t=this;return JC.log("view setPagePosition",(new Date).getTime()),this}},e(document).ready(function(){if(!t.autoInit)return;t.init(document.body)})}(jQuery),JC.Slider})})(typeof define=="function"&&define.amd?define:function(e,t){t&&t()},this);