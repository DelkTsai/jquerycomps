(function(e,t){e(["JC.common","JC.BaseMVC"],function(){return function(e){function t(n){n&&(n=e(n));if(t.getInstance(n))return t.getInstance(n);t.getInstance(n,this),this._model=new t.Model(n),this._view=new t.View(this._model),this._init()}window.JC=window.JC||{log:function(){}},JC.PopTips=t,t.getInstance=function(n,r){typeof n=="string"&&!/</.test(n)&&(n=e(n));if(!n||!n.length||typeof n=="string")return;return typeof r!="undefined"&&n.data(t.Model._instanceName,r),n.data(t.Model._instanceName)},t.init=function(n){var r=[];return n=e(n||document),n&&n.length&&(n.hasClass("js_compPopTips")?r.push(new t(n)):n.find("span.js_compPopTips,a.js_compPopTips,b.js_compPopTips,em.js_compPopTips").each(function(){r.push(new t(this))})),r},t.update=function(){var n=e(JC.f.printf("#{0}>div",t.Model._boxId));if(!n.length)return;n.each(function(){var t=e(this),n=t.data("CPopTipsIns");if(!n)return;n._model.layout().is(":visible")&&n.update()})},BaseMVC.build(t),JC.f.extendObject(t.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("CPopTipsUpdate",function(t){e._model.beforeShowCallback()&&e._model.beforeShowCallback().call(e,e.selector())});var t=null,n=null,r=null,i=null;e._model.triggerType()=="hover"&&(e._model.selector().on("mouseenter",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),t=setTimeout(function(){e._view.update(),e._view.show()},50)}).on("mouseleave",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),n=setTimeout(function(){e._view.hide()},200)}),e._model.layout().on("mouseenter",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),r=setTimeout(function(){e._view.update(),e._view.show()},50)}).on("mouseleave",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),i=setTimeout(function(){e._view.hide()},200)})),e._model.triggerType()=="click"&&e._model.selector().on("click",function(t){e._model.layout().is(":visible")?e._view.hide():(e._view.update(),e._view.show())})},_inited:function(){var t=e(this);t.trigger("CPopTipsUpdate")},update:function(){return this._view.update(),this}}),t.Model._instanceName="PopTips",t.Model._boxId="CPTBox",JC.f.extendObject(t.Model.prototype,{init:function(){var e=this},baseTpl:'<div class="CPT CPT_{0}" style="position:absolute;display:none;"><div class="CPT_shadow"><div class="CPT_container"><div class="CPT_arrow CPT_arrow_{1}"><em></em><span></span></div><div class="CPT_content"  data-role="content" {3}>{2}</div></div></div></div>',theme:function(){var e=this.stringProp("theme");return!e&&(e="yellow"),e},contents:function(){var e=this.attrProp("content")||this.attrProp("title");return!e&&(e=this.selector().text()),e},htmlContents:function(){var e,t=JC.f.parentSelector(this.selector(),this.attrProp("htmlContent"));return e=JC.f.scriptContent(t),e},arrowPosition:function(){var e=this.stringProp("arrowPosition");return!e&&(e="left"),e},arrowPositionOffset:function(){var e=this.stringProp("arrowPositionOffset"),t=this.arrowPosition();(t==="left"||t==="right")&&e!="top"&&(e="");if(t==="top"||t==="bottom")if(e!="left"||e!="right")e="";return e},offsetXY:function(){var e=this.attrProp("offsetXY").split(","),t=parseInt(e[0],10)||0,n=parseInt(e[1],10)||0;return{x:t,y:n}},triggerType:function(){var e=this.stringProp("triggerType");return!e&&(e="hover"),e},layout:function(){var t=this,n=t.baseTpl;return this._layout||(t.htmlContents()?this._layout=e(JC.f.printf(n,t.theme(),t.arrowPosition(),t.htmlContents(),'style="width:'+t.layoutWidth()+";height:"+t.layoutHeight()+';"')).appendTo(this.layoutBox()):this._layout=e(JC.f.printf(n,t.theme(),t.arrowPosition(),t.contents(),'style="width:'+t.layoutWidth()+";height:"+t.layoutHeight()+';"')).appendTo(this.layoutBox())),this._layout},layoutWidth:function(){var e=this.intProp("popTipsWidth");return e&&(e+="px"),!e&&(e="auto"),e},layoutHeight:function(){var e=this.intProp("popTipsHeight");return e&&(e+="px"),!e&&(e="auto"),e},layoutBox:function(){var n=e("#"+t.Model._boxId);if(!n||!n.length)n=e(JC.f.printf('<div id="{0}"></div>',t.Model._boxId)).appendTo(document.body);return n},calcPosOffset:function(e,t,n,r){var i={},s=this,o=s.selector(),t={top:o.offset().top+s.offsetXY().y,left:o.offset().left+s.offsetXY().x,width:o.prop("offsetWidth"),height:o.prop("offsetHeight")},n=s.layout().outerWidth(),r=s.layout().outerHeight();switch(e){case"top":i={top:t.top+t.height+5,left:t.left+t.width/2-n/2};break;case"right":i={top:t.top+t.height/2-r/2,left:t.left-n-5};break;case"bottom":i={top:t.top-r-5,left:t.left+t.width/2-n/2};break;case"left":i={top:t.top+t.height/2-r/2,left:t.left+t.width+5}}return i.width=n,i.height=r,i},offSet:function(e){this.layout().css({top:e.top,left:e.left})},changePosition:function(e,t){var n=this,r;return r=n.calcPosOffset(e),n.changeArrow(t),(t==="top"||t==="bottom")&&n.offSet(r),r},changeArrow:function(e){var t=this;t.layout().find("div.CPT_arrow")[0].className="CPT_arrow CPT_arrow_"+e},setPosition:function(t,n){var r=this,i,s,o=e(window),u=o.outerHeight(),a=o.outerWidth(),f=o.scrollTop(),l=o.scrollLeft(),c=a+l,h=u+f,p=t.width+t.left,d=t.top+t.height,v=r.arrowPositionOffset(),m;r.offSet(t),v&&(v="_"+v),n==="bottom"&&(t.top<0?(i="top",s="top"+v,r.changePosition(i,s)):r.changeArrow("bottom"+v)),n==="top"&&(h<d?(i="bottom",s="bottom"+v,m=r.changePosition(i,s)):r.changeArrow("top"+v)),n==="right"&&(t.left<0?(i="left",s="left"+v,m=r.changePosition(i,s),p=m.width+m.left,c<p?(i="bottom",s="bottom",m=r.changePosition(i,s),m.top<0&&(i="top",s="top",m=r.changePosition(i,s))):r.offSet(m)):r.changeArrow("right"+v)),n==="left"&&(c<p?(i="right",s="right"+v,m=r.changePosition(i,s),m.left<0?(i="bottom",s="bottom",m=r.changePosition(i,s),m.top<0&&(i="top",s="top",m=r.changePosition(i,s))):r.offSet(m)):r.changeArrow("left"+v))},beforeShowCallback:function(){var e=this,t=e.selector(),n="beforeShowCallback";return e.callbackProp(t,n)},afterHideCallback:function(){var e=this,t=e.selector(),n="afterShowCallback";return e.callbackProp(t,n)}}),JC.f.extendObject(t.View.prototype,{init:function(){var e=this},update:function(){var e=this,t=e._model.selector(),n={top:t.offset().top,left:t.offset().left,width:t.prop("offsetWidth"),height:t.prop("offsetHeight")},r=e._model.arrowPosition(),i;i=e._model.calcPosOffset(r,n),e._model.setPosition(i,r),e._model.layout().data("CPopTipsIns",e)},show:function(){var e=this;e._model.layout().show()},hide:function(){var e=this;e._model.layout().hide(),e._model.afterHideCallback()&&e._model.afterHideCallback().call(e,e.selector())}}),e(document).ready(function(){var e=0;t.autoInit&&(e=t.init())}),e(window).on("resize",function(){JC.f.safeTimeout(function(){t.update()},null,"PopTipsResize",20)})}(jQuery),JC.PopTips})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);