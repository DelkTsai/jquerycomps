(function(e,t){e(["JC.common"],function(){return function(e){function t(i,s){if(i&&e(i).length){i=e(i);if(t.getInstance(i))return t.getInstance(i);i.data("TreeIns",this)}this._model=new n(i,s),this._view=new r(this._model)}function n(e,t){this._container=e,this._data=t,this._id="tree_"+(new Date).getTime()+"_",this._highlight,this._events={},this._init()}function r(e){this._model=e,this._treeRoot}window.JC=window.JC||{log:function(){}},window.Tree=JC.Tree=t,t.getInstance=function(t){return t=e(t),t.data("TreeIns")},t.dataFilter,t.prototype={init:function(){return this._view.init(),this._view.treeRoot().data("TreeIns",this),this},open:function(e){return typeof e=="undefined"?(this._view.openAll(),this):(this._view.open(e),this)},close:function(e){return typeof e=="undefined"?(this._view.closeAll(),this):(this._view.close(e),this)},idPrefix:function(){return this._model.idPrefix()},getItem:function(t){var n;return t&&(n=e("#"+this._model.id(t))),n},on:function(e,t){return!e||!t?this:(this._model.addEvent(e,t),this)},event:function(e){if(!e)return;return this._model.event(e)},highlight:function(e){return this._model.highlight(e)}},n.prototype={_init:function(){return t.dataFilter&&(this._data=t.dataFilter(this._data)),this},container:function(){return this._container},id:function(e){return this._id+e},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(e){return this._data.data[e]},hasChild:function(e){return e in this._data.data},event:function(e){return e=e.toLowerCase(),this._events[e]},addEvent:function(e,t){e=e.toLowerCase(),e in this._events||(this._events[e]=[]),this._events[e].unshift(t)},highlight:function(e){return e&&(this._highlight=e),this._highlight}},r.prototype={init:function(){if(!this._model.data()||!this._model.root())return;return this._process(this._model.child(this._model.root()[0]),this._initRoot()),this},treeRoot:function(e){return e&&(this._treeRoot=e),this._treeRoot},_process:function(e,t){for(var n=0,r=e.length,i,s;n<r;n++)i=e[n],s=n===r-1,this._model.hasChild(i[0])?this._initFolder(t,i,s):this._initFile(t,i,s)},_initRoot:function(){var t=this;if(!t._model.data().root)return;var n=t._model.data().root,r=e('<ul class="tree_wrap"></ul>'),i=this._initLabel(n),s=e('<li class="folder_open"></li>');s.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>'),i.appendTo(s),s.appendTo(r),r.appendTo(t._model.container()),this.treeRoot(r);var o=e('<ul style="" class="tree_wrap_inner"></ul>');return o.appendTo(s),o},_initFolder:function(t,n,r){var i="",s="";r&&(i="folder_span_lst ",s="folder_last");var o=this._initLabel(n),u=e(JC.f.printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',n[1],i));u.addClass(JC.f.printf("folder_closed {0} folder",s)),o.appendTo(u);var a=e('<ul style="display:none;" class="folder_ul_lst" ></ul>');a.appendTo(u),u.appendTo(t),this._process(this._model.child(n[0]),a)},_initFile:function(t,n,r){var i="folder_img_bottom ",s="";r&&(i="folder_img_last ",s="");var o=this._initLabel(n),u=e(JC.f.printf('<li><span class="{1}file">&nbsp;</span></li>',n[1],i));u.addClass("folder_closed file"),o.appendTo(u),u.appendTo(t)},_initLabel:function(t){var n=e('<div class="node_ctn"></div>');return n.attr("id",this._model.id(t[0])).attr("dataid",t[0]).attr("dataname",t[1]).data("nodeData",t),this._model.event("RenderLabel")?e.each(this._model.event("RenderLabel"),function(e,r){if(r.call(n,t,n)===!1)return!1}):n.html(t[1]||"没有标签"),n},openAll:function(){if(!this.treeRoot())return;this.treeRoot().find("span.folder_img_closed").each(function(){e(this).trigger("click")})},closeAll:function(){if(!this.treeRoot())return;this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if(e(this).hasClass("folder_img_closed"))return;e(this).trigger("click")})},open:function(t){if(!t)return;var n=e("#"+this._model.id(t));if(!n.length)return;var r=n.parents("li");this._model.highlight()&&this._model.highlight().removeClass("highlight"),n.addClass("highlight"),this._model.highlight(n),r.each(function(){var t=e(this),n=t.find("> span.folderRoot, > span.folder");if(n.length){if(n.hasClass("folder_img_open"))return;n.trigger("click")}})},close:function(t){if(!t)return;var n=e("#"+this._model.id(t));if(!n.length)return;var r=n.parent("li").find("> span.folderRoot, > span.folder");if(r.length){if(r.hasClass("folder_img_closed"))return;r.trigger("click")}}},t.lastHover=null,e(document).delegate("ul.tree_wrap div.node_ctn","mouseenter",function(){t.lastHover&&t.lastHover.removeClass("ms_over"),e(this).addClass("ms_over"),t.lastHover=e(this)}),e(document).delegate("ul.tree_wrap div.node_ctn","mouseleave",function(){t.lastHover&&t.lastHover.removeClass("ms_over")}),e(document).delegate("ul.tree_wrap div.node_ctn","click",function(t){var n=e(this),r=n.parents("ul.tree_wrap"),i=r.data("TreeIns");if(!i)return;var s=i.event("click");s&&s.length&&e.each(s,function(e,r){if(r.call(n,t)===!1)return!1}),i.highlight()&&i.highlight().removeClass("highlight"),n.addClass("highlight"),i.highlight(n);var s=i.event("change");s&&s.length&&e.each(s,function(e,r){if(r.call(n,t)===!1)return!1})}),e(document).delegate("ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(t){var n=e(this),r=n.parent("li"),i=r.find("> ul"),s=n.parents("ul.tree_wrap"),o=s.data("TreeIns"),u=o.event("FolderClick");u&&u.length&&e.each(u,function(e,r){if(r.call(n,t)===!1)return!1}),n.hasClass("folder_img_open")?(n.removeClass("folder_img_open").addClass("folder_img_closed"),i.hide()):n.hasClass("folder_img_closed")&&(n.addClass("folder_img_open").removeClass("folder_img_closed"),i.show()),r.hasClass("folder_closed")?r.addClass("folder_open").removeClass("folder_closed"):r.hasClass("folder_open")&&r.removeClass("folder_open").addClass("folder_closed")})}(jQuery),JC.Tree})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);