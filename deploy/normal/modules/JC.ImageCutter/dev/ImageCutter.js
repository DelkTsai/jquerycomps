(function(e,t){e(["JC.Drag"],function(){function r(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,r))return JC.BaseMVC.getInstance(e,r);JC.BaseMVC.getInstance(e,r,this),this._model=new r.Model(e),this._view=new r.View(this._model),this._init(),JC.log(r.Model._instanceName,"all inited",(new Date).getTime())}function i(e,t,n,r){var i,s;return e>n&&t<e?(i=n,s=t-t/(e/(e-n))):t>r&&t>e?(i=e-e/(t/(t-r)),s=r):(i=n,s=r),{width:i,height:s}}function s(e,t){var n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r);return i}function o(e,t){var n=t*Math.PI/180;return{x:parseInt(Math.cos(n)*e),y:parseInt(Math.sin(n)*e)}}var e=$(document),t=$(window),n;return JC.ImageCutter=r,r.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compImageCutter")?t.push(new r(e)):e.find("div.js_compImageCutter").each(function(){t.push(new r(this))})),t},r.minSidelength=50,r._positionPoint=1e4,r._defaultCursor="auto",r.dragInfo=function(e,n,i,s){return e&&n&&i&&(r._dragInfo={ins:e,evt:n,size:e._model.size(),tmpSize:i,pageX:n.pageX,pageY:n.pageY,srcSelector:s,offset:e.selector().offset(),minDistance:e._model.minDistance(),winWidth:t.width(),winHeight:t.height(),btnSidelength:e._model.btnTl().width()}),r._dragInfo},r.cleanInfo=function(){e.off("mouseup",r.dragMainMouseUp),e.off("mousemove",r.dragMainMouseMove),e.off("mouseup",r.dragBtnMouseUp),e.off("mousemove",r.dragBtnMouseMove),r.dragInfo(null),n.css("cursor",r._defaultCursor)},r.dragMainMouseMove=function(e){if(!r.dragInfo()||!e)return;var t=r.dragInfo(),n,n=t.ins,i=t.pageX-e.pageX,s=t.pageY-e.pageY,o=t.size.dragger.left-i,u=t.size.dragger.top-s,a=t.size.maxX-t.size.dragger.srcSidelength,f=t.size.maxY-t.size.dragger.srcSidelength;o<t.size.minX&&(o=t.size.minX),o>a&&(o=a),u<t.size.minY&&(u=t.size.minY),u>f&&(u=f),t.tmpSize.dragger.left=o,t.tmpSize.dragger.top=u,n.updatePosition(t.tmpSize),n.trigger(r.Model.UPDATE_RECT,[t.tmpSize])},r.dragMainMouseUp=function(e){if(!r.dragInfo())return;var t=r.dragInfo(),i=t.ins;n.css("cursor",r._defaultCursor),i._size(t.tmpSize),i.trigger(r.Model.UPDATE_RECT,[t.tmpSize]),i.trigger(r.Model.DRAG_DONE,[t.tmpSize]),i.cleanStatus()},r.dragBtnMouseMove=function(e){if(!r.dragInfo()||!e)return;var t=r.dragInfo(),n=t.ins,i=t.pageX-e.pageX,s=t.pageY-e.pageY,o=t.srcSelector.attr("diretype");switch(o){case"cic_btnTl":r.resizeTopLeft(t,i,s,e);break;case"cic_btnTc":r.resizeTopCenter(t,i,s,e);break;case"cic_btnTr":r.resizeTopRight(t,i,s,e);break;case"cic_btnMl":r.resizeMidLeft(t,i,s,e);break;case"cic_btnMr":r.resizeMidRight(t,i,s,e);break;case"cic_btnBl":r.resizeBottomLeft(t,i,s,e);break;case"cic_btnBc":r.resizeBottomCenter(t,i,s,e);break;case"cic_btnBr":r.resizeBottomRight(t,i,s,e)}n.trigger(r.Model.UPDATE_RECT,[t.tmpSize])},r.dragBtnMouseUp=function(e){if(!r.dragInfo())return;var t=r.dragInfo(),i=t.ins;n.css("cursor",r._defaultCursor),i._size(t.tmpSize),i.trigger(r.Model.UPDATE_RECT,[t.tmpSize]),i.trigger(r.Model.DRAG_DONE,[t.tmpSize]),i.cleanStatus()},JC.BaseMVC.build(r),JC.f.extendObject(r.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var t=this;t.on(r.Model.INITED,function(e){t._model.imageUrl()&&t.update(t._model.imageUrl())}),t.on("CICImageLoad",function(e,n,i,s){if(i<t._model.minSidelength()||s<t._model.minSidelength()){t.trigger(r.Model.ERROR_SIZE,[i,s,n]);return}var o=t._model.size(i,s);if(o.preview.width<t._model.minSidelength()||o.preview.height<t._model.minSidelength()){t.trigger(r.Model.ERROR_PREVIEW,[i,s,n,o]);return}n.css({width:o.preview.width+"px",height:o.preview.height+"px",left:o.left+"px",top:o.top+"px"}),n.prependTo(t.selector()),t._model.imageUrlSelector()&&t._model.imageUrlSelector().length&&t._model.imageUrlSelector().val(n.attr("src")),t._view.initDragger(o),t.trigger(r.Model.INIT_PREVIEW),t.trigger(r.Model.UPDATE_COORDINATE,[o])}),t.selector().delegate("div.cic_dragMain","mousedown",function(i){return i.preventDefault(),i.stopPropagation(),r.cleanInfo(),r.dragInfo(t,i,JC.f.cloneObject(t._model.size()),$(this)),n.css("cursor","move"),t.trigger(r.Model.INIT_PREVIEW),e.on("mousemove",r.dragMainMouseMove),e.on("mouseup",r.dragMainMouseUp),!1}),t.selector().delegate("button.cic_btn","mousedown",function(i){i.preventDefault(),r.cleanInfo(),r.dragInfo(t,i,JC.f.cloneObject(t._model.size()),$(this));var s=$(this),o=s.attr("diretype");switch(o){case"cic_btnTl":n.css("cursor","nw-resize");break;case"cic_btnTc":n.css("cursor","n-resize");break;case"cic_btnTr":n.css("cursor","ne-resize");break;case"cic_btnMl":n.css("cursor","w-resize");break;case"cic_btnMr":n.css("cursor","e-resize");break;case"cic_btnBl":n.css("cursor","sw-resize");break;case"cic_btnBc":n.css("cursor","s-resize");break;case"cic_btnBr":n.css("cursor","se-resize")}return t.trigger(r.Model.INIT_PREVIEW),e.on("mousemove",r.dragBtnMouseMove),e.on("mouseup",r.dragBtnMouseUp),!1}),t.on(r.Model.INIT_PREVIEW,function(e){t._view.initPreviewItems()}),t.on(r.Model.UPDATE_RECT,function(e,n){t.trigger(r.Model.UPDATE_PREVIEW,[n])}),t.on(r.Model.UPDATE_PREVIEW,function(e,n){if(!n)return;t._view.updatePreviewItems(n)}),t.on(r.Model.DRAG_DONE,function(e,n){t.trigger(r.Model.UPDATE_COORDINATE,[n])}),t.on(r.Model.UPDATE_COORDINATE,function(e,n){var n=n||t._model.size(),r=t._model.coordinateSelector();if(!n)return;var i=t._model.realCoordinate(n);t._model.coordinateUpdateCb()&&t._model.coordinateUpdateCb().call(t,i,t._model.imageUrl());if(!r||!r.length)return;r.val(i)}),t.on(r.Model.ERROR_SIZE,function(e,n,r,i){t._view.sizeError(n,r,i)}),t.on(r.Model.ERROR_PREVIEW,function(e,n,r,i,s){t._view.previewError(n,r,i,s)})},_inited:function(){this.trigger(r.Model.INITED)},update:function(e){if(!e)return;this._view.update(e)},updatePosition:function(){this._view.updatePosition.apply(this._view,JC.f.sliceArgs(arguments))},cleanStatus:function(){var e=this;r.cleanInfo()},_size:function(){this._model.size.apply(this._model,JC.f.sliceArgs(arguments))}}),r.Model._instanceName="JCImageCutter",r.Model.INITED="ImageCutterInited",r.Model.INIT_PREVIEW="CICInitPreview",r.Model.DRAG_DONE="CICDragDone",r.Model.UPDATE_RECT="CICUpdateDragger",r.Model.UPDATE_PREVIEW="CICUpdatePreview",r.Model.UPDATE_COORDINATE="CICUpdateCoordinate",r.Model.ERROR_SIZE="CICSizeError",r.Model.ERROR_PREVIEW="CICPreviewError",JC.f.extendObject(r.Model.prototype,{init:function(){var e=this;this._size={selector:{width:e.selector().prop("offsetWidth"),height:e.selector().prop("offsetHeight")},img:{width:0,height:0},preview:{width:0,height:0},left:0,top:0}},imageUrl:function(){return this.attrProp("imageUrl")},previewSelector:function(e){return this.is("[previewSelector]")&&(!this._previewSelector||e)&&(this._previewSelector=this.selectorProp("previewSelector")),this._previewSelector},minSidelength:function(){return this.intProp("minSidelength")||r.minSidelength},minDistance:function(){return s({x:0,y:0},{x:this.minSidelength(),y:this.minSidelength()})},size:function(e,t){if(e&&t){this._size.img={width:e,height:t},this._size.preview={width:e,height:t};if(e>this._size.selector.width||t>this._size.selector.height)this._size.preview=i(e,t,this._size.selector.width,this._size.selector.height);this._size.preview.width=Math.round(this._size.preview.width),this._size.preview.height=Math.round(this._size.preview.height),this._size.left=Math.round((this._size.selector.width-this._size.preview.width)/2),this._size.top=Math.round((this._size.selector.height-this._size.preview.height)/2),this._size.width=e,this._size.height=t,this._size.minX=this._size.left,this._size.maxX=this._size.minX+this._size.preview.width,this._size.minY=this._size.top,this._size.maxY=this._size.minY+this._size.preview.height,this._size.dragger={srcSidelength:0,sidelength:0,halfSidelength:0,left:0,top:0}}return e&&!t&&(this._size=e),this._size},realCoordinate:function(e){var t=[];if(e){var n=this,r=e.img.width/e.preview.width,i=(e.dragger.left-e.left)*r,s=(e.dragger.top-e.top)*r,o=e.dragger.srcSidelength*r;i=Math.ceil(i),s=Math.ceil(s),o=Math.ceil(o),i<0&&(i=0),s<0&&(s=0),i+o>e.img.width&&(o=e.img.width-i),s+o>e.img.height&&(o=e.img.height-s),t.push(i,s,o,o,e.img.width,e.img.height)}return t},coordinateUpdateCb:function(){return this.callbackProp("coordinateUpdateCb")},clean:function(){},draggerList:function(){return this._draggerList||(this._draggerList=$(JC.f.printf("{0}{1}{2}{3}{4}{5}{6}{7}{8}",'<button type="button" class="cic_btn cic_btnTl" diretype="cic_btnTl" ></button>','<button type="button" class="cic_btn cic_btnTc" diretype="cic_btnTc" ></button>','<button type="button" class="cic_btn cic_btnTr" diretype="cic_btnTr" ></button>','<button type="button" class="cic_btn cic_btnMl" diretype="cic_btnMl" ></button>','<button type="button" class="cic_btn cic_btnMr" diretype="cic_btnMr" ></button>','<button type="button" class="cic_btn cic_btnBl" diretype="cic_btnBl" ></button>','<button type="button" class="cic_btn cic_btnBc" diretype="cic_btnBc" ></button>','<button type="button" class="cic_btn cic_btnBr" diretype="cic_btnBr" ></button>')),this._draggerList.hide().appendTo(this.selector())),this._draggerList},btnTl:function(){return!this._btnTl&&(this.draggerList(),this._btnTl=this.selector().find("button.cic_btnTl")),this._btnTl},btnTc:function(){return!this._btnTc&&(this.draggerList(),this._btnTc=this.selector().find("button.cic_btnTc")),this._btnTc},btnTr:function(){return!this._btnTr&&(this.draggerList(),this._btnTr=this.selector().find("button.cic_btnTr")),this._btnTr},btnMl:function(){return!this._btnMl&&(this.draggerList(),this._btnMl=this.selector().find("button.cic_btnMl")),this._btnMl},btnMr:function(){return!this._btnMr&&(this.draggerList(),this._btnMr=this.selector().find("button.cic_btnMr")),this._btnMr},btnBl:function(){return!this._btnBl&&(this.draggerList(),this._btnBl=this.selector().find("button.cic_btnBl")),this._btnBl},btnBc:function(){return!this._btnBc&&(this.draggerList(),this._btnBc=this.selector().find("button.cic_btnBc")),this._btnBc},btnBr:function(){return!this._btnBr&&(this.draggerList(),this._btnBr=this.selector().find("button.cic_btnBr")),this._btnBr},maskList:function(){return this._maskList||(this._maskList=$(JC.f.printf("{0}{1}{2}{3}",'<div class="cic_mask cic_maskLeft"></div>','<div class="cic_mask cic_maskTop"></div>','<div class="cic_mask cic_maskRight"></div>','<div class="cic_mask cic_maskBottom"></div>')),this._maskList.hide().appendTo(this.selector())),this._maskList},maskLeft:function(){return!this._maskLeft&&(this.maskList(),this._maskLeft=this.selector().find("div.cic_maskLeft")),this._maskLeft},maskTop:function(){return!this._maskTop&&(this.maskList(),this._maskTop=this.selector().find("div.cic_maskTop")),this._maskTop},maskRight:function(){return!this._maskRight&&(this.maskList(),this._maskRight=this.selector().find("div.cic_maskRight")),this._maskRight},maskBottom:function(){return!this._maskBottom&&(this.maskList(),this._maskBottom=this.selector().find("div.cic_maskBottom")),this._maskBottom},dragMain:function(){return this._dragMain||(this._dragMain=$('<div class="cic_dragMain"></div>'),this._dragMain.hide().appendTo(this.selector())),this._dragMain},cicErrorBox:function(){return this._cicErrorBox||(this._cicErrorBox=$('<div class="CIC_ERROR"></div>'),this._cicErrorBox.appendTo(this.selector())),this._cicErrorBox},coordinateSelector:function(){return this.selectorProp("coordinateSelector")},defaultCoordinate:function(){var e=this,t="",n=this.attrProp("defaultCoordinate");return n&&(t=n.replace(/[^\d,\-]+/g,""),t&&(t=t.split(","),$.each(t,function(e,n){t[e]=parseInt(n,10),JC.log("aaa",n,t[e])}),JC.log(t))),t},imageUrlSelector:function(){return this.selectorProp("imageUrlSelector")}}),JC.f.extendObject(r.View.prototype,{init:function(){var e=this},clean:function(){this.selector().find("img").remove(),this.selector().find("button").hide(),this._model.cicErrorBox().hide()},update:function(e){if(!e)return;var t=this,n=document.createElement("img");t.clean(),$(n).on("load",function(){t.trigger("CICImageLoad",[$(n),this.width,this.height])}),$(n).on("mousedown",function(e){return e.preventDefault(),!1}),n.src=e},initDragger:function(e){this._model.dragMain(),this._model.maskList();var t=this,n=t._model.draggerList(),r=e.preview.width>e.preview.height?e.preview.height:e.preview.width,r=r/2>t._model.minSidelength()?r/2:t._model.minSidelength(),r=Math.ceil(r),r=r>t._model.minSidelength()?r:t._model.minSidelength(),i=t._model.btnTl().width(),s=r,r=r-i,o=r/2,u=e.left+(e.preview.width-r)/2-i/2,a=e.top+(e.preview.height-r)/2-i/2;e.dragger={srcSidelength:s,sidelength:r,halfSidelength:o,left:u,top:a},e=t.processDefaultCoordinate(e),t.updatePosition(e)},processDefaultCoordinate:function(e){var t=this,n=t._model.defaultCoordinate(),r=t._model.btnTl().width();if(n.length){var i=e.dragger.srcSidelength,s=e.dragger.sidelength,o=e.dragger.halfSidelength,u=e.left,a=e.top;switch(n.length){case 1:i=n[0],u=e.left+(e.preview.width-i)/2,a=e.top+(e.preview.height-i)/2;break;case 2:u=n[0],a=n[1];break;case 3:u=n[0]+e.left,a=n[1]+e.top,i=n[2]}if(i>e.preview.width||i>e.preview.height)i=e.preview.width>e.preview.height?e.preview.height:e.preview.width,u=e.left+(e.preview.width-i)/2,a=e.top+(e.preview.height-i)/2;if(u<e.left||u+i>e.left+e.preview.width||a<e.top||a+i>e.top+e.preview.height)u=e.left+(e.preview.width-i)/2,a=e.top+(e.preview.height-i)/2;s=i-r,o=s/2,i<t._model.minSidelength()&&(i=t._model.minSidelength(),s=i-r,o=s/2,u=e.left+(t.preview.width-i)/2,a=e.top+(t.preview.height-i)/2),e.dragger={srcSidelength:i,sidelength:s,halfSidelength:o,left:u,top:a}}return e},updatePosition:function(e){var t=this;t.updateDragger(e),t.updateMask(e),t.updateDragMain(e)},updateDragger:function(e){var t=this;t._model.btnTl().css({left:e.dragger.left,top:e.dragger.top}),t._model.btnTc().css({left:e.dragger.left+e.dragger.halfSidelength,top:e.dragger.top}),t._model.btnTr().css({left:e.dragger.left+e.dragger.sidelength,top:e.dragger.top}),t._model.btnMl().css({left:e.dragger.left,top:e.dragger.top+e.dragger.halfSidelength}),t._model.btnMr().css({left:e.dragger.left+e.dragger.sidelength,top:e.dragger.top+e.dragger.halfSidelength}),t._model.btnBl().css({left:e.dragger.left,top:e.dragger.top+e.dragger.sidelength}),t._model.btnBc().css({left:e.dragger.left+e.dragger.halfSidelength,top:e.dragger.top+e.dragger.sidelength}),t._model.btnBr().css({left:e.dragger.left+e.dragger.sidelength,top:e.dragger.top+e.dragger.sidelength}),t._model.draggerList().show()},updateMask:function(e){var t=this,n=t._model.maskList();t._model.maskLeft().css({height:e.dragger.srcSidelength,width:e.dragger.left,top:e.dragger.top}),t._model.maskTop().css({height:e.dragger.top,width:e.selector.width}),t._model.maskRight().css({left:e.dragger.left+e.dragger.srcSidelength,top:e.dragger.top,width:e.selector.width-e.dragger.left-e.dragger.srcSidelength,height:e.dragger.srcSidelength}),t._model.maskBottom().css({height:e.selector.height-(e.dragger.top+e.dragger.srcSidelength),width:e.selector.width,top:e.dragger.top+e.dragger.srcSidelength}),n.show()},updateDragMain:function(e){var t=this,n=t._model.dragMain();n.css({width:e.dragger.srcSidelength,height:e.dragger.srcSidelength,left:e.dragger.left,top:e.dragger.top}),n.show()},initPreviewItems:function(){var e=this,t=e._model.previewSelector(!0);if(!t||!t.length)return;t.each(function(){var t=$(this),n=t.find("img");n.length?n.attr("src",e._model.imageUrl()):(n=$(JC.f.printf('<img src="{0}" />',e._model.imageUrl())),n.appendTo(t))}),e.trigger(r.Model.UPDATE_RECT,[e._model.size()])},updatePreviewItems:function(e){var t=this,n=t._model.previewSelector();if(!e)return;if(!n||!n.length)return;n.each(function(){var t=$(this),n=t.width(),r=t.find("img");if(!n||!r.length)return;var n=t.width(),i=n/e.dragger.srcSidelength,s=e.preview.width*i,o=e.preview.height*i,u=(e.dragger.left-e.left)*i,a=(e.dragger.top-e.top)*i;r.css({width:s,height:o,left:-u,top:-a})})},sizeError:function(e,t,n){this._model.cicErrorBox().show().html(JC.f.printf("{5}<p>图片实际宽高为: {2}, {3}</p><p>可接受的最小宽高为: {0}, {1}</p>{4}",this._model.minSidelength(),this._model.minSidelength(),e,t,'<a href="'+n.attr("src")+'" target="_blank">查看图片</a>',"<h3>图片尺寸错误 </h3>"))},previewError:function(e,t,n,r){this._model.cicErrorBox().show().html(JC.f.printf("{5}<p>图片实际宽高为: {2}, {3}</p><p>图片缩放后宽高为: {6}, {7}</p><p>可接受的最小宽高为: {0}, {1}</p>{4}",this._model.minSidelength(),this._model.minSidelength(),e,t,'<a href="'+n.attr("src")+'" target="_blank">查看图片</a>',"<h3>图片缩放比例尺寸错误 </h3>",r.preview.width,r.preview.height))}}),r.resizeTopLeft=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left+e.size.dragger.srcSidelength,a=e.size.dragger.top+e.size.dragger.srcSidelength,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:0,y:-r._positionPoint})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:0,y:-r._positionPoint})),c=f-l,h=e.size.dragger.srcSidelength+c;a-h<e.size.top&&(h=a-e.size.top),u-h<e.size.left&&(h=u-e.size.left),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u-h,top:a-h},o.updatePosition(e.tmpSize)},r.resizeTopCenter=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.left+e.size.preview.width,a=e.size.dragger.top+e.size.dragger.srcSidelength,f=e.size.dragger.left+e.size.dragger.srcSidelength/2,l=Math.ceil(s({x:e.pageX,y:e.pageY},{x:e.pageX,y:-r._positionPoint})),c=Math.ceil(s({x:i.pageX,y:i.pageY},{x:e.pageX,y:-r._positionPoint})),h=l-c,p=e.size.dragger.srcSidelength+h;a-p<e.size.top&&(p=a-e.size.top),f-p/2<e.size.left&&(p=(f-e.size.left)*2),f+p/2>u&&(p=(u-f)*2),p=p<o._model.minSidelength()?o._model.minSidelength():p,e.tmpSize.dragger={srcSidelength:p,sidelength:p-e.btnSidelength,halfSidelength:(p-e.btnSidelength)/2,left:f-p/2,top:a-p},o.updatePosition(e.tmpSize)},r.resizeTopRight=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left,a=e.size.dragger.top+e.size.dragger.srcSidelength,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:r._positionPoint,y:0})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:r._positionPoint,y:0})),c=f-l,h=e.size.dragger.srcSidelength+c;a-h<e.size.top&&(h=a-e.size.top),u+h>e.size.left+e.size.preview.width&&(h=e.size.left+e.size.preview.width-u),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u,top:a-h},o.updatePosition(e.tmpSize)},r.resizeMidLeft=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left+e.size.dragger.srcSidelength,a=e.size.dragger.top+e.size.dragger.srcSidelength/2,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:-r._positionPoint,y:e.pageY})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:-r._positionPoint,y:e.pageY})),c=f-l,h=e.size.dragger.srcSidelength+c;a-h/2<e.size.top&&(h=(a-e.size.top)*2),a+h/2>e.size.top+e.size.preview.height&&(h=(e.size.top+e.size.preview.height-a)*2),u-h<e.size.left&&(h=u-e.size.left),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u-h,top:a-h/2},o.updatePosition(e.tmpSize)},r.resizeMidRight=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left,a=e.size.dragger.top+e.size.dragger.srcSidelength/2,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:r._positionPoint,y:e.pageY})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:r._positionPoint,y:e.pageY})),c=f-l,h=e.size.dragger.srcSidelength+c;a-h/2<e.size.top&&(h=(a-e.size.top)*2),a+h/2>e.size.top+e.size.preview.height&&(h=(e.size.top+e.size.preview.height-a)*2),u+h>e.size.left+e.size.preview.width&&(h=e.size.left+e.size.preview.width-u),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u,top:a-h/2},o.updatePosition(e.tmpSize)},r.resizeBottomLeft=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left+e.size.dragger.srcSidelength,a=e.size.dragger.top,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:r._positionPoint,y:0})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:r._positionPoint,y:0})),c=f-l,h=e.size.dragger.srcSidelength-c;a+h>e.size.top+e.size.preview.height&&(h=e.size.top+e.size.preview.height-a),u-h<e.size.left&&(h=u-e.size.left),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u-h,top:a},o.updatePosition(e.tmpSize)},r.resizeBottomCenter=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.top,a=e.size.dragger.left+e.size.dragger.srcSidelength/2,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:e.pageX,y:-r._positionPoint})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:e.pageX,y:-r._positionPoint})),c=f-l,h=e.size.dragger.srcSidelength-c;u+h>e.size.top+e.size.preview.height&&(h=e.size.top+e.size.preview.height-u),a-h/2<e.size.left&&(h=(a-e.size.left)*2),a+h/2>e.size.left+e.size.preview.width&&(h=(e.size.left+e.size.preview.width-a)*2),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:a-h/2,top:u},o.updatePosition(e.tmpSize)},r.resizeBottomRight=function(e,t,n,i){if(!e)return;var o=e.ins,u=e.size.dragger.left,a=e.size.dragger.top,f=Math.ceil(s({x:e.pageX,y:e.pageY},{x:0,y:-r._positionPoint})),l=Math.ceil(s({x:i.pageX,y:i.pageY},{x:0,y:-r._positionPoint})),c=f-l,h=e.size.dragger.srcSidelength-c;u+h>e.size.left+e.size.preview.width&&(h=e.size.left+e.size.preview.width-u),a+h>e.size.top+e.size.preview.height&&(h=e.size.top+e.size.preview.height-a),h=h<o._model.minSidelength()?o._model.minSidelength():h,e.tmpSize.dragger={srcSidelength:h,sidelength:h-e.btnSidelength,halfSidelength:(h-e.btnSidelength)/2,left:u,top:a},o.updatePosition(e.tmpSize)},e.ready(function(){n=$("body"),r._defaultCursor=n.css("cursor"),r.autoInit&&r.init()}),JC.ImageCutter})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);