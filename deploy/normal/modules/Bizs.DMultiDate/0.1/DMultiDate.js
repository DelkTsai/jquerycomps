(function(e,t){e(["JC.BaseMVC","JC.Calendar"],function(){function e(t){if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return window.Bizs.DMultiDate=e,e.prototype={_beforeInit:function(){var e=this},_initHanlderEvent:function(){var t=this,n=e.Model._inscount++,r="Bizs.DMultiDate_update_start"+n,i="Bizs.DMultiDate_update_end"+n,s="Bizs.DMultiDate_show_start"+n,o="Bizs.DMultiDate_show_end"+n,u="Bizs.DMultiDate_hide_start"+n,a="Bizs.DMultiDate_hide_end"+n,f="Bizs.DMultiDate_layoutchange_start"+n,l="Bizs.DMultiDate_layoutchange_end"+n,c="parsedateweek",h="parsedatemonth",p="parsedateseason",d="parsedateyear";t._initDefaultData(),t._model.calendarTypeEl().on("change",function(e,n){var r=$(this),i=r.val();i==="day"&&(i="date"),t._model.updatemddateElProp(i);if(n)return;setTimeout(function(){t._model.setmddate(""),t._model.setHiddenStartdate(""),t._model.setHiddenEnddate(""),Calendar.pickDate(t._model.mddateEl().eq(0)[0])},10)}),t._model.mddateEl().eq(0).attr("calendarupdate",r).attr("calendarshow",s).attr("calendarhide",u).attr("calendarlayoutchange",f),t._model.mddateEl().eq(1).attr("calendarupdate",i).attr("calendarshow",o).attr("calendarhide",a).attr("calendarlayoutchange",l),window[r]=function(e,n){var r=t._model.mddateEl(),i=t._model.calendarType(),s=e,o=r.eq(1).attr("maxvalue"),u,a=new Date;o&&(o=JC.f.dateDetect(o));switch(i){case"week":u=t._model.weekrange(),u&&s.setDate(s.getDate()+(u-1)*7+6);break;case"month":u=t._model.monthrange(),u&&s.setMonth(s.getMonth()+(u-1));break;case"season":u=t._model.seasonrange(),u&&s.setMonth(s.getMonth()+u*3);break;case"year":u=t._model.yearrange(),u&&s.setYear(s.getFullYear()+u);break;case"date":default:u=t._model.dayrange(),u&&s.setDate(s.getDate()+u)}u&&(o.getTime()<=a.getTime()&&s.getTime()>a.getTime()&&(s=o),r.eq(1).attr("maxvalue",JC.f.formatISODate(s))),t._model.setHiddenStartdate(JC.f.formatISODate(e))},window[i]=function(e,n){var r=t._model.getRange(t._model.calendarType());r,t._model.setHiddenEnddate(JC.f.formatISODate(e))},window[s]=function(){},window[o]=function(){},window[u]=function(){JC.Tips&&JC.Tips.hide(),t._model.updateHiddenStartdate()},window[a]=function(){JC.Tips&&JC.Tips.hide(),t._model.updateHiddenEnddate()},window[f]=function(){},window[l]=function(){},window[c]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.split("W");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r,i,s,o,u,a;r=parseInt(e[0],10),i=parseInt(e[1],10),s=JC.f.pureDate(new Date(e[0]),0,1),o=JC.f.pureDate(new Date(e[1]),0,1),u=u||JC.f.weekOfYear(e[0],JC.Calendar.weekDayOffset),$(u).each(function(e,n){if(n.week===i)return t.start=new Date,t.end=new Date,t.start.setTime(n.start),t.end.setTime(n.end),!1})}return t},window[h]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.replace(/[^\d]+/g,"");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r=e.slice(0,4),i=parseInt(e.slice(4,6),10)-1;t.start=new Date(r,i,1)}return t},window[p]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.split("Q");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r=parseInt(e[0],10),i=parseInt(e[1],10),s=JC.f.pureDate(new Date(e[0]),0,1),o=JC.f.pureDate(new Date(e[1]),0,1),u=JC.f.seasonOfYear(e[0]);$(u).each(function(e,n){if(n.season===i)return t.start=new Date,t.end=new Date,t.start.setTime(n.start),t.end.setTime(n.end),!1})}return t},window[d]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;return e&&(e=e.replace(/[^\d]+/g,""),n=e.slice(0,4),t.start=new Date(n,0,1)),t.start||(t.start=new Date,t.end=new Date),t},t._model.calendarTypeEl().trigger("change",[!0])},_initDefaultData:function(){var e=this,t=e._model.urlStartdate(),n=e._model.urlEnddate(),r=e._model.urlCalendarType()||e._model.calendarType();e._model.updatemddateElProp(r),e._model.calendarTypeEl().val(r),setTimeout(function(){e._model.setmddate(t,n),e._model.setHiddenStartdate(t),e._model.setHiddenEnddate(n)},200)},_inited:function(){}},e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.isDMultiDate=function(e){var t;return e&&(e=$(e)).length&&(t=e.is("[DMultiDatelayout]")),t},BaseMVC.buildModel(e),e.Model._instanceName="DMultiDate",e.Model._inscount=1,e.Model.prototype={init:function(){},calendarTypeEl:function(){return this.selector().find(">select")},calendarType:function(){return this.calendarTypeEl().val()},mddateEl:function(){var e=this,t=e.attrProp("mddateEl")||".js_multidate";return JC.f.parentSelector(e.selector(),t)},setmddate:function(e,t){var n=this.mddateEl();n.eq(0).val(e),n.eq(1).val(t)},updatemddateElProp:function(e){var t=this,n=t.mddateEl();n.attr("multidate",e),e==="date"?n.removeAttr("dateparse").removeAttr("dateformat").removeAttr("fulldateformat"):(n.eq(0).attr("fulldateformat","{0}"),n.eq(1).attr("fulldateformat","{1}"),n.attr("dateformat",t.dateformartType(e)).attr("dateparse","parsedate"+e))},dateformartType:function(e){var t;switch(e){case"week":t="YYWWK";break;case"month":t="YY-MM";break;case"season":t="YYQYQ";break;case"year":t="YY";break;case"date":default:t=""}return t},hiddenStartdateEl:function(){var e=this,t=e.attrProp("mdstartdate")||".js_startdate";return JC.f.parentSelector(e.selector(),t)},hiddenEnddateEl:function(){var e=this,t=e.attrProp("mdenddate")||".js_enddate";return JC.f.parentSelector(e.selector(),t)},setHiddenStartdate:function(e){this.hiddenStartdateEl().val(e)},setHiddenEnddate:function(e){this.hiddenEnddateEl().val(e)},updateHiddenStartdate:function(){var e=this,t=e.mddateEl().eq(0).val();if(!t){e.setHiddenStartdate("");return}e.setHiddenStartdate(t)},updateHiddenEnddate:function(){var e=this,t=e.mddateEl().eq(1).val();if(!t){e.setHiddenEnddate("");return}e.setHiddenEnddate(t)},urlCalendarType:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.calendarTypeEl().attr("name")||"")||"").toLowerCase()},urlStartdate:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.hiddenStartdateEl().attr("name")||"")||"")},urlEnddate:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.hiddenEnddateEl().attr("name")||"")||"")},decodedata:function(e){e=e.replace(/[\+]/g," ");try{e=decodeURIComponent(e)}catch(t){}return e},getRange:function(e){var t=this,n;switch(e){case"week":n=t.weekrange();break;case"month":n=t.monthrange();break;case"season":n=t.seasonrange();break;case"year":n=t.yearrange();break;default:n=t.dayrange()}return n},dayrange:function(){return this.intProp("mddayrange")},weekrange:function(){return this.intProp("mdweekrange")},monthrange:function(){return this.intProp("mdmonthrange")},seasonrange:function(){return this.intProp("mdseasonrange")},yearrange:function(){return this.intProp("mdyearrange")}},BaseMVC.buildView(e),e.View.prototype={init:function(){return this}},BaseMVC.build(e,"Bizs"),$(document).ready(function(){$(".js_autoDMultiDate").each(function(){new e($(this))})}),Bizs.DMultiDate})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);