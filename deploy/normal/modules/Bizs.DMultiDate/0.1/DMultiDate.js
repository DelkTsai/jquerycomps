(function(e,t){e(["JC.BaseMVC","JC.Calendar"],function(){function e(t){if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return window.Bizs.DMultiDate=e,e.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var e=this;$([e._view,e._model]).on("BindEvent",function(t,n,r){e.on(n,r)}),$([e._view,e._model]).on("TriggerEvent",function(t,n){var r=JC.f.sliceArgs(arguments);r.shift(),r.shift(),e.trigger(n,r)}),e._initDefaultValue(),e._initHandlerEvent(),e.selector().trigger("change",[!0])},_initDefaultValue:function(){var e=this,t=e._model.qstartdate(),n=e._model.qenddate(),r=e._model.mdCustomStartDate(),i=e._model.mdCustomEndDate();e._model.selector(e._model.qtype()),e._model.mdstartdate(t),e._model.mdenddate(n),e._model.mddate().attr("name")?e._model.mddate(e._model.qdate()):t&&n&&(t==n?e._model.mddate(JC.f.formatISODate(JC.f.parseISODate(t))):e._model.mddate(JC.f.printf("{0} è‡³ {1}",JC.f.formatISODate(JC.f.parseISODate(t)),JC.f.formatISODate(JC.f.parseISODate(n))))),r&&r.length&&r.val(t?JC.f.formatISODate(JC.f.parseISODate(t)):t),i&&i.length&&i.val(n?JC.f.formatISODate(JC.f.parseISODate(n)):n)},_initHandlerEvent:function(){var e=this;e._model.selector().on("change",function(t,n){var r=$(this),i=r.val().trim().toLowerCase(),s=e._model.mdDefaultBox(),o=e._model.mdCustomBox();if(i=="custom")s&&o&&s.length&&o.length&&(s.hide(),s.find("input").prop("disabled",!0),o.find("input").prop("disabled",!1),o.show());else{s&&o&&s.length&&o.length&&(o.hide(),o.find("input").prop("disabled",!0),s.find("input").prop("disabled",!1),s.show());if(n)return;e._model.settype(i),setTimeout(function(){JC.Calendar.pickDate(e._model.mddate()[0]),e._model.mdstartdate(""),e._model.mdenddate("")},10)}})},_inited:function(){}},e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.isDMultiDate=function(e){var t;return e&&(e=$(e)).length&&(t=e.is("[DMultiDatelayout]")),t},BaseMVC.buildModel(e),e.Model._instanceName="DMultiDate",e.Model._inscount=1,e.Model.prototype={init:function(){var t=this,n="Bizs.DMultiDate_Start"+e.Model._inscount,r="Bizs.DMultiDate_End"+e.Model._inscount,i="Bizs.DMultiDate_show_"+e.Model._inscount,s="Bizs.DMultiDate_hide_"+e.Model._inscount,o="Bizs.DMultiDate_hide_start_"+e.Model._inscount,u="Bizs.DMultiDate_hide_end_"+e.Model._inscount,a="Bizs.DMultiDate_layoutchange_"+e.Model._inscount;return e.Model._inscount++,window[n]=function(e,n,r){t.mdstartdate(JC.f.formatISODate(e,"")),console.log("_startDate",e)},window[r]=function(e,n,r){t.mdenddate(JC.f.formatISODate(n,"")),console.log("_endDate",n)},t.mddate().eq(0).attr("calendarupdate",n),t.mddate().eq(1).attr("calendarupdate",r),console.log("xxx"),window[i]=function(){var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},t.mddate().attr("calendarshow",i),window[o]=function(){JC.Tips&&JC.Tips.hide(),t.updateHiddenDate()},window[u]=function(){JC.Tips&&JC.Tips.hide(),t.updateHiddenDate()},t.mddate().eq(0).attr("calendarhide",o),t.mddate().eq(1).attr("calendarhide",u),window[a]=function(){JC.Tips&&JC.Tips.hide();var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},t.mddate().attr("calendarlayoutchange",a),t},mdDefaultBox:function(){return this.selectorProp("mdDefaultBox")},mdCustomBox:function(){return this.selectorProp("mdCustomBox")},mdCustomStartDate:function(){return this.selectorProp("mdCustomStartDate")},mdCustomEndDate:function(){return this.selectorProp("mdCustomEndDate")},selector:function(e){return typeof e!="undefined"&&this.hastype(this.qtype())&&this._selector.val(e)&&this.settype(e),this._selector},mddateBox:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mddatebox"));return t},mddate:function(e){var t=this.mddateBox().find(this.selector().attr("mddate"));return typeof e!="undefined"&&t.val(e),t},mdstartdate:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mdstartdate"));return typeof e!="undefined"&&t.val(e.replace(/[^\d]/g,"")),t},mdenddate:function(e){var t=JC.f.parentSelector(this.selector(),this.selector().attr("mdenddate"));return typeof e!="undefined"&&t.val(e.replace(/[^\d]/g,"")),t},qtype:function(){return this.decodedata(JC.f.getUrlParam(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(JC.f.getUrlParam(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(JC.f.getUrlParam(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(JC.f.getUrlParam(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(e){var t=!1;return this.selector().find("> option").each(function(){if($(this).val().trim()==e)return t=!0,!1}),t},settype:function(e){var t=this.mddate();switch(e){case"date":this.selector().attr("mddatebox","/.js_multidateDateBox");break;case"week":this.selector().attr("mddatebox","/.js_multidateWeekBox");break;case"season":this.selector().attr("mddatebox","/.js_multidateSeasonBox");break;case"month":this.selector().attr("mddatebox","/.js_multidateMonthBox")}this.mddateBox().css("display","inline-block").siblings(".js_multidateBox").hide(),t.val("")},decodedata:function(e){e=e.replace(/[\+]/g," ");try{e=decodeURIComponent(e)}catch(t){}return e},updateHiddenDate:function(){var e=this;e.mddate().each(function(t){var n=$(this),r=$.trim(n.val());if(!r){t===0&&e.mdstartdate(""),t===1&&e.mdenddate("");return}r=r.replace(/[^\d]+/g,""),t===0&&e.mdstartdate(r),t===2&&e.mdenddate(r)})}},BaseMVC.buildView(e),e.View.prototype={init:function(){return this}},BaseMVC.build(e,"Bizs"),$(document).ready(function(){$("select.js_autoDMultiDate").each(function(){new e($(this))})}),Bizs.DMultiDate})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);