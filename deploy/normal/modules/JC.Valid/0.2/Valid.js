(function(e,t){e(["JC.common"],function(){function e(){var r=JC.f.sliceArgs(arguments);if(r.length)return e.check.apply(null,r);if(e._instance)return e._instance;e._instance=this,this._model=new t,this._view=new n(this._model),this._init()}function t(){this._init()}function n(e){this._model=e}return window.JC=window.JC||{log:function(){}},JC.Valid=window.Valid=e,e.prototype={_init:function(){var e=this;return $([this._view,this._model]).on(t.BIND,function(t,n,r){e.on(n,r)}),$([this._view,this._model]).on(t.TRIGGER,function(t,n){var r=JC.f.sliceArgs(arguments).slice(2);e.trigger(n,r)}),e.on(t.CORRECT,function(t){var n=JC.f.sliceArgs(arguments).slice(1);e._view.valid.apply(e._view,n)}),e.on(t.ERROR,function(t){var n=JC.f.sliceArgs(arguments).slice(1);e._view.error.apply(e._view,n)}),e.on(t.FOCUS_MSG,function(t){var n=JC.f.sliceArgs(arguments).slice(1);e._view.focusmsg.apply(e._view,n)}),this._view.init(),this},on:function(e,t){return $(this).on(e,t),this},trigger:function(e,t){return $(this).trigger(e,t),this},parse:function(n){var r=this,i=!0,n=$(n);if(!r._model.isAvalible(n))return i;if(!r._model.isValid(n))return i;if(e.ignore(n))return i;var s=r._model.parseDatatype(n),o=n.prop("nodeName").toLowerCase();switch(o){case"input":case"textarea":(n.attr("type")||"").toLowerCase()!="file"&&r._model.isAutoTrim(n)&&n.val($.trim(n.val()))}if(!r._model.reqmsg(n))return i=!1,i;if(!r._model.lengthValid(n))return i=!1,i;if(s&&r._model[s]&&n.val()&&!r._model[s](n))return i=!1,i;var u=n.attr("subdatatype");return u&&(u=u.replace(/[\s]+/g,"").split(/[,\|]/),$.each(u,function(e,t){t=r._model.parseSubdatatype(t);if(t&&r._model[t]&&(n.val()||t=="alternative")&&!r._model[t](n))return i=!1,!1})),i&&r.trigger(t.CORRECT,n),i},check:function(){var t=this,n=!0,r=JC.f.sliceArgs(arguments),i,s;return $.each(r,function(r,o){o=$(o),e.isFormValid=!1;if(t._model.isForm(o)){e.isFormValid=!0;var u=t._model.isErrorAbort(o),a=e.ignore(o),f;for(i=0,s=o[0].length;i<s;i++){var l=$(o[0][i]);if(!t._model.isValid(l))continue;if(a&&!l.val().trim())continue;!t.parse(l)&&(n=!1);if(u&&!n)break}}else if(e.isFormControl(o)){if(!t._model.isValid(o))return;!t.parse(o)&&(n=!1)}else!t.check(o.find(e._formControls))&&(n=!1)}),n},clearError:function(){var t=JC.f.sliceArgs(arguments),n=this;return $.each(t,function(t,n){$(n).each(function(){var t=$(this);switch(t.prop("nodeName").toLowerCase()){case"form":for(var n=0,r=t[0].length;n<r;n++)e.setValid($(t[0][n]),1,!0);break;default:e.setValid(t,1,!0)}})}),this},isValid:function(e){return this._model.isValid(e)}},e.checkAll=e.check=function(){return e.getInstance().check.apply(e.getInstance(),JC.f.sliceArgs(arguments))},e.getInstance=function(){return!e._instance&&new e,e._instance},e.checkTimeout=function(t,n){t&&(t=$(t));if(!t||!t.length)return;n=parseInt(t.attr("validCheckTimeout"))||n;var r="VALID_CHECK_TIMEOUT";n?(t.data(r)&&clearTimeout(t.data(r)),t.data(r,setTimeout(function(){e.check(t)},n))):e.check(t)},e.dataValid=function(t,n,r,i){var s=!1,o="datavalidmsg";return t&&(t=$(t)),typeof n!="undefined"?(s=n,t.attr("datavalid",n),r||(n?t.trigger("blur",[!0]):(i&&(o=" "+i),e.setError(t,o,!0)))):t&&t.length&&(s=JC.f.parseBool(t.attr("datavalid"))),s},e.isValid=function(t){return e.getInstance().isValid(t)},e.statusTimeout={valid:function(n,r){n&&(n=$(n));if(!n||!n.length)return;n.data(t.TIMEOUT_VALID)&&clearTimeout(n.data(t.TIMEOUT_VALID)),r&&e.statusTimeout.clear(),r&&n.data(t.TIMEOUT_VALID,r)},error:function(n,r){n&&(n=$(n));if(!n||!n.length)return;n.data(t.TIMEOUT_ERROR)&&clearTimeout(n.data(t.TIMEOUT_ERROR)),r&&e.statusTimeout.clear(),r&&n.data(t.TIMEOUT_ERROR,r)},focus:function(n,r){n&&(n=$(n));if(!n||!n.length)return;n.data(t.TIMEOUT_FOCUS)&&clearTimeout(n.data(t.TIMEOUT_FOCUS)),r&&e.statusTimeout.clear(),r&&n.data(t.TIMEOUT_FOCUS,r)},success:function(n,r){n&&(n=$(n));if(!n||!n.length)return;n.data(t.TIMEOUT_SUCCESS)&&clearTimeout(n.data(t.TIMEOUT_SUCCESS)),r&&e.statusTimeout.clear(),r&&n.data(t.TIMEOUT_SUCCESS,r)},clear:function(t){for(var n in e.statusTimeout){if(n=="clear")continue;e.statusTimeout[n](t)}}},e.setValid=function(t,n,r,i){return t=$(t),t.each(function(t,s){s=$(this),e.statusTimeout.clear(s),$(e.getInstance()._view).trigger("setValid",[s,n,r,i])}),e.getInstance()},e.setError=function(t,n,r){return t=$(t),t.each(function(t,i){i=$(this),e.statusTimeout.clear(i);if(n&&n.trim()&&/^[\s]/.test(n)){var s="autoGenerateErrorMsg";i.attr(s,n),n=s}$(e.getInstance()._view).trigger("setError",[i,n,r])}),e.getInstance()},e.focusmsg=e.setFocusMsg=function(n,r,i){return n=$(n),n.each(function(n,s){s=$(this),e.statusTimeout.clear(s),typeof r=="string"&&(i=r,r=!1);if(i&&i.trim()&&/^[\s]/.test(i)){var o="autoGenerateFocusMsg";s.attr(o,i),i=o}e.getInstance().trigger(t.FOCUS_MSG,[s,r,i])}),e.getInstance()},e.focusmsgEverytime=!0,e.emDisplayType="inline",e.showValidStatus=!1,e.clearError=function(){return e.getInstance().clearError.apply(e.getInstance(),JC.f.sliceArgs(arguments))},e.errorAbort=!1,e.autoTrim=!0,e.itemCallback,e.ignore=function(e,t){e=$(e);if(!e||!e.length)return!0;var n=!1;return typeof t!="undefined"?(t?e.removeAttr("ignoreprocess"):e.attr("ignoreprocess",!0),n=!t):e.is("[ignoreprocess]")&&((e.attr("ignoreprocess")||"").trim()?n=JC.f.parseBool(e.attr("ignoreprocess")):n=!0),n},e._formControls="input, select, textarea",e.isFormControl=function(t){var n=!1;return t&&(t=$(t)).length&&(n=t.is(e._formControls)),n},e.ignoreAutoCheckEvent=!1,t.TRIGGER="TriggerEvent",t.BIND="BindEvent",t.ERROR="ValidError",t.CORRECT="ValidCorrect",t.FOCUS_MSG="ValidFocusMsg",t.TIMEOUT_VALID="Valid_ValidTimeout",t.TIMEOUT_ERROR="Valid_ErrorTimeout",t.TIMEOUT_FOCUS="Valid_FocusTimeout",t.TIMEOUT_SUCCESS="Valid_SuccessTimeout",t.SELECTOR_ERROR="~ em.error, ~ em.errormsg",t.CSS_ERROR="error errormsg",t.FILTER_ERROR="em.error em.errormsg",t.prototype={_init:function(){return this},parseDatatype:function(e){var t="";return typeof e=="string"?t=e:t=e.attr("datatype")||"text",t.toLowerCase().replace(/\-.*/,"")},parseSubdatatype:function(e){var t="";return typeof e=="string"?t=e:t=e.attr("subdatatype")||"",t.toLowerCase().replace(/\-.*/,"")},isAvalible:function(e){return(e.is(":visible")||this.isValidHidden(e))&&!e.is("[disabled]")},isForm:function(e){var t;return e.prop("nodeName")&&e.prop("nodeName").toLowerCase()=="form"&&(t=!0),t},isErrorAbort:function(t){var n=e.errorAbort;return t.is("[errorabort]")&&(n=JC.f.parseBool(t.attr("errorabort"))),n},isValid:function(e){e=$(e);var t,n;return e.each(function(){n=$(this);if(n.is("[datatype]")||n.is("[subdatatype]")||n.is("[minlength]")||n.is("[maxlength]")||n.is("[reqmsg]")||n.is("form"))t=!0}),t},isAutoTrim:function(t){t=$(t);var n=e.autoTrim,r=JC.f.getJqParent(t,"form");return r&&r.length&&r.is("[validautotrim]")&&(n=JC.f.parseBool(r.attr("validautotrim"))),t.is("[validautotrim]")&&(n=JC.f.parseBool(t.attr("validautotrim"))),n},isReqmsg:function(e){return e.is("[reqmsg]")},isValidMsg:function(t){t=$(t);var n=e.showValidStatus,r=JC.f.getJqParent(t,"form");return r&&r.length&&r.is("[validmsg]")&&(n=JC.f.parseBool(r.attr("validmsg"))),t.is("[validmsg]")&&(n=JC.f.parseBool(t.attr("validmsg"))),n},isValidHidden:function(e){var t=!1;return e.is("[subdatatype]")&&/hidden/i.test(e.attr("subdatatype"))&&(t=!0),t},validitemcallback:function(t){t=$(t);var n=e.itemCallback,r=JC.f.getJqParent(t,"form"),i;return r&&r.length&&r.is("[validitemcallback]")&&(i=r.attr("validitemcallback"))&&(i=window[i])&&(n=i),t.is("[validitemcallback]")&&(i=t.attr("validitemcallback"))&&(i=window[i])&&(n=i),n},isMinlength:function(e){return e.is("[minlength]")},isMaxlength:function(e){return e.is("[maxlength]")},minlength:function(e){return parseInt(e.attr("minlength"),10)||0},maxlength:function(e){return parseInt(e.attr("maxlength"),10)||0},isMinvalue:function(e){return e.is("[minvalue]")},isMaxvalue:function(e){return e.is("[maxvalue]")},isDatatarget:function(e,t){var n=!1,r="datatarget";return t&&(t+=r)&&(n=e.is("["+t+"]")),!n&&(n=e.is("["+r+"]")),n},datatarget:function(e,t){var n,r="datatarget";return t&&(t+=r)&&(t=e.attr(t))&&(n=JC.f.parentSelector(e,t)),(!n||!n.length)&&(n=JC.f.parentSelector(e,e.attr(r))),n},minvalue:function(e,t){if(typeof t!="string")return t?parseFloat(e.attr("minvalue"))||0:parseInt(e.attr("minvalue"),10)||0;var n=t.toLowerCase().trim();switch(n){default:return JC.f.parseDate(e.attr("minvalue"),e)}},maxvalue:function(e,t){if(typeof t!="string")return t?parseFloat(e.attr("maxvalue"))||0:parseInt(e.attr("maxvalue"),10)||0;var n=t.toLowerCase().trim();switch(n){default:return JC.f.parseDate(e.attr("maxvalue"),e)}},lengthValid:function(e){var n=this,r=!0,e=$(e),i=n.parseDatatype(e),s,o,u=$.trim(e.val()),a;if(!u)return r;n.isMinlength(e)&&(s=n.minlength(e)),n.isMaxlength(e)&&(o=n.maxlength(e));switch(i){case"bytetext":a=n.bytelen(u);break;case"richtext":default:a=u.length}return s&&a<s&&(r=!1),o&&a>o&&(r=!1),JC.log("lengthValid: ",s,o,r,u.length),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},n:function(e,n){var r=this,i=!0,s=e.val().trim(),o=+s,u=0,a=10,f=Math.pow(10,a),l,c,h;return r.isMinvalue(e)&&(u=r.minvalue(e,/\./.test(e.attr("minvalue")))||u),/^[0]+$/.test(s)&&s.length>1&&(i=!1),i&&!isNaN(o)&&o>=u?(e.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(e,t){h=t.split("."),l=parseInt(h[0]),c=parseInt(h[1]),l>a&&(f=Math.pow(10,l))}),r.isMaxvalue(e)&&(f=r.maxvalue(e,/\./.test(e.attr("maxvalue")))),o>=u&&o<=f?(typeof l!="undefined"&&typeof c!="undefined"&&(i=(new RegExp("^(?:-|)(?:[\\d]{0,"+l+"}|)(?:\\.[\\d]{1,"+c+"}|)$")).test(s)),typeof l!="undefined"&&typeof c=="undefined"&&(i=(new RegExp("^(?:-|)[\\d]{1,"+l+"}$")).test(s)),typeof l=="undefined"&&typeof c!="undefined"&&(i=(new RegExp("^(?:-|)\\.[\\d]{1,"+c+"}$")).test(s)),typeof c=="undefined"&&/\./.test(s)&&(i=!1)):i=!1):i=!1,!i&&!n&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},nrange:function(e){var n=this,r=n.n(e),i,s,o,u,a;if(r){e.is("[fromNEl]")&&(o=n.getElement(e.attr("fromNEl"),e),u=e),e.is("[toNEl]")&&(o=e,u=n.getElement(e.attr("toNEl"),e)),o&&o.length||u&&u.length||(a=n.sametypeitems(e),a.length>=2&&(o=$(a[0]),u=$(a[1])));if(o&&o.length||u&&u.length){JC.log("nrange",o.length,u.length),u.val($.trim(u.val())),o.val($.trim(o.val()));if(u[0]!=o[0]&&u.val().length&&o.val().length)return r&&(r=n.n(u,!0)),r&&(r=n.n(o,!0)),r&&+o.val()>+u.val()&&(r=!1),JC.log("nrange:",+o.val(),+u.val(),r),r&&$(n).trigger(t.TRIGGER,[t.CORRECT,o]),r&&$(n).trigger(t.TRIGGER,[t.CORRECT,u]),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,o]),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,u]),r}}return r},d:function(e,n){var r=this,i=$.trim(e.val()),s=!0,o=JC.f.parseDate(i,e),u;return i&&o?(r.isMinvalue(e)&&(u=r.minvalue(e,"d"))&&o.getTime()<u.getTime()&&(s=!1),s&&r.isMaxvalue(e)&&(u=r.maxvalue(e,"d"))&&o.getTime()>u.getTime()&&(s=!1)):i&&(s=!1),!s&&!n&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),s},date:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},ddate:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},daterange:function(e){var n=this,r=n.d(e),i,s,o,u,a;if(r){e.is("[fromDateEl]")&&(o=n.getElement(e.attr("fromDateEl"),e),u=e),e.is("[toDateEl]")&&(o=e,u=n.getElement(e.attr("toDateEl"),e)),o&&o.length&&u&&u.length||(a=n.sametypeitems(e),a.length>=2&&(o=$(a[0]),u=$(a[1])));if(o&&o.length||u&&u.length)JC.log("daterange",o.length,u.length),u.val($.trim(u.val())),o.val($.trim(o.val())),u[0]!=o[0]&&u.val().length&&o.val().length&&(r&&(r=n.d(u,!0))&&(i=JC.f.parseDate(o.val(),o)),r&&(r=n.d(o,!0))&&(s=JC.f.parseDate(u.val(),u)),r&&i&&s&&i.getTime()>s.getTime()&&(r=!1),r&&$(n).trigger(t.TRIGGER,[t.CORRECT,o]),r&&$(n).trigger(t.TRIGGER,[t.CORRECT,u]),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,o]),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,u]))}return r},drange:function(){return this.daterange.apply(this,JC.f.sliceArgs(arguments))},time:function(e){var n=this,r=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},minute:function(e){var n=this,r=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},bankcard:function(e){var n=this,r=e.val().trim().replace(/[\s]+/g," ");e.val(r);var i=r.replace(/[^\d]/g,""),s=/^[0-9](?:[\d]{21}|[\d]{20}|[\d]{19}|[\d]{18}|[\d]{17}|[\d]{16}|[\d]{15}|[\d]{14}|[\d]{13}|[\d]{12}|[\d]{11}|)$/.test(i);return/^[0]+$/.test(i)&&(s=!1),!s&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),s},cnname:function(e,n){var r=this,i=r.bytelen(e.val())<=32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},enname:function(e,n){var r=this,i=r.bytelen(e.val())<=32&&/^[a-zA-Z ]{2,32}$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},allname:function(e){var n=this,r=n.bytelen(e.val())<=32&&(n.cnname(e,!0)||n.enname(e,!0));return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},username:function(e){var n=this,r=/^[a-zA-Z0-9][\w-]{2,30}$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},idnumber:function(e){var n=this,r=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},mobilecode:function(e,n){var r=this,i=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},mobile:function(e,t){return this.mobilecode(e,t)},mobilezonecode:function(e,n){var r=this,i=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},phonecode:function(e){var n=this,r=/^[1-9][0-9]{6,7}$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},phone:function(e,n){var r=this,i=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},phoneall:function(e,n){var r=this,i=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)(?:\#|\-)[\d]{1,6}|)$/.test(e.val());return!n&&!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e]),i},phonezone:function(e){var n=this,r=e.val().trim(),i,s=/^[0-9]{3,4}$/,o;return o=e.attr("datatype").split("-"),o.length>1&&(s=new RegExp("^[0-9]{"+o[1]+"}$")),i=s.test(r),!i&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),i},phoneext:function(e){var n=this,r=/^[0-9]{1,6}$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},mobilephone:function(e){var n=this,r=this.mobilecode(e,!0)||this.phone(e,!0);return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},mobilephoneall:function(e){var n=this,r=this.mobilezonecode(e,!0)||this.phoneall(e,!0);return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},reg:function(e){var n=this,r=!0,i;return e.is("[reg-pattern]")&&(i=e.attr("reg-pattern")),i||(i=$.trim(e.attr("datatype")).replace(/^reg(?:\-|)/i,"")),i.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(t,n,i){JC.log(n,i),r=(new RegExp(n,i||"")).test(e.val())}),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},vcode:function(e){var n=this,r,i=parseInt($.trim(e.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;return JC.log("vcodeValid: "+i),r=(new RegExp("^[0-9a-zA-Z]{"+i+"}$")).test(e.val()),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},text:function(e){return!0},bytetext:function(e){return!0},richtext:function(e){return!0},bytelen:function(e){return e.replace(/[^\x00-\xff]/g,"11").length},url:function(e){var n=this,r=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/[\w\/\.\#\+\-\~\%\?\_\=\&]*|)$/i.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},domain:function(e){var n=this,r=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/|)$/i.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},stricdomain:function(e){var n=this,r=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})$/i.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},email:function(e){var n=this,r=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},countrycode:function(e){var n=this,r=e.val().trim(),i=/^(?:\+|)[\d]{1,6}$/.test(r);return!i&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),i},zipcode:function(e){var n=this,r=/^[0-9]{6}$/.test(e.val());return!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},taxcode:function(e){var n=this,r=!1,i=e.val().trim();return r=/^[\w]{15}$/.test(i)||/^[\w]{18}$/.test(i)||/^[\w]{20}$/.test(i),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},reconfirm:function(e){var n=this,r=!0,i,s="ReconfirmValidTime",o="reconfirm";JC.log(o,(new Date).getTime()),n.isDatatarget(e,o)&&(i=n.datatarget(e,o)),(!i||!i.length)&&(i=n.samesubtypeitems(e,o));var u=!1;return i&&i.length&&i.each(function(){var t=$(this);n.checkRepeatProcess(t,s,!0)&&(u=!0),e.val()!=$(this).val()&&(r=!1)}),!r&&i.length&&i.each(function(){if(e[0]==this)return;$(n).trigger(t.TRIGGER,[t.ERROR,$(this),"reconfirmmsg",!0])}),r&&i&&i.length&&i.each(function(){if(e[0]==this)return;if(u)return!1;$(n).trigger(t.TRIGGER,[t.CORRECT,$(this)])}),r?$(n).trigger(t.TRIGGER,[t.CORRECT,e]):$(n).trigger(t.TRIGGER,[t.ERROR,e,"reconfirmmsg",!0]),r},checkRepeatProcess:function(e,t,n,r){var i=(new Date).getTime(),s=!1;return r=r||200,e.data(t)&&i-e.data(t)<r&&(s=!0,e.data(t,i)),n&&e.data(t,i),s},alternative:function(e){var n=this,r=!0,i,s="AlternativeValidTime",o=n.parseDatatype(e),u="alternative";JC.log(u,(new Date).getTime()),n.isDatatarget(e,u)&&(i=n.datatarget(e,u)),(!i||!i.length)&&(i=n.samesubtypeitems(e,u));var a=!1,f;if(i.length&&!$.trim(e.val())){var l=!1;i.each(function(){var t=$(this);if(e[0]==this)return;n.checkRepeatProcess(t,s,!0)&&(a=!0);if($(this).val())return l=!0,!1}),r=l}!r&&i&&i.length&&i.each(function(){if(e[0]==this)return;if(a)return!1;$(n).trigger(t.TRIGGER,[t.ERROR,$(this),"alternativemsg",!0])}),r&&i&&i.length&&i.each(function(){if(e[0]==this)return;var r=$(this),i=n.parseDatatype(r);if(i&&n[i]&&$(this).val())n[i]($(this));else if(!$(this).val()){$(n).trigger(t.TRIGGER,[t.CORRECT,$(this)]);var s=JC.f.parentSelector($(this),$(this).attr("reqtargetdatatarget"));s&&s.length&&$(n).trigger(t.TRIGGER,[t.CORRECT,s])}});if(r&&i&&i.length){var c=!1,h=[];i.each(function(){if(e[0]==this)return;var t=$(this),n;t.is("[alternativeReqTarget]")&&(n=JC.f.parentSelector(t,t.attr("alternativeReqTarget")),n&&n.length&&n.each(function(){var e=$(this),t=e.val().trim();t||(h.push(e),c=!0)}))}),e.is("[alternativeReqTarget]")&&(f=JC.f.parentSelector(e,e.attr("alternativeReqTarget")),f&&f.length&&f.each(function(){var e=$(this),t=e.val().trim();t||(h.push(e),c=!0)}));if(c&&h.length)return r=!1,$.each(h,function(e,r){r=$(r),$(n).trigger(t.TRIGGER,[t.ERROR,r,"alternativeReqmsg",!0])}),r}return r?o&&n[o]&&e.val()?n[o](e):e.val()||$(n).trigger(t.TRIGGER,[t.CORRECT,e]):$(n).trigger(t.TRIGGER,[t.ERROR,e,"alternativemsg",!0]),r},reqtarget:function(e){var n=this,r=!0,i=e.val().trim(),s,o=JC.f.parentSelector(e,e.attr("reqtargetdatatarget")||e.attr("datatarget"));return i&&o&&o.length?(s=o.val().trim(),!s&&(r=!1),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,o,"reqtargetmsg",!0]),r&&o.trigger("blur")):o&&o.length&&o.trigger("blur"),r},unique:function(n){var r=this,i=!0,s,o,u=[],a=r.typeLen(n.attr("subdatatype"))[0],f="UniqueValidTime",l="unique",c=JC.f.parseBool(n.attr("uniqueIgnoreCase")),h,p;r.isDatatarget(n,l)&&(s=r.datatarget(n,l)),(!s||!s.length)&&(s=r.samesubtypeitems(n,l)),h=[],p=[];var d=!1;if(s&&s.length){o={},s.each(function(e){var t=$(this);if(t.is("[processDisabled]")&&(!t.attr("processDisabled")||JC.f.parseBool(t.attr("processDisabled")))){if(!t.is(":visible"))return}else if(!r.isAvalible(t))return;r.checkRepeatProcess(t,f,!0)&&(d=!0),e%a===0&&u.push([]),u[u.length-1]&&u[u.length-1].push(t)}),$.each(u,function(e,t){var n=[],r=!1;$.each(t,function(e,t){var i,s=JC.f.parseBool(t.attr("uniqueIgnoreEmpty"));i=$(t).val().trim(),s&&!i&&t.is(":visible")&&(r=!0),n.push(i)});var s=n.join(""),u=n.join("####");if(r)return;if(!s)return;c&&(u=u.toLowerCase()),u in o?(o[u].push(t),i=!1):o[u]=[t]});for(var v in o)o[v].length>1?(i=!1,$.each(o[v],function(e,t){h=h.concat(t)})):$.each(o[v],function(e,t){p=p.concat(t)})}return $.each(p,function(t,n){var i=r.parseDatatype(n);i&&r[i]&&n.val()?r[i](n)&&e.setValid(n):e.setValid(n)}),!i&&h.length&&$.each(h,function(e,n){n=$(n);var i=n.val().trim();if(d)return!1;if(!i)return;i&&$(r).trigger(t.TRIGGER,[t.ERROR,n,"uniquemsg",!0])}),i},datavalid:function(n){var r=!0,i=this;return e.isFormValid?n.is("[datavalid]")?(JC.log("datavalid",(new Date).getTime()),r=JC.f.parseBool(n.attr("datavalid")),r||e.statusTimeout.error(n,setTimeout(function(){$(i).trigger(t.TRIGGER,[t.ERROR,n,"datavalidmsg",!0])},1)),r):r:r},typeLen:function(e){var t=[1];return e&&(e=e.replace(/[^\d\.]/g,""))&&(t=e.split("."))&&(t[0]=parseInt(t[0],10)||1,t[1]=parseInt(t[1],10)||0),t},findValidEle:function(e){var t=this,n="~ em.validmsg",r=e.find(n),i;return e.attr("validel")&&(i=t.getElement(e.attr("validel"),e,n)).length&&(r=i),r},findFocusEle:function(e){var t=this,n="~ em.focusmsg",r=e.find(n),i;return e.attr("focusel")&&(i=t.getElement(e.attr("focusel"),e,n)).length&&(r=i),r},findErrorEle:function(e){var n=this,r=t.SELECTOR_ERROR,i=e.find(r),s;return e.attr("emel")&&(s=n.getElement(e.attr("emel"),e,r)).length&&(i=s),i},getElement:function(e,n,r){if(/^\^$/.test(e))r=r||t.SELECTOR_ERROR,e=$(n.parent().find(r));else if(/^[\/\|\<\(]/.test(e))e=JC.f.parentSelector(n,e);else{if(/\./.test(e))return $(e);/^[\w-]+$/.test(e)&&(e="#"+e,e=$(e.replace(/[\#]+/g,"#")))}return $(e)},errorMsg:function(e,t,n){var r=e.is("[errmsg]")?" "+e.attr("errmsg"):e.is("[reqmsg]")?e.attr("reqmsg"):"";t&&(r=e.attr(t)||r),n&&r&&(r=" "+r),r=(r||"").trim().toLowerCase()=="undefined"||typeof r==undefined?"":r;if(r&&!/^[\s]/.test(r))switch(e.prop("type").toLowerCase()){case"file":r="请上传"+r;break;case"select-multiple":case"select-one":case"checkbox":case"radio":case"select":r="请选择"+r;break;case"textarea":case"password":case"text":r="请填写"+r}return $.trim(r)},reqmsg:function(e){var n=!0,r=this;return r.isReqmsg(e)?(e.val()&&e.val().constructor==Array?n=!!$.trim(e.val().join("")+""):n=!!$.trim(e.val()||""),!n&&$(r).trigger(t.TRIGGER,[t.ERROR,e,"reqmsg"]),JC.log("regmsgValid: "+n),n):n},sametypeitems:function(e){var t=this,n=[],r=e.parent(),i=e.attr("datatype"),s=new RegExp(i,"i");return/select/i.test(e.prop("nodeName"))?r.find("[datatype]").each(function(){s.test($(this).attr("datatype"))&&n.push($(this))}):r.find("input[datatype]").each(function(){s.test($(this).attr("datatype"))&&n.push($(this))}),n.length?$(n):n},samesubtypeitems:function(e,t){var n=this,r=[],i=e.parent(),t=t||e.attr("subdatatype"),s=new RegExp(t,"i"),o=e.prop("nodeName").toLowerCase(),u="input";return/select/.test(o)?u="select":/textarea/.test(o)&&(u="textarea"),i.find(u+"[subdatatype]").each(function(){s.test($(this).attr("subdatatype"))&&r.push($(this))}),r.length?$(r):r},focusmsgeverytime:function(t){var n=e.focusmsgEverytime;return t.is("[focusmsgeverytime]")&&(n=JC.f.parseBool(t.attr("focusmsgeverytime"))),n},validemdisplaytype:function(t){t&&(t=$(t));var n=e.emDisplayType,r=JC.f.getJqParent(t,"form"),i;return r&&r.length&&r.is("[validemdisplaytype]")&&(i=r.attr("validemdisplaytype"))&&(n=i),t.is("[validemdisplaytype]")&&(i=t.attr("validemdisplaytype"))&&(n=i),n},checkedType:function(e,n){e&&(e=$(e)),n=n||"checkbox";var r=this,i=!0,s,o,u=1,a=0,f=e,l=e.parent().prop("nodeName").toLowerCase()=="label",c=n+"finder";return JC.log(e.attr("name")+", "+e.val()),e.is("[datatarget]")?(s=JC.f.parentSelector(e,e.attr("datatarget")),o=[],s.each(function(){var e=$(this);e.is(":visible")&&!e.prop("disabled")&&o.push(e)}),s=$(o)):(l?(f.is("["+c+"]")?f=JC.f.parentSelector(e,e.attr(c)):f=e.parent().parent(),o=JC.f.parentSelector(f,"|input[datatype]")):o=JC.f.parentSelector(f,"/input[datatype]"),s=[],o.each(function(){var e=$(this),t=new RegExp(n,"i");t.test(e.attr("datatype"))&&e.is(":visible")&&!e.prop("disabled")&&s.push(e)}),s=$(s)),l&&s.each(function(){var e=$(this);e.is("[emel]")||e.attr("emel","//em.error"),e.is("[validel]")||e.attr("validel","//em.validmsg"),e.is("[focusel]")||e.attr("focusel","//em.focusmsg")}),s.length&&$(e=s[s.length-1]).data("Last"+n,!0),s.length&&(e.is("[datatype]")&&e.attr("datatype").replace(/[^\-]+?\-([\d]+)/,function(e,t){u=parseInt(t,10)||u}),s.length>=u&&(s.each(function(){$(this).prop("checked")&&a++}),a<u&&(i=!1)),!i&&$(r).trigger(t.TRIGGER,[t.ERROR,e])),i},checkbox:function(e){return this.checkedType(e,"checkbox")},radio:function(e){return this.checkedType(e,"radio")},file:function(e){var n=this,r=!0,i=e.val().trim().toLowerCase(),s=n.dataFileExt(e),o,u;return s.length&&(r=!1,$.each(s,function(e,t){t+="$",o=new RegExp(t,"i");if(o.test(i))return r=!0,!1})),!r&&$(n).trigger(t.TRIGGER,[t.ERROR,e]),r},dataFileExt:function(e){var t=[],n;return e.is("[fileext]")&&(n=e.attr("fileext").replace(/[\s]+/g,""))&&(n=n.replace(/\./g,"\\."))&&(t=n.toLowerCase().split(",")),t},ignoreAutoCheckEvent:function(t){var n=e.ignoreAutoCheckEvent,r;return t&&(t=$(t)),t&&t.length&&(r=JC.f.getJqParent(t,"form"),r&&r.length&&r.is("[ignoreAutoCheckEvent]")&&(n=JC.f.parseBool(r.attr("ignoreAutoCheckEvent"))),t.is("[ignoreAutoCheckEvent]")&&(n=JC.f.parseBool(t.attr("ignoreAutoCheckEvent")))),n}},n.prototype={init:function(){var e=this;return $(e).on("setValid",function(n,r,i,s,o){var u;r.removeClass(t.CSS_ERROR),r.find(JC.f.printf('~ em:not("em.focusmsg, em.validmsg, {0}")',t.FILTER_ERROR)).css("display",e._model.validemdisplaytype(r)),r.find(t.SELECTOR_ERROR).hide(),r.attr("emel")&&(u=e._model.getElement(r.attr("emel"),r))&&u.hide(),typeof s=="undefined"&&typeof r.val()!="object"&&!r.val().trim()&&(s=1),e.validMsg(r,s,o)}),$(e).on("setError",function(n,r,i,s){var o=e._model.errorMsg.apply(e._model,[r,i,s]),u,a,f,l;r.addClass(t.CSS_ERROR),r.find(JC.f.printf("~ em:not({0})",t.FILTER_ERROR)).hide(),r.is("[validel]")&&(a=e._model.getElement(r.attr("validel"),r))&&a.hide(),r.is("[focusel]")&&(f=e._model.getElement(r.attr("focusel"),r))&&f.hide(),r.is("[emEl]")&&(u=e._model.getElement(r.attr("emEl"),r))&&u.addClass(t.CSS_ERROR),(!u||!u.length)&&(u=r.find(t.SELECTOR_ERROR)),u.length||(u=$(JC.f.printf('<em class="{0}"></em>',t.CSS_ERROR))).insertAfter(r),!o.trim()&&(o="&nbsp;"),u.html(o).css("display",e._model.validemdisplaytype(r)),JC.log("error:",o)}),this},valid:function(t,n,r){t&&(t=$(t));var i=this,s;t.data("JCValidStatus",!0);var o=!JC.f.parseBool(t.attr("validnoerror"));e.statusTimeout.valid(t,setTimeout(function(){$(i).trigger("setValid",[t,n,r,o]),(s=i._model.validitemcallback(t))&&s(t,!0)},n||150))},validMsg:function(e,t,n){var r=this,i=(e.attr("validmsg")||"").trim().toLowerCase(),s;if(r._model.isValidMsg(e)){if(i=="true"||i=="1")i="";!i.trim()&&(i="&nbsp;");var o=r._model.findFocusEle(e),u=r._model.findValidEle(e),a=r._model.findErrorEle(e);!u.length&&(u=$('<em class="validmsg"></em>'),e.after(u)),u.html(i),t?u.hide():(u.css("display",r._model.validemdisplaytype(e)),o&&o.hide(),a&&a.hide())}else n&&(s=r._model.findFocusEle(e))&&s.hide()},error:function(t,n,r){t&&(t=$(t));var i=this,s=arguments,o;return t.is("[validnoerror]")?!0:(t.data("JCValidStatus",!1),e.statusTimeout.error(t,setTimeout(function(){$(i).trigger("setError",[t,n,r]),(o=i._model.validitemcallback(t))&&o(t,!1)},150)),!1)},focusmsg:function(t,n,r){if(t&&(t=$(t)).length&&(t.is("[focusmsg]")||r&&t.is("["+r+"]"))){JC.log("focusmsg",(new Date).getTime());var i,s=this,o=s._model.findFocusEle(t),u=s._model.findValidEle(t),a=s._model.findErrorEle(t),f=t.attr("focusmsg");r&&(f=t.attr(r||f));if(n&&o&&o.length){o.hide();return}a.length&&a.is(":visible")&&a.hide();if(u.length&&u.is(":visible"))return;!o.length&&(o=$('<em class="focusmsg"></em>'),t.after(o)),t.is("[validnoerror]")?i=e.check(t):(t.attr("validnoerror",!0),i=e.check(t),t.removeAttr("validnoerror")),!f.trim()&&(f="&nbsp;"),s._model.focusmsgeverytime(t)?o.html(f).css("display",s._model.validemdisplaytype(t)):i&&o.html(f).css("display",s._model.validemdisplaytype(t))}}},$(document).delegate("input[type=text], input[type=password], textarea","blur",function(n){var r=$(this),i=e.getInstance();if(i._model.ignoreAutoCheckEvent(r))return;i.trigger(t.FOCUS_MSG,[r,!0]),e.checkTimeout(r)}),$(document).delegate("input","blur",function(n){var r=$(this),i=e.getInstance();if(r.attr("type"))return;if(i._model.ignoreAutoCheckEvent(r))return;i.trigger(t.FOCUS_MSG,[r,!0]),e.checkTimeout(r)}),$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","change",function(t,n){if(n)return;var r=$(this),i=e.getInstance();if(i._model.ignoreAutoCheckEvent(r))return;e.checkTimeout(r)}),$(document).delegate("input[type=text], input[type=password], textarea, select, input[type=file], input[type=checkbox], input[type=radio]","focus",function(n){var r=$(this),i=e.getInstance(),s=r.val().trim();if(i._model.ignoreAutoCheckEvent(r))return;i.trigger(t.FOCUS_MSG,[r]),!s&&e.setValid(r)}),$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","blur",function(n){var r=$(this),i=e.getInstance();if(i._model.ignoreAutoCheckEvent(r))return;i.trigger(t.FOCUS_MSG,[r,!0])}),$(document).delegate("input[type=hidden][subdatatype]","change",function(t){var n=$(this),r=e.getInstance(),i=!1,s;if(r._model.ignoreAutoCheckEvent(n))return;n.is("[subdatatype]")&&(i=/hidden/i.test(n.attr("subdatatype")));if(n.data("HID_CHANGE_CHECK")){s=(new Date).getTime()-n.data("HID_CHANGE_CHECK");if(s<50)return}if(!n.val())return;n.data("HID_CHANGE_CHECK",(new Date).getTime()),JC.log("hidden val",(new Date).getTime(),n.val()),e.checkTimeout($(this))}),$(document).delegate("input[type=text][subdatatype]","keyup",function(t){var n=$(this),r=/datavalid/i.test(n.attr("subdatatype"));if(!r)return;if(n.prop("disabled")||n.prop("readonly"))return;e.dataValid(n,!1,!0);var i;n.attr("datavalidKeyupCallback")&&(i=window[n.attr("datavalidKeyupCallback")])&&i.call(n,t);if(n.data("DataValidInited"))return;n.data("DataValidInited",!0),n.data("DataValidCache",{}),n.on("DataValidUpdate",function(t,r){var i,s;if(!n.data("DataValidCache"))return;s=n.data("DataValidCache")[r];if(!s)return;r==="suchestest"&&(s.data.errorno=0),e.dataValid(n,!s.data.errorno,!1,s.data.errmsg),n.attr("datavalidCallback")&&(i=window[n.attr("datavalidCallback")])&&i.call(n,s.data,s.text)}),n.on("blur",function(e,t){JC.log("datavalid",(new Date).getTime());if(t)return;var r=n.val().trim(),i,s,o=n.attr("datavalidurl");if(!r)return;if(!o)return;n.data("DataValidTm")&&clearTimeout(n.data("DataValidTm")),n.data("DataValidTm",setTimeout(function(){r=n.val().trim();if(!r)return;r=JC.f.encoder(n)(r);if(!n.data("JCValidStatus"))return;o=JC.f.printf(o,r),n.attr("datavalidUrlFilter")&&(i=window[n.attr("datavalidUrlFilter")])&&(o=i.call(n,o));if(r in n.data("DataValidCache")){n.trigger("DataValidUpdate",r);return}$.get(o).done(function(e){s=e;try{e=$.parseJSON(e)}catch(t){e={errorno:1}}n.data("DataValidCache")[r]={key:r,data:e,text:s},n.trigger("DataValidUpdate",r)})},151))})}),JC.Valid})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);