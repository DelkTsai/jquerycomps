(function(e,t){e(["JC.BaseMVC","JC.Panel"],function(){function t(e){e&&(e=$(e));if(t.getInstance(e))return t.getInstance(e);t.getInstance(e,this),this._model=new t.Model(e),this._view=new t.View(this._model),this._init()}return window.Bizs.ActionLogic=t,!e.amd&&JC.use&&!JC.Panel&&JC.use("Panel"),t.getInstance=function(e,t){typeof e=="string"&&!/</.test(e)&&(e=$(e));if(!e||!e.length||typeof e=="string")return;return typeof t!="undefined"&&e.data("ActionLogicIns",t),e.data("ActionLogicIns")},t.isActionLogic=function(e){var t;return e&&(e=$(e)).length&&(t=e.is("[baltype]")),t},t.init=function(e){e&&$(e).find(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join()).on("click",function(e){var n=$(this);t.process(n)&&n.prop("nodeName").toLowerCase()=="a"&&e.preventDefault()})},t.process=function(e){e=$(e);if(!e||!e.length)return null;if(!t.isActionLogic(e))return;var n=t.getInstance(e);return!n&&(n=new t(e)),n&&n.process(),n},t.random=!0,t.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("StaticPanel",function(t,n){e.trigger("ShowPanel",[JC.f.scriptContent(n)])}),e.on(t.Model.SHOW_PANEL,function(t,n){var r=JC.Dialog(n);r.on("confirm",function(){return e._model.balCallback()&&e._model.balCallback().call(e._model.selector(),r,e)?!0:!1})}),e.on("AjaxPanel",function(n,r,i){if(!r||!i)return;e._model.balRandom()&&(i=JC.f.addUrlParams(i,{rnd:(new Date).getTime()})),$.get(i).done(function(n){switch(r){case t.Model.SHOW_PANEL:e.trigger("ShowPanel",[n]);break;case t.Model.DATA_PANEL:try{n=$.parseJSON(n)}catch(i){}n&&(n.errorno?e.trigger("ShowError",[n.errmsg||"操作失败, 请重试!",1]):e.trigger("ShowPanel",[n.data]))}})}),e.on("Go",function(t,n){if(!n)return;e._model.balRandom()&&(n=JC.f.addUrlParams(n,{rnd:(new Date).getTime()})),JC.f.reloadPage(n)}),e.on("AjaxAction",function(t,n){if(!n)return;e._model.balRandom()&&(n=JC.f.addUrlParams(n,{rnd:(new Date).getTime()})),$.get(n).done(function(t){try{t=$.parseJSON(t)}catch(n){}e._model.balCallback()?e._model.balCallback().call(e.selector(),t,e):t&&"errorno"in t?t.errorno?e.trigger("ShowError",[t.errmsg||"操作失败, 请重试!",1]):e.trigger("ShowSuccess",[t.errmsg||"操作完成",function(){e._model.balDoneUrl()&&JC.f.reloadPage(e._model.balDoneUrl()||location.href)}]):JC.Dialog.alert(t,1)})}),e.on("ShowError",function(t,n,r,i){var s;switch(e._model.balErrorPopupType()){case"alert":s=JC.alert(n,e._model.selector(),r||1),i&&s.on("confirm",function(){i()});break;case"msgbox":s=JC.msgbox(n,e._model.selector(),r||1),i&&s.on("close",function(){i()});break;case"dialog.msgbox":s=JC.Dialog.msgbox(n,r||1),i&&s.on("close",function(){i()});break;default:s=JC.Dialog.alert(n,r||1),i&&s.on("confirm",function(){i()})}}),e.on("ShowConfirm",function(t,n,r,i){var s;switch(e._model.balConfirmPopupType()){case"dialog.confirm":s=JC.Dialog.confirm(n,r||1),i&&s.on("confirm",function(){i()});break;default:s=JC.confirm(n,e._model.selector(),r||1),i&&s.on("confirm",function(){i()})}}),e.on("ShowSuccess",function(t,n,r){var i;switch(e._model.balSuccessPopupType()){case"alert":i=JC.alert(n,e._model.selector()),r&&i.on("confirm",function(){r()});break;case"dialog.alert":i=JC.Dialog.alert(n),r&&i.on("confirm",function(){r()});break;case"dialog.msgbox":i=JC.Dialog.msgbox(n),r&&i.on("close",function(){r()});break;default:i=JC.msgbox(n,e.selector()),r&&i.on("close",function(){r()})}})},process:function(){var e=this;JC.hideAllPopup(1);switch(e._model.baltype()){case"panel":e._model.is("[balPanelTpl]")?e.trigger("StaticPanel",[e._model.balPanelTpl()]):e._model.is("[balAjaxHtml]")?e.trigger("AjaxPanel",[t.Model.SHOW_PANEL,e._model.balAjaxHtml()]):e._model.is("[balAjaxData]")&&e.trigger("AjaxPanel",[t.Model.DATA_PANEL,e._model.balAjaxData()]);break;case"link":e._model.is("[balConfirmMsg]")?e.trigger("ShowConfirm",[e._model.balConfirmMsg(),2,function(){e.trigger("Go",e._model.balUrl())}]):e.trigger("Go",e._model.balUrl());break;case"ajaxaction":if(e._model.is("[balConfirmMsg]")){var n=JC.confirm(e._model.balConfirmMsg(),e.selector(),2);n.on("confirm",function(){e.trigger("AjaxAction",e._model.balUrl())})}else e.trigger("AjaxAction",e._model.balUrl())}return this}},JC.BaseMVC.buildModel(t),t.Model.SHOW_PANEL="ShowPanel",t.Model.DATA_PANEL="DataPanel",t.Model.prototype={init:function(){},baltype:function(){return this.stringProp("baltype")},balPanelTpl:function(){var e,t=this;return e=t.selectorProp("balPanelTpl")||e,e},balCallback:function(){var e,t=this;return e=t.callbackProp("balCallback")||e,e},balAjaxHtml:function(){return this.selector().attr("balAjaxHtml")},balAjaxData:function(){return this.selector().attr("balAjaxData")},balRandom:function(){var e=t.random,n=this;return n.is("[balRandom]")&&(e=JC.f.parseBool(n.stringProp("balRandom"))),e},balUrl:function(){var e="?",t=this;return t.selector().prop("nodeName").toLowerCase()=="a"&&(e=t.selector().attr("href")),t.is("[balUrl]")&&(e=t.selector().attr("balUrl")),JC.f.urlDetect(e)},balDoneUrl:function(){var e=this.attrProp("balDoneUrl");return JC.f.urlDetect(e)},balConfirmMsg:function(){var e="确定要执行吗?";return e=this.selector().attr("balConfirmMsg")||e,e},balErrorPopupType:function(){var e=this.stringProp("balErrorPopupType")||"dialog";return e},balSuccessPopupType:function(){var e=this.stringProp("balSuccessPopupType")||"msgbox";return e},balConfirmPopupType:function(){var e=this.stringProp("balConfirmPopupType")||"confirm";return e}},JC.BaseMVC.buildView(t),t.View.prototype={init:function(){}},JC.BaseMVC.build(t),$(document).ready(function(){$(document).delegate(["a.js_bizsActionLogic","input.js_bizsActionLogic","button.js_bizsActionLogic"].join(),"click",function(e){var n=$(this);t.process(n)&&n.prop("nodeName").toLowerCase()=="a"&&e.preventDefault()})}),Bizs.ActionLogic})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);