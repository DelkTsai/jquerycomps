(function(e,t){e(["JC.common","JC.BaseMVC"],function(){return function(e){function t(n){n&&(n=e(n));if(t.getInstance(n))return t.getInstance(n);t.getInstance(n,this),this._model=new t.Model(n),this._view=new t.View(this._model),this._init()}window.JC=window.JC||{log:function(){}},JC.TableFreeze=t,t.getInstance=function(n,r){typeof n=="string"&&!/</.test(n)&&(n=e(n));if(!n||!n.length||typeof n=="string")return;return typeof r!="undefined"&&n.data(t.Model._instanceName,r),n.data(t.Model._instanceName)},t.init=function(n){var r=[];return n=e(n||document),n&&n.length&&(n.hasClass("js_compTableFreeze")?r.push(new t(n)):n.find("div.js_compTableFreeze").each(function(){r.push(new t(this))})),r},BaseMVC.build(t),JC.f.extendObject(t.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("CTableFreezeUpdate",function(t){e._model.beforeCreateTableCallback()&&e._model.beforeCreateTableCallback().call(e,e.selector()),e._view.update(),e._model.afterCreateTableCallback()&&e._model.afterCreateTableCallback().call(e,e.selector())})},_inited:function(){var t=e(this);t.trigger("CTableFreezeUpdate")},update:function(){return this._view.update(),this},fixHeight:function(){var t=this,n=t._model.saveWidth,r=t._model.selector().prop("offsetWidth"),i=t._model.selector().find("div.js-roll-table,div.js-fixed-table");return t._model.setHeight(),n<=r&&(i.each(function(){e(this).find("tr").height("auto")}),t._model.setHeight()),this}}),t.Model._instanceName="TableFreeze",JC.f.extendObject(t.Model.prototype,{init:function(){var e=this;this.sourceTable=this.selector().find("table").eq(0)},detachTable:function(){this.sourceTable.remove()},saveWidth:[],createTplBox:function(){var e=this,t=e.freezeType(),n=e.tTpl(),r,i,s,o,u,a,f,l,c,h;switch(t){case"prev":i=parseInt(e.freezeCols(),10),r=JC.f.printf(n,"js-fixed-table compTFPrevFixed","js-roll-table compTFPrevRoll"),e.selector().append(r),f=JC.f.getJqParent(e.selector().find("div.js-fixed-table"),"td"),l=JC.f.getJqParent(e.selector().find("div.js-roll-table"),"td"),e.setWidth(0,f,i),e.setWidth(i,l,e.colNum()),s=e.selector().find("div.js-fixed-table thead").eq(0),o=e.selector().find("div.js-fixed-table tbody").eq(0),u=e.selector().find("div.js-roll-table thead").eq(0),a=e.selector().find("div.js-roll-table tbody").eq(0),e.createHdTpl(s,i),e.createBdTpl(o,i),e.createHdTpl(u,e.colNum()-i),e.createBdTpl(a,e.colNum()-i);break;case"last":i=parseInt(e.freezeCols(),10),r=JC.f.printf(n,"js-roll-table compTFLastRoll","js-fixed-table compTFLastFixed"),e.selector().append(r),f=JC.f.getJqParent(e.selector().find("div.js-roll-table"),"td"),l=JC.f.getJqParent(e.selector().find("div.js-fixed-table"),"td"),e.setWidth(0,f,e.colNum()-i),e.setWidth(e.colNum()-i,l,e.colNum()),s=e.selector().find("div.js-roll-table thead").eq(0),o=e.selector().find("div.js-roll-table tbody").eq(0),u=e.selector().find("div.js-fixed-table thead").eq(0),a=e.selector().find("div.js-fixed-table tbody").eq(0),e.createHdTpl(s,e.colNum()-i),e.createBdTpl(o,e.colNum()-i),e.createHdTpl(u,i),e.createBdTpl(a,i);break;case"both":var p,d,v;i=parseInt(e.freezeCols()[0],10),p=parseInt(e.freezeCols()[1],10),r=JC.f.printf(n,"js-fixed-table compTFBothFixed","js-roll-table compTFBothRoll","js-fixed-table compTFBothFixed"),e.selector().append(r),f=JC.f.getJqParent(e.selector().find("div.js-fixed-table").eq(0),"td"),l=JC.f.getJqParent(e.selector().find("div.js-roll-table"),"td"),c=JC.f.getJqParent(e.selector().find("div.js-fixed-table").eq(1),"td"),e.setWidth(0,f,i),e.setWidth(i,l,i+e.colNum()-i-p),e.setWidth(i+e.colNum()-i-p,c,e.colNum()),s=e.selector().find("div.js-fixed-table thead").eq(0),o=e.selector().find("div.js-fixed-table tbody").eq(0),u=e.selector().find("div.js-roll-table thead").eq(0),a=e.selector().find("div.js-roll-table tbody").eq(0),d=e.selector().find("div.js-fixed-table thead").eq(1),v=e.selector().find("div.js-fixed-table tbody").eq(1),e.createHdTpl(s,i),e.createBdTpl(o,i),e.createHdTpl(u,e.colNum()-i-p),e.createBdTpl(a,e.colNum()-i-p),e.createHdTpl(d,p),e.createBdTpl(v,p)}h=JC.f.getJqParent(f,"table"),e.hasFixedPXWidth()&&(h.css("width",e.selector().find("table").prop("offsetWidth")),JC.log(1)),e.selector().find("div.js-roll-table>table").width("120%"),e.setHeight()},createHdTpl:function(t,n){var r=this,i=r.sourceTable,s=document.createDocumentFragment(),o=e(s);i.find("thead").eq(0).children("tr").each(function(t,r){var i=0,s,u=e(r).get(0).cloneNode(!1);o.append(u),s=o.children("tr:last"),e(r).children("td,th").each(function(t,r){var o=e(this).attr("colspan");if(i>=n)return!1;e(this).appendTo(s),typeof o=="undefined"?i+=1:i+=parseInt(o,10)})}),o.appendTo(t)},createBdTpl:function(t,n){var r=this,i=r.sourceTable,s={},o=document.createDocumentFragment(),u=e(o);i.find("tbody").eq(0).children("tr").each(function(t,r){var i=e(r).get(0).cloneNode(!1),o=0,a;u.append(i),a=u.children("tr:last"),e(r).children("td,th").each(function(r,i){var u=e(this).attr("colspan"),f=e(this).attr("rowspan"),l={},c;if(o>=n)return!1;if(typeof f!="undefined"){f=parseInt(f,10),l={six:r,rowspan:f};for(var h=1;h<f;h++)r==0?s[t+h+(r+1).toString()]=l:s[t+h+r.toString()]=l}typeof u=="undefined"?o+=1:o+=parseInt(u,10),c=t+(r+1).toString(),c in s&&(o+=1),e(this).appendTo(a)})}),u.appendTo(t)},setWidth:function(t,n,r){var i=this.colWidth(),s=0,o;for(o=t;o<r;o++)s+=i[o];s*=100,e(n).css("width",s+"%")},setHeight:function(){var t=this,n=t.freezeType(),r=t.selector().find("div.js-fixed-table").eq(0).find("tr"),i=t.selector().find("div.js-roll-table>table").find("tr"),s=t.selector().find("div.js-fixed-table").eq(1).find("table").eq(0).find("tr");r.each(function(t,r){var o=i.eq(t),u=s.eq(t),a=e(r),f;f=Math.max(a.prop("offsetHeight"),o.prop("offsetHeight")),n=="both"&&(f=Math.max(f,u.prop("offsetHeight"))),a.height(f),o.height(f),n=="both"&&u.height(f)})},freezeType:function(){var e=this,t;return t=e.attrProp(e.selector(),"freezeType")||"prev",t},freezeCols:function(){var e=this,t;return t=e.attrProp(e.selector(),"freezeCols")||1,t=t.split(","),t},tableWidth:function(){var e=this,t=e.selector().prop("offsetWidth");return t},rowHeight:function(){var t=this,n=t.selector().find("table tr"),r=[];return n.each(function(){r.push(e(this).prop("offsetHeight")+"px")}),r},scrollWidth:function(){var e=this;return e.selector().attr("scrollWidth")},colWidth:function(){var t=this,n=t.selector().find("table>thead th"),n,r=[];return n.each(function(){r.push(e(this).prop("offsetWidth")/t.tableWidth())}),r},colNum:function(){var e=this,t=0;return t=e.selector().find("thead>tr>th").length,t},rowNum:function(){var e=this,t=0;return t=e.selector().find("tbody>tr").length,t},supportFreeze:function(){var e=this,t=!0;if(e.freezeCols().length==0||e.freezeCols().length==1&&parseInt(e.freezeCols(),10)==0||parseInt(e.freezeCols(),10)>e.colNum()||e.freezeCols().length==2&&parseInt(e.freezeCols()[0],10)+parseInt(e.freezeCols()[1],10)>=e.colNum())t=!1;return t},supportScroll:function(){var t=this,n=0,r=!0;return e.each(t.freezeCols(),function(e,t){n+=parseInt(t,10)}),n==t.colNum()&&(r=!1),r},hasFixedPXWidth:function(){var e=this,t=e.selector().get(0).style.width,n=e.selector().find("table").eq(0).attr("width")||e.selector().find("table").eq(0).get(0).style.width,r=e.tdThHasFixedPXWidth(),i=!0;if(t&&/%/.test(t))if(!n||n&&/%/.test(n))return!1;return!n||n&&/%/.test(n)?!1:r?!0:!1},tdThHasFixedPXWidth:function(){var t=this,n=t.selector().find("table").eq(0).find("tr").eq(0).find("th,td");return n.each(function(){var t=e(this),n=t.attr("width")||t.get(0).style.width;if(!n)return!1;if(n&&/%/.test(n))return!1}),!0},tTpl:function(){var t=this,n,r,i,s;n=t.selector().find("table").get(0).cloneNode(!1),r=t.selector().find("thead").get(0).cloneNode(!1),i=t.selector().find("tbody").get(0).cloneNode(!1),e(r).appendTo(e(n)),e(i).appendTo(e(n)),e(n).width("100%");switch(t.freezeType()){case"prev":case"last":s='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+n.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+n.outerHTML+"</div></td>"+"</tr></table>";break;case"both":s='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+n.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+n.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{2}" style="width:100%;">'+n.outerHTML+"</div></td></tr></table>"}return s},beforeCreateTableCallback:function(){var e=this,t=e.selector(),n="beforeCreateTableCallback";return e.callbackProp(t,n)},afterCreateTableCallback:function(){var e=this,t=e.selector(),n="afterCreateTableCallback";return e.callbackProp(t,n)},baseTpl:'<div class="{0}" style="width:100%;"><table style="padding:0;margin:0;"><thead></thead><tbody></tbody></table></div>'}),JC.f.extendObject(t.View.prototype,{init:function(){var e=this},update:function(){var e=this;if(!e._model.supportScroll())return;if(!e._model.supportFreeze()){e._model.selector().css({"overflow-x":"scroll"}).addClass("compTFAllRoll"),e._model.selector().children("table").css("width","110%");return}e._model.createTplBox(),e._model.detachTable()}}),e(document).ready(function(){function i(){r.off("resize",i),e("div.js_compTableFreeze").each(function(){var n=t.getInstance(e(this));n&&n.fixHeight(),n._model.saveWidth=n._model.selector().width()}),r.data("CTFResizeTimeout")&&clearTimeout(r.data("CTFResizeTimeout")),r.data("CTFResizeTimeout",setTimeout(function(){r.off("resize",i),r.on("resize",i)},200))}var n=0;t.autoInit&&(n=t.init());var r=e(window);r.on("resize",i)})}(jQuery),JC.TableFreeze})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);