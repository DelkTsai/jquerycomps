(function(e,t){e(["JC.Calendar.date"],function(){function e(e){this._selector=e}function t(e){this._model=e}function n(e,t){var n=[],r,i=1,t=t||0,e=parseInt(e,10),s=new Date(e,0,1);s.getDay()>1&&s.setDate(s.getDate()-s.getDay()+7),s.getDay()===0&&s.setDate(s.getDate()+1),t>0&&(t=(new Date(2e3,1,2)-new Date(2e3,1,1))*t);while(s.getFullYear()<=e){r={week:i++,start:null,end:null},r.start=s.getTime()+t,s.setDate(s.getDate()+6),r.end=s.getTime()+t,s.setDate(s.getDate()+1);if(s.getFullYear()>e){s=new Date(s.getFullYear(),0,1);if(s.getDay()<2)break}n.push(r)}return n}JC.Calendar.weekTpl="",JC.Calendar.weekDayOffset=0,JC.Calendar.WeekModel=e,JC.Calendar.WeekView=t,JC.Calendar.clone(e,t),JC.f.extendObject(e.prototype,{layout:function(){var e=$("#UXCCalendar_week");return e.length||(e=$(JC.Calendar.weekTpl||this.tpl).hide(),e.attr("id","UXCCalendar_week").hide().appendTo(document.body)),e},tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var e=0,t,n=new Date;return(t=this.layout().find("td.cur a[dstart]")).length&&(n=new Date)&&n.setTime(t.attr("dstart")),e=n.getMonth(),e},selectedDate:function(){var e,t,n;return t=this.layout().find("td.cur"),t.length&&!t.hasClass("unable")&&(n=t.find("a[dstart]"))&&(e={start:new Date,end:new Date},e.start.setTime(n.attr("dstart")),e.end.setTime(n.attr("dend"))),e},singleLayoutDate:function(){var e=this,t=e.defaultDate(),n=this.day(),r,i=e.layout().find("td.cur > a[week]");return t.date.setDate(1),t.date.setFullYear(this.year()),t.date.setMonth(this.month()),r=JC.f.maxDayOfMonth(t.date),n>r&&(n=r),t.date.setDate(n),i.length&&(t.curweek=parseInt(i.attr("week"),10)),JC.log("WeekModel.singleLayoutDate:",i.length,t.curweek),t}}),JC.f.extendObject(t.prototype,{_buildBody:function(e){var t=this,r=e.date,i=t._model.layout(),s=(new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate())).getTime(),o=n(r.getFullYear(),JC.Calendar.weekDayOffset),u=n(r.getFullYear()+1,JC.Calendar.weekDayOffset),a=0,f=[],l,c,h,p,d,v=r.getFullYear(),m=Math.ceil(o.length/8),g=JC.Calendar.lastIpt,y=JC.f.parseBool(g.attr("currentcanselect"));if(e.maxvalue&&y){var b=e.maxvalue.getDay();b>0&&e.maxvalue.setDate(e.maxvalue.getDate()+(7-b))}f.push("<tr>");for(var w=1,E=m*8;w<=E;w++)c=o[w-1],c||(c=u[a++],v=r.getFullYear()+1),p=new Date,d=new Date,p.setTime(c.start),d.setTime(c.end),h=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",v,JC.Calendar.getCnNum(c.week),JC.f.formatISODate(p),JC.f.formatISODate(d),JC.Calendar.cnWeek.charAt(p.getDay()%7),JC.Calendar.cnWeek.charAt(d.getDay()%7)),l=[],e.minvalue&&p.getTime()<e.minvalue.getTime()&&l.push("unable"),e.maxvalue&&d.getTime()>e.maxvalue.getTime()&&l.push("unable"),e.curweek?c.week==e.curweek&&r.getFullYear()==p.getFullYear()&&l.push("cur"):r.getTime()>=p.getTime()&&r.getTime()<=d.getTime()&&l.push("cur"),s>=p.getTime()&&s<=d.getTime()&&l.push("today"),f.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',l.join(" "),c.week,h,p.getTime(),d.getTime(),e.date.getTime())),w%8===0&&w!=E&&f.push("</tr><tr>");f.push("</tr>"),i.find("table.UTableBorder tbody").html($(f.join("")))},updateSelected:function(e){var t=this,n,r,i;if(!e)i=this._model.selectedDate(),i&&(n=i.start,r=i.end);else{e=$(e),i=JC.f.getJqParent(e,"td");if(i&&i.hasClass("unable"))return;n=new Date,r=new Date,n.setTime(e.attr("dstart")),r.setTime(e.attr("dend"))}if(!n||!r)return;t._model.selector().val(t._model.fullFormat(t._model.dateFormat(n),t._model.dateFormat(r))),$(t).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",n,r]),JC.Calendar.hide()}}),$(document).delegate(["input[datatype=week]","input[multidate=week]"].join(),"focus",function(e){Calendar.pickDate(this)}),$(document).delegate(["button[datatype=week]","button[multidate=week]"].join(),"click",function(e){Calendar.pickDate(this)}),$(document).delegate(["textarea[datatype=week]","textarea[multidate=week]"].join(),"click",function(e){Calendar.pickDate(this)})})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);