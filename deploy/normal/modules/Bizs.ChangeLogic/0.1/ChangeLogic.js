(function(e,t){e(["JC.BaseMVC"],function(){return function(e){function t(e){if(t.getInstance(e))return t.getInstance(e);t.getInstance(e,this),JC.log("Bizs.ChangeLogic:",(new Date).getTime()),this._model=new n(e),this._view=new r(this._model),this._init()}function n(e){this._selector=e}function r(e){this._model=e}window.Bizs=window.Bizs||{},window.Bizs.ChangeLogic=t,t.prototype={_init:function(){var t=this,n;return t._initHandlerEvent(),e([t._view,t._model]).on("BindEvent",function(e,n,r){t.on(n,r)}),e([t._view,t._model]).on("TriggerEvent",function(e,n){var r=JC.f.sliceArgs(arguments).slice(2);t.trigger(n,r)}),t._model.init(),t._view.init(),t._model.bclTrigger().on("change",function(e){JC.log("bclTrigger change",(new Date).getTime()),t._view.change(this)}),(n=t._model.bclTrigger(!0))&&n.trigger("change"),t},_initHandlerEvent:function(){var e=this;e.on("DisableItem",function(t,n){e._model.bclDisableCallback()&&e._model.bclDisableCallback().call(e,n,e._model.selector())}),e.on("EnableItem",function(t,n){e._model.bclEnableCallback()&&e._model.bclEnableCallback().call(e,n,e._model.selector())}),e.on("ChangeDone",function(t,n){e._model.bclDoneCallback()&&e._model.bclDoneCallback().call(e,n,e._model.selector())})},selector:function(){return this._model.selector()},on:function(t,n){return e(this).on(t,n),this},trigger:function(t,n){return e(this).trigger(t,n),this}},t.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=e(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data("ChangeLogicIns",n),t.data("ChangeLogicIns")},t.doneCallback=null,t.enableCallback=null,t.disableCallback=null,t.init=function(n){n=e(n||document);if(!n||!n.length)return;n.hasClass("js_bizChangeLogic")?new t(n):n.find(["div.js_bizChangeLogic","dl.js_bizChangeLogic","table.js_bizChangeLogic"].join()).each(function(){new t(e(this))})},n.prototype={init:function(){return this},selector:function(){return this._selector},bclTrigger:function(t){var n=this,r=JC.f.parentSelector(this.selector(),this.selector().attr("bclTrigger")),i;return t&&r.each(function(){i=e(this);if(i.prop("checked")||i.prop("selected"))return r=i,!1}),r},bclDisableTarget:function(t){var n=this,r,i;return n.selector().attr("bclDisableTarget")&&(r=JC.f.parentSelector(n.selector(),n.selector().attr("bclDisableTarget"))),t&&(t=e(t)).length&&t.attr("bclTrigger")&&(r=JC.f.parentSelector(t,t.attr("bclDisableTarget"))),r},bclDisable:function(t){var n=!1,r;t&&(t=e(t));if(!t||!t.length)return n;if(t.prop("nodeName").toLowerCase()=="select"){r=t.find(":selected");if(!r.length)return n;if(t.is("[bclDisable]")||r.is("[bclDisable]"))t.is("[bclDisable]")&&(n=t.attr("bclDisable")==t.val()),r.is("[bclDisable]")&&(n=JC.f.parseBool(r.attr("bclDisable")))}else t.is("[bclDisable]")&&(n=JC.f.parseBool(t.attr("bclDisable")));return t.prop("nodeName").toLowerCase()=="input"&&t.attr("type").toLowerCase()=="checkbox"&&(n=!t.prop("checked")),n},bclDisplay:function(t){var n=!1,r;t&&(t=e(t));if(!t||!t.length)return n;if(t.prop("nodeName").toLowerCase()=="select"){r=t.find(":selected");if(!r.length)return n;!t.is("[bclDisplay]")&&!r.is("[bclDisplay]")?(t.is("[bclDisable]")&&(n=t.attr("bclDisable")==t.val()),r.is("[bclDisable]")&&(n=JC.f.parseBool(r.attr("bclDisable")))):(t.is("[bclDisplay]")&&(n=t.attr("bclDisplay")==t.val()),r.is("[bclDisplay]")&&(n=JC.f.parseBool(r.attr("bclDisplay"))))}else t.is("[bclDisplay]")?t.is("[bclDisplay]")&&(n=JC.f.parseBool(t.attr("bclDisplay"))):t.is("[bclDisable]")&&(n=!JC.f.parseBool(t.attr("bclDisable")));return t.prop("nodeName").toLowerCase()=="input"&&t.attr("type").toLowerCase()=="checkbox"&&(n=t.prop("checked")),n},bclHideTarget:function(t){var n=this,r,i;return n.selector().attr("bclHideTarget")&&(r=JC.f.parentSelector(n.selector(),n.selector().attr("bclHideTarget"))),t&&(t=e(t)).length&&t.attr("bclHideTarget")&&(r=JC.f.parentSelector(t,t.attr("bclHideTarget"))),r},bclHideToggle:function(e){var t;return e&&e.is("[bclHideToggle]")&&(t=JC.f.parseBool(e.attr("bclHideToggle"))),t},bclDoneCallback:function(){var e=t.doneCallback,n;return this.selector()&&(n=this.selector().attr("bclDoneCallback"))&&(n=window[n])&&(e=n),e},bclEnableCallback:function(){var e=t.enableCallback,n;return this.selector()&&(n=this.selector().attr("bclEnableCallback"))&&(n=window[n])&&(e=n),e},bclDisableCallback:function(){var e=t.disableCallback,n;return this.selector()&&(n=this.selector().attr("bclDisableCallback"))&&(n=window[n])&&(e=n),e}},r.prototype={init:function(){return this},change:function(t){t&&(t=e(t));if(!(t&&t.length&&t.is(":visible")))return;var n=this,r=n._model.bclDisable(t),i=n._model.bclDisableTarget(t),s=n._model.bclDisplay(t),o=n._model.bclHideTarget(t);if(t.is("[bclHideTargetSub]")){var u=JC.f.parentSelector(t,t.attr("bclHideTargetSub"));u&&u.length&&(t.prop("checked")?u.show():u.hide())}i&&i.length&&i.each(function(){var t=e(this);t.attr("disabled",r),JC.Valid&&JC.Valid.setValid(t);if(t.is("[bclHideTargetSub]")){var n=JC.f.parentSelector(t,t.attr("bclHideTargetSub"));if(!n||!n.length)return;r?n.hide():t.prop("checked")?n.show():n.hide()}}),o&&o.length&&o.each(function(){var t=n._model.bclHideToggle(e(this))?!s:s;t?e(this).show():e(this).hide()}),r?e(n).trigger("TriggerEvent",["DisableItem",t]):e(n).trigger("TriggerEvent",["EnableItem",t]),e(n).trigger("TriggerEvent",["ChangeDone",t]),JC.log("ChangeLogic view change",(new Date).getTime(),r)}},e(document).ready(function(){setTimeout(function(){t.init()},10)})}(jQuery),Bizs.ChangeLogic})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);