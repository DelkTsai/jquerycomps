(function(e,t){e(["JC.BaseMVC"],function(){return function(e){function t(e){if(t._instance)return t._instance;this._model=new t.Model(e),this._init()}window.Bizs=window.Bizs||{},Bizs.KillISPCache=t,t.prototype={_beforeInit:function(){JC.log("KillISPCache._beforeInit",(new Date).getTime()),this._model.processAjax()},process:function(t,n){t&&(t=e(t));if(!t||!t.length)return;var r=this;return r._model.ignoreSameLinkText(n),r._model.selector(t),r._model.processLink(),r._model.processForm(),this},ignoreUrl:function(e){return this._model.ignoreUrl(e)},ignoreSelector:function(e){return this._model.ignoreSelector(e)}},t.getInstance=function(){return!t._instance&&(t._instance=new t),t._instance},t.ignoreSameLinkText=!0,t.randName="",t.ignoreUrl=function(e){return t.getInstance().ignoreUrl(e)},t.ignoreSelector=function(e){return t.getInstance().ignoreSelector(e)},JC.BaseMVC.buildModel(t),t.Model.prototype={init:function(){this._postfix=JC.f.printf("{0}_{1}_",(new Date).getTime().toString(),Math.round(Math.random()*1e5)),this._count=1,this._ignoreSameLinkText=!0,this._randName="isp",this._ignoreUrl=[],this._ignoreSelector=[]},ignoreUrl:function(e){return typeof e=="string"&&(e=e.split(",")),e&&e.length&&(this._ignoreUrl=this._ignoreUrl.concat(e)),this._ignoreUrl},ignoreSelector:function(e){return typeof e=="string"&&(e=e.split(",")),e&&e.length&&(this._ignoreSelector=this._ignoreSelector.concat(e)),this._ignoreSelector},processLink:function(){var t=this;this.selector().find("a[href]").each(function(){var n=e(this),r=(n.attr("href")||"").trim(),i=n.html().trim();if(/javascript\:/.test(r)||/^[\s]*\#/.test(r))return;if(t.ignoreSameLinkText()&&r.trim()==n.html().trim())return;var s=t.ignoreSelector(),o=!1;e.each(s,function(e,t){if(n.is(t))return o=!0,!1});if(o)return;r=JC.f.addUrlParams(r,t.keyVal()),n.attr("href",r),n.html(i)})},processForm:function(){var t=this;this.selector().find("form").each(function(){var n=e(this),r=(n.prop("method")||"").toLowerCase();if(r=="post")return;var i=t.ignoreSelector(),s=!1;e.each(i,function(e,t){if(n.is(t))return s=!0,!1});if(s)return;n.find("input[name="+t.randName()+"]").length||e('<input type="hidden" name="'+t.randName()+'" value="'+t.postfix()+'" >').appendTo(n)})},processAjax:function(){var t=this;e(document).ajaxSend(function(n,r,i){if(i.type=="POST")return;var s=t.ignoreUrl(),o=!1;e.each(s,function(e,t){var n=t.length,r=i.url.slice(0,n);t.toLowerCase()==r.toLowerCase()&&(o=!0)}),!o&&(i.url=JC.f.addUrlParams(i.url,t.keyVal()))})},ignoreSameLinkText:function(e){return typeof e!="undefined"&&(t.ignoreSameLinkText=e),t.ignoreSameLinkText},postfix:function(){return this._postfix+this._count++},randName:function(){return t.randName||this._randName},keyVal:function(){var e={};return e[this.randName()]=this.postfix(),e}},JC.BaseMVC.build(t,"Bizs"),e(document).ready(function(){setTimeout(function(){t.autoInit&&t.getInstance().process(e(document))},100)})}(jQuery),Bizs.KillISPCache})})(typeof define=="function"&&define.amd?define:function(e,t){t&&t()},this);