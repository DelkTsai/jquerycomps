(function(e,t){e(["JC.BaseMVC"],function(){function n(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,n))return JC.BaseMVC.getInstance(e,n);JC.BaseMVC.getInstance(e,n,this),this._model=new n.Model(e),this._view=new n.View(this._model),this._init(),JC.log(n.Model._instanceName,"all inited",(new Date).getTime())}var e=$(document),t=$(window);return JC.DragSelect=n,n.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compDragSelect")?t.push(new n(e)):e.find("div.js_compDragSelect").each(function(){t.push(new n(this))})),t},n.AR_IX=function(e,t,n){return e[t]||e[0]||n||""},JC.BaseMVC.build(n),JC.f.extendObject(n.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("inited",function(){}),$.each(e._model.itemsClassAr(),function(r,i){function u(n){e._model.selectReady(r,!1),t.off("mouseup",u),e.trigger("select_done",[r,i,s,o])}var s=n.AR_IX(e._model.selectClassAr(),r),o=n.AR_IX(e._model.unselectClassAr(),r);e.selector().delegate(i,"click",function(e){}),e.selector().delegate(i,"mousedown",function(n){var a=$(this);t.off("mouseup",u),e._model.clearCache(),e._model.selectReady(r,!0),e.trigger("item_find",[a,r,i,s,o]),t.on("mouseup",u),JC.log("mousedown",r,i,JC.f.ts())}),e.selector().delegate(i,"mouseover",function(t){if(!e._model.selectReady(r))return;var n=$(this);e.trigger("item_find",[n,r,i,s,o])})}),e.on("init_count",function(t,r,i,s,o,u){r=$(r);var a;r.data(e._model.countKey())?(a=r.data(e._model.countKey()),n.Model.UNI_COUNT-2==a&&e._model.prevItem()&&(e._model.prevItem().data(e._model.countKey(),0),e.trigger("unselect_item",[e._model.prevItem(),i,s,o,u]))):r.data(e._model.countKey(),n.Model.UNI_COUNT++)}),e.on("item_find",function(t,n,r,i,s,o){n=$(n),e.trigger("init_count",[n,r]),n.hasClass(s)?e.trigger("unselect_item",[n,r,i,s,o]):e.trigger("select_item",[n,r,i,s,o])}),e.on("select_item",function(t,n,r,i,s,o){n=$(n),s&&n.addClass(s),o&&n.removeClass(o),e._model.findedItems(n,i)}),e.on("unselect_item",function(t,n,r,i,s,o){n=$(n),s&&n.removeClass(s),o&&n.addClass(o),e._model.findedItems(n,i)}),e.on("select_done",function(t,n,r,i,s){JC.log("select_done",JC.f.ts());var o=e._model.fixFindedItems(r,i,s);e.trigger("process_select",[o,n,r,i,s])}),e.on("process_select",function(e,t,n,r,i,s){JC.log("process_select",JC.f.ts()),JC.dir(t)})},_inited:function(){this.trigger("inited")}}),n.Model._instanceName="JCDragSelect",n.Model.UNI_COUNT=1,n.Model.BEFORE_FIND_PREFIX="beforeSelected",JC.f.extendObject(n.Model.prototype,{init:function(){},findedItems:function(e,t,n){var r=this;if(e&&t){!r._findedItems&&(r._findedItems={},r._findedItems[t]={}),!r._findedItems[t]&&(r._findedItems[t]={});var i=e.data(r.countKey());r._findedItems[t][i]=e}return!n&&t?r._findedItems[t]:r._findedItems},fixFindedItems:function(e,t,n){var r=this,i=r.findedItems(null,e);return $.each(i,function(e,n){n.hasClass(t)||delete i.select[e]}),i},clearFindedItems:function(){this._findedItems={}},prevItem:function(e){return typeof e!="undefined"&&(this._prevItem=e),this._prevItem},countKey:function(e){var t=this;return(!t._countKey||e)&&(t._countKey="CDS_"+(new Date).getTime()),t._countKey},selectReady:function(e,t){return!this._selectReady&&(this._selectReady={}),typeof t!="undefined"&&(this._selectReady[e]=t),this._selectReady[e]},items:function(){return this.selectorProp("cdsItems")},itemsClass:function(){return this.attrProp("cdsItems")},selectClass:function(){return this.attrProp("cdsSelectClass")},unselectClass:function(){return this.attrProp("cdsUnselectClass")},processAr:function(e,t){var n=this;return!n[e]&&(n[e]=t.split(n.itemDelimiter()),$.each(n[e],function(t,r){n[e][t]=$.trim(r)})),n[e]},itemsAr:function(){return this.processAr("_itemsAr",this.items())},itemsClassAr:function(){return this.processAr("_itemsClassAr",this.itemsClass())},selectClassAr:function(){return this.processAr("_selectClassAr",this.selectClass())},unselectClassAr:function(){return this.processAr("_unselectClassAr",this.unselectClass())},itemDelimiter:function(){return this.attrProp("cdsItemDelimiter")||"||"},clearCache:function(){var e=this;e.prevItem(null),e._relativeParent=null,e.clearFindedItems(),e.countKey(!0)}}),JC.f.extendObject(n.View.prototype,{init:function(){}}),e.ready(function(){n.autoInit&&n.init()}),JC.DragSelect})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);