(function(b,a){b(["JC.common"],function(){(function(d){window.JC=window.JC||{log:function(){}};JC.Valid=window.Valid=c;function c(){var g=JC.f.sliceArgs(arguments);if(g.length){return c.check.apply(null,g)}if(c._instance){return c._instance}c._instance=this;this._model=new f();this._view=new e(this._model);this._init()}c.prototype={_init:function(){var g=this;d([this._view,this._model]).on(f.BIND,function(h,j,i){g.on(j,i)});d([this._view,this._model]).on(f.TRIGGER,function(h,j){var i=JC.f.sliceArgs(arguments).slice(2);g.trigger(j,i)});g.on(f.CORRECT,function(h){var i=JC.f.sliceArgs(arguments).slice(1);g._view.valid.apply(g._view,i)});g.on(f.ERROR,function(h){var i=JC.f.sliceArgs(arguments).slice(1);g._view.error.apply(g._view,i)});g.on(f.FOCUS_MSG,function(h){var i=JC.f.sliceArgs(arguments).slice(1);g._view.focusmsg.apply(g._view,i)});this._view.init();return this},on:function(h,g){d(this).on(h,g);return this},trigger:function(h,g){d(this).trigger(h,g);return this},parse:function(i){var h=this,k=true,i=d(i);if(!h._model.isAvalible(i)){return k}if(!h._model.isValid(i)){return k}if(c.ignore(i)){return k}var g=h._model.parseDatatype(i),j=i.prop("nodeName").toLowerCase();switch(j){case"input":case"textarea":(i.attr("type")||"").toLowerCase()!="file"&&h._model.isAutoTrim(i)&&i.val(d.trim(i.val()));break}if(!h._model.reqmsg(i)){k=false;return k}if(!h._model.lengthValid(i)){k=false;return k}if(g&&h._model[g]&&i.val()){if(!h._model[g](i)){k=false;return k}}var l=i.attr("subdatatype");if(l){l=l.replace(/[\s]+/g,"").split(/[,\|]/);d.each(l,function(m,n){n=h._model.parseSubdatatype(n);if(n&&h._model[n]&&(i.val()||n=="alternative")){if(!h._model[n](i)){k=false;return false}}})}k&&h.trigger(f.CORRECT,i);return k},check:function(){var g=this,m=true,l=JC.f.sliceArgs(arguments),k,h;d.each(l,function(p,n){n=d(n);c.isFormValid=false;if(g._model.isForm(n)){c.isFormValid=true;var o=g._model.isErrorAbort(n),i=c.ignore(n),j;for(k=0,h=n[0].length;k<h;k++){var q=d(n[0][k]);if(!g._model.isValid(q)){continue}if(i&&!q.val().trim()){continue}!g.parse(q)&&(m=false);if(o&&!m){break}}}else{if(c.isFormControl(n)){if(!g._model.isValid(n)){return}!g.parse(n)&&(m=false)}else{!g.check(n.find(c._formControls))&&(m=false)}}});return m},clearError:function(){var h=JC.f.sliceArgs(arguments),g=this;d.each(h,function(j,i){d(i).each(function(){var m=d(this);switch(m.prop("nodeName").toLowerCase()){case"form":for(var l=0,k=m[0].length;l<k;l++){c.setValid(d(m[0][l]),1,true)}break;default:c.setValid(m,1,true);break}})});return this},isValid:function(g){return this._model.isValid(g)}};c.checkAll=c.check=function(){return c.getInstance().check.apply(c.getInstance(),JC.f.sliceArgs(arguments))};c.getInstance=function(){!c._instance&&new c();return c._instance};c.checkTimeout=function(g,i){g&&(g=d(g));if(!(g&&g.length)){return}i=parseInt(g.attr("validCheckTimeout"))||i;var h="VALID_CHECK_TIMEOUT";if(i){g.data(h)&&clearTimeout(g.data(h));g.data(h,setTimeout(function(){c.check(g)},i))}else{c.check(g)}};c.dataValid=function(g,i,k,h){var j=false,l="datavalidmsg";g&&(g=d(g));if(typeof i!="undefined"){j=i;g.attr("datavalid",i);if(!k){if(i){g.trigger("blur",[true])}else{h&&(l=" "+h);c.setError(g,l,true)}}}else{if(g&&g.length){j=JC.f.parseBool(g.attr("datavalid"))}}return j};c.isValid=function(g){return c.getInstance().isValid(g)};c.statusTimeout={valid:function(g,h){g&&(g=d(g));if(!(g&&g.length)){return}g.data(f.TIMEOUT_VALID)&&clearTimeout(g.data(f.TIMEOUT_VALID));h&&c.statusTimeout.clear();h&&g.data(f.TIMEOUT_VALID,h)},error:function(g,h){g&&(g=d(g));if(!(g&&g.length)){return}g.data(f.TIMEOUT_ERROR)&&clearTimeout(g.data(f.TIMEOUT_ERROR));h&&c.statusTimeout.clear();h&&g.data(f.TIMEOUT_ERROR,h)},focus:function(g,h){g&&(g=d(g));if(!(g&&g.length)){return}g.data(f.TIMEOUT_FOCUS)&&clearTimeout(g.data(f.TIMEOUT_FOCUS));h&&c.statusTimeout.clear();h&&g.data(f.TIMEOUT_FOCUS,h)},success:function(g,h){g&&(g=d(g));if(!(g&&g.length)){return}g.data(f.TIMEOUT_SUCCESS)&&clearTimeout(g.data(f.TIMEOUT_SUCCESS));h&&c.statusTimeout.clear();h&&g.data(f.TIMEOUT_SUCCESS,h)},clear:function(g){for(var h in c.statusTimeout){if(h=="clear"){continue}c.statusTimeout[h](g)}}};c.setValid=function(j,h,g,i){j=d(j);j.each(function(l,k){k=d(this);c.statusTimeout.clear(k);d(c.getInstance()._view).trigger("setValid",[k,h,g,i])});return c.getInstance()};c.setError=function(i,h,g){i=d(i);i.each(function(l,k){k=d(this);c.statusTimeout.clear(k);if(h&&h.trim()&&/^[\s]/.test(h)){var j="autoGenerateErrorMsg";k.attr(j,h);h=j}d(c.getInstance()._view).trigger("setError",[k,h,g])});return c.getInstance()};c.focusmsg=c.setFocusMsg=function(i,h,g){i=d(i);i.each(function(l,k){k=d(this);c.statusTimeout.clear(k);if(typeof h=="string"){g=h;h=false}if(g&&g.trim()&&/^[\s]/.test(g)){var j="autoGenerateFocusMsg";k.attr(j,g);g=j}c.getInstance().trigger(f.FOCUS_MSG,[k,h,g])});return c.getInstance()};c.focusmsgEverytime=true;c.emDisplayType="inline";c.showValidStatus=false;c.clearError=function(){return c.getInstance().clearError.apply(c.getInstance(),JC.f.sliceArgs(arguments))};c.errorAbort=false;c.autoTrim=true;c.itemCallback;c.ignore=function(g,i){g=d(g);if(!(g&&g.length)){return true}var h=false;if(typeof i!="undefined"){i?g.removeAttr("ignoreprocess"):g.attr("ignoreprocess",true);h=!i}else{g.is("[ignoreprocess]")&&((g.attr("ignoreprocess")||"").trim()?(h=JC.f.parseBool(g.attr("ignoreprocess"))):(h=true))}return h};c._formControls="input, select, textarea";c.isFormControl=function(g){var h=false;g&&(g=d(g)).length&&(h=g.is(c._formControls));return h};c.ignoreAutoCheckEvent=false;function f(){this._init()}f.TRIGGER="TriggerEvent";f.BIND="BindEvent";f.ERROR="ValidError";f.CORRECT="ValidCorrect";f.FOCUS_MSG="ValidFocusMsg";f.TIMEOUT_VALID="Valid_ValidTimeout";f.TIMEOUT_ERROR="Valid_ErrorTimeout";f.TIMEOUT_FOCUS="Valid_FocusTimeout";f.TIMEOUT_SUCCESS="Valid_SuccessTimeout";f.SELECTOR_ERROR="~ em.error, ~ em.errormsg";f.CSS_ERROR="error errormsg";f.FILTER_ERROR="em.error em.errormsg";f.prototype={_init:function(){return this},parseDatatype:function(g){var h="";if(typeof g=="string"){h=g}else{h=g.attr("datatype")||"text"}return h.toLowerCase().replace(/\-.*/,"")},parseSubdatatype:function(g){var h="";if(typeof g=="string"){h=g}else{h=g.attr("subdatatype")||""}return h.toLowerCase().replace(/\-.*/,"")},isAvalible:function(g){return(g.is(":visible")||this.isValidHidden(g))&&!g.is("[disabled]")},isForm:function(g){var h;g.prop("nodeName")&&g.prop("nodeName").toLowerCase()=="form"&&(h=true);return h},isErrorAbort:function(g){var h=c.errorAbort;g.is("[errorabort]")&&(h=JC.f.parseBool(g.attr("errorabort")));return h},isValid:function(g){g=d(g);var i,h;g.each(function(){h=d(this);if(h.is("[datatype]")||h.is("[subdatatype]")||h.is("[minlength]")||h.is("[maxlength]")||h.is("[reqmsg]")||h.is("form")){i=true}});return i},isAutoTrim:function(h){h=d(h);var i=c.autoTrim,g=JC.f.getJqParent(h,"form");g&&g.length&&g.is("[validautotrim]")&&(i=JC.f.parseBool(g.attr("validautotrim")));h.is("[validautotrim]")&&(i=JC.f.parseBool(h.attr("validautotrim")));return i},isReqmsg:function(g){return g.is("[reqmsg]")},isValidMsg:function(h){h=d(h);var i=c.showValidStatus,g=JC.f.getJqParent(h,"form");g&&g.length&&g.is("[validmsg]")&&(i=JC.f.parseBool(g.attr("validmsg")));h.is("[validmsg]")&&(i=JC.f.parseBool(h.attr("validmsg")));return i},isValidHidden:function(g){var h=false;g.is("[subdatatype]")&&/hidden/i.test(g.attr("subdatatype"))&&(h=true);return h},validitemcallback:function(h){h=d(h);var j=c.itemCallback,g=JC.f.getJqParent(h,"form"),i;g&&g.length&&g.is("[validitemcallback]")&&(i=g.attr("validitemcallback"))&&(i=window[i])&&(j=i);h.is("[validitemcallback]")&&(i=h.attr("validitemcallback"))&&(i=window[i])&&(j=i);return j},isMinlength:function(g){return g.is("[minlength]")},isMaxlength:function(g){return g.is("[maxlength]")},minlength:function(g){return parseInt(g.attr("minlength"),10)||0},maxlength:function(g){return parseInt(g.attr("maxlength"),10)||0},isMinvalue:function(g){return g.is("[minvalue]")},isMaxvalue:function(g){return g.is("[maxvalue]")},isDatatarget:function(g,h){var j=false,i="datatarget";h&&(h+=i)&&(j=g.is("["+h+"]"));!j&&(j=g.is("["+i+"]"));return j},datatarget:function(g,h){var j,i="datatarget";h&&(h+=i)&&(h=g.attr(h))&&(j=JC.f.parentSelector(g,h));!(j&&j.length)&&(j=JC.f.parentSelector(g,g.attr(i)));return j},minvalue:function(g,i){if(typeof i=="string"){var h=i.toLowerCase().trim();switch(h){default:return JC.f.parseDate(g.attr("minvalue"),g)}}else{if(i){return parseFloat(g.attr("minvalue"))||0}else{return parseInt(g.attr("minvalue"),10)||0}}},maxvalue:function(g,i){if(typeof i=="string"){var h=i.toLowerCase().trim();switch(h){default:return JC.f.parseDate(g.attr("maxvalue"),g)}}else{if(i){return parseFloat(g.attr("maxvalue"))||0}else{return parseInt(g.attr("maxvalue"),10)||0}}},lengthValid:function(k){var h=this,m=true,k=d(k),g=h.parseDatatype(k),l,j,n=d.trim(k.val()),i;if(!n){return m}h.isMinlength(k)&&(l=h.minlength(k));h.isMaxlength(k)&&(j=h.maxlength(k));switch(g){case"bytetext":i=h.bytelen(n);break;case"richtext":default:i=n.length;break}l&&(i<l)&&(m=false);j&&(i>j)&&(m=false);JC.log("lengthValid: ",l,j,m,n.length);!m&&d(h).trigger(f.TRIGGER,[f.ERROR,k]);return m},n:function(n,i){var g=this,r=true,o=n.val().trim(),j=+o,l=0,p=10,q=Math.pow(10,p),h,k,m;g.isMinvalue(n)&&(l=g.minvalue(n,/\./.test(n.attr("minvalue")))||l);if(/^[0]+$/.test(o)&&o.length>1){r=false}if(r&&!isNaN(j)&&j>=l){n.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(t,s){m=s.split(".");h=parseInt(m[0]);k=parseInt(m[1]);h>p&&(q=Math.pow(10,h))});g.isMaxvalue(n)&&(q=g.maxvalue(n,/\./.test(n.attr("maxvalue"))));if(j>=l&&j<=q){typeof h!="undefined"&&typeof k!="undefined"&&(r=new RegExp("^(?:-|)(?:[\\d]{0,"+h+"}|)(?:\\.[\\d]{1,"+k+"}|)$").test(o));typeof h!="undefined"&&typeof k=="undefined"&&(r=new RegExp("^(?:-|)[\\d]{1,"+h+"}$").test(o));typeof h=="undefined"&&typeof k!="undefined"&&(r=new RegExp("^(?:-|)\\.[\\d]{1,"+k+"}$").test(o));typeof k=="undefined"&&/\./.test(o)&&(r=false)}else{r=false}}else{r=false}!r&&!i&&d(g).trigger(f.TRIGGER,[f.ERROR,n]);return r},nrange:function(i){var g=this,n=g.n(i),j,h,m,l,k;if(n){if(i.is("[fromNEl]")){m=g.getElement(i.attr("fromNEl"),i);l=i}if(i.is("[toNEl]")){m=i;l=g.getElement(i.attr("toNEl"),i)}if(!(m&&m.length||l&&l.length)){k=g.sametypeitems(i);if(k.length>=2){m=d(k[0]);l=d(k[1])}}if(m&&m.length||l&&l.length){JC.log("nrange",m.length,l.length);l.val(d.trim(l.val()));m.val(d.trim(m.val()));if(l[0]!=m[0]&&l.val().length&&m.val().length){n&&(n=g.n(l,true));n&&(n=g.n(m,true));n&&(+m.val())>(+l.val())&&(n=false);JC.log("nrange:",+m.val(),+l.val(),n);n&&d(g).trigger(f.TRIGGER,[f.CORRECT,m]);n&&d(g).trigger(f.TRIGGER,[f.CORRECT,l]);!n&&d(g).trigger(f.TRIGGER,[f.ERROR,m]);!n&&d(g).trigger(f.TRIGGER,[f.ERROR,l]);return n}}}return n},d:function(j,h){var g=this,m=d.trim(j.val()),k=true,i=JC.f.parseDate(m,j),l;if(m&&i){if(g.isMinvalue(j)&&(l=g.minvalue(j,"d"))){i.getTime()<l.getTime()&&(k=false)}if(k&&g.isMaxvalue(j)&&(l=g.maxvalue(j,"d"))){i.getTime()>l.getTime()&&(k=false)}}!k&&!h&&d(g).trigger(f.TRIGGER,[f.ERROR,j]);return k},date:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},daterange:function(i){var g=this,n=g.d(i),j,h,k,m,l;if(n){if(i.is("[fromDateEl]")){k=g.getElement(i.attr("fromDateEl"),i);m=i}if(i.is("[toDateEl]")){k=i;m=g.getElement(i.attr("toDateEl"),i)}if(!(k&&k.length&&m&&m.length)){l=g.sametypeitems(i);if(l.length>=2){k=d(l[0]);m=d(l[1])}}if(k&&k.length||m&&m.length){JC.log("daterange",k.length,m.length);m.val(d.trim(m.val()));k.val(d.trim(k.val()));if(m[0]!=k[0]&&m.val().length&&k.val().length){n&&(n=g.d(m,true))&&(j=JC.f.parseDate(k.val(),k));n&&(n=g.d(k,true))&&(h=JC.f.parseDate(m.val(),m));n&&j&&h&&j.getTime()>h.getTime()&&(n=false);n&&d(g).trigger(f.TRIGGER,[f.CORRECT,k]);n&&d(g).trigger(f.TRIGGER,[f.CORRECT,m]);!n&&d(g).trigger(f.TRIGGER,[f.ERROR,k]);!n&&d(g).trigger(f.TRIGGER,[f.ERROR,m])}}}return n},time:function(h){var g=this,i=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},minute:function(h){var g=this,i=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},bankcard:function(i){var g=this,j=i.val().trim().replace(/[\s]+/g," ");i.val(j);var h=j.replace(/[^\d]/g,""),k=/^[0-9](?:[\d]{21}|[\d]{20}|[\d]{19}|[\d]{18}|[\d]{17}|[\d]{16}|[\d]{15}|[\d]{14}|[\d]{13}|[\d]{12}|[\d]{11}|)$/.test(h);/^[0]+$/.test(h)&&(k=false);!k&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return k},cnname:function(h,j){var g=this,i=g.bytelen(h.val())<=32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(h.val());!j&&!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},enname:function(h,j){var g=this,i=g.bytelen(h.val())<=32&&/^[a-zA-Z ]{2,32}$/.test(h.val());!j&&!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},allname:function(h){var g=this,i=g.bytelen(h.val())<=32&&(g.cnname(h,true)||g.enname(h,true));!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},username:function(h){var g=this,i=/^[a-zA-Z0-9][\w-]{2,30}$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},idnumber:function(h){var g=this,i=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},mobilecode:function(i,h){var g=this,j=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(i.val());!h&&!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},mobile:function(h,g){return this.mobilecode(h,g)},mobilezonecode:function(i,h){var g=this,j=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(i.val());!h&&!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},phonecode:function(h){var g=this,i=/^[1-9][0-9]{6,7}$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},phone:function(i,h){var g=this,j=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(i.val());!h&&!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},phoneall:function(i,h){var g=this,j=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)(?:\#|\-)[\d]{1,6}|)$/.test(i.val());!h&&!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},phonezone:function(i){var g=this,j=i.val().trim(),k,l=/^[0-9]{3,4}$/,h;h=i.attr("datatype").split("-");h.length>1&&(l=new RegExp("^[0-9]{"+h[1]+"}$"));k=l.test(j);!k&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return k},phoneext:function(h){var g=this,i=/^[0-9]{1,6}$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},mobilephone:function(h){var g=this,i=this.mobilecode(h,true)||this.phone(h,true);!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},mobilephoneall:function(h){var g=this,i=this.mobilezonecode(h,true)||this.phoneall(h,true);!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},reg:function(i){var g=this,j=true,h;if(i.is("[reg-pattern]")){h=i.attr("reg-pattern")}if(!h){h=d.trim(i.attr("datatype")).replace(/^reg(?:\-|)/i,"")}h.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(l,k,m){JC.log(k,m);j=new RegExp(k,m||"").test(i.val())});!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},vcode:function(i){var g=this,j,h=parseInt(d.trim(i.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;JC.log("vcodeValid: "+h);j=new RegExp("^[0-9a-zA-Z]{"+h+"}$").test(i.val());!j&&d(g).trigger(f.TRIGGER,[f.ERROR,i]);return j},text:function(g){return true},bytetext:function(g){return true},richtext:function(g){return true},bytelen:function(g){return g.replace(/[^\x00-\xff]/g,"11").length},url:function(h){var g=this,i=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/[\w\/\.\#\+\-\~\%\?\_\=\&]*|)$/i.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},domain:function(h){var g=this,i=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/|)$/i.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},stricdomain:function(h){var g=this,i=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})$/i.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},email:function(h){var g=this,i=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},countrycode:function(h){var g=this,i=h.val().trim(),j=/^(?:\+|)[\d]{1,6}$/.test(i);!j&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return j},zipcode:function(h){var g=this,i=/^[0-9]{6}$/.test(h.val());!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return i},taxcode:function(h){var g=this,j=false,i=h.val().trim();j=/^[\w]{15}$/.test(i)||/^[\w]{18}$/.test(i)||/^[\w]{20}$/.test(i);!j&&d(g).trigger(f.TRIGGER,[f.ERROR,h]);return j},reconfirm:function(l){var g=this,m=true,h,j="ReconfirmValidTime",k="reconfirm";JC.log(k,new Date().getTime());g.isDatatarget(l,k)&&(h=g.datatarget(l,k));!(h&&h.length)&&(h=g.samesubtypeitems(l,k));var i=false;if(h&&h.length){h.each(function(){var n=d(this);if(g.checkRepeatProcess(n,j,true)){i=true}if(l.val()!=d(this).val()){m=false}})}!m&&h.length&&h.each(function(){if(l[0]==this){return}d(g).trigger(f.TRIGGER,[f.ERROR,d(this),"reconfirmmsg",true])});if(m&&h&&h.length){h.each(function(){if(l[0]==this){return}if(i){return false}d(g).trigger(f.TRIGGER,[f.CORRECT,d(this)])})}m?d(g).trigger(f.TRIGGER,[f.CORRECT,l]):d(g).trigger(f.TRIGGER,[f.ERROR,l,"reconfirmmsg",true]);return m},checkRepeatProcess:function(h,i,g,k){var j=new Date().getTime(),l=false;k=k||200;if(h.data(i)){if((j-h.data(i))<k){l=true;h.data(i,j)}}g&&h.data(i,j);return l},alternative:function(n){var h=this,r=true,g,m="AlternativeValidTime",q=h.parseDatatype(n),p="alternative";JC.log(p,new Date().getTime());h.isDatatarget(n,p)&&(g=h.datatarget(n,p));!(g&&g.length)&&(g=h.samesubtypeitems(n,p));var l=false;var j;if(g.length&&!d.trim(n.val())){var i=false;g.each(function(){var s=d(this);if(n[0]==this){return}if(h.checkRepeatProcess(s,m,true)){l=true}if(d(this).val()){i=true;return false}});r=i}!r&&g&&g.length&&g.each(function(){if(n[0]==this){return}if(l){return false}d(h).trigger(f.TRIGGER,[f.ERROR,d(this),"alternativemsg",true])});if(r&&g&&g.length){g.each(function(){if(n[0]==this){return}var s=d(this),u=h.parseDatatype(s);if(u&&h[u]&&d(this).val()){h[u](d(this))}else{if(!d(this).val()){d(h).trigger(f.TRIGGER,[f.CORRECT,d(this)]);var t=JC.f.parentSelector(d(this),d(this).attr("reqtargetdatatarget"));t&&t.length&&d(h).trigger(f.TRIGGER,[f.CORRECT,t])}}})}if(r&&g&&g.length){var k=false,o=[];g.each(function(){if(n[0]==this){return}var s=d(this),t;if(s.is("[alternativeReqTarget]")){t=JC.f.parentSelector(s,s.attr("alternativeReqTarget"));if(t&&t.length){t.each(function(){var v=d(this),u=v.val().trim();if(!u){o.push(v);k=true}})}}});if(n.is("[alternativeReqTarget]")){j=JC.f.parentSelector(n,n.attr("alternativeReqTarget"));if(j&&j.length){j.each(function(){var t=d(this),s=t.val().trim();if(!s){o.push(t);k=true}})}}if(k&&o.length){r=false;d.each(o,function(s,t){t=d(t);d(h).trigger(f.TRIGGER,[f.ERROR,t,"alternativeReqmsg",true])});return r}}if(r){if(q&&h[q]&&n.val()){h[q](n)}else{if(!n.val()){d(h).trigger(f.TRIGGER,[f.CORRECT,n])}}}else{d(h).trigger(f.TRIGGER,[f.ERROR,n,"alternativemsg",true])}return r},reqtarget:function(i){var g=this,l=true,j=i.val().trim(),k,h=JC.f.parentSelector(i,i.attr("reqtargetdatatarget")||i.attr("datatarget"));if(j&&h&&h.length){k=h.val().trim();!k&&(l=false);!l&&d(g).trigger(f.TRIGGER,[f.ERROR,h,"reqtargetmsg",true]);l&&h.trigger("blur")}else{if(h&&h.length){h.trigger("blur")}}return l},unique:function(o){var i=this,t=true,h,m,g=[],q=i.typeLen(o.attr("subdatatype"))[0],n="UniqueValidTime",p="unique",l=JC.f.parseBool(o.attr("uniqueIgnoreCase")),s,r;i.isDatatarget(o,p)&&(h=i.datatarget(o,p));!(h&&h.length)&&(h=i.samesubtypeitems(o,p));s=[];r=[];var k=false;if(h&&h.length){m={};h.each(function(v){var u=d(this);if(u.is("[processDisabled]")&&(!u.attr("processDisabled")||JC.f.parseBool(u.attr("processDisabled")))){if(!u.is(":visible")){return}}else{if(!i.isAvalible(u)){return}}if(i.checkRepeatProcess(u,n,true)){k=true}if(v%q===0){g.push([])}g[g.length-1]&&g[g.length-1].push(u)});d.each(g,function(v,y){var x=[],z=false;d.each(y,function(C,D){var A,B=JC.f.parseBool(D.attr("uniqueIgnoreEmpty"));A=d(D).val().trim();B&&!A&&D.is(":visible")&&(z=true);x.push(A)});var u=x.join(""),w=x.join("####");if(z){return}if(!u){return}l&&(w=w.toLowerCase());if(w in m){m[w].push(y);t=false}else{m[w]=[y]}});for(var j in m){if(m[j].length>1){t=false;d.each(m[j],function(u,v){s=s.concat(v)})}else{d.each(m[j],function(u,v){r=r.concat(v)})}}}d.each(r,function(v,w){var u=i.parseDatatype(w);if(u&&i[u]&&w.val()){if(i[u](w)){c.setValid(w)}}else{c.setValid(w)}});!t&&s.length&&d.each(s,function(v,w){w=d(w);var u=w.val().trim();if(k){return false}if(!u){return}u&&d(i).trigger(f.TRIGGER,[f.ERROR,w,"uniquemsg",true])});return t},datavalid:function(h){var i=true,g=this;if(!c.isFormValid){return i}if(!h.is("[datavalid]")){return i}JC.log("datavalid",new Date().getTime());i=JC.f.parseBool(h.attr("datavalid"));if(!i){c.statusTimeout.error(h,setTimeout(function(){d(g).trigger(f.TRIGGER,[f.ERROR,h,"datavalidmsg",true])},1))}return i},typeLen:function(h){var g=[1];h&&(h=h.replace(/[^\d\.]/g,""))&&(g=h.split("."))&&(g[0]=parseInt(g[0],10)||1,g[1]=parseInt(g[1],10)||0);return g},findValidEle:function(i){var g=this,h="~ em.validmsg",k=i.find(h),j;if(i.attr("validel")&&(j=g.getElement(i.attr("validel"),i,h)).length){k=j}return k},findFocusEle:function(i){var g=this,h="~ em.focusmsg",k=i.find(h),j;if(i.attr("focusel")&&(j=g.getElement(i.attr("focusel"),i,h)).length){k=j}return k},findErrorEle:function(i){var g=this,h=f.SELECTOR_ERROR,k=i.find(h),j;if(i.attr("emel")&&(j=g.getElement(i.attr("emel"),i,h)).length){k=j}return k},getElement:function(g,h,i){if(/^\^$/.test(g)){i=i||f.SELECTOR_ERROR;g=d(h.parent().find(i))}else{if(/^[\/\|\<\(]/.test(g)){g=JC.f.parentSelector(h,g)}else{if(/\./.test(g)){return d(g)}else{if(/^[\w-]+$/.test(g)){g="#"+g;g=d(g.replace(/[\#]+/g,"#"))}}}}return d(g)},errorMsg:function(i,h,g){var j=i.is("[errmsg]")?" "+i.attr("errmsg"):i.is("[reqmsg]")?i.attr("reqmsg"):"";h&&(j=i.attr(h)||j);g&&j&&(j=" "+j);j=(j||"").trim().toLowerCase()=="undefined"||typeof j==undefined?"":j;if(j&&!/^[\s]/.test(j)){switch(i.prop("type").toLowerCase()){case"file":j="请上传"+j;break;case"select-multiple":case"select-one":case"checkbox":case"radio":case"select":j="请选择"+j;break;case"textarea":case"password":case"text":j="请填写"+j;break}}return d.trim(j)},reqmsg:function(h){var i=true,g=this;if(!g.isReqmsg(h)){return i}if(h.val()&&h.val().constructor==Array){i=!!(d.trim(h.val().join("")+""))}else{i=!!d.trim(h.val()||"")}!i&&d(g).trigger(f.TRIGGER,[f.ERROR,h,"reqmsg"]);JC.log("regmsgValid: "+i);return i},sametypeitems:function(i){var g=this,k=[],j=i.parent(),h=i.attr("datatype"),l=new RegExp(h,"i");if(/select/i.test(i.prop("nodeName"))){j.find("[datatype]").each(function(){l.test(d(this).attr("datatype"))&&k.push(d(this))})}else{j.find("input[datatype]").each(function(){l.test(d(this).attr("datatype"))&&k.push(d(this))})}return k.length?d(k):k},samesubtypeitems:function(k,j){var h=this,m=[],l=k.parent(),j=j||k.attr("subdatatype"),n=new RegExp(j,"i"),g=k.prop("nodeName").toLowerCase(),i="input";if(/select/.test(g)){i="select"}else{if(/textarea/.test(g)){i="textarea"}}l.find(i+"[subdatatype]").each(function(){n.test(d(this).attr("subdatatype"))&&m.push(d(this))});return m.length?d(m):m},focusmsgeverytime:function(g){var h=c.focusmsgEverytime;g.is("[focusmsgeverytime]")&&(h=JC.f.parseBool(g.attr("focusmsgeverytime")));return h},validemdisplaytype:function(h){h&&(h=d(h));var j=c.emDisplayType,g=JC.f.getJqParent(h,"form"),i;g&&g.length&&g.is("[validemdisplaytype]")&&(i=g.attr("validemdisplaytype"))&&(j=i);h.is("[validemdisplaytype]")&&(i=h.attr("validemdisplaytype"))&&(j=i);return j},checkedType:function(n,k){n&&(n=d(n));k=k||"checkbox";var h=this,q=true,p,m,i=1,o=0,l=n,j=n.parent().prop("nodeName").toLowerCase()=="label",g=k+"finder";JC.log(n.attr("name")+", "+n.val());if(n.is("[datatarget]")){p=JC.f.parentSelector(n,n.attr("datatarget"));m=[];p.each(function(){var r=d(this);r.is(":visible")&&!r.prop("disabled")&&m.push(r)});p=d(m)}else{if(j){if(!l.is("["+g+"]")){l=n.parent().parent()}else{l=JC.f.parentSelector(n,n.attr(g))}m=JC.f.parentSelector(l,"|input[datatype]")}else{m=JC.f.parentSelector(l,"/input[datatype]")}p=[];m.each(function(){var r=d(this);var s=new RegExp(k,"i");s.test(r.attr("datatype"))&&r.is(":visible")&&!r.prop("disabled")&&p.push(r)});p=d(p)}if(j){p.each(function(){var r=d(this);if(!r.is("[emel]")){r.attr("emel","//em.error")}if(!r.is("[validel]")){r.attr("validel","//em.validmsg")}if(!r.is("[focusel]")){r.attr("focusel","//em.focusmsg")}})}p.length&&d(n=p[p.length-1]).data("Last"+k,true);if(p.length){n.is("[datatype]")&&n.attr("datatype").replace(/[^\-]+?\-([\d]+)/,function(s,r){i=parseInt(r,10)||i});if(p.length>=i){p.each(function(){d(this).prop("checked")&&o++});if(o<i){q=false}}!q&&d(h).trigger(f.TRIGGER,[f.ERROR,n])}return q},checkbox:function(g){return this.checkedType(g,"checkbox")},radio:function(g){return this.checkedType(g,"radio")},file:function(i){var h=this,l=true,k=i.val().trim().toLowerCase(),g=h.dataFileExt(i),m,j;if(g.length){l=false;d.each(g,function(o,n){n+="$";m=new RegExp(n,"i");if(m.test(k)){l=true;return false}})}!l&&d(h).trigger(f.TRIGGER,[f.ERROR,i]);return l},dataFileExt:function(g){var i=[],h;g.is("[fileext]")&&(h=g.attr("fileext").replace(/[\s]+/g,""))&&(h=h.replace(/\./g,"\\."))&&(i=h.toLowerCase().split(","));return i},ignoreAutoCheckEvent:function(h){var i=c.ignoreAutoCheckEvent,g;h&&(h=d(h));if(h&&h.length){g=JC.f.getJqParent(h,"form");g&&g.length&&g.is("[ignoreAutoCheckEvent]")&&(i=JC.f.parseBool(g.attr("ignoreAutoCheckEvent")));h.is("[ignoreAutoCheckEvent]")&&(i=JC.f.parseBool(h.attr("ignoreAutoCheckEvent")))}return i}};function e(g){this._model=g}e.prototype={init:function(){var g=this;d(g).on("setValid",function(j,k,m,i,h){var l;k.removeClass(f.CSS_ERROR);k.find(JC.f.printf('~ em:not("em.focusmsg, em.validmsg, {0}")',f.FILTER_ERROR)).css("display",g._model.validemdisplaytype(k));k.find(f.SELECTOR_ERROR).hide();k.attr("emel")&&(l=g._model.getElement(k.attr("emel"),k))&&l.hide();typeof i=="undefined"&&typeof k.val()!="object"&&!k.val().trim()&&(i=1);g.validMsg(k,i,h)});d(g).on("setError",function(h,n,i,o){var k=g._model.errorMsg.apply(g._model,[n,i,o]),m,p,j,l;n.addClass(f.CSS_ERROR);n.find(JC.f.printf("~ em:not({0})",f.FILTER_ERROR)).hide();if(n.is("[validel]")){(p=g._model.getElement(n.attr("validel"),n))&&p.hide()}if(n.is("[focusel]")){(j=g._model.getElement(n.attr("focusel"),n))&&j.hide()}if(n.is("[emEl]")){(m=g._model.getElement(n.attr("emEl"),n))&&m.addClass(f.CSS_ERROR)}!(m&&m.length)&&(m=n.find(f.SELECTOR_ERROR));if(!m.length){(m=d(JC.f.printf('<em class="{0}"></em>',f.CSS_ERROR))).insertAfter(n)}!k.trim()&&(k="&nbsp;");m.html(k).css("display",g._model.validemdisplaytype(n));JC.log("error:",k)});return this},valid:function(j,l,i){j&&(j=d(j));var g=this,k;j.data("JCValidStatus",true);var h=!JC.f.parseBool(j.attr("validnoerror"));c.statusTimeout.valid(j,setTimeout(function(){d(g).trigger("setValid",[j,l,i,h]);(k=g._model.validitemcallback(j))&&k(j,true)},l||150))},validMsg:function(m,l,k){var g=this,j=(m.attr("validmsg")||"").trim().toLowerCase(),i;if(g._model.isValidMsg(m)){if(j=="true"||j=="1"){j=""}!j.trim()&&(j="&nbsp;");var h=g._model.findFocusEle(m),n=g._model.findValidEle(m),o=g._model.findErrorEle(m);!n.length&&(n=d('<em class="validmsg"></em>'),m.after(n));n.html(j);l?n.hide():(n.css("display",g._model.validemdisplaytype(m)),h&&h.hide(),o&&o.hide())}else{if(k){(i=g._model.findFocusEle(m))&&i.hide()}}},error:function(k,j,i){k&&(k=d(k));var h=this,g=arguments,l;if(k.is("[validnoerror]")){return true}k.data("JCValidStatus",false);c.statusTimeout.error(k,setTimeout(function(){d(h).trigger("setError",[k,j,i]);(l=h._model.validitemcallback(k))&&l(k,false)},150));return false},focusmsg:function(l,i,j){if(l&&(l=d(l)).length&&(l.is("[focusmsg]")||(j&&l.is("["+j+"]")))){JC.log("focusmsg",new Date().getTime());var o,g=this,h=g._model.findFocusEle(l),m=g._model.findValidEle(l),n=g._model.findErrorEle(l),k=l.attr("focusmsg");j&&(k=l.attr(j||k));if(i&&h&&h.length){h.hide();return}n.length&&n.is(":visible")&&n.hide();if(m.length&&m.is(":visible")){return}!h.length&&(h=d('<em class="focusmsg"></em>'),l.after(h));if(l.is("[validnoerror]")){o=c.check(l)}else{l.attr("validnoerror",true);o=c.check(l);l.removeAttr("validnoerror")}!k.trim()&&(k="&nbsp;");if(g._model.focusmsgeverytime(l)){h.html(k).css("display",g._model.validemdisplaytype(l))}else{o&&h.html(k).css("display",g._model.validemdisplaytype(l))}}}};d(document).delegate("input[type=text], input[type=password], textarea","blur",function(h){var g=d(this),i=c.getInstance();if(i._model.ignoreAutoCheckEvent(g)){return}i.trigger(f.FOCUS_MSG,[g,true]);c.checkTimeout(g)});d(document).delegate("input","blur",function(h){var g=d(this),i=c.getInstance();if(g.attr("type")){return}if(i._model.ignoreAutoCheckEvent(g)){return}i.trigger(f.FOCUS_MSG,[g,true]);c.checkTimeout(g)});d(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","change",function(i,h){if(h){return}var g=d(this),j=c.getInstance();if(j._model.ignoreAutoCheckEvent(g)){return}c.checkTimeout(g)});d(document).delegate("input[type=text], input[type=password], textarea, select, input[type=file], input[type=checkbox], input[type=radio]","focus",function(h){var g=d(this),i=c.getInstance(),j=g.val().trim();if(i._model.ignoreAutoCheckEvent(g)){return}i.trigger(f.FOCUS_MSG,[g]);!j&&c.setValid(g)});d(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","blur",function(h){var g=d(this),i=c.getInstance();if(i._model.ignoreAutoCheckEvent(g)){return}i.trigger(f.FOCUS_MSG,[g,true])});d(document).delegate("input[type=hidden][subdatatype]","change",function(h){var g=d(this),i=c.getInstance(),k=false,j;if(i._model.ignoreAutoCheckEvent(g)){return}g.is("[subdatatype]")&&(k=/hidden/i.test(g.attr("subdatatype")));if(g.data("HID_CHANGE_CHECK")){j=new Date().getTime()-g.data("HID_CHANGE_CHECK");if(j<50){return}}if(!g.val()){return}g.data("HID_CHANGE_CHECK",new Date().getTime());JC.log("hidden val",new Date().getTime(),g.val());c.checkTimeout(d(this))});d(document).delegate("input[type=text][subdatatype]","keyup",function(i){var h=d(this);var g=/datavalid/i.test(h.attr("subdatatype"));if(!g){return}if(h.prop("disabled")||h.prop("readonly")){return}c.dataValid(h,false,true);var j;h.attr("datavalidKeyupCallback")&&(j=window[h.attr("datavalidKeyupCallback")])&&j.call(h,i);if(h.data("DataValidInited")){return}h.data("DataValidInited",true);h.data("DataValidCache",{});h.on("DataValidUpdate",function(l,n){var m,k;if(!h.data("DataValidCache")){return}k=h.data("DataValidCache")[n];if(!k){return}n==="suchestest"&&(k.data.errorno=0);c.dataValid(h,!k.data.errorno,false,k.data.errmsg);h.attr("datavalidCallback")&&(m=window[h.attr("datavalidCallback")])&&m.call(h,k.data,k.text)});h.on("blur",function(l,k){JC.log("datavalid",new Date().getTime());if(k){return}var o=h.val().trim(),n,p,m=h.attr("datavalidurl");if(!o){return}if(!m){return}h.data("DataValidTm")&&clearTimeout(h.data("DataValidTm"));h.data("DataValidTm",setTimeout(function(){o=h.val().trim();if(!o){return}o=JC.f.encoder(h)(o);if(!h.data("JCValidStatus")){return}m=JC.f.printf(m,o);h.attr("datavalidUrlFilter")&&(n=window[h.attr("datavalidUrlFilter")])&&(m=n.call(h,m));if(o in h.data("DataValidCache")){h.trigger("DataValidUpdate",o);return}d.get(m).done(function(q){p=q;try{q=d.parseJSON(q)}catch(r){q={errorno:1}}h.data("DataValidCache")[o]={key:o,data:q,text:p};h.trigger("DataValidUpdate",o)})},151))})})}(jQuery));return JC.Valid})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));