(function(b,a){b(["JC.common"],function(){window.JC=window.JC||{log:function(){}};JC.Valid=window.Valid=c;function c(){var f=JC.f.sliceArgs(arguments);if(f.length){return c.check.apply(null,f)}if(c._instance){return c._instance}c._instance=this;this._model=new e();this._view=new d(this._model);this._init()}c.prototype={_init:function(){var f=this;$([this._view,this._model]).on(e.BIND,function(g,i,h){f.on(i,h)});$([this._view,this._model]).on(e.TRIGGER,function(g,i){var h=JC.f.sliceArgs(arguments).slice(2);f.trigger(i,h)});f.on(e.CORRECT,function(g){var h=JC.f.sliceArgs(arguments).slice(1);f._view.valid.apply(f._view,h)});f.on(e.ERROR,function(g){var h=JC.f.sliceArgs(arguments).slice(1);f._view.error.apply(f._view,h)});f.on(e.FOCUS_MSG,function(g){var h=JC.f.sliceArgs(arguments).slice(1);f._view.focusmsg.apply(f._view,h)});this._view.init();return this},on:function(g,f){$(this).on(g,f);return this},trigger:function(g,f){$(this).trigger(g,f);return this},parse:function(h){var g=this,j=true,h=$(h);if(!g._model.isAvalible(h)){return j}if(!g._model.isValid(h)){return j}if(c.ignore(h)){return j}var f=g._model.parseDatatype(h),i=h.prop("nodeName").toLowerCase();switch(i){case"input":case"textarea":(h.attr("type")||"").toLowerCase()!="file"&&g._model.isAutoTrim(h)&&h.val($.trim(h.val()));break}if(!g._model.reqmsg(h)){j=false;return j}if(!g._model.lengthValid(h)){j=false;return j}if(f&&g._model[f]&&h.val()){if(!g._model[f](h)){j=false;return j}}var k=h.attr("subdatatype");if(k){k=k.replace(/[\s]+/g,"").split(/[,\|]/);$.each(k,function(l,m){m=g._model.parseSubdatatype(m);if(m&&g._model[m]&&(h.val()||m=="alternative")){if(!g._model[m](h)){j=false;return false}}})}j&&g.trigger(e.CORRECT,h);return j},check:function(){var f=this,l=true,k=JC.f.sliceArgs(arguments),h,g;$.each(k,function(o,m){m=$(m);c.isFormValid=false;if(f._model.isForm(m)){c.isFormValid=true;var n=f._model.isErrorAbort(m),i=c.ignore(m),j;for(h=0,g=m[0].length;h<g;h++){var p=$(m[0][h]);if(!f._model.isValid(p)){continue}if(i&&!p.val().trim()){continue}!f.parse(p)&&(l=false);if(n&&!l){break}}}else{if(c.isFormControl(m)){if(!f._model.isValid(m)){return}!f.parse(m)&&(l=false)}else{!f.check(m.find(c._formControls))&&(l=false)}}});return l},clearError:function(){var g=JC.f.sliceArgs(arguments),f=this;$.each(g,function(i,h){$(h).each(function(){var m=$(this);switch(m.prop("nodeName").toLowerCase()){case"form":for(var l=0,k=m[0].length;l<k;l++){c.setValid($(m[0][l]),1,true)}break;default:c.setValid(m,1,true);break}})});return this},isValid:function(f){return this._model.isValid(f)}};c.checkAll=c.check=function(){return c.getInstance().check.apply(c.getInstance(),JC.f.sliceArgs(arguments))};c.getInstance=function(){!c._instance&&new c();return c._instance};c.checkTimeout=function(f,h){f&&(f=$(f));if(!(f&&f.length)){return}h=parseInt(f.attr("validCheckTimeout"))||h;var g="VALID_CHECK_TIMEOUT";if(h){f.data(g)&&clearTimeout(f.data(g));f.data(g,setTimeout(function(){c.check(f)},h))}else{c.check(f)}};c.dataValid=function(f,h,j,g){var i=false,k="datavalidmsg";f&&(f=$(f));if(typeof h!="undefined"){i=h;f.attr("datavalid",h);if(!j){if(h){f.trigger("blur",[true])}else{g&&(k=" "+g);c.setError(f,k,true)}}}else{if(f&&f.length){i=JC.f.parseBool(f.attr("datavalid"))}}return i};c.isValid=function(f){return c.getInstance().isValid(f)};c.statusTimeout={valid:function(f,g){f&&(f=$(f));if(!(f&&f.length)){return}f.data(e.TIMEOUT_VALID)&&clearTimeout(f.data(e.TIMEOUT_VALID));g&&c.statusTimeout.clear();g&&f.data(e.TIMEOUT_VALID,g)},error:function(f,g){f&&(f=$(f));if(!(f&&f.length)){return}f.data(e.TIMEOUT_ERROR)&&clearTimeout(f.data(e.TIMEOUT_ERROR));g&&c.statusTimeout.clear();g&&f.data(e.TIMEOUT_ERROR,g)},focus:function(f,g){f&&(f=$(f));if(!(f&&f.length)){return}f.data(e.TIMEOUT_FOCUS)&&clearTimeout(f.data(e.TIMEOUT_FOCUS));g&&c.statusTimeout.clear();g&&f.data(e.TIMEOUT_FOCUS,g)},success:function(f,g){f&&(f=$(f));if(!(f&&f.length)){return}f.data(e.TIMEOUT_SUCCESS)&&clearTimeout(f.data(e.TIMEOUT_SUCCESS));g&&c.statusTimeout.clear();g&&f.data(e.TIMEOUT_SUCCESS,g)},clear:function(f){for(var g in c.statusTimeout){if(g=="clear"){continue}c.statusTimeout[g](f)}}};c.setValid=function(i,g,f,h){i=$(i);i.each(function(k,j){j=$(this);c.statusTimeout.clear(j);$(c.getInstance()._view).trigger("setValid",[j,g,f,h])});return c.getInstance()};c.setError=function(h,g,f){h=$(h);h.each(function(k,j){j=$(this);c.statusTimeout.clear(j);if(g&&g.trim()&&/^[\s]/.test(g)){var i="autoGenerateErrorMsg";j.attr(i,g);g=i}$(c.getInstance()._view).trigger("setError",[j,g,f])});return c.getInstance()};c.focusmsg=c.setFocusMsg=function(h,g,f){h=$(h);h.each(function(k,j){j=$(this);c.statusTimeout.clear(j);if(typeof g=="string"){f=g;g=false}if(f&&f.trim()&&/^[\s]/.test(f)){var i="autoGenerateFocusMsg";j.attr(i,f);f=i}c.getInstance().trigger(e.FOCUS_MSG,[j,g,f])});return c.getInstance()};c.focusmsgEverytime=true;c.emDisplayType="inline";c.showValidStatus=false;c.clearError=function(){return c.getInstance().clearError.apply(c.getInstance(),JC.f.sliceArgs(arguments))};c.errorAbort=false;c.autoTrim=true;c.itemCallback;c.ignore=function(f,h){f=$(f);if(!(f&&f.length)){return true}var g=false;if(typeof h!="undefined"){h?f.removeAttr("ignoreprocess"):f.attr("ignoreprocess",true);g=!h}else{f.is("[ignoreprocess]")&&((f.attr("ignoreprocess")||"").trim()?(g=JC.f.parseBool(f.attr("ignoreprocess"))):(g=true))}return g};c._formControls="input, select, textarea";c.isFormControl=function(f){var g=false;f&&(f=$(f)).length&&(g=f.is(c._formControls));return g};c.ignoreAutoCheckEvent=false;function e(){this._init()}e.TRIGGER="TriggerEvent";e.BIND="BindEvent";e.ERROR="ValidError";e.CORRECT="ValidCorrect";e.FOCUS_MSG="ValidFocusMsg";e.TIMEOUT_VALID="Valid_ValidTimeout";e.TIMEOUT_ERROR="Valid_ErrorTimeout";e.TIMEOUT_FOCUS="Valid_FocusTimeout";e.TIMEOUT_SUCCESS="Valid_SuccessTimeout";e.SELECTOR_ERROR="~ em.error, ~ em.errormsg";e.CSS_ERROR="error errormsg";e.FILTER_ERROR="em.error em.errormsg";e.prototype={_init:function(){return this},parseDatatype:function(f){var g="";if(typeof f=="string"){g=f}else{g=f.attr("datatype")||"text"}return g.toLowerCase().replace(/\-.*/,"")},parseSubdatatype:function(f){var g="";if(typeof f=="string"){g=f}else{g=f.attr("subdatatype")||""}return g.toLowerCase().replace(/\-.*/,"")},isAvalible:function(f){return(f.is(":visible")||this.isValidHidden(f))&&!f.is("[disabled]")},isForm:function(f){var g;f.prop("nodeName")&&f.prop("nodeName").toLowerCase()=="form"&&(g=true);return g},isErrorAbort:function(f){var g=c.errorAbort;f.is("[errorabort]")&&(g=JC.f.parseBool(f.attr("errorabort")));return g},isValid:function(f){f=$(f);var h,g;f.each(function(){g=$(this);if(g.is("[datatype]")||g.is("[subdatatype]")||g.is("[minlength]")||g.is("[maxlength]")||g.is("[reqmsg]")||g.is("form")){h=true}});return h},isAutoTrim:function(g){g=$(g);var h=c.autoTrim,f=JC.f.getJqParent(g,"form");f&&f.length&&f.is("[validautotrim]")&&(h=JC.f.parseBool(f.attr("validautotrim")));g.is("[validautotrim]")&&(h=JC.f.parseBool(g.attr("validautotrim")));return h},isReqmsg:function(f){return f.is("[reqmsg]")},isValidMsg:function(g){g=$(g);var h=c.showValidStatus,f=JC.f.getJqParent(g,"form");f&&f.length&&f.is("[validmsg]")&&(h=JC.f.parseBool(f.attr("validmsg")));g.is("[validmsg]")&&(h=JC.f.parseBool(g.attr("validmsg")));return h},isValidHidden:function(f){var g=false;f.is("[subdatatype]")&&/hidden/i.test(f.attr("subdatatype"))&&(g=true);return g},validitemcallback:function(g){g=$(g);var i=c.itemCallback,f=JC.f.getJqParent(g,"form"),h;f&&f.length&&f.is("[validitemcallback]")&&(h=f.attr("validitemcallback"))&&(h=window[h])&&(i=h);g.is("[validitemcallback]")&&(h=g.attr("validitemcallback"))&&(h=window[h])&&(i=h);return i},isMinlength:function(f){return f.is("[minlength]")},isMaxlength:function(f){return f.is("[maxlength]")},minlength:function(f){return parseInt(f.attr("minlength"),10)||0},maxlength:function(f){return parseInt(f.attr("maxlength"),10)||0},isMinvalue:function(f){return f.is("[minvalue]")},isMaxvalue:function(f){return f.is("[maxvalue]")},isDatatarget:function(f,g){var i=false,h="datatarget";g&&(g+=h)&&(i=f.is("["+g+"]"));!i&&(i=f.is("["+h+"]"));return i},datatarget:function(f,g){var i,h="datatarget";g&&(g+=h)&&(g=f.attr(g))&&(i=JC.f.parentSelector(f,g));!(i&&i.length)&&(i=JC.f.parentSelector(f,f.attr(h)));return i},minvalue:function(f,h){if(typeof h=="string"){var g=h.toLowerCase().trim();switch(g){default:return JC.f.parseDate(f.attr("minvalue"),f)}}else{if(h){return parseFloat(f.attr("minvalue"))||0}else{return parseInt(f.attr("minvalue"),10)||0}}},maxvalue:function(f,h){if(typeof h=="string"){var g=h.toLowerCase().trim();switch(g){default:return JC.f.parseDate(f.attr("maxvalue"),f)}}else{if(h){return parseFloat(f.attr("maxvalue"))||0}else{return parseInt(f.attr("maxvalue"),10)||0}}},lengthValid:function(j){var g=this,l=true,j=$(j),f=g.parseDatatype(j),k,i,m=$.trim(j.val()),h;if(!m){return l}g.isMinlength(j)&&(k=g.minlength(j));g.isMaxlength(j)&&(i=g.maxlength(j));switch(f){case"bytetext":h=g.bytelen(m);break;case"richtext":default:h=m.length;break}k&&(h<k)&&(l=false);i&&(h>i)&&(l=false);JC.log("lengthValid: ",k,i,l,m.length);!l&&$(g).trigger(e.TRIGGER,[e.ERROR,j]);return l},n:function(m,h){var f=this,q=true,n=m.val().trim(),i=+n,k=0,o=10,p=Math.pow(10,o),g,j,l;f.isMinvalue(m)&&(k=f.minvalue(m,/\./.test(m.attr("minvalue")))||k);if(/^[0]+$/.test(n)&&n.length>1){q=false}if(q&&!isNaN(i)&&i>=k){m.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(s,r){l=r.split(".");g=parseInt(l[0]);j=parseInt(l[1]);g>o&&(p=Math.pow(10,g))});f.isMaxvalue(m)&&(p=f.maxvalue(m,/\./.test(m.attr("maxvalue"))));if(i>=k&&i<=p){typeof g!="undefined"&&typeof j!="undefined"&&(q=new RegExp("^(?:-|)(?:[\\d]{0,"+g+"}|)(?:\\.[\\d]{1,"+j+"}|)$").test(n));typeof g!="undefined"&&typeof j=="undefined"&&(q=new RegExp("^(?:-|)[\\d]{1,"+g+"}$").test(n));typeof g=="undefined"&&typeof j!="undefined"&&(q=new RegExp("^(?:-|)\\.[\\d]{1,"+j+"}$").test(n));typeof j=="undefined"&&/\./.test(n)&&(q=false)}else{q=false}}else{q=false}!q&&!h&&$(f).trigger(e.TRIGGER,[e.ERROR,m]);return q},nrange:function(h){var f=this,m=f.n(h),i,g,l,k,j;if(m){if(h.is("[fromNEl]")){l=f.getElement(h.attr("fromNEl"),h);k=h}if(h.is("[toNEl]")){l=h;k=f.getElement(h.attr("toNEl"),h)}if(!(l&&l.length||k&&k.length)){j=f.sametypeitems(h);if(j.length>=2){l=$(j[0]);k=$(j[1])}}if(l&&l.length||k&&k.length){JC.log("nrange",l.length,k.length);k.val($.trim(k.val()));l.val($.trim(l.val()));if(k[0]!=l[0]&&k.val().length&&l.val().length){m&&(m=f.n(k,true));m&&(m=f.n(l,true));m&&(+l.val())>(+k.val())&&(m=false);JC.log("nrange:",+l.val(),+k.val(),m);m&&$(f).trigger(e.TRIGGER,[e.CORRECT,l]);m&&$(f).trigger(e.TRIGGER,[e.CORRECT,k]);!m&&$(f).trigger(e.TRIGGER,[e.ERROR,l]);!m&&$(f).trigger(e.TRIGGER,[e.ERROR,k]);return m}}}return m},d:function(i,g){var f=this,l=$.trim(i.val()),j=true,h=JC.f.parseDate(l,i),k;if(l&&h){if(f.isMinvalue(i)&&(k=f.minvalue(i,"d"))){h.getTime()<k.getTime()&&(j=false)}if(j&&f.isMaxvalue(i)&&(k=f.maxvalue(i,"d"))){h.getTime()>k.getTime()&&(j=false)}}!j&&!g&&$(f).trigger(e.TRIGGER,[e.ERROR,i]);return j},date:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},daterange:function(h){var f=this,m=f.d(h),i,g,j,l,k;if(m){if(h.is("[fromDateEl]")){j=f.getElement(h.attr("fromDateEl"),h);l=h}if(h.is("[toDateEl]")){j=h;l=f.getElement(h.attr("toDateEl"),h)}if(!(j&&j.length&&l&&l.length)){k=f.sametypeitems(h);if(k.length>=2){j=$(k[0]);l=$(k[1])}}if(j&&j.length||l&&l.length){JC.log("daterange",j.length,l.length);l.val($.trim(l.val()));j.val($.trim(j.val()));if(l[0]!=j[0]&&l.val().length&&j.val().length){m&&(m=f.d(l,true))&&(i=JC.f.parseDate(j.val(),j));m&&(m=f.d(j,true))&&(g=JC.f.parseDate(l.val(),l));m&&i&&g&&i.getTime()>g.getTime()&&(m=false);m&&$(f).trigger(e.TRIGGER,[e.CORRECT,j]);m&&$(f).trigger(e.TRIGGER,[e.CORRECT,l]);!m&&$(f).trigger(e.TRIGGER,[e.ERROR,j]);!m&&$(f).trigger(e.TRIGGER,[e.ERROR,l])}}}return m},time:function(g){var f=this,h=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},minute:function(g){var f=this,h=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},bankcard:function(h){var f=this,i=h.val().trim().replace(/[\s]+/g," ");h.val(i);var g=i.replace(/[^\d]/g,""),j=/^[0-9](?:[\d]{21}|[\d]{20}|[\d]{19}|[\d]{18}|[\d]{17}|[\d]{16}|[\d]{15}|[\d]{14}|[\d]{13}|[\d]{12}|[\d]{11}|)$/.test(g);/^[0]+$/.test(g)&&(j=false);!j&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return j},cnname:function(g,i){var f=this,h=f.bytelen(g.val())<=32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(g.val());!i&&!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},enname:function(g,i){var f=this,h=f.bytelen(g.val())<=32&&/^[a-zA-Z ]{2,32}$/.test(g.val());!i&&!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},allname:function(g){var f=this,h=f.bytelen(g.val())<=32&&(f.cnname(g,true)||f.enname(g,true));!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},username:function(g){var f=this,h=/^[a-zA-Z0-9][\w-]{2,30}$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},idnumber:function(g){var f=this,h=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},mobilecode:function(h,g){var f=this,i=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(h.val());!g&&!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},mobile:function(g,f){return this.mobilecode(g,f)},mobilezonecode:function(h,g){var f=this,i=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(h.val());!g&&!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},phonecode:function(g){var f=this,h=/^[1-9][0-9]{6,7}$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},phone:function(h,g){var f=this,i=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(h.val());!g&&!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},phoneall:function(h,g){var f=this,i=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)(?:\#|\-)[\d]{1,6}|)$/.test(h.val());!g&&!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},phonezone:function(h){var f=this,i=h.val().trim(),j,k=/^[0-9]{3,4}$/,g;g=h.attr("datatype").split("-");g.length>1&&(k=new RegExp("^[0-9]{"+g[1]+"}$"));j=k.test(i);!j&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return j},phoneext:function(g){var f=this,h=/^[0-9]{1,6}$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},mobilephone:function(g){var f=this,h=this.mobilecode(g,true)||this.phone(g,true);!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},mobilephoneall:function(g){var f=this,h=this.mobilezonecode(g,true)||this.phoneall(g,true);!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},reg:function(h){var f=this,i=true,g;if(h.is("[reg-pattern]")){g=h.attr("reg-pattern")}if(!g){g=$.trim(h.attr("datatype")).replace(/^reg(?:\-|)/i,"")}g.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(k,j,l){JC.log(j,l);i=new RegExp(j,l||"").test(h.val())});!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},vcode:function(h){var f=this,i,g=parseInt($.trim(h.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;JC.log("vcodeValid: "+g);i=new RegExp("^[0-9a-zA-Z]{"+g+"}$").test(h.val());!i&&$(f).trigger(e.TRIGGER,[e.ERROR,h]);return i},text:function(f){return true},bytetext:function(f){return true},richtext:function(f){return true},bytelen:function(f){return f.replace(/[^\x00-\xff]/g,"11").length},url:function(g){var f=this,h=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/[\w\/\.\#\+\-\~\%\?\_\=\&]*|)$/i.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},domain:function(g){var f=this,h=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/|)$/i.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},stricdomain:function(g){var f=this,h=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})$/i.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},email:function(g){var f=this,h=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},countrycode:function(g){var f=this,h=g.val().trim(),i=/^(?:\+|)[\d]{1,6}$/.test(h);!i&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return i},zipcode:function(g){var f=this,h=/^[0-9]{6}$/.test(g.val());!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return h},taxcode:function(g){var f=this,i=false,h=g.val().trim();i=/^[\w]{15}$/.test(h)||/^[\w]{18}$/.test(h)||/^[\w]{20}$/.test(h);!i&&$(f).trigger(e.TRIGGER,[e.ERROR,g]);return i},reconfirm:function(k){var f=this,l=true,g,i="ReconfirmValidTime",j="reconfirm";JC.log(j,new Date().getTime());f.isDatatarget(k,j)&&(g=f.datatarget(k,j));!(g&&g.length)&&(g=f.samesubtypeitems(k,j));var h=false;if(g&&g.length){g.each(function(){var m=$(this);if(f.checkRepeatProcess(m,i,true)){h=true}if(k.val()!=$(this).val()){l=false}})}!l&&g.length&&g.each(function(){if(k[0]==this){return}$(f).trigger(e.TRIGGER,[e.ERROR,$(this),"reconfirmmsg",true])});if(l&&g&&g.length){g.each(function(){if(k[0]==this){return}if(h){return false}$(f).trigger(e.TRIGGER,[e.CORRECT,$(this)])})}l?$(f).trigger(e.TRIGGER,[e.CORRECT,k]):$(f).trigger(e.TRIGGER,[e.ERROR,k,"reconfirmmsg",true]);return l},checkRepeatProcess:function(g,h,f,j){var i=new Date().getTime(),k=false;j=j||200;if(g.data(h)){if((i-g.data(h))<j){k=true;g.data(h,i)}}f&&g.data(h,i);return k},alternative:function(m){var g=this,q=true,f,l="AlternativeValidTime",p=g.parseDatatype(m),o="alternative";JC.log(o,new Date().getTime());g.isDatatarget(m,o)&&(f=g.datatarget(m,o));!(f&&f.length)&&(f=g.samesubtypeitems(m,o));var k=false;var i;if(f.length&&!$.trim(m.val())){var h=false;f.each(function(){var r=$(this);if(m[0]==this){return}if(g.checkRepeatProcess(r,l,true)){k=true}if($(this).val()){h=true;return false}});q=h}!q&&f&&f.length&&f.each(function(){if(m[0]==this){return}if(k){return false}$(g).trigger(e.TRIGGER,[e.ERROR,$(this),"alternativemsg",true])});if(q&&f&&f.length){f.each(function(){if(m[0]==this){return}var r=$(this),t=g.parseDatatype(r);if(t&&g[t]&&$(this).val()){g[t]($(this))}else{if(!$(this).val()){$(g).trigger(e.TRIGGER,[e.CORRECT,$(this)]);var s=JC.f.parentSelector($(this),$(this).attr("reqtargetdatatarget"));s&&s.length&&$(g).trigger(e.TRIGGER,[e.CORRECT,s])}}})}if(q&&f&&f.length){var j=false,n=[];f.each(function(){if(m[0]==this){return}var r=$(this),s;if(r.is("[alternativeReqTarget]")){s=JC.f.parentSelector(r,r.attr("alternativeReqTarget"));if(s&&s.length){s.each(function(){var u=$(this),t=u.val().trim();if(!t){n.push(u);j=true}})}}});if(m.is("[alternativeReqTarget]")){i=JC.f.parentSelector(m,m.attr("alternativeReqTarget"));if(i&&i.length){i.each(function(){var s=$(this),r=s.val().trim();if(!r){n.push(s);j=true}})}}if(j&&n.length){q=false;$.each(n,function(r,s){s=$(s);$(g).trigger(e.TRIGGER,[e.ERROR,s,"alternativeReqmsg",true])});return q}}if(q){if(p&&g[p]&&m.val()){g[p](m)}else{if(!m.val()){$(g).trigger(e.TRIGGER,[e.CORRECT,m])}}}else{$(g).trigger(e.TRIGGER,[e.ERROR,m,"alternativemsg",true])}return q},reqtarget:function(h){var f=this,k=true,i=h.val().trim(),j,g=JC.f.parentSelector(h,h.attr("reqtargetdatatarget")||h.attr("datatarget"));if(i&&g&&g.length){j=g.val().trim();!j&&(k=false);!k&&$(f).trigger(e.TRIGGER,[e.ERROR,g,"reqtargetmsg",true]);k&&g.trigger("blur")}else{if(g&&g.length){g.trigger("blur")}}return k},unique:function(n){var h=this,s=true,g,l,f=[],p=h.typeLen(n.attr("subdatatype"))[0],m="UniqueValidTime",o="unique",k=JC.f.parseBool(n.attr("uniqueIgnoreCase")),r,q;h.isDatatarget(n,o)&&(g=h.datatarget(n,o));!(g&&g.length)&&(g=h.samesubtypeitems(n,o));r=[];q=[];var j=false;if(g&&g.length){l={};g.each(function(u){var t=$(this);if(t.is("[processDisabled]")&&(!t.attr("processDisabled")||JC.f.parseBool(t.attr("processDisabled")))){if(!t.is(":visible")){return}}else{if(!h.isAvalible(t)){return}}if(h.checkRepeatProcess(t,m,true)){j=true}if(u%p===0){f.push([])}f[f.length-1]&&f[f.length-1].push(t)});$.each(f,function(u,x){var w=[],y=false;$.each(x,function(B,C){var z,A=JC.f.parseBool(C.attr("uniqueIgnoreEmpty"));z=$(C).val().trim();A&&!z&&C.is(":visible")&&(y=true);w.push(z)});var t=w.join(""),v=w.join("####");if(y){return}if(!t){return}k&&(v=v.toLowerCase());if(v in l){l[v].push(x);s=false}else{l[v]=[x]}});for(var i in l){if(l[i].length>1){s=false;$.each(l[i],function(t,u){r=r.concat(u)})}else{$.each(l[i],function(t,u){q=q.concat(u)})}}}$.each(q,function(u,v){var t=h.parseDatatype(v);if(t&&h[t]&&v.val()){if(h[t](v)){c.setValid(v)}}else{c.setValid(v)}});!s&&r.length&&$.each(r,function(u,v){v=$(v);var t=v.val().trim();if(j){return false}if(!t){return}t&&$(h).trigger(e.TRIGGER,[e.ERROR,v,"uniquemsg",true])});return s},datavalid:function(g){var h=true,f=this;if(!c.isFormValid){return h}if(!g.is("[datavalid]")){return h}JC.log("datavalid",new Date().getTime());h=JC.f.parseBool(g.attr("datavalid"));if(!h){c.statusTimeout.error(g,setTimeout(function(){$(f).trigger(e.TRIGGER,[e.ERROR,g,"datavalidmsg",true])},1))}return h},typeLen:function(g){var f=[1];g&&(g=g.replace(/[^\d\.]/g,""))&&(f=g.split("."))&&(f[0]=parseInt(f[0],10)||1,f[1]=parseInt(f[1],10)||0);return f},findValidEle:function(h){var f=this,g="~ em.validmsg",j=h.find(g),i;if(h.attr("validel")&&(i=f.getElement(h.attr("validel"),h,g)).length){j=i}return j},findFocusEle:function(h){var f=this,g="~ em.focusmsg",j=h.find(g),i;if(h.attr("focusel")&&(i=f.getElement(h.attr("focusel"),h,g)).length){j=i}return j},findErrorEle:function(h){var f=this,g=e.SELECTOR_ERROR,j=h.find(g),i;if(h.attr("emel")&&(i=f.getElement(h.attr("emel"),h,g)).length){j=i}return j},getElement:function(f,g,h){if(/^\^$/.test(f)){h=h||e.SELECTOR_ERROR;f=$(g.parent().find(h))}else{if(/^[\/\|\<\(]/.test(f)){f=JC.f.parentSelector(g,f)}else{if(/\./.test(f)){return $(f)}else{if(/^[\w-]+$/.test(f)){f="#"+f;f=$(f.replace(/[\#]+/g,"#"))}}}}return $(f)},errorMsg:function(h,g,f){var i=h.is("[errmsg]")?" "+h.attr("errmsg"):h.is("[reqmsg]")?h.attr("reqmsg"):"";g&&(i=h.attr(g)||i);f&&i&&(i=" "+i);i=(i||"").trim().toLowerCase()=="undefined"||typeof i==undefined?"":i;if(i&&!/^[\s]/.test(i)){switch(h.prop("type").toLowerCase()){case"file":i="请上传"+i;break;case"select-multiple":case"select-one":case"checkbox":case"radio":case"select":i="请选择"+i;break;case"textarea":case"password":case"text":i="请填写"+i;break}}return $.trim(i)},reqmsg:function(g){var h=true,f=this;if(!f.isReqmsg(g)){return h}if(g.val()&&g.val().constructor==Array){h=!!($.trim(g.val().join("")+""))}else{h=!!$.trim(g.val()||"")}!h&&$(f).trigger(e.TRIGGER,[e.ERROR,g,"reqmsg"]);JC.log("regmsgValid: "+h);return h},sametypeitems:function(h){var f=this,j=[],i=h.parent(),g=h.attr("datatype"),k=new RegExp(g,"i");if(/select/i.test(h.prop("nodeName"))){i.find("[datatype]").each(function(){k.test($(this).attr("datatype"))&&j.push($(this))})}else{i.find("input[datatype]").each(function(){k.test($(this).attr("datatype"))&&j.push($(this))})}return j.length?$(j):j},samesubtypeitems:function(j,i){var g=this,l=[],k=j.parent(),i=i||j.attr("subdatatype"),m=new RegExp(i,"i"),f=j.prop("nodeName").toLowerCase(),h="input";if(/select/.test(f)){h="select"}else{if(/textarea/.test(f)){h="textarea"}}k.find(h+"[subdatatype]").each(function(){m.test($(this).attr("subdatatype"))&&l.push($(this))});return l.length?$(l):l},focusmsgeverytime:function(f){var g=c.focusmsgEverytime;f.is("[focusmsgeverytime]")&&(g=JC.f.parseBool(f.attr("focusmsgeverytime")));return g},validemdisplaytype:function(g){g&&(g=$(g));var i=c.emDisplayType,f=JC.f.getJqParent(g,"form"),h;f&&f.length&&f.is("[validemdisplaytype]")&&(h=f.attr("validemdisplaytype"))&&(i=h);g.is("[validemdisplaytype]")&&(h=g.attr("validemdisplaytype"))&&(i=h);return i},checkedType:function(m,j){m&&(m=$(m));j=j||"checkbox";var g=this,p=true,o,l,h=1,n=0,k=m,i=m.parent().prop("nodeName").toLowerCase()=="label",f=j+"finder";JC.log(m.attr("name")+", "+m.val());if(m.is("[datatarget]")){o=JC.f.parentSelector(m,m.attr("datatarget"));l=[];o.each(function(){var q=$(this);q.is(":visible")&&!q.prop("disabled")&&l.push(q)});o=$(l)}else{if(i){if(!k.is("["+f+"]")){k=m.parent().parent()}else{k=JC.f.parentSelector(m,m.attr(f))}l=JC.f.parentSelector(k,"|input[datatype]")}else{l=JC.f.parentSelector(k,"/input[datatype]")}o=[];l.each(function(){var q=$(this);var r=new RegExp(j,"i");r.test(q.attr("datatype"))&&q.is(":visible")&&!q.prop("disabled")&&o.push(q)});o=$(o)}if(i){o.each(function(){var q=$(this);if(!q.is("[emel]")){q.attr("emel","//em.error")}if(!q.is("[validel]")){q.attr("validel","//em.validmsg")}if(!q.is("[focusel]")){q.attr("focusel","//em.focusmsg")}})}o.length&&$(m=o[o.length-1]).data("Last"+j,true);if(o.length){m.is("[datatype]")&&m.attr("datatype").replace(/[^\-]+?\-([\d]+)/,function(r,q){h=parseInt(q,10)||h});if(o.length>=h){o.each(function(){$(this).prop("checked")&&n++});if(n<h){p=false}}!p&&$(g).trigger(e.TRIGGER,[e.ERROR,m])}return p},checkbox:function(f){return this.checkedType(f,"checkbox")},radio:function(f){return this.checkedType(f,"radio")},file:function(h){var g=this,k=true,j=h.val().trim().toLowerCase(),f=g.dataFileExt(h),l,i;if(f.length){k=false;$.each(f,function(n,m){m+="$";l=new RegExp(m,"i");if(l.test(j)){k=true;return false}})}!k&&$(g).trigger(e.TRIGGER,[e.ERROR,h]);return k},dataFileExt:function(f){var h=[],g;f.is("[fileext]")&&(g=f.attr("fileext").replace(/[\s]+/g,""))&&(g=g.replace(/\./g,"\\."))&&(h=g.toLowerCase().split(","));return h},ignoreAutoCheckEvent:function(g){var h=c.ignoreAutoCheckEvent,f;g&&(g=$(g));if(g&&g.length){f=JC.f.getJqParent(g,"form");f&&f.length&&f.is("[ignoreAutoCheckEvent]")&&(h=JC.f.parseBool(f.attr("ignoreAutoCheckEvent")));g.is("[ignoreAutoCheckEvent]")&&(h=JC.f.parseBool(g.attr("ignoreAutoCheckEvent")))}return h}};function d(f){this._model=f}d.prototype={init:function(){var f=this;$(f).on("setValid",function(i,j,l,h,g){var k;j.removeClass(e.CSS_ERROR);j.find(JC.f.printf('~ em:not("em.focusmsg, em.validmsg, {0}")',e.FILTER_ERROR)).css("display",f._model.validemdisplaytype(j));j.find(e.SELECTOR_ERROR).hide();j.attr("emel")&&(k=f._model.getElement(j.attr("emel"),j))&&k.hide();typeof h=="undefined"&&typeof j.val()!="object"&&!j.val().trim()&&(h=1);f.validMsg(j,h,g)});$(f).on("setError",function(g,m,h,n){var j=f._model.errorMsg.apply(f._model,[m,h,n]),l,o,i,k;m.addClass(e.CSS_ERROR);m.find(JC.f.printf("~ em:not({0})",e.FILTER_ERROR)).hide();if(m.is("[validel]")){(o=f._model.getElement(m.attr("validel"),m))&&o.hide()}if(m.is("[focusel]")){(i=f._model.getElement(m.attr("focusel"),m))&&i.hide()}if(m.is("[emEl]")){(l=f._model.getElement(m.attr("emEl"),m))&&l.addClass(e.CSS_ERROR)}!(l&&l.length)&&(l=m.find(e.SELECTOR_ERROR));if(!l.length){(l=$(JC.f.printf('<em class="{0}"></em>',e.CSS_ERROR))).insertAfter(m)}!j.trim()&&(j="&nbsp;");l.html(j).css("display",f._model.validemdisplaytype(m));JC.log("error:",j)});return this},valid:function(i,k,h){i&&(i=$(i));var f=this,j;i.data("JCValidStatus",true);var g=!JC.f.parseBool(i.attr("validnoerror"));c.statusTimeout.valid(i,setTimeout(function(){$(f).trigger("setValid",[i,k,h,g]);(j=f._model.validitemcallback(i))&&j(i,true)},k||150))},validMsg:function(l,k,j){var f=this,i=(l.attr("validmsg")||"").trim().toLowerCase(),h;if(f._model.isValidMsg(l)){if(i=="true"||i=="1"){i=""}!i.trim()&&(i="&nbsp;");var g=f._model.findFocusEle(l),m=f._model.findValidEle(l),n=f._model.findErrorEle(l);!m.length&&(m=$('<em class="validmsg"></em>'),l.after(m));m.html(i);k?m.hide():(m.css("display",f._model.validemdisplaytype(l)),g&&g.hide(),n&&n.hide())}else{if(j){(h=f._model.findFocusEle(l))&&h.hide()}}},error:function(j,i,h){j&&(j=$(j));var g=this,f=arguments,k;if(j.is("[validnoerror]")){return true}j.data("JCValidStatus",false);c.statusTimeout.error(j,setTimeout(function(){$(g).trigger("setError",[j,i,h]);(k=g._model.validitemcallback(j))&&k(j,false)},150));return false},focusmsg:function(k,h,i){if(k&&(k=$(k)).length&&(k.is("[focusmsg]")||(i&&k.is("["+i+"]")))){JC.log("focusmsg",new Date().getTime());var n,f=this,g=f._model.findFocusEle(k),l=f._model.findValidEle(k),m=f._model.findErrorEle(k),j=k.attr("focusmsg");i&&(j=k.attr(i||j));if(h&&g&&g.length){g.hide();return}m.length&&m.is(":visible")&&m.hide();if(l.length&&l.is(":visible")){return}!g.length&&(g=$('<em class="focusmsg"></em>'),k.after(g));if(k.is("[validnoerror]")){n=c.check(k)}else{k.attr("validnoerror",true);n=c.check(k);k.removeAttr("validnoerror")}!j.trim()&&(j="&nbsp;");if(f._model.focusmsgeverytime(k)){g.html(j).css("display",f._model.validemdisplaytype(k))}else{n&&g.html(j).css("display",f._model.validemdisplaytype(k))}}}};$(document).delegate("input[type=text], input[type=password], textarea","blur",function(g){var f=$(this),h=c.getInstance();if(h._model.ignoreAutoCheckEvent(f)){return}h.trigger(e.FOCUS_MSG,[f,true]);c.checkTimeout(f)});$(document).delegate("input","blur",function(g){var f=$(this),h=c.getInstance();if(f.attr("type")){return}if(h._model.ignoreAutoCheckEvent(f)){return}h.trigger(e.FOCUS_MSG,[f,true]);c.checkTimeout(f)});$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","change",function(h,g){if(g){return}var f=$(this),i=c.getInstance();if(i._model.ignoreAutoCheckEvent(f)){return}c.checkTimeout(f)});$(document).delegate("input[type=text], input[type=password], textarea, select, input[type=file], input[type=checkbox], input[type=radio]","focus",function(g){var f=$(this),h=c.getInstance(),i=f.val().trim();if(h._model.ignoreAutoCheckEvent(f)){return}h.trigger(e.FOCUS_MSG,[f]);!i&&c.setValid(f)});$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","blur",function(g){var f=$(this),h=c.getInstance();if(h._model.ignoreAutoCheckEvent(f)){return}h.trigger(e.FOCUS_MSG,[f,true])});$(document).delegate("input[type=hidden][subdatatype]","change",function(g){var f=$(this),h=c.getInstance(),j=false,i;if(h._model.ignoreAutoCheckEvent(f)){return}f.is("[subdatatype]")&&(j=/hidden/i.test(f.attr("subdatatype")));if(f.data("HID_CHANGE_CHECK")){i=new Date().getTime()-f.data("HID_CHANGE_CHECK");if(i<50){return}}if(!f.val()){return}f.data("HID_CHANGE_CHECK",new Date().getTime());JC.log("hidden val",new Date().getTime(),f.val());c.checkTimeout($(this))});$(document).delegate("input[type=text][subdatatype]","keyup",function(h){var g=$(this);var f=/datavalid/i.test(g.attr("subdatatype"));if(!f){return}if(g.prop("disabled")||g.prop("readonly")){return}c.dataValid(g,false,true);var i;g.attr("datavalidKeyupCallback")&&(i=window[g.attr("datavalidKeyupCallback")])&&i.call(g,h);if(g.data("DataValidInited")){return}g.data("DataValidInited",true);g.data("DataValidCache",{});g.on("DataValidUpdate",function(k,m){var l,j;if(!g.data("DataValidCache")){return}j=g.data("DataValidCache")[m];if(!j){return}m==="suchestest"&&(j.data.errorno=0);c.dataValid(g,!j.data.errorno,false,j.data.errmsg);g.attr("datavalidCallback")&&(l=window[g.attr("datavalidCallback")])&&l.call(g,j.data,j.text)});g.on("blur",function(k,j){JC.log("datavalid",new Date().getTime());if(j){return}var n=g.val().trim(),m,o,l=g.attr("datavalidurl");if(!n){return}if(!l){return}g.data("DataValidTm")&&clearTimeout(g.data("DataValidTm"));g.data("DataValidTm",setTimeout(function(){n=g.val().trim();if(!n){return}n=JC.f.encoder(g)(n);if(!g.data("JCValidStatus")){return}l=JC.f.printf(l,n);g.attr("datavalidUrlFilter")&&(m=window[g.attr("datavalidUrlFilter")])&&(l=m.call(g,l));if(n in g.data("DataValidCache")){g.trigger("DataValidUpdate",n);return}$.get(l).done(function(p){o=p;try{p=$.parseJSON(p)}catch(q){p={errorno:1}}g.data("DataValidCache")[n]={key:n,data:p,text:o};g.trigger("DataValidUpdate",n)})},151))})});return JC.Valid})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));