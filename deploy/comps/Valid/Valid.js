(function(define,_win){define(["JC.common"],function(){window.JC=window.JC||{log:function(){}};JC.Valid=window.Valid=Valid;function Valid(){var _args=JC.f.sliceArgs(arguments);if(_args.length){return Valid.check.apply(null,_args)}if(Valid._instance){return Valid._instance}Valid._instance=this;this._model=new Model();this._view=new View(this._model);this._init()}Valid.prototype={_init:function(){var _p=this;$([this._view,this._model]).on(Model.BIND,function(_evt,_evtName,_cb){_p.on(_evtName,_cb)});$([this._view,this._model]).on(Model.TRIGGER,function(_evt,_evtName){var _data=JC.f.sliceArgs(arguments).slice(2);_p.trigger(_evtName,_data)});_p.on(Model.CORRECT,function(_evt){var _data=JC.f.sliceArgs(arguments).slice(1);_p._view.valid.apply(_p._view,_data)});_p.on(Model.ERROR,function(_evt){var _data=JC.f.sliceArgs(arguments).slice(1);_p._view.error.apply(_p._view,_data)});_p.on(Model.FOCUS_MSG,function(_evt){var _data=JC.f.sliceArgs(arguments).slice(1);_p._view.focusmsg.apply(_p._view,_data)});this._view.init();return this},on:function(_evtName,_cb){$(this).on(_evtName,_cb);return this},trigger:function(_evtName,_data){$(this).trigger(_evtName,_data);return this},parse:function(_item){var _p=this,_r=true,_item=$(_item);if(!_p._model.isAvalible(_item)){return _r}if(!_p._model.isValid(_item)){return _r}if(Valid.ignore(_item)){return _r}var _dt=_p._model.parseDatatype(_item),_nm=_item.prop("nodeName").toLowerCase();switch(_nm){case"input":case"textarea":(_item.attr("type")||"").toLowerCase()!="file"&&_p._model.isAutoTrim(_item)&&_item.val($.trim(_item.val()));break}if(!_p._model.reqmsg(_item)){_item.attr("datatypestatus","false");return _r=false}if(!_p._model.lengthValid(_item)){_item.attr("datatypestatus","false");return _r=false}if(_dt&&_p._model[_dt]&&_item.val()){if(!_p._model[_dt](_item)){_item.attr("datatypestatus","false");return _r=false}}_item.attr("datatypestatus","true");var _subDtLs=_item.attr("subdatatype");if(_subDtLs){_subDtLs=_subDtLs.replace(/[\s]+/g,"").split(/[,\|]/);$.each(_subDtLs,function(_ix,_sdt){_sdt=_p._model.parseSubdatatype(_sdt);if(_sdt&&_p._model[_sdt]&&(_item.val()||_sdt=="alternative")){if(!_p._model[_sdt](_item)){_r=false;return false}}})}_r&&_p.trigger(Model.CORRECT,_item);return _r},check:function(){var _p=this,_r=true,_items=JC.f.sliceArgs(arguments),i,j;$.each(_items,function(_ix,_item){_item=$(_item);Valid.isFormValid=false;if(_p._model.isForm(_item)){Valid.isFormValid=true;var _errorabort=_p._model.isErrorAbort(_item),_isIgnoreForm=Valid.ignore(_item),tmp;for(i=0,j=_item[0].length;i<j;i++){var _sitem=$(_item[0][i]);if(_isIgnoreForm&&!(_sitem.val()||"").trim()){continue}!_p.parse(_sitem)&&(_r=false);if(_errorabort&&!_r){break}}}else{if(Valid.isFormControl(_item)){!_p.parse(_item)&&(_r=false)}else{!_p.check(_item.find(Valid._formControls))&&(_r=false)}}});return _r},clearError:function(){var _items=JC.f.sliceArgs(arguments),_p=this;$.each(_items,function(_ix,_item){$(_item).each(function(){var _item=$(this);switch(_item.prop("nodeName").toLowerCase()){case"form":for(var i=0,j=_item[0].length;i<j;i++){Valid.setValid($(_item[0][i]),1,true)}break;default:Valid.setValid(_item,1,true);break}})});return this},isValid:function(_selector){return this._model.isValid(_selector)}};Valid.checkAll=Valid.check=function(){return Valid.getInstance().check.apply(Valid.getInstance(),JC.f.sliceArgs(arguments))};Valid.getInstance=function(){!Valid._instance&&new Valid();return Valid._instance};Valid.checkTimeout=function(_selector,_tm){_selector&&(_selector=$(_selector));if(!(_selector&&_selector.length)){return}_tm=parseInt(_selector.attr("validCheckTimeout"))||_tm;var _dname="VALID_CHECK_TIMEOUT";if(_tm){_selector.data(_dname)&&clearTimeout(_selector.data(_dname));_selector.data(_dname,setTimeout(function(){Valid.check(_selector)},_tm))}else{Valid.check(_selector)}};Valid.dataValid=function(_selector,_settter,_noStatus,_customMsg){var _r=false,_msg="datavalidmsg";_selector&&(_selector=$(_selector));if(typeof _settter!="undefined"){_r=_settter;_selector.attr("datavalid",_settter);if(!_noStatus){if(_settter){_selector.trigger("blur",[true])}else{_customMsg&&(_msg=" "+_customMsg);Valid.setError(_selector,_msg,true)}}}else{if(_selector&&_selector.length){_r=JC.f.parseBool(_selector.attr("datavalid"))}}return _r};Valid.isValid=function(_selector){return Valid.getInstance().isValid(_selector)};Valid.statusTimeout={valid:function(_selector,_tm){_selector&&(_selector=$(_selector));if(!(_selector&&_selector.length)){return}_selector.data(Model.TIMEOUT_VALID)&&clearTimeout(_selector.data(Model.TIMEOUT_VALID));_tm&&Valid.statusTimeout.clear();_tm&&_selector.data(Model.TIMEOUT_VALID,_tm)},error:function(_selector,_tm){_selector&&(_selector=$(_selector));if(!(_selector&&_selector.length)){return}_selector.data(Model.TIMEOUT_ERROR)&&clearTimeout(_selector.data(Model.TIMEOUT_ERROR));_tm&&Valid.statusTimeout.clear();_tm&&_selector.data(Model.TIMEOUT_ERROR,_tm)},focus:function(_selector,_tm){_selector&&(_selector=$(_selector));if(!(_selector&&_selector.length)){return}_selector.data(Model.TIMEOUT_FOCUS)&&clearTimeout(_selector.data(Model.TIMEOUT_FOCUS));_tm&&Valid.statusTimeout.clear();_tm&&_selector.data(Model.TIMEOUT_FOCUS,_tm)},success:function(_selector,_tm){_selector&&(_selector=$(_selector));if(!(_selector&&_selector.length)){return}_selector.data(Model.TIMEOUT_SUCCESS)&&clearTimeout(_selector.data(Model.TIMEOUT_SUCCESS));_tm&&Valid.statusTimeout.clear();_tm&&_selector.data(Model.TIMEOUT_SUCCESS,_tm)},clear:function(_selector){for(var k in Valid.statusTimeout){if(k=="clear"){continue}Valid.statusTimeout[k](_selector)}}};Valid.setValid=function(_items,_tm,_noStyle,_isUserSet){_items=$(_items);_items.each(function(_ix,_item){_item=$(this);Valid.statusTimeout.clear(_item);$(Valid.getInstance()._view).trigger("setValid",[_item,_tm,_noStyle,_isUserSet])});return Valid.getInstance()};Valid.setError=function(_items,_msgAttr,_fullMsg){_items=$(_items);_items.each(function(_ix,_item){_item=$(this);Valid.statusTimeout.clear(_item);if(_msgAttr&&_msgAttr.trim()&&/^[\s]/.test(_msgAttr)){var _autoKey="autoGenerateErrorMsg";_item.attr(_autoKey,_msgAttr);_msgAttr=_autoKey}$(Valid.getInstance()._view).trigger("setError",[_item,_msgAttr,_fullMsg])});return Valid.getInstance()};Valid.focusmsg=Valid.setFocusMsg=function(_items,_setHide,_msgAttr){_items=$(_items);_items.each(function(_ix,_item){_item=$(this);Valid.statusTimeout.clear(_item);if(typeof _setHide=="string"){_msgAttr=_setHide;_setHide=false}if(_msgAttr&&_msgAttr.trim()&&/^[\s]/.test(_msgAttr)){var _autoKey="autoGenerateFocusMsg";_item.attr(_autoKey,_msgAttr);_msgAttr=_autoKey}Valid.getInstance().trigger(Model.FOCUS_MSG,[_item,_setHide,_msgAttr])});return Valid.getInstance()};Valid.focusmsgEverytime=true;Valid.emDisplayType="inline";Valid.showValidStatus=false;Valid.clearError=function(){return Valid.getInstance().clearError.apply(Valid.getInstance(),JC.f.sliceArgs(arguments))};Valid.errorAbort=false;Valid.autoTrim=true;Valid.itemCallback;Valid.ignore=function(_item,_delIgnore){_item=$(_item);if(!(_item&&_item.length)){return true}var _r=false;if(typeof _delIgnore!="undefined"){_delIgnore?_item.removeAttr("ignoreprocess"):_item.attr("ignoreprocess",true);_r=!_delIgnore}else{_item.is("[ignoreprocess]")&&((_item.attr("ignoreprocess")||"").trim()?(_r=JC.f.parseBool(_item.attr("ignoreprocess"))):(_r=true))}return _r};Valid._formControls="input, select, textarea";Valid.isFormControl=function(_selector){var _r=false;_selector&&(_selector=$(_selector)).length&&(_r=_selector.is(Valid._formControls));return _r};Valid.ignoreAutoCheckEvent=false;function Model(){this._init()}Model.TRIGGER="TriggerEvent";Model.BIND="BindEvent";Model.ERROR="ValidError";Model.CORRECT="ValidCorrect";Model.FOCUS_MSG="ValidFocusMsg";Model.TIMEOUT_VALID="Valid_ValidTimeout";Model.TIMEOUT_ERROR="Valid_ErrorTimeout";Model.TIMEOUT_FOCUS="Valid_FocusTimeout";Model.TIMEOUT_SUCCESS="Valid_SuccessTimeout";Model.SELECTOR_ERROR="~ em.error, ~ em.errormsg";Model.CSS_ERROR="error errormsg";Model.FILTER_ERROR="em.error em.errormsg";Model.prototype={_init:function(){return this},parseDatatype:function(_item){var _r="";if(typeof _item=="string"){_r=_item}else{_r=_item.attr("datatype")||"text"}return _r.toLowerCase().replace(/\-.*/,"")},parseSubdatatype:function(_item){var _r="";if(typeof _item=="string"){_r=_item}else{_r=_item.attr("subdatatype")||""}return _r.toLowerCase().replace(/\-.*/,"")},isForm:function(_item){var _r;_item.prop("nodeName")&&_item.prop("nodeName").toLowerCase()=="form"&&(_r=true);return _r},isErrorAbort:function(_item){var _r=Valid.errorAbort;_item.is("[errorabort]")&&(_r=JC.f.parseBool(_item.attr("errorabort")));return _r},isValid:function(_item){_item=$(_item);var _r,_tmp;_item.each(function(){_tmp=$(this);if(_tmp.is("[datatype]")||_tmp.is("[subdatatype]")||_tmp.is("[minlength]")||_tmp.is("[maxlength]")||_tmp.is("[reqmsg]")||_tmp.is("form")){_r=true}});return _r},isAutoTrim:function(_item){_item=$(_item);var _r=Valid.autoTrim;_item.is("[validautotrim]")&&(_r=JC.f.parseBool(_item.attr("validautotrim")));return _r},isReqmsg:function(_item){return _item.is("[reqmsg]")},isValidMsg:function(_item){_item=$(_item);var _r=Valid.showValidStatus,_form=JC.f.getJqParent(_item,"form");_form&&_form.length&&_form.is("[validmsg]")&&(_r=JC.f.parseBool(_form.attr("validmsg")));_item.is("[validmsg]")&&(_r=JC.f.parseBool(_item.attr("validmsg")));return _r},isAvalible:function(_item){return(_item.is(":visible")||this.isValidHidden(_item))&&!_item.is("[disabled]")},isValidHidden:function(_item){var _r=false;_item.is("[subdatatype]")&&/hidden/i.test(_item.attr("subdatatype"))&&_item.parent().is(":visible")&&(_r=true);_item.is("[validHidden]")&&(_r=JC.f.parseBool(_item.attr("validHidden")||"false"));return _r},validitemcallback:function(_item){_item=$(_item);var _r=Valid.itemCallback,_form=JC.f.getJqParent(_item,"form"),_tmp;_form&&_form.length&&_form.is("[validitemcallback]")&&(_tmp=_form.attr("validitemcallback"))&&(_tmp=window[_tmp])&&(_r=_tmp);_item.is("[validitemcallback]")&&(_tmp=_item.attr("validitemcallback"))&&(_tmp=window[_tmp])&&(_r=_tmp);return _r},isMinlength:function(_item){return _item.is("[minlength]")},isMaxlength:function(_item){return _item.is("[maxlength]")},minlength:function(_item){return parseInt(_item.attr("minlength"),10)||0},maxlength:function(_item){return parseInt(_item.attr("maxlength"),10)||0},isMinvalue:function(_item){return _item.is("[minvalue]")},isMaxvalue:function(_item){return _item.is("[maxvalue]")},isDatatarget:function(_item,_key){var _r=false,_defKey="datatarget";_key&&(_key+=_defKey)&&(_r=_item.is("["+_key+"]"));!_r&&(_r=_item.is("["+_defKey+"]"));return _r},datatarget:function(_item,_key){var _r,_defKey="datatarget";_key&&(_key+=_defKey)&&(_key=_item.attr(_key))&&(_r=JC.f.parentSelector(_item,_key));!(_r&&_r.length)&&(_r=JC.f.parentSelector(_item,_item.attr(_defKey)));return _r},minvalue:function(_item,_isFloat){if(typeof _isFloat=="string"){var _datatype=_isFloat.toLowerCase().trim();switch(_datatype){default:return JC.f.parseDate(_item.attr("minvalue"),_item,true)}}else{if(_isFloat){return parseFloat(_item.attr("minvalue"))||0}else{return parseInt(_item.attr("minvalue"),10)||0}}},maxvalue:function(_item,_isFloat){if(typeof _isFloat=="string"){var _datatype=_isFloat.toLowerCase().trim(),_r;switch(_datatype){default:return JC.f.parseDate(_item.attr("maxvalue"),_item,true)}}else{if(_isFloat){return parseFloat(_item.attr("maxvalue"))||0}else{return parseInt(_item.attr("maxvalue"),10)||0}}},lengthValid:function(_item){var _p=this,_r=true,_item=$(_item),_dt=_p.parseDatatype(_item),_min,_max,_val=$.trim(_item.val()),_len;if(!_val){return _r}_p.isMinlength(_item)&&(_min=_p.minlength(_item));_p.isMaxlength(_item)&&(_max=_p.maxlength(_item));switch(_dt){case"bytetext":_len=_p.bytelen(_val);break;case"richtext":default:_len=_val.length;break}_min&&(_len<_min)&&(_r=false);_max&&(_len>_max)&&(_r=false);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},n:function(_item,_noError){var _p=this,_r=true,_valStr=_item.val().trim(),_val=+_valStr,_min=0,_pow=10,_max=Math.pow(10,_pow),_n,_f,_tmp;_p.isMinvalue(_item)&&(_min=_p.minvalue(_item,/\./.test(_item.attr("minvalue")))||_min);if(/^[0]+$/.test(_valStr)&&_valStr.length>1){_r=false}if(_r&&!isNaN(_val)&&_val>=_min){_item.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function($0,$1){_tmp=$1.split(".");_n=parseInt(_tmp[0]);_f=parseInt(_tmp[1]);_n>_pow&&(_max=Math.pow(10,_n))});_p.isMaxvalue(_item)&&(_max=_p.maxvalue(_item,/\./.test(_item.attr("maxvalue"))));if(_val>=_min&&_val<=_max){typeof _n!="undefined"&&typeof _f!="undefined"&&(_r=new RegExp("^(?:-|)(?:[\\d]{0,"+_n+"}|)(?:\\.[\\d]{1,"+_f+"}|)$").test(_valStr));typeof _n!="undefined"&&typeof _f=="undefined"&&(_r=new RegExp("^(?:-|)[\\d]{1,"+_n+"}$").test(_valStr));typeof _n=="undefined"&&typeof _f!="undefined"&&(_r=new RegExp("^(?:-|)\\.[\\d]{1,"+_f+"}$").test(_valStr));typeof _f=="undefined"&&/\./.test(_valStr)&&(_r=false)}else{_r=false}}else{_r=false}!_r&&!_noError&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},nrange:function(_item){var _p=this,_r=_p.n(_item),_min,_max,_fromNEl,_toNEl,_items,_tmp;if(_r){if(_item.is("[fromNEl]")){_fromNEl=_p.getElement(_item.attr("fromNEl"),_item);_toNEl=_item}if(_item.is("[toNEl]")){_fromNEl=_item;_toNEl=_p.getElement(_item.attr("toNEl"),_item)}if(!(_fromNEl&&_fromNEl.length||_toNEl&&_toNEl.length)){_items=_p.sametypeitems(_item);if(_items.length>=2){_fromNEl=$(_items[0]);_toNEl=$(_items[1])}}if(_fromNEl&&_fromNEl.length||_toNEl&&_toNEl.length){_toNEl.val($.trim(_toNEl.val()));_fromNEl.val($.trim(_fromNEl.val()));if(_toNEl[0]!=_fromNEl[0]&&_toNEl.val().length&&_fromNEl.val().length){_r&&(_r=_p.n(_toNEl,true));_r&&(_r=_p.n(_fromNEl,true));_r&&(+_fromNEl.val())>(+_toNEl.val())&&(_r=false);_r&&(_tmp=_fromNEl.attr("rangeCanEqual")||_toNEl.attr("rangeCanEqual"))&&!JC.f.parseBool(_tmp)&&(JC.f.parseFinance(_fromNEl.val(),10)===JC.f.parseFinance(_toNEl.val(),10))&&(_r=false);_r&&$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_fromNEl]);_r&&$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_toNEl]);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_fromNEl]);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_toNEl]);return _r}}}return _r},d:function(_item,_noError){var _p=this,_val=$.trim(_item.val()),_r=true,_date=JC.f.parseDate(_val,_item),_tmpDate;if(_val&&_date){if(_p.isMinvalue(_item)&&(_tmpDate=_p.minvalue(_item,"d"))){_date.getTime()<_tmpDate.getTime()&&(_r=false)}if(_r&&_p.isMaxvalue(_item)&&(_tmpDate=_p.maxvalue(_item,"d"))){_date.getTime()>_tmpDate.getTime()&&(_r=false)}}else{if(_val){_r=false}}!_r&&!_noError&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},date:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},ddate:function(){return this.d.apply(this,JC.f.sliceArgs(arguments))},daterange:function(_item){var _p=this,_r=_p.d(_item),_min,_max,_fromDateEl,_toDateEl,_items,_tmp;if(_r){if(_item.is("[fromDateEl]")){_fromDateEl=_p.getElement(_item.attr("fromDateEl"),_item);_toDateEl=_item}if(_item.is("[toDateEl]")){_fromDateEl=_item;_toDateEl=_p.getElement(_item.attr("toDateEl"),_item)}if(!(_fromDateEl&&_fromDateEl.length&&_toDateEl&&_toDateEl.length)){_items=_p.sametypeitems(_item);if(_items.length>=2){_fromDateEl=$(_items[0]);_toDateEl=$(_items[1])}}if(_fromDateEl&&_fromDateEl.length||_toDateEl&&_toDateEl.length){_toDateEl.val($.trim(_toDateEl.val()));_fromDateEl.val($.trim(_fromDateEl.val()));if(_toDateEl[0]!=_fromDateEl[0]&&_toDateEl.val().length&&_fromDateEl.val().length){_r&&(_r=_p.d(_toDateEl,true))&&(_min=JC.f.parseDate(_fromDateEl.val(),_fromDateEl));_r&&(_r=_p.d(_fromDateEl,true))&&(_max=JC.f.parseDate(_toDateEl.val(),_toDateEl));_r&&_min&&_max&&_min.getTime()>_max.getTime()&&(_r=false);_r&&(_tmp=_fromDateEl.attr("rangeCanEqual")||_toDateEl.attr("rangeCanEqual"))&&!JC.f.parseBool(_tmp)&&_min&&_max&&_min.getTime()==_max.getTime()&&(_r=false);_r&&$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_fromDateEl]);_r&&$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_toDateEl]);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_fromDateEl]);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_toDateEl])}}}return _r},drange:function(){return this.daterange.apply(this,JC.f.sliceArgs(arguments))},time:function(_item){var _p=this,_r=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},minute:function(_item){var _p=this,_r=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},bankcard:function(_item){var _p=this,_v=_item.val().trim().replace(/[\s]+/g," ");_item.val(_v);var _dig=_v.replace(/[^\d]/g,""),_r=/^[0-9](?:[\d]{24}|[\d]{23}|[\d]{22}|[\d]{21}|[\d]{20}|[\d]{19}|[\d]{18}|[\d]{17}|[\d]{16}|[\d]{15}|[\d]{14}|[\d]{13}|[\d]{12}|[\d]{11}|[\d]{10}|[\d]{9}|[\d]{8}|)$/.test(_dig);/^[0]+$/.test(_dig)&&(_r=false);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},cnname:function(_item,_noStatus){var _p=this,_r=_p.bytelen(_item.val())<=32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(_item.val());!_noStatus&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},enname:function(_item,_noStatus){var _p=this,_r=_p.bytelen(_item.val())<=32&&/^[a-zA-Z ]{2,32}$/.test(_item.val());!_noStatus&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},allname:function(_item){var _p=this,_r=_p.bytelen(_item.val())<=32&&(_p.cnname(_item,true)||_p.enname(_item,true));!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},username:function(_item){var _p=this,_r=/^[a-zA-Z0-9][\w-]{2,30}$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},idnumber:function(_item){var _p=this,_r=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},mobilecode:function(_item,_noError){var _p=this,_r=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(_item.val());!_noError&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},mobile:function(_item,_noError){return this.mobilecode(_item,_noError)},mobilezonecode:function(_item,_noError){var _p=this,_r=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(_item.val());!_noError&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},phonecode:function(_item){var _p=this,_r=/^[1-9][0-9]{6,7}$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},phone:function(_item,_noError){var _p=this,_r=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(_item.val());!_noError&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},phoneall:function(_item,_noError){var _p=this,_r=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)(?:\#|\-)[\d]{1,6}|)$/.test(_item.val());!_noError&&!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},phonezone:function(_item){var _p=this,_v=_item.val().trim(),_r,_re=/^[0-9]{3,4}$/,_pattern;_pattern=_item.attr("datatype").split("-");_pattern.length>1&&(_re=new RegExp("^[0-9]{"+_pattern[1]+"}$"));_r=_re.test(_v);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},phoneext:function(_item){var _p=this,_r=/^[0-9]{1,6}$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},mobilephone:function(_item){var _p=this,_r=this.mobilecode(_item,true)||this.phone(_item,true);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},mobilephoneall:function(_item){var _p=this,_r=this.mobilezonecode(_item,true)||this.phoneall(_item,true);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},reg:function(_item){var _p=this,_r=true,_pattern;if(_item.is("[reg-pattern]")){_pattern=_item.attr("reg-pattern")}if(!_pattern){_pattern=$.trim(_item.attr("datatype")).replace(/^reg(?:\-|)/i,"")}_pattern.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function($0,$1,$2){_r=new RegExp($1,$2||"").test(_item.val())});!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},vcode:function(_item){var _p=this,_r,_len=parseInt($.trim(_item.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;_r=new RegExp("^[0-9a-zA-Z]{"+_len+"}$").test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},text:function(_item){return true},bytetext:function(_item){return true},richtext:function(_item){return true},bytelen:function(_s){return _s.replace(/[^\x00-\xff]/g,"11").length},url:function(_item){var _p=this,_r=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/[^\s<>]*|)$/i.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},domain:function(_item){var _p=this,_r=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})(?:\/|)$/i.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},stricdomain:function(_item){var _p=this,_r=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.([a-z]{2,6})$/i.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},email:function(_item){var _p=this,_r=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},countrycode:function(_item){var _p=this,_v=_item.val().trim(),_r=/^(?:\+|)[\d]{1,6}$/.test(_v);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},zipcode:function(_item){var _p=this,_r=/^[0-9]{6}$/.test(_item.val());!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},taxcode:function(_item){var _p=this,_r=false,_v=_item.val().trim();_r=/^[\w]{15}$/.test(_v)||/^[\w]{18}$/.test(_v)||/^[\w]{20}$/.test(_v);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},reconfirm:function(_item){var _p=this,_r=true,_target,_KEY="ReconfirmValidTime",_typeKey="reconfirm";_p.isDatatarget(_item,_typeKey)&&(_target=_p.datatarget(_item,_typeKey));!(_target&&_target.length)&&(_target=_p.samesubtypeitems(_item,_typeKey));var _isReturn=false;if(_target&&_target.length){_target.each(function(){var _sp=$(this);if(_p.checkRepeatProcess(_sp,_KEY,true)){_isReturn=true}if(_item.val()!=$(this).val()){_r=false}})}!_r&&_target.length&&_target.each(function(){if(_item[0]==this){return}$(_p).trigger(Model.TRIGGER,[Model.ERROR,$(this),"reconfirmmsg",true])});if(_r&&_target&&_target.length){_target.each(function(){if(_item[0]==this){return}if(_isReturn){return false}$(_p).trigger(Model.TRIGGER,[Model.CORRECT,$(this)])})}_r?$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_item]):$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item,"reconfirmmsg",true]);return _r},checkRepeatProcess:function(_item,_key,_setTime,_tm){var _time=new Date().getTime(),_r=false;_tm=_tm||200;if(_item.data(_key)){if((_time-_item.data(_key))<_tm){_r=true;_item.data(_key,_time)}}_setTime&&_item.data(_key,_time);return _r},alternative:function(_item){var _p=this,_r=true,_target,_KEY="AlternativeValidTime",_dt=_p.parseDatatype(_item),_typeKey="alternative";_p.isDatatarget(_item,_typeKey)&&(_target=_p.datatarget(_item,_typeKey));!(_target&&_target.length)&&(_target=_p.samesubtypeitems(_item,_typeKey));var _isReturn=false;var _reqTarget;if(_target.length&&!$.trim(_item.val())){var _hasVal=false;_target.each(function(){var _sp=$(this);if(_item[0]==this){return}if(_p.checkRepeatProcess(_sp,_KEY,true)){_isReturn=true}if($(this).val()){_hasVal=true;return false}});_r=_hasVal}!_r&&_target&&_target.length&&_target.each(function(){if(_item[0]==this){return}if(_isReturn){return false}$(_p).trigger(Model.TRIGGER,[Model.ERROR,$(this),"alternativemsg",true])});if(_r&&_target&&_target.length){_target.each(function(){if(_item[0]==this){return}var _sp=$(this),_sdt=_p.parseDatatype(_sp);if(_sdt&&_p[_sdt]&&$(this).val()){_p[_sdt]($(this))}else{if(!$(this).val()){$(_p).trigger(Model.TRIGGER,[Model.CORRECT,$(this)]);var _reqTarget=JC.f.parentSelector($(this),$(this).attr("reqtargetdatatarget"));_reqTarget&&_reqTarget.length&&$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_reqTarget])}}})}if(_r&&_target&&_target.length){var _hasReqTarget=false,_reqErrList=[];_target.each(function(){if(_item[0]==this){return}var _sp=$(this),_reqTarget;if(_sp.is("[alternativeReqTarget]")){_reqTarget=JC.f.parentSelector(_sp,_sp.attr("alternativeReqTarget"));if(_reqTarget&&_reqTarget.length){_reqTarget.each(function(){var _ssp=$(this),_v=_ssp.val().trim();if(!_v){_reqErrList.push(_ssp);_hasReqTarget=true}})}}});if(_item.is("[alternativeReqTarget]")){_reqTarget=JC.f.parentSelector(_item,_item.attr("alternativeReqTarget"));if(_reqTarget&&_reqTarget.length){_reqTarget.each(function(){var _ssp=$(this),_v=_ssp.val().trim();if(!_v){_reqErrList.push(_ssp);_hasReqTarget=true}})}}if(_hasReqTarget&&_reqErrList.length){_r=false;$.each(_reqErrList,function(_ix,_sitem){_sitem=$(_sitem);$(_p).trigger(Model.TRIGGER,[Model.ERROR,_sitem,"alternativeReqmsg",true])});return _r}}if(_r){if(_dt&&_p[_dt]&&_item.val()){_p[_dt](_item)}else{if(!_item.val()){$(_p).trigger(Model.TRIGGER,[Model.CORRECT,_item])}}}else{$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item,"alternativemsg",true])}return _r},reqtarget:function(_item){var _p=this,_r=true,_v=_item.val().trim(),_tv,_target=JC.f.parentSelector(_item,_item.attr("reqtargetdatatarget")||_item.attr("datatarget"));if(_v&&_target&&_target.length){_tv=_target.val().trim();!_tv&&(_r=false);!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_target,"reqtargetmsg",true]);_r&&_target.trigger("blur")}else{if(_target&&_target.length){_target.trigger("blur")}}return _r},ucheck:function(_item){var _r=true,_p=this;this.ucheckCallback(_item)&&(_r=this.ucheckCallback(_item)(_item));!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item,"ucheckmsg",true]);return _r},ucheckCallback:function(_item){var _r;if(_item&&_item.length&&_item.is("[ucheckCallback]")){_r=window[_item.attr("ucheckCallback")]}return _r},unique:function(_item){var _p=this,_r=true,_target,_tmp,_group=[],_len=_p.typeLen(_item.attr("subdatatype"))[0],_KEY="UniqueValidTime",_typeKey="unique",_ignoreCase=JC.f.parseBool(_item.attr("uniqueIgnoreCase")),_errLs,_corLs;_p.isDatatarget(_item,_typeKey)&&(_target=_p.datatarget(_item,_typeKey));!(_target&&_target.length)&&(_target=_p.samesubtypeitems(_item,_typeKey));_errLs=[];_corLs=[];var _isReturn=false;if(_target&&_target.length){_tmp={};_target.each(function(_ix){var _sp=$(this);if(_sp.is("[processDisabled]")&&(!_sp.attr("processDisabled")||JC.f.parseBool(_sp.attr("processDisabled")))){if(!(_sp.is(":visible")||_p.isValidHidden(_sp))){return}}else{if(!_p.isAvalible(_sp)){return}}if(_p.checkRepeatProcess(_sp,_KEY,true)){_isReturn=true}if(_ix%_len===0){_group.push([])}_group[_group.length-1]&&_group[_group.length-1].push(_sp)});$.each(_group,function(_ix,_items){var _tmpAr=[],_ignoreEmpty=false;$.each(_items,function(_six,_sitem){var _tmpV,_ignore=JC.f.parseBool(_sitem.attr("uniqueIgnoreEmpty"));_tmpV=$(_sitem).val().trim();_ignore&&!_tmpV&&(_sitem.is(":visible")||_p.isValidHidden(_sitem))&&(_ignoreEmpty=true);_tmpAr.push(_tmpV)});var _pureVal=_tmpAr.join(""),_compareVal=_tmpAr.join("####");if(_ignoreEmpty){return}if(!_pureVal){return}_ignoreCase&&(_compareVal=_compareVal.toLowerCase());if(_compareVal in _tmp){_tmp[_compareVal].push(_items);_r=false}else{_tmp[_compareVal]=[_items]}});for(var _k in _tmp){if(_tmp[_k].length>1){_r=false;$.each(_tmp[_k],function(_ix,_items){_errLs=_errLs.concat(_items)})}else{$.each(_tmp[_k],function(_ix,_items){_corLs=_corLs.concat(_items)})}}}$.each(_corLs,function(_ix,_sitem){var _dt=_p.parseDatatype(_sitem);if(_dt&&_p[_dt]&&_sitem.val()){if(_p[_dt](_sitem)){Valid.setValid(_sitem)}}else{Valid.setValid(_sitem)}});!_r&&_errLs.length&&$.each(_errLs,function(_ix,_sitem){_sitem=$(_sitem);var _sv=(_sitem.val()||"").trim();if(_isReturn){return false}if(!_sv){return}_sv&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_sitem,"uniquemsg",true])});return _r},datavalid:function(_item){var _r=true,_p=this;if(!Valid.isFormValid){return _r}if(!_item.is("[datavalid]")){return _r}_r=JC.f.parseBool(_item.attr("datavalid"));if(!_r){Valid.statusTimeout.error(_item,setTimeout(function(){$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item,"datavalidmsg",true])},1))}return _r},typeLen:function(_type){var _lenAr=[1];_type&&(_type=_type.replace(/[^\d\.]/g,""))&&(_lenAr=_type.split("."))&&(_lenAr[0]=parseInt(_lenAr[0],10)||1,_lenAr[1]=parseInt(_lenAr[1],10)||0);return _lenAr},findValidEle:function(_item){var _p=this,_selector="~ em.validmsg",_r=_item.find(_selector),_tmp;if(_item.attr("validel")&&(_tmp=_p.getElement(_item.attr("validel"),_item,_selector)).length){_r=_tmp}return _r},findFocusEle:function(_item){var _p=this,_selector="~ em.focusmsg",_r=_item.find(_selector),_tmp;if(_item.attr("focusel")&&(_tmp=_p.getElement(_item.attr("focusel"),_item,_selector)).length){_r=_tmp}return _r},findErrorEle:function(_item){var _p=this,_selector=Model.SELECTOR_ERROR,_r=_item.find(_selector),_tmp;if(_item.attr("emel")&&(_tmp=_p.getElement(_item.attr("emel"),_item,_selector)).length){_r=_tmp}return _r},getElement:function(_selector,_item,_subselector){if(/^\^$/.test(_selector)){_subselector=_subselector||Model.SELECTOR_ERROR;_selector=$(_item.parent().find(_subselector))}else{if(/^[\/\|\<\(]/.test(_selector)){_selector=JC.f.parentSelector(_item,_selector)}else{if(/\./.test(_selector)){return $(_selector)}else{if(/^[\w-]+$/.test(_selector)){_selector="#"+_selector;_selector=$(_selector.replace(/[\#]+/g,"#"))}}}}return $(_selector)},errorMsg:function(_item,_msgAttr,_fullMsg){var _msg=_item.is("[errmsg]")?" "+_item.attr("errmsg"):_item.is("[reqmsg]")?_item.attr("reqmsg"):"";_msgAttr&&(_msg=_item.attr(_msgAttr)||_msg);_fullMsg&&_msg&&(_msg=" "+_msg);_msg=(_msg||"").trim().toLowerCase()=="undefined"||typeof _msg==undefined?"":_msg;if(_msg&&!/^[\s]/.test(_msg)){switch(_item.prop("type").toLowerCase()){case"file":_msg="请上传"+_msg;break;case"select-multiple":case"select-one":case"checkbox":case"radio":case"select":_msg="请选择"+_msg;break;case"textarea":case"password":case"text":_msg="请填写"+_msg;break}}return $.trim(_msg)},reqmsg:function(_item){var _r=true,_p=this;if(!_p.isReqmsg(_item)){return _r}if(_item.val()&&_item.val().constructor==Array){_r=!!($.trim(_item.val().join("")+""))}else{_r=!!$.trim(_item.val()||"")}!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item,"reqmsg"]);return _r},sametypeitems:function(_item){var _p=this,_r=[],_pnt=_item.parent(),_type=_item.attr("datatype"),_re=new RegExp(_type,"i");if(/select/i.test(_item.prop("nodeName"))){_pnt.find("[datatype]").each(function(){_re.test($(this).attr("datatype"))&&_r.push($(this))})}else{_pnt.find("input[datatype]").each(function(){_re.test($(this).attr("datatype"))&&_r.push($(this))})}return _r.length?$(_r):_r},samesubtypeitems:function(_item,_type){var _p=this,_r=[],_pnt=_item.parent(),_type=_type||_item.attr("subdatatype"),_re=new RegExp(_type,"i"),_nodeName=_item.prop("nodeName").toLowerCase(),_tagName="input";if(/select/.test(_nodeName)){_tagName="select"}else{if(/textarea/.test(_nodeName)){_tagName="textarea"}}_pnt.find(_tagName+"[subdatatype]").each(function(){_re.test($(this).attr("subdatatype"))&&_r.push($(this))});return _r.length?$(_r):_r},focusmsgeverytime:function(_item){var _r=Valid.focusmsgEverytime;_item.is("[focusmsgeverytime]")&&(_r=JC.f.parseBool(_item.attr("focusmsgeverytime")));return _r},validemdisplaytype:function(_item){_item&&(_item=$(_item));var _r=Valid.emDisplayType,_form=JC.f.getJqParent(_item,"form"),_tmp;_form&&_form.length&&_form.is("[validemdisplaytype]")&&(_tmp=_form.attr("validemdisplaytype"))&&(_r=_tmp);_item.is("[validemdisplaytype]")&&(_tmp=_item.attr("validemdisplaytype"))&&(_r=_tmp);return _r},checkedType:function(_item,_type){_item&&(_item=$(_item));_type=_type||"checkbox";var _p=this,_r=true,_items,_tmp,_ckLen=1,_count=0,_finder=_item,_pntIsLabel=_item.parent().prop("nodeName").toLowerCase()=="label",_finderKey=_type+"finder";if(_item.is("[datatarget]")){_items=JC.f.parentSelector(_item,_item.attr("datatarget"));_tmp=[];_items.each(function(){var _sp=$(this);(_sp.is(":visible")||_p.isValidHidden(_sp))&&!_sp.prop("disabled")&&_tmp.push(_sp)});_items=$(_tmp)}else{if(_pntIsLabel){if(!_finder.is("["+_finderKey+"]")){_finder=_item.parent().parent()}else{_finder=JC.f.parentSelector(_item,_item.attr(_finderKey))}_tmp=JC.f.parentSelector(_finder,"|input[datatype]")}else{_tmp=JC.f.parentSelector(_finder,"/input[datatype]")}_items=[];_tmp.each(function(){var _sp=$(this);var _re=new RegExp(_type,"i");_re.test(_sp.attr("datatype"))&&(_sp.is(":visible")||_p.isValidHidden(_sp))&&!_sp.prop("disabled")&&_items.push(_sp)});_items=$(_items)}if(_pntIsLabel){_items.each(function(){var _sp=$(this);if(!_sp.is("[emel]")){_sp.attr("emel","//em.error")}if(!_sp.is("[validel]")){_sp.attr("validel","//em.validmsg")}if(!_sp.is("[focusel]")){_sp.attr("focusel","//em.focusmsg")}})}_items.length&&$(_item=_items[_items.length-1]).data("Last"+_type,true);if(_items.length){_item.is("[datatype]")&&_item.attr("datatype").replace(/[^\-]+?\-([\d]+)/,function($0,$1){_ckLen=parseInt($1,10)||_ckLen});if(_items.length>=_ckLen){_items.each(function(){$(this).prop("checked")&&_count++});if(_count<_ckLen){_r=false}}!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item])}return _r},checkbox:function(_item){return this.checkedType(_item,"checkbox")},radio:function(_item){return this.checkedType(_item,"radio")},file:function(_item){var _p=this,_r=true,_v=_item.val().trim().toLowerCase(),_extLs=_p.dataFileExt(_item),_re,_tmp;if(_extLs.length){_r=false;$.each(_extLs,function(_ix,_item){_item+="$";_re=new RegExp(_item,"i");if(_re.test(_v)){_r=true;return false}})}!_r&&$(_p).trigger(Model.TRIGGER,[Model.ERROR,_item]);return _r},dataFileExt:function(_item){var _r=[],_tmp;_item.is("[fileext]")&&(_tmp=_item.attr("fileext").replace(/[\s]+/g,""))&&(_tmp=_tmp.replace(/\./g,"\\."))&&(_r=_tmp.toLowerCase().split(","));return _r},ignoreAutoCheckEvent:function(_item){var _r=Valid.ignoreAutoCheckEvent,_form;_item&&(_item=$(_item));if(_item&&_item.length){_form=JC.f.getJqParent(_item,"form");_form&&_form.length&&_form.is("[ignoreAutoCheckEvent]")&&(_r=JC.f.parseBool(_form.attr("ignoreAutoCheckEvent")));_item.is("[ignoreAutoCheckEvent]")&&(_r=JC.f.parseBool(_item.attr("ignoreAutoCheckEvent")))}return _r}};function View(_model){this._model=_model}View.prototype={init:function(){var _p=this;$(_p).on("setValid",function(_evt,_item,_tm,_noStyle,_hideFocusMsg){var _tmp;_item.removeClass(Model.CSS_ERROR);_item.find(JC.f.printf('~ em:not("em.focusmsg, em.validmsg, {0}")',Model.FILTER_ERROR)).css("display",_p._model.validemdisplaytype(_item));_item.find(Model.SELECTOR_ERROR).hide();_item.attr("emel")&&(_tmp=_p._model.getElement(_item.attr("emel"),_item))&&_tmp.hide();typeof _noStyle=="undefined"&&typeof _item.val()!="object"&&!_item.val().trim()&&(_noStyle=1);_p.validMsg(_item,_noStyle,_hideFocusMsg)});$(_p).on("setError",function(_evt,_item,_msgAttr,_fullMsg){var _msg=_p._model.errorMsg.apply(_p._model,[_item,_msgAttr,_fullMsg]),_errEm,_validEm,_focusEm,_tmp;_item.addClass(Model.CSS_ERROR);_item.find(JC.f.printf("~ em:not({0})",Model.FILTER_ERROR)).hide();if(_item.is("[validel]")){(_validEm=_p._model.getElement(_item.attr("validel"),_item))&&_validEm.hide()}if(_item.is("[focusel]")){(_focusEm=_p._model.getElement(_item.attr("focusel"),_item))&&_focusEm.hide()}if(_item.is("[emEl]")){(_errEm=_p._model.getElement(_item.attr("emEl"),_item))&&_errEm.addClass(Model.CSS_ERROR)}!(_errEm&&_errEm.length)&&(_errEm=_item.find(Model.SELECTOR_ERROR));if(!_errEm.length){(_errEm=$(JC.f.printf('<em class="{0}"></em>',Model.CSS_ERROR))).insertAfter(_item)}!_msg.trim()&&(_msg="&nbsp;");_errEm.html(_msg).css("display",_p._model.validemdisplaytype(_item))});return this},valid:function(_item,_tm,_noStyle){_item&&(_item=$(_item));var _p=this,_tmp;_item.data("JCValidStatus",true);var _hideFocusMsg=!JC.f.parseBool(_item.attr("validnoerror"));Valid.statusTimeout.valid(_item,setTimeout(function(){$(_p).trigger("setValid",[_item,_tm,_noStyle,_hideFocusMsg]);(_tmp=_p._model.validitemcallback(_item))&&_tmp(_item,true)},_tm||150))},validMsg:function(_item,_noStyle,_hideFocusMsg){var _p=this,_msg=(_item.attr("validmsg")||"").trim().toLowerCase(),_focusEm;if(_p._model.isValidMsg(_item)){if(_msg=="true"||_msg=="1"){_msg=""}!_msg.trim()&&(_msg="&nbsp;");var _focusmsgem=_p._model.findFocusEle(_item),_validmsgem=_p._model.findValidEle(_item),_errorEm=_p._model.findErrorEle(_item);!_validmsgem.length&&(_validmsgem=$('<em class="validmsg"></em>'),_item.after(_validmsgem));_validmsgem.html(_msg);_noStyle?_validmsgem.hide():(_validmsgem.css("display",_p._model.validemdisplaytype(_item)),_focusmsgem&&_focusmsgem.hide(),_errorEm&&_errorEm.hide())}else{if(_hideFocusMsg){(_focusEm=_p._model.findFocusEle(_item))&&_focusEm.hide()}}},error:function(_item,_msgAttr,_fullMsg){_item&&(_item=$(_item));var _p=this,arg=arguments,_tmp;if(_item.is("[validnoerror]")){return true}_item.data("JCValidStatus",false);Valid.statusTimeout.error(_item,setTimeout(function(){$(_p).trigger("setError",[_item,_msgAttr,_fullMsg]);(_tmp=_p._model.validitemcallback(_item))&&_tmp(_item,false)},150));return false},focusmsg:function(_item,_setHide,_msgAttr){if(_item&&(_item=$(_item)).length&&(_item.is("[focusmsg]")||(_msgAttr&&_item.is("["+_msgAttr+"]")))){var _r,_p=this,_focusmsgem=_p._model.findFocusEle(_item),_validmsgem=_p._model.findValidEle(_item),_errorEm=_p._model.findErrorEle(_item),_msg=_item.attr("focusmsg");_msgAttr&&(_msg=_item.attr(_msgAttr||_msg));if(_setHide&&_focusmsgem&&_focusmsgem.length){_focusmsgem.hide();return}_errorEm.length&&_errorEm.is(":visible")&&_errorEm.hide();if(_validmsgem.length&&_validmsgem.is(":visible")){return}!_focusmsgem.length&&(_focusmsgem=$('<em class="focusmsg"></em>'),_item.after(_focusmsgem));if(_item.is("[validnoerror]")){_r=Valid.check(_item)}else{_item.attr("validnoerror",true);_r=Valid.check(_item);_item.removeAttr("validnoerror")}!_msg.trim()&&(_msg="&nbsp;");if(_p._model.focusmsgeverytime(_item)){_focusmsgem.html(_msg).css("display",_p._model.validemdisplaytype(_item))}else{_r&&_focusmsgem.html(_msg).css("display",_p._model.validemdisplaytype(_item))}}}};$(document).delegate("input[type=text], input[type=password], textarea","blur",function($evt){var _p=$(this),_ins=Valid.getInstance();if(_ins._model.ignoreAutoCheckEvent(_p)){return}_ins.trigger(Model.FOCUS_MSG,[_p,true]);Valid.checkTimeout(_p)});$(document).delegate("input","blur",function(_evt){var _p=$(this),_ins=Valid.getInstance();if(_p.attr("type")){return}if(_ins._model.ignoreAutoCheckEvent(_p)){return}_ins.trigger(Model.FOCUS_MSG,[_p,true]);Valid.checkTimeout(_p)});$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","change",function($evt,_ignore){if(_ignore){return}var _p=$(this),_ins=Valid.getInstance();if(_ins._model.ignoreAutoCheckEvent(_p)){return}Valid.checkTimeout(_p)});$(document).delegate("input[type=text], input[type=password], textarea, select, input[type=file], input[type=checkbox], input[type=radio]","focus",function($evt){var _p=$(this),_ins=Valid.getInstance(),_v=_p.val().trim();if(_ins._model.ignoreAutoCheckEvent(_p)){return}_ins.trigger(Model.FOCUS_MSG,[_p]);!_v&&Valid.setValid(_p)});$(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","blur",function($evt){var _p=$(this),_ins=Valid.getInstance();if(_ins._model.ignoreAutoCheckEvent(_p)){return}_ins.trigger(Model.FOCUS_MSG,[_p,true])});$(document).delegate("input[type=hidden][subdatatype]","change",function(_evt){var _p=$(this),_ins=Valid.getInstance(),_isHidden=false,_tmp;if(_ins._model.ignoreAutoCheckEvent(_p)){return}_p.is("[subdatatype]")&&(_isHidden=/hidden/i.test(_p.attr("subdatatype")));if(_p.data("HID_CHANGE_CHECK")){_tmp=new Date().getTime()-_p.data("HID_CHANGE_CHECK");if(_tmp<50){return}}if(!_p.val()){return}_p.data("HID_CHANGE_CHECK",new Date().getTime());Valid.checkTimeout($(this))});$(document).delegate("input[type=text][subdatatype]","keyup",function(_evt){var _sp=$(this);var _isDatavalid=/datavalid/i.test(_sp.attr("subdatatype"));if(!_isDatavalid){return}if(_sp.prop("disabled")||_sp.prop("readonly")){return}Valid.dataValid(_sp,false,true);var _keyUpCb;_sp.attr("datavalidKeyupCallback")&&(_keyUpCb=window[_sp.attr("datavalidKeyupCallback")])&&_keyUpCb.call(_sp,_evt);if(_sp.data("DataValidInited")){return}_sp.data("DataValidInited",true);_sp.data("DataValidCache",{});_sp.on("DataValidUpdate",function(_evt,_v,_data){var _tmp,_json;if(JC.f.parseBool(_sp.attr("datavalidNoCache"))){_json=_data}else{if(!_sp.data("DataValidCache")){return}_json=_sp.data("DataValidCache")[_v]}if(!_json){return}_v==="suchestest"&&(_json.data.errorno=0);Valid.dataValid(_sp,!_json.data.errorno,false,_json.data.errmsg);_sp.attr("datavalidCallback")&&(_tmp=window[_sp.attr("datavalidCallback")])&&_tmp.call(_sp,_json.data,_json.text)});_sp.on("DataValidVerify",function(_evt,_ignoreStatus,_cb){var _v=_sp.val().trim(),_tmp,_strData,_url=_sp.attr("datavalidurl"),_datavalidCheckCallback;if(!_v){return}_sp.attr("datavalidCheckCallback")&&(_datavalidCheckCallback=window[_sp.attr("datavalidCheckCallback")]);if(_datavalidCheckCallback){innerDone(_datavalidCheckCallback.call(_sp));return}if(!_url){return}_sp.data("DataValidTm")&&clearTimeout(_sp.data("DataValidTm"));_sp.data("DataValidTm",setTimeout(function(){_v=_sp.val().trim();if(!_v){return}_v=JC.f.encoder(_sp)(_v);if(!_ignoreStatus){if(!_sp.data("JCValidStatus")){return}}_url=JC.f.printf(_url,_v);_sp.attr("datavalidUrlFilter")&&(_tmp=window[_sp.attr("datavalidUrlFilter")])&&(_url=_tmp.call(_sp,_url));if(_v in _sp.data("DataValidCache")){_sp.trigger("DataValidUpdate",_v);return}var _ajaxType="get",_requestData;_sp.attr("datavalidAjaxType")&&(_ajaxType=_sp.attr("datavalidAjaxType")||_ajaxType);if(_sp.attr("datavalidRequestData")){try{_requestData=eval("("+_sp.attr("datavalidRequestData")+")")}catch(ex){}}_requestData=_requestData||{};if(_ajaxType.toLowerCase()=="post"){$.post(_url,_requestData).done(innerDone)}else{$.get(_url,_requestData).done(innerDone)}},151));function innerDone(_d){_strData=_d;if(typeof _d=="string"){try{_d=$.parseJSON(_d)}catch(ex){_d={errorno:1}}}var _data={key:_v,data:_d,text:_strData};!JC.f.parseBool(_sp.attr("datavalidNoCache"))&&(_sp.data("DataValidCache")[_v]=_data);_sp.trigger("DataValidUpdate",[_v,_data]);_cb&&_cb.call(_sp,_data)}});_sp.on("blur",function(_evt,_ignoreProcess){if(_ignoreProcess){return}_sp.trigger("DataValidVerify")})});return JC.Valid})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));