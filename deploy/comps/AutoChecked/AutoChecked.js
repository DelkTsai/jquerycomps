(function(b,a){b(["JC.common"],function(){(function(d){window.JC=window.JC||{log:function(){}};JC.Form&&(JC.Form.initCheckAll=c);JC.AutoChecked=c;function c(g){g=d(g);if(!(g&&g.length)){return}if(g.prop("nodeName").toLowerCase()!="input"){return c.init(g)}if(c.getInstance(g)){return c.getInstance(g)}c.getInstance(g,this);JC.log("AutoChecked init",new Date().getTime());this._model=new f(g);this._view=new e(this._model);this._init()}c.init=function(h){h=d(h);if(!(h&&h.length)){return}var i=h.find("input[type=checkbox][checktype][checkfor]"),g;i.each(function(){g=d(this);if(!c.isAutoChecked(g)){return}if(c.getInstance(g)){c.getInstance(g).update();return}new c(g)})};c.prototype={_init:function(){var g=this;g._initHandlerEvent();d([g._view,g._model]).on("BindEvent",function(h,j,i){g.on(j,i)});d([g._view,g._model]).on("TriggerEvent",function(h,j){var i=JC.f.sliceArgs(arguments);i.shift();i.shift();g.trigger(j,i)});g._model.init();g._view.init();g._view.itemChange();return g},_initHandlerEvent:function(){var g=this;g.selector().on("change",function(){g.trigger(g._model.checktype())});g.on("all",function(){JC.log("AutoChecked all",new Date().getTime());g._view.allChange()});g.on("inverse",function(){JC.log("AutoChecked inverse",new Date().getTime());g._view.inverseChange()});if(!(g._model.checktype()=="inverse"&&g._model.hasCheckAll())){d(g._model.delegateElement()).delegate(g._model.delegateSelector(),"click",function(h){if(c.isAutoChecked(d(this))){return}JC.log("AutoChecked change",new Date().getTime());g._view.itemChange()})}},update:function(){this._view.itemChange();return this},selector:function(){return this._model.selector()},on:function(h,g){d(this).on(h,g);return this},trigger:function(h,g){d(this).trigger(h,g);return this}};c.getInstance=function(g,h){if(typeof g=="string"&&!/</.test(g)){g=d(g)}if(!(g&&g.length)||(typeof g=="string")){return}typeof h!="undefined"&&g.data("AutoCheckedIns",h);return g.data("AutoCheckedIns")};c.isAutoChecked=function(g){var h;g&&(g=d(g)).length&&(h=g.is("[checkfor]")&&g.is("[checktype]"));return h};function f(g){this._selector=g}f.isParentSelectorRe=/^[\/\|<\(]/;f.parentSelectorRe=/[^\/\|<\(]/g;f.childSelectorRe=/[\/\|<\(]/g;f.parentNodeRe=/^[<\(]/;f.prototype={init:function(){return this},checktype:function(){return(this.selector().attr("checktype")||"").toLowerCase()},checkfor:function(){return(this.selector().attr("checkfor")||"")},checkall:function(){return(this.selector().attr("checkall")||"")},checktrigger:function(){return(this.selector().attr("checktrigger")||"")},hasCheckAll:function(){return this.selector().is("[checkall]")&&this.selector().attr("checkall")},selector:function(){return this._selector},isParentSelector:function(){return f.isParentSelectorRe.test(this.selector().attr("checkfor"))},delegateSelector:function(){var h=this.selector().attr("checkfor"),g;if(this.isParentSelector()){if(f.parentNodeRe.test(this.checkfor())){this.checkfor().replace(/[\s]([\s\S]+)/,function(j,i){h=i})}else{h=this.checkfor().replace(f.childSelectorRe,"")}}return h},delegateElement:function(){var g=this,i=d(document),h;if(this.isParentSelector()){if(f.parentNodeRe.test(this.checkfor())){this.checkfor().replace(/^([^\s]+)/,function(k,j){i=JC.f.parentSelector(g.selector(),j)})}else{h=this.checkfor().replace(f.parentSelectorRe,"");i=JC.f.parentSelector(g.selector(),h)}}return i},items:function(){return this.delegateElement().find(this.delegateSelector())},checkedAll:function(){return this.selector().prop("checked")},checkedInverse:function(){return this.selector().prop("checked")},allSelector:function(){var g;if(this.checktype()=="inverse"){this.checkall()&&(g=JC.f.parentSelector(this.selector(),this.checkall()))}else{g=this.selector()}return g}};function e(g){this._model=g}e.prototype={init:function(){return this},itemChange:function(){switch(this._model.checktype()){case"all":this._fixAll();break}},allChange:function(){var g=this,h=g._model.checkedAll();g._model.items().each(function(){var i=d(this);if(c.isAutoChecked(i)){return}if(i.is("[disabled]")){return}i.prop("checked",h);g.triggerEvent(i)})},inverseChange:function(){var g=this;g._model.items().each(function(){var h=d(this);if(c.isAutoChecked(h)){return}if(h.is("[disabled]")){return}h.prop("checked",!h.prop("checked"));g.triggerEvent(h)});this._fixAll()},_fixAll:function(){var g=this,i=true,h=0;if(g._model.allSelector().prop("disabled")){return}g._model.items().each(function(){if(c.isAutoChecked(d(this))){return}if(d(this).is("[disabled]")){return}h++;if(!d(this).prop("checked")){return i=false}});JC.log("_fixAll:",i);if(!h){i=false}g._model.allSelector().prop("checked",i)},triggerEvent:function(h){var g=this,i=g._model.checktrigger();i&&d(h).trigger(i)}};d(document).ready(function(g){c.init(d(document))})}(jQuery));return JC.AutoChecked})}(typeof define==="function"&&define.amd?define:function(a,b){b&&b()},this));