(function(b,a){b(["JC.common","JC.BaseMVC"],function(){(function(e){window.JC=window.JC||{log:function(){}};JC.TableFreeze=d;function d(f){f&&(f=e(f));if(d.getInstance(f)){return d.getInstance(f)}d.getInstance(f,this);this._model=new d.Model(f);this._view=new d.View(this._model);this._init()}d.getInstance=function(f,g){if(typeof f=="string"&&!/</.test(f)){f=e(f)}if(!(f&&f.length)||(typeof f=="string")){return}typeof g!="undefined"&&f.data(d.Model._instanceName,g);return f.data(d.Model._instanceName)};d.init=function(f){var g=[];f=e(f||document);if(f&&f.length){if(f.hasClass("js_compTableFreeze")){g.push(new d(f))}else{f.find("div.js_compTableFreeze").each(function(){g.push(new d(this))})}}return g};d.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var f=this;f.on("CTableFreezeUpdate",function(g){f._view.update()})},_inited:function(){var f=e(this);f.trigger("CTableFreezeUpdate")},update:function(){this._view.update();return this},fixHeight:function(){var g=this,f=g._model.saveWidth,i=g._model.selector().prop("offsetWidth"),h=g._model.selector().children("div.js-roll-table,div.js-fixed-table");g._model.setHeight();if(f<=i){h.find("tr").css("height","auto")}g._model.setHeight();return this}};BaseMVC.buildModel(d);d.Model.prototype={init:function(){var f=this;this.sourceTable=this.selector().find("table").eq(0)},detachTable:function(){this.sourceTable.detach()},saveWidth:[],createTplBox:function(){var h=this,p=h.freezeType(),q=h.baseTpl,m,g,n,j,l,f;switch(p){case"prev":g=parseInt(h.freezeCols(),10);m=JC.f.printf(q,"js-fixed-table compTFPrevFixed")+JC.f.printf(q,"js-roll-table compTFPrevRoll");h.selector().append(m);h.setWidth(0,h.selector().find("div.js-fixed-table"),g);h.setWidth(g,h.selector().find("div.js-roll-table"),h.colNum());n=h.selector().find("div.js-fixed-table thead").eq(0);j=h.selector().find("div.js-fixed-table tbody").eq(0);l=h.selector().find("div.js-roll-table thead").eq(0);f=h.selector().find("div.js-roll-table tbody").eq(0);h.createHdTpl(n,g,"prev",l);h.createBdTpl(j,g,"prev",f);h.createHdTpl(l,h.colNum()-g);h.createBdTpl(f,h.colNum()-g);break;case"last":g=parseInt(h.freezeCols(),10);m=JC.f.printf(q,"js-roll-table compTFLastRoll")+JC.f.printf(q,"js-fixed-table compTFLastFixed");h.selector().append(m);h.setWidth(0,h.selector().find("div.js-roll-table"),h.colNum()-g);h.setWidth(h.colNum()-g,h.selector().find("div.js-fixed-table"),h.colNum());n=h.selector().find("div.js-roll-table thead").eq(0);j=h.selector().find("div.js-roll-table tbody").eq(0);l=h.selector().find("div.js-fixed-table thead").eq(0);f=h.selector().find("div.js-fixed-table tbody").eq(0);h.createHdTpl(n,h.colNum()-g);h.createBdTpl(j,h.colNum()-g);h.createHdTpl(l,g);h.createBdTpl(f,g);break;case"both":var i,k,o;g=parseInt(h.freezeCols()[0],10);i=parseInt(h.freezeCols()[1],10);m=JC.f.printf(q,"js-fixed-table compTFBothFixed")+JC.f.printf(q,"js-roll-table compTFBothRoll")+JC.f.printf(q,"js-fixed-table compTFBothFixed");h.selector().append(m);h.setWidth(0,h.selector().find("div.js-fixed-table").eq(0),g);h.setWidth(g,h.selector().find("div.js-roll-table"),g+h.colNum()-g-i);h.setWidth(g+h.colNum()-g-i,h.selector().find("div.js-fixed-table").eq(1),h.colNum());n=h.selector().find("div.js-fixed-table thead").eq(0);j=h.selector().find("div.js-fixed-table tbody").eq(0);l=h.selector().find("div.js-roll-table thead").eq(0);f=h.selector().find("div.js-roll-table tbody").eq(0);k=h.selector().find("div.js-fixed-table thead").eq(1);o=h.selector().find("div.js-fixed-table tbody").eq(1);h.createHdTpl(n,g);h.createBdTpl(j,g);h.createHdTpl(l,h.colNum()-g-i);h.createBdTpl(f,i);h.createHdTpl(k,i);h.createBdTpl(o,i);break}h.saveWidth=h.selector().prop("offsetWidth");h.setHeight()},createHdTpl:function(h,k){var f=this,j=f.sourceTable,i=document.createDocumentFragment(),g=e(i);j.find("thead").eq(0).children("tr").each(function(p,o){var n=0,l,m=e(o).get(0).cloneNode(false);g.append(m);l=g.children("tr:last");e(o).children("td,th").each(function(q,s){var r=e(this).attr("colspan");if(n>=k){return false}e(this).appendTo(l);if(typeof r==="undefined"){n=n+1}else{n+=parseInt(r,10)}})});g.appendTo(h)},createBdTpl:function(j,l){var f=this,i=f.sourceTable,k={},h=document.createDocumentFragment(),g=e(h);i.find("tbody").eq(0).children("tr").each(function(q,p){var o=e(p).get(0).cloneNode(false),n=0,m;g.append(o);m=g.children("tr:last");e(p).children("td,th").each(function(s,x){var v=e(this).attr("colspan"),u=e(this).attr("rowspan"),w={},t;if(n>=l){return false}if(typeof u!="undefined"){u=parseInt(u,10);w={six:s,rowspan:u};for(var r=1;r<u;r++){k[(q+r)+"0"]=w}}if(typeof v==="undefined"){n=n+1}else{n+=parseInt(v,10)}t=q+"0";if(t in k){n=n+1}e(this).appendTo(m)})});g.appendTo(j)},setWidth:function(l,k,j){var f=this.colWidth(),h=0,g;for(g=l;g<j;g++){h=h+f[g]}h=h*100;e(k).css("width",h+"%")},setHeight:function(){var f=this,h=f.freezeType();var g=f.selector().find("div.js-fixed-table").eq(0).find("table").eq(0).find("tr");g.each(function(n,m){var l=f.selector().find("div.js-roll-table tr").eq(n),o=f.selector().find("div.js-fixed-table").eq(1).find("table").eq(0).find("tr").eq(n),k=[],j=e(m),i;k=[j.prop("offsetHeight"),l.prop("offsetHeight")];if(h=="both"){k.push(o.prop("offsetHeight"))}i=c(k);j.height(i);l.height(i);o.height(i)})},freezeType:function(){var f=this,g;g=f.attrProp(f.selector(),"freezeType")||"prev";return g},freezeCols:function(){var f=this,g;g=f.attrProp(f.selector(),"freezeCols")||1;g=g.split(",");return g},tableWidth:function(){var f=this,g=f.selector().prop("offsetWidth");return g},rowHeight:function(){var f=this,g=f.selector().find("table tr"),h=[];g.each(function(){h.push(e(this).prop("offsetHeight")+"px")});return h},scrollWidth:function(){var f=this;return f.selector().attr("scrollWidth")},colWidth:function(){var f=this,g=f.selector().find("table>thead th"),g,h=[];g.each(function(){h.push(e(this).prop("offsetWidth")/f.tableWidth())});return h},colNum:function(){var f=this,g=0;g=f.selector().find("thead>tr>th").length;return g},rowNum:function(){var f=this,g=0;g=f.selector().find("tbody>tr").length;return g},supportFreeze:function(){var f=this,g=true;if(f.freezeCols().length==0||(f.freezeCols().length==1&&parseInt(f.freezeCols(),10)==0)){g=false}return g},supportScroll:function(){var f=this,g=0,h=true;e.each(f.freezeCols(),function(i,j){g=g+parseInt(j,10)});if(g==f.colNum()){h=false}return h},hasFixedPXWidth:function(){var g=this,i=g.selector().get(0).style.width,f=g.selector().find("table").eq(0).attr("width")||g.selector().find("table").eq(0).get(0).style.width,j=g.tdThHasFixedPXWidth(),h=true;if(i&&/%/.test(i)){if(!f||(f&&/%/.test(f))){h=false;return false}}if(!f||(f&&/%/.test(f))){h=false;return false}if(!j){h=false;return false}return true},tdThHasFixedPXWidth:function(){var f=this,g=f.selector().find("table").eq(0).find("tr").eq(0).find("th,td");g.each(function(){var h=e(this),i=h.attr("width")||h.get(0).style.width;if(!i){return false}if(i&&/%/.test(i)){return false}});return true},tTpl:function(){var g,h,i,f=this;g=f.selector().find("table").get(0).cloneNode(false);h=f.selector().find("thead").get(0).cloneNode(false);i=f.selector().find("tbody").get(0).cloneNode(false);return},baseTpl:'<div class="{0}"><table><thead></thead><tbody></tbody></table></div>'};BaseMVC.buildView(d);d.View.prototype={init:function(){var f=this},update:function(){var f=this;if(!f._model.supportScroll()){return}if(!f._model.supportFreeze()){f._model.selector().css({"overflow-x":"scroll"}).addClass("compTFAllRoll");f._model.selector().children("table").css("width","110%");return}f._model.createTplBox();f._model.detachTable()}};BaseMVC.build(d);e(document).ready(function(){var f=0;d.autoInit&&(f=d.init())});e(window).on("resize",function(){e("div.js_compTableFreeze").each(function(){var f=d.getInstance(e(this));f&&f.fixHeight()})});function c(j){var g,f=j.length,h=j[0];for(g=1;g<f;g++){if(j[g]>h){h=j[g]}}return h}}(jQuery));return JC.TableFreeze})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));