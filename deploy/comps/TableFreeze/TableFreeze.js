(function(b,a){b(["JC.BaseMVC"],function(){JC.TableFreeze=c;function c(d){d&&(d=$(d));if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.init=function(d){var e=[];d=$(d||document);if(d.length){if(d.hasClass("js_compTableFreeze")){e.push(new c(d))}else{d.find("div.js_compTableFreeze").each(function(){e.push(new c(this))})}}return e};BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var d=this;d.on("CTableFreezeUpdate",function(g){d._model.beforeCreateTableCallback()&&d._model.beforeCreateTableCallback().call(d,d.selector());d._view.update();d._model.afterCreateTableCallback()&&d._model.afterCreateTableCallback().call(d,d.selector());if(d._model.needHoverClass()){var e=d._model.hoverClass();if(!d._model.supportFreeze()||!d._model.supportScroll()){d._model.selector().find("table>tbody>tr").on("mouseenter",function(){$(this).addClass(e)}).on("mouseleave",function(){$(this).removeClass(e)})}else{var f="td.compTFEextraTd>div>table>tbody>tr",h="td.compTFEextraTd>div>table>tbody>tr.",i;$(document).undelegate(f,"mouseenter").delegate(f,"mouseenter",function(){var j=$(this),k=JC.f.getJqParent(j,"table.compTFEextraTable");i=k.find(h+j.data("linktr")).addClass(e)}).undelegate(f,"mouseleave").delegate(f,"mouseleave",function(){if(i&&i.length>0){i.removeClass(e)}})}}})},_inited:function(){var d=$(this);d.trigger("CTableFreezeUpdate")},update:function(){this._view.update();return this},fixHeight:function(){var f=this,e=c.Model.saveWidth,g=f._model.selector(),j=g.prop("offsetWidth"),h=g.find("div.js-roll-table,div.js-fixed-table"),d=g.find("div.js-roll-table"),k=g.find("div.js-fixed-table"),i=0;f._model.setHeight();if(e<=j){h.each(function(){$(this).find("tr").height("auto")});f._model.setHeight()}k.each(function(){i+=$(this).parent("td").prop("offsetWidth")});d.css("width",j-i);$("#t21").append("<p>"+j+"   "+(j-i)+"</p>");return this}});c.Model._instanceName="TableFreeze";c.Model.saveWidth=0;JC.f.extendObject(c.Model.prototype,{init:function(){var d=this;this.sourceTable=this.selector().find("table").eq(0)},detachTable:function(){this.sourceTable.remove()},linkTpl:function(){var d=this,e;if(d.selector().find("table>tbody").length>0){e=d.selector().find("table>tbody>tr")}else{e=d.selector().find("table>tr")}e.each(function(f){$(this).attr("data-linktr","CTF"+f)})},createTplBox:function(){var t=this,q=t.freezeType(),h=t.tTpl(),s=t.selector(),r=t.colNum(),g,u,j,p,l,e;var o,n,m,f;switch(q){case"prev":u=parseInt(t.freezeCols(),10);g=JC.f.printf(h,"js-fixed-table compTFPrevFixed","js-roll-table compTFPrevRoll");s.append(g);o=JC.f.getJqParent(s.find(".js-fixed-table"),".compTFEextraTd");n=JC.f.getJqParent(s.find(".js-roll-table"),".compTFEextraTd");t.setWidth(0,o,u,n);j=s.find(".js-fixed-table>table>thead");p=s.find(".js-fixed-table>table>tbody");l=s.find(".js-roll-table>table>thead");e=s.find(".js-roll-table>table>tbody");t.createHdTpl(j,u);t.createBdTpl(p,u);t.createHdTpl(l,r-u);t.createBdTpl(e,r-u);break;case"last":u=parseInt(t.freezeCols(),10);g=JC.f.printf(h,"js-roll-table compTFLastRoll","js-fixed-table compTFLastFixed");s.append(g);o=JC.f.getJqParent(s.find("div.js-roll-table"),"td.compTFEextraTd");n=JC.f.getJqParent(s.find("div.js-fixed-table"),"td.compTFEextraTd");t.setWidth(r-u,n,r,o);j=s.find("div.js-roll-table>table>thead");p=s.find("div.js-roll-table>table>tbody");l=s.find("div.js-fixed-table>table>thead");e=s.find("div.js-fixed-table>table>tbody");t.createHdTpl(j,r-u);t.createBdTpl(p,r-u);t.createHdTpl(l,u);t.createBdTpl(e,u);break;case"both":var i,k,d;u=parseInt(t.freezeCols()[0],10);i=parseInt(t.freezeCols()[1],10);g=JC.f.printf(h,"js-fixed-table compTFBothFixed","js-roll-table compTFBothRoll","js-fixed-table compTFBothFixed");s.append(g);o=JC.f.getJqParent(s.find("div.js-fixed-table:eq(0)"),"td.compTFEextraTd");n=JC.f.getJqParent(s.find("div.js-roll-table"),"td.compTFEextraTd");m=JC.f.getJqParent(s.find("div.js-fixed-table:eq(1)"),"td.compTFEextraTd");t.setWidth(0,o,u);t.setWidth(u,n,u+r-u-i);t.setWidth(u+r-u-i,m,r);j=s.find("div.js-fixed-table:eq(0)>table>thead");p=s.find("div.js-fixed-table:eq(0)>table>tbody");l=s.find("div.js-roll-table>table>thead");e=s.find("div.js-roll-table>table>tbody");k=s.find("div.js-fixed-table:eq(1)>table>thead");d=s.find("div.js-fixed-table:eq(1)>table>tbody");t.createHdTpl(j,u);t.createBdTpl(p,u);t.createHdTpl(l,r-u-i);t.createBdTpl(e,r-u-i);t.createHdTpl(k,i);t.createBdTpl(d,i);break}s.find("div.js-roll-table>table").width(t.scrollwidth());t.setHeight()},createHdTpl:function(f,i){var d=this,h=d.sourceTable,g=document.createDocumentFragment(),e=$(g);h.find("thead:eq(0)>tr").each(function(n,m){var l=0,j,k=$(m).get(0).cloneNode(false);e.append(k);j=e.children("tr:last");$(m).children("td,th").each(function(o,q){var p=$(this).attr("colspan");if(l>=i){return false}$(this).appendTo(j);if(typeof p==="undefined"){l=l+1}else{l+=parseInt(p,10)}})});e.appendTo(f)},createBdTpl:function(i,k){var d=this,h=d.sourceTable,g=h.find("tbody:eq(0)>tr"),j={},f=document.createDocumentFragment(),e=$(f);g.each(function(q,p){var m=$(this),o=m.get(0).cloneNode(false),r=m.children("td,th"),n=0,l;$(o).addClass("CTF CTF"+q).removeAttr("id");e.append(o);l=e.children("tr:last");r.each(function(u,z){var s=$(this),x=s.attr("colspan"),w=s.attr("rowspan"),y={},v;if(n>=k){return false}if(typeof w!="undefined"){w=parseInt(w,10);y={six:u,rowspan:w};for(var t=1;t<w;t++){if(u==0){j[(q+t)+(u+1).toString()]=y}else{j[(q+t)+u.toString()]=y}}}if(typeof x==="undefined"){n=n+1}else{n+=parseInt(x,10)}v=q+(u+1).toString();if(v in j){n=n+1}s.appendTo(l)})});e.appendTo(i)},setWidth:function(e,j,g,m){var d=this.colWidth(),l=0,f,k=this.tableWidth(),h=0,m=$(m);for(f=e;f<g;f++){l=l+d[f]}l=l+1;h=l/k;h=h*100;$(j).css("width",h+"%");if(m.length){m.css("width",(100-h)+"%").find(">div").css("width",k-l-1)}$("#t21").append(","+k+"   "+($(".js-roll-table").prop("offsetWidth"))+"   "+h+" "+(100-h))},setHeight:function(){var d=this,g=d.freezeType(),f=d.selector().find("div.js-fixed-table:eq(0)>table>thead>tr,div.js-fixed-table:eq(0)>table>tbody>tr"),e=d.selector().find("div.js-roll-table>table>thead>tr,div.js-roll-table>table>tbody>tr"),h=d.selector().find("div.js-fixed-table:eq(1)>table>thead>tr,div.js-fixed-table:eq(1)>table>tbody>tr");f.each(function(m,l){var k=e.eq(m),n=h.eq(m),j=$(l),i;i=Math.max(j.prop("offsetHeight"),k.prop("offsetHeight"));if(g=="both"){i=Math.max(i,n.prop("offsetHeight"))}j.height(i);k.height(i);if(g=="both"){n.height(i)}})},freezeType:function(){var d=this,e;e=d.attrProp(d.selector(),"freezeType")||"prev";return e},freezeCols:function(){var d=this,e;e=d.attrProp(d.selector(),"freezeCols")||1;e=e.split(",");return e},scrollwidth:function(){var d=this.attrProp("scrollwidth");!d&&(d="120%");return d},needHoverClass:function(){var d=this.boolProp(this.selector().find("table").eq(0),"needHoverClass");!d&&(d=true);return d},hoverClass:function(){var d=this.attrProp(this.selector().find("table").eq(0),"hoverClass");!d&&(d="compTFHover");return d},tableWidth:function(){var d=this,e=d.selector().width(),f=d.selector().parent();while(1){if(f&&f.prop("nodeName").toUpperCase()==="BODY"){break}if(f.width()<e){e=f.width();break}f=f.parent()}return e},rowHeight:function(){var d=this,e=d.selector().find("table tr"),f=[];e.each(function(){f.push($(this).prop("offsetHeight")+"px")});return f},scrollWidth:function(){var d=this;return d.selector().attr("scrollWidth")},colWidth:function(){var d=this,e=d.selector().find("table>thead th"),e,f=[],g=d.tableWidth();e.each(function(){f.push($(this).prop("offsetWidth"))});return f},colNum:function(){var d=this,e=0;e=d.selector().find("thead>tr>th").length;return e},rowNum:function(){var d=this,e=0;e=d.selector().find("tbody>tr").length;return e},supportFreeze:function(){var d=this,e=true;if(d.freezeCols().length==0||(d.freezeCols().length==1&&(parseInt(d.freezeCols(),10)==0)||parseInt(d.freezeCols(),10)>d.colNum())||(d.freezeCols().length==2&&(parseInt(d.freezeCols()[0],10)+parseInt(d.freezeCols()[1],10)>=d.colNum()))){e=false}return e},supportScroll:function(){var d=this,e=0,f=true;$.each(d.freezeCols(),function(g,h){e=e+parseInt(h,10)});if(e==d.colNum()){f=false}return f},hasFixedPXWidth:function(){var e=this,g=e.selector().get(0).style.width,d=e.selector().find("table").eq(0).attr("width")||e.selector().find("table").eq(0).get(0).style.width,h=e.tdThHasFixedPXWidth(),f=true;if(g&&/%/.test(g)){if(!d||(d&&/%/.test(d))){return false}}if(!d||(d&&/%/.test(d))){return false}if(!h){return false}return true},tdThHasFixedPXWidth:function(){var d=this,e=d.selector().find("table").eq(0).find("tr").eq(0).find("th,td");e.each(function(){var f=$(this),g=f.attr("width")||f.get(0).style.width;if(!g){return false}if(g&&/%/.test(g)){return false}});return true},tTpl:function(){var d=this,e,f,h,g;e=d.selector().find("table").get(0).cloneNode(false);f=d.selector().find("thead").get(0).cloneNode(false);h=d.selector().find("tbody").get(0).cloneNode(false);$(f).appendTo($(e));$(h).appendTo($(e));$(e).width("100%");switch(d.freezeType()){case"prev":case"last":g='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+e.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+e.outerHTML+"</div></td></tr></table>";break;case"both":g='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+e.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+e.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{2}" style="width:100%;">'+e.outerHTML+"</div></td></tr></table>";break}return g},beforeCreateTableCallback:function(){var d=this,e=d.selector(),f="beforeCreateTableCallback";return d.callbackProp(e,f)},afterCreateTableCallback:function(){var d=this,e=d.selector(),f="afterCreateTableCallback";return d.callbackProp(e,f)},baseTpl:'<div class="{0}" style="width:100%;"><table style="padding:0;margin:0;"><thead></thead><tbody></tbody></table></div>'});JC.f.extendObject(c.View.prototype,{init:function(){var d=this;d._model.linkTpl()},update:function(){var d=this;if(!d._model.supportScroll()){return}if(!d._model.supportFreeze()){d._model.selector().css({"overflow-x":"scroll"}).addClass("compTFAllRoll").children("table").css("width",d._model.scrollwidth());return}d._model.createTplBox();d._model.detachTable()}});$(document).ready(function(){var e=0;c.autoInit&&(e=c.init());var f=$(window);f.on("resize",d);function d(){f.off("resize",d);$("div.js_compTableFreeze").each(function(){var g=c.getInstance($(this));g&&g.fixHeight();c.Model.saveWidth=g._model.tableWidth()});f.data("CTFResizeTimeout")&&clearTimeout(f.data("CTFResizeTimeout"));f.data("CTFResizeTimeout",setTimeout(function(){f.off("resize",d);f.on("resize",d)},200))}});return JC.TableFreeze})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));