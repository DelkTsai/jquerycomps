(function(b,a){b(["JC.common","JC.BaseMVC"],function(){(function(d){window.JC=window.JC||{log:function(){}};JC.TableFreeze=c;function c(e){e&&(e=d(e));if(c.getInstance(e)){return c.getInstance(e)}c.getInstance(e,this);this._model=new c.Model(e);this._view=new c.View(this._model);this._init()}c.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=d(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data(c.Model._instanceName,f);return e.data(c.Model._instanceName)};c.init=function(e){var f=[];e=d(e||document);if(e&&e.length){if(e.hasClass("js_compTableFreeze")){f.push(new c(e))}else{e.find("div.js_compTableFreeze").each(function(){f.push(new c(this))})}}return f};BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("CTableFreezeUpdate",function(h){e._model.beforeCreateTableCallback()&&e._model.beforeCreateTableCallback().call(e,e.selector());e._view.update();e._model.afterCreateTableCallback()&&e._model.afterCreateTableCallback().call(e,e.selector());if(e._model.needHoverClass()){var f=e._model.hoverClass();if(!e._model.supportFreeze()||!e._model.supportScroll()){e._model.selector().find("tr").on("mouseenter",function(){d(this).addClass(f)}).on("mouseleave",function(){d(this).removeClass(f)})}else{var g="td.compTFEextraTd>div>table>tbody>tr",i="td.compTFEextraTd>div>table>tbody>tr.",j;d(document).undelegate(g,"mouseenter").delegate(g,"mouseenter",function(){var k=d(this),l=JC.f.getJqParent(k,"table.compTFEextraTable");j=l.find(i+k.data("linktr")).addClass(f)}).undelegate(g,"mouseleave").delegate(g,"mouseleave",function(){if(j.length>0){j.removeClass(f)}})}}})},_inited:function(){var e=d(this);e.trigger("CTableFreezeUpdate")},update:function(){this._view.update();return this},fixHeight:function(){var f=this,e=f._model.saveWidth,h=f._model.selector().prop("offsetWidth"),g=f._model.selector().find("div.js-roll-table,div.js-fixed-table");f._model.setHeight();if(e<=h){g.each(function(){d(this).find("tr").height("auto")});f._model.setHeight()}return this}});c.Model._instanceName="TableFreeze";JC.f.extendObject(c.Model.prototype,{init:function(){var e=this;this.sourceTable=this.selector().find("table").eq(0)},detachTable:function(){this.sourceTable.remove()},saveWidth:[],linkTpl:function(){var e=this,f;if(e.selector().find("table>tbody").length>0){f=e.selector().find("table>tbody>tr")}else{f=e.selector().find("table>tr")}f.each(function(g){d(this).attr("data-linktr","CTF"+g)})},createTplBox:function(){var h=this,s=h.freezeType(),t=h.tTpl(),m,f,n,j,l,e;var q,p,o,g;switch(s){case"prev":f=parseInt(h.freezeCols(),10);m=JC.f.printf(t,"js-fixed-table compTFPrevFixed","js-roll-table compTFPrevRoll");h.selector().append(m);q=JC.f.getJqParent(h.selector().find("div.js-fixed-table"),"td.compTFEextraTd");p=JC.f.getJqParent(h.selector().find("div.js-roll-table"),"td.compTFEextraTd");h.setWidth(0,q,f);h.setWidth(f,p,h.colNum());n=h.selector().find("div.js-fixed-table>table>thead");j=h.selector().find("div.js-fixed-table>table>tbody");l=h.selector().find("div.js-roll-table>table>thead");e=h.selector().find("div.js-roll-table>table>tbody");h.createHdTpl(n,f);h.createBdTpl(j,f);h.createHdTpl(l,h.colNum()-f);h.createBdTpl(e,h.colNum()-f);break;case"last":f=parseInt(h.freezeCols(),10);m=JC.f.printf(t,"js-roll-table compTFLastRoll","js-fixed-table compTFLastFixed");h.selector().append(m);q=JC.f.getJqParent(h.selector().find("div.js-roll-table"),"td.compTFEextraTd");p=JC.f.getJqParent(h.selector().find("div.js-fixed-table"),"td.compTFEextraTd");h.setWidth(0,q,h.colNum()-f);h.setWidth(h.colNum()-f,p,h.colNum());n=h.selector().find("div.js-roll-table>table>thead");j=h.selector().find("div.js-roll-table>table>tbody");l=h.selector().find("div.js-fixed-table>table>thead");e=h.selector().find("div.js-fixed-table>table>tbody");h.createHdTpl(n,h.colNum()-f);h.createBdTpl(j,h.colNum()-f);h.createHdTpl(l,f);h.createBdTpl(e,f);break;case"both":var i,k,r;f=parseInt(h.freezeCols()[0],10);i=parseInt(h.freezeCols()[1],10);m=JC.f.printf(t,"js-fixed-table compTFBothFixed","js-roll-table compTFBothRoll","js-fixed-table compTFBothFixed");h.selector().append(m);q=JC.f.getJqParent(h.selector().find("div.js-fixed-table:eq(0)"),"td.compTFEextraTd");p=JC.f.getJqParent(h.selector().find("div.js-roll-table"),"td.compTFEextraTd");o=JC.f.getJqParent(h.selector().find("div.js-fixed-table:eq(1)"),"td.compTFEextraTd");h.setWidth(0,q,f);h.setWidth(f,p,f+h.colNum()-f-i);h.setWidth(f+h.colNum()-f-i,o,h.colNum());n=h.selector().find("div.js-fixed-table:eq(0)>table>thead");j=h.selector().find("div.js-fixed-table:eq(0)>table>tbody");l=h.selector().find("div.js-roll-table>table>thead");e=h.selector().find("div.js-roll-table>table>tbody");k=h.selector().find("div.js-fixed-table:eq(1)>table>thead");r=h.selector().find("div.js-fixed-table:eq(1)>table>tbody");h.createHdTpl(n,f);h.createBdTpl(j,f);h.createHdTpl(l,h.colNum()-f-i);h.createBdTpl(e,h.colNum()-f-i);h.createHdTpl(k,i);h.createBdTpl(r,i);break}g=JC.f.getJqParent(q,"table");if(h.hasFixedPXWidth()){g.css("width",h.selector().find("table").prop("offsetWidth"))}h.selector().find("div.js-roll-table>table").width("120%");h.setHeight()},createHdTpl:function(g,j){var e=this,i=e.sourceTable,h=document.createDocumentFragment(),f=d(h);i.find("thead:eq(0)>tr").each(function(o,n){var m=0,k,l=d(n).get(0).cloneNode(false);f.append(l);k=f.children("tr:last");d(n).children("td,th").each(function(p,r){var q=d(this).attr("colspan");if(m>=j){return false}d(this).appendTo(k);if(typeof q==="undefined"){m=m+1}else{m+=parseInt(q,10)}})});f.appendTo(g)},createBdTpl:function(j,l){var e=this,i=e.sourceTable,h=i.find("tbody:eq(0)>tr"),k={},g=document.createDocumentFragment(),f=d(g);h.each(function(r,q){var n=d(this),p=n.get(0).cloneNode(false),s=n.children("td,th"),o=0,m;d(p).addClass("CTF CTF"+r).removeAttr("id");f.append(p);m=f.children("tr:last");s.each(function(v,A){var t=d(this),y=t.attr("colspan"),x=t.attr("rowspan"),z={},w;if(o>=l){return false}if(typeof x!="undefined"){x=parseInt(x,10);z={six:v,rowspan:x};for(var u=1;u<x;u++){if(v==0){k[(r+u)+(v+1).toString()]=z}else{k[(r+u)+v.toString()]=z}}}if(typeof y==="undefined"){o=o+1}else{o+=parseInt(y,10)}w=r+(v+1).toString();if(w in k){o=o+1}t.appendTo(m)})});f.appendTo(j)},setWidth:function(k,j,h){var e=this.colWidth(),g=0,f;for(f=k;f<h;f++){g=g+e[f]}g=g*100;d(j).css("width",g+"%")},setHeight:function(){var e=this,h=e.freezeType(),g=e.selector().find("div.js-fixed-table:eq(0)>table>thead>tr,div.js-fixed-table:eq(0)>table>tbody>tr"),f=e.selector().find("div.js-roll-table>table>thead>tr,div.js-roll-table>table>tbody>tr"),i=e.selector().find("div.js-fixed-table:eq(1)>table>thead>tr,div.js-fixed-table:eq(1)>table>tbody>tr");g.each(function(n,m){var l=f.eq(n),o=i.eq(n),k=d(m),j;j=Math.max(k.prop("offsetHeight"),l.prop("offsetHeight"));if(h=="both"){j=Math.max(j,o.prop("offsetHeight"))}k.height(j);l.height(j);if(h=="both"){o.height(j)}})},freezeType:function(){var e=this,f;f=e.attrProp(e.selector(),"freezeType")||"prev";return f},freezeCols:function(){var e=this,f;f=e.attrProp(e.selector(),"freezeCols")||1;f=f.split(",");return f},needHoverClass:function(){var e=this.boolProp(this.selector().find("table").eq(0),"needHoverClass");!e&&(e=true);return e},hoverClass:function(){var e=this.attrProp(this.selector().find("table").eq(0),"hoverClass");!e&&(e="compTFHover");return e},tableWidth:function(){var e=this,f=e.selector().prop("offsetWidth");return f},rowHeight:function(){var e=this,f=e.selector().find("table tr"),g=[];f.each(function(){g.push(d(this).prop("offsetHeight")+"px")});return g},scrollWidth:function(){var e=this;return e.selector().attr("scrollWidth")},colWidth:function(){var e=this,f=e.selector().find("table>thead th"),f,g=[];f.each(function(){g.push(d(this).prop("offsetWidth")/e.tableWidth())});return g},colNum:function(){var e=this,f=0;f=e.selector().find("thead>tr>th").length;return f},rowNum:function(){var e=this,f=0;f=e.selector().find("tbody>tr").length;return f},supportFreeze:function(){var e=this,f=true;if(e.freezeCols().length==0||(e.freezeCols().length==1&&(parseInt(e.freezeCols(),10)==0)||parseInt(e.freezeCols(),10)>e.colNum())||(e.freezeCols().length==2&&(parseInt(e.freezeCols()[0],10)+parseInt(e.freezeCols()[1],10)>=e.colNum()))){f=false}return f},supportScroll:function(){var e=this,f=0,g=true;d.each(e.freezeCols(),function(h,i){f=f+parseInt(i,10)});if(f==e.colNum()){g=false}return g},hasFixedPXWidth:function(){var f=this,h=f.selector().get(0).style.width,e=f.selector().find("table").eq(0).attr("width")||f.selector().find("table").eq(0).get(0).style.width,i=f.tdThHasFixedPXWidth(),g=true;if(h&&/%/.test(h)){if(!e||(e&&/%/.test(e))){return false}}if(!e||(e&&/%/.test(e))){return false}if(!i){return false}return true},tdThHasFixedPXWidth:function(){var e=this,f=e.selector().find("table").eq(0).find("tr").eq(0).find("th,td");f.each(function(){var g=d(this),h=g.attr("width")||g.get(0).style.width;if(!h){return false}if(h&&/%/.test(h)){return false}});return true},tTpl:function(){var e=this,f,g,i,h;f=e.selector().find("table").get(0).cloneNode(false);g=e.selector().find("thead").get(0).cloneNode(false);i=e.selector().find("tbody").get(0).cloneNode(false);d(g).appendTo(d(f));d(i).appendTo(d(f));d(f).width("100%");switch(e.freezeType()){case"prev":case"last":h='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+f.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+f.outerHTML+"</div></td></tr></table>";break;case"both":h='<table class="compTFEextraTable"><tr><td class="compTFEextraTd"><div class="{0}" style="width:100%;">'+f.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{1}" style="width:100%;">'+f.outerHTML+'</div></td><td class="compTFEextraTd"><div class="{2}" style="width:100%;">'+f.outerHTML+"</div></td></tr></table>";break}return h},beforeCreateTableCallback:function(){var e=this,f=e.selector(),g="beforeCreateTableCallback";return e.callbackProp(f,g)},afterCreateTableCallback:function(){var e=this,f=e.selector(),g="afterCreateTableCallback";return e.callbackProp(f,g)},baseTpl:'<div class="{0}" style="width:100%;"><table style="padding:0;margin:0;"><thead></thead><tbody></tbody></table></div>'});JC.f.extendObject(c.View.prototype,{init:function(){var e=this;e._model.linkTpl()},update:function(){var e=this;if(!e._model.supportScroll()){return}if(!e._model.supportFreeze()){e._model.selector().css({"overflow-x":"scroll"}).addClass("compTFAllRoll");e._model.selector().children("table").css("width","110%");return}e._model.createTplBox();e._model.detachTable()}});d(document).ready(function(){var f=0;c.autoInit&&(f=c.init());var g=d(window);g.on("resize",e);function e(){g.off("resize",e);d("div.js_compTableFreeze").each(function(){var h=c.getInstance(d(this));h&&h.fixHeight();h._model.saveWidth=h._model.selector().width()});g.data("CTFResizeTimeout")&&clearTimeout(g.data("CTFResizeTimeout"));g.data("CTFResizeTimeout",setTimeout(function(){g.off("resize",e);g.on("resize",e)},200))}})}(jQuery));return JC.TableFreeze})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));