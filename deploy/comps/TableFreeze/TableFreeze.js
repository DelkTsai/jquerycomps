(function(b,a){b(["JC.common","JC.BaseMVC"],function(){(function(d){window.JC=window.JC||{log:function(){}};JC.TableFreeze=c;function c(e){e&&(e=d(e));if(c.getInstance(e)){return c.getInstance(e)}c.getInstance(e,this);this._model=new c.Model(e);this._view=new c.View(this._model);this._init()}c.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=d(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data(c.Model._instanceName,f);return e.data(c.Model._instanceName)};c.init=function(e){var f=[];e=d(e||document);if(e&&e.length){if(e.hasClass("js_compTableFreeze")){f.push(new c(e))}else{e.find("div.js_compTableFreeze").each(function(){f.push(new c(this))})}}return f};c.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("CTableFreezeUpdate",function(f){e._model.beforeCreateTableCallback()&&e._model.beforeCreateTableCallback().call(e,e.selector());e._view.update();e._model.afterCreateTableCallback()&&e._model.afterCreateTableCallback().call(e,e.selector())})},_inited:function(){var e=d(this);e.trigger("CTableFreezeUpdate")},update:function(){this._view.update();return this},fixHeight:function(){var f=this,e=f._model.saveWidth,h=f._model.selector().prop("offsetWidth"),g=f._model.selector().find("div.js-roll-table,div.js-fixed-table");f._model.setHeight();if(e<=h){g.each(function(){d(this).find("tr").height("auto")});f._model.setHeight()}return this}};BaseMVC.buildModel(c);c.Model.prototype={init:function(){var e=this;this.sourceTable=this.selector().find("table").eq(0)},detachTable:function(){this.sourceTable.remove()},saveWidth:[],createTplBox:function(){var g=this,o=g.freezeType(),p=g.baseTpl,l,f,m,i,k,e;switch(o){case"prev":f=parseInt(g.freezeCols(),10);l=JC.f.printf(p,"js-fixed-table compTFPrevFixed")+JC.f.printf(p,"js-roll-table compTFPrevRoll");g.selector().append(l);g.setWidth(0,g.selector().find("div.js-fixed-table"),f);g.setWidth(f,g.selector().find("div.js-roll-table"),g.colNum());m=g.selector().find("div.js-fixed-table thead").eq(0);i=g.selector().find("div.js-fixed-table tbody").eq(0);k=g.selector().find("div.js-roll-table thead").eq(0);e=g.selector().find("div.js-roll-table tbody").eq(0);g.createHdTpl(m,f);g.createBdTpl(i,f);g.createHdTpl(k,g.colNum()-f);g.createBdTpl(e,g.colNum()-f);break;case"last":f=parseInt(g.freezeCols(),10);l=JC.f.printf(p,"js-roll-table compTFLastRoll")+JC.f.printf(p,"js-fixed-table compTFLastFixed");g.selector().append(l);g.setWidth(0,g.selector().find("div.js-roll-table"),g.colNum()-f);g.setWidth(g.colNum()-f,g.selector().find("div.js-fixed-table"),g.colNum());m=g.selector().find("div.js-roll-table thead").eq(0);i=g.selector().find("div.js-roll-table tbody").eq(0);k=g.selector().find("div.js-fixed-table thead").eq(0);e=g.selector().find("div.js-fixed-table tbody").eq(0);g.createHdTpl(m,g.colNum()-f);g.createBdTpl(i,g.colNum()-f);g.createHdTpl(k,f);g.createBdTpl(e,f);break;case"both":var h,j,n;f=parseInt(g.freezeCols()[0],10);h=parseInt(g.freezeCols()[1],10);l=JC.f.printf(p,"js-fixed-table compTFBothFixed")+JC.f.printf(p,"js-roll-table compTFBothRoll")+JC.f.printf(p,"js-fixed-table compTFBothFixed");g.selector().append(l);g.setWidth(0,g.selector().find("div.js-fixed-table").eq(0),f);g.setWidth(f,g.selector().find("div.js-roll-table"),f+g.colNum()-f-h);g.setWidth(f+g.colNum()-f-h,g.selector().find("div.js-fixed-table").eq(1),g.colNum());m=g.selector().find("div.js-fixed-table thead").eq(0);i=g.selector().find("div.js-fixed-table tbody").eq(0);k=g.selector().find("div.js-roll-table thead").eq(0);e=g.selector().find("div.js-roll-table tbody").eq(0);j=g.selector().find("div.js-fixed-table thead").eq(1);n=g.selector().find("div.js-fixed-table tbody").eq(1);g.createHdTpl(m,f);g.createBdTpl(i,f);g.createHdTpl(k,g.colNum()-f-h);g.createBdTpl(e,g.colNum()-f-h);g.createHdTpl(j,h);g.createBdTpl(n,h);break}g.setHeight()},createHdTpl:function(g,j){var e=this,i=e.sourceTable,h=document.createDocumentFragment(),f=d(h);i.find("thead").eq(0).children("tr").each(function(o,n){var m=0,k,l=d(n).get(0).cloneNode(false);f.append(l);k=f.children("tr:last");d(n).children("td,th").each(function(p,r){var q=d(this).attr("colspan");if(m>=j){return false}d(this).appendTo(k);if(typeof q==="undefined"){m=m+1}else{m+=parseInt(q,10)}})});f.appendTo(g)},createBdTpl:function(i,k){var e=this,h=e.sourceTable,j={},g=document.createDocumentFragment(),f=d(g);h.find("tbody").eq(0).children("tr").each(function(p,o){var n=d(o).get(0).cloneNode(false),m=0,l;f.append(n);l=f.children("tr:last");d(o).children("td,th").each(function(r,w){var u=d(this).attr("colspan"),t=d(this).attr("rowspan"),v={},s;if(m>=k){return false}if(typeof t!="undefined"){t=parseInt(t,10);v={six:r,rowspan:t};for(var q=1;q<t;q++){if(r==0){j[(p+q)+(r+1).toString()]=v}else{j[(p+q)+r.toString()]=v}}}if(typeof u==="undefined"){m=m+1}else{m+=parseInt(u,10)}s=p+(r+1).toString();if(s in j){m=m+1}d(this).appendTo(l)})});f.appendTo(i)},setWidth:function(k,j,h){var e=this.colWidth(),g=0,f;for(f=k;f<h;f++){g=g+e[f]}g=g*100-0.6;d(j).css("width",g+"%")},setHeight:function(){var e=this,h=e.freezeType(),g=e.selector().find("div.js-fixed-table").eq(0).find("tr"),f=e.selector().find("div.js-roll-table>table").find("tr"),i=e.selector().find("div.js-fixed-table").eq(1).find("table").eq(0).find("tr");g.each(function(n,m){var l=f.eq(n),o=i.eq(n),k=d(m),j;j=Math.max(k.prop("offsetHeight"),l.prop("offsetHeight"));if(h=="both"){j=Math.max(j,o.prop("offsetHeight"))}k.height(j);l.height(j);if(h=="both"){o.height(j)}})},freezeType:function(){var e=this,f;f=e.attrProp(e.selector(),"freezeType")||"prev";return f},freezeCols:function(){var e=this,f;f=e.attrProp(e.selector(),"freezeCols")||1;f=f.split(",");return f},tableWidth:function(){var e=this,f=e.selector().prop("offsetWidth");return f},rowHeight:function(){var e=this,f=e.selector().find("table tr"),g=[];f.each(function(){g.push(d(this).prop("offsetHeight")+"px")});return g},scrollWidth:function(){var e=this;return e.selector().attr("scrollWidth")},colWidth:function(){var e=this,f=e.selector().find("table>thead th"),f,g=[];f.each(function(){g.push(d(this).prop("offsetWidth")/e.tableWidth())});return g},colNum:function(){var e=this,f=0;f=e.selector().find("thead>tr>th").length;return f},rowNum:function(){var e=this,f=0;f=e.selector().find("tbody>tr").length;return f},supportFreeze:function(){var e=this,f=true;if(e.freezeCols().length==0||(e.freezeCols().length==1&&(parseInt(e.freezeCols(),10)==0)||parseInt(e.freezeCols(),10)>e.colNum())||(e.freezeCols().length==2&&(parseInt(e.freezeCols()[0],10)+parseInt(e.freezeCols()[1],10)>=e.colNum()))){f=false}return f},supportScroll:function(){var e=this,f=0,g=true;d.each(e.freezeCols(),function(h,i){f=f+parseInt(i,10)});if(f==e.colNum()){g=false}return g},hasFixedPXWidth:function(){var f=this,h=f.selector().get(0).style.width,e=f.selector().find("table").eq(0).attr("width")||f.selector().find("table").eq(0).get(0).style.width,i=f.tdThHasFixedPXWidth(),g=true;if(h&&/%/.test(h)){if(!e||(e&&/%/.test(e))){return false}}if(!e||(e&&/%/.test(e))){return false}if(!i){return false}return true},tdThHasFixedPXWidth:function(){var e=this,f=e.selector().find("table").eq(0).find("tr").eq(0).find("th,td");f.each(function(){var g=d(this),h=g.attr("width")||g.get(0).style.width;if(!h){return false}if(h&&/%/.test(h)){return false}});return true},tTpl:function(){var e=this,g,h,j,i=document.createDocumentFragment(),f=d(i);d("<div></div>").appendTo(f);g=e.selector().find("table").get(0).cloneNode(false);h=e.selector().find("thead").get(0).cloneNode(false);j=e.selector().find("tbody").get(0).cloneNode(false);d("div#t2").append(f)},beforeCreateTableCallback:function(){var e=this,f=e.selector(),g="beforeCreateTableCallback";return e.callbackProp(f,g)},afterCreateTableCallback:function(){var e=this,f=e.selector(),g="afterCreateTableCallback";return e.callbackProp(f,g)},baseTpl:'<div class="{0}"><table><thead></thead><tbody></tbody></table></div>'};BaseMVC.buildView(c);c.View.prototype={init:function(){var e=this},update:function(){var e=this;if(!e._model.supportScroll()){return}if(!e._model.supportFreeze()){e._model.selector().css({"overflow-x":"scroll"}).addClass("compTFAllRoll");e._model.selector().children("table").css("width","110%");return}e._model.createTplBox();e._model.detachTable()}};BaseMVC.build(c);d(document).ready(function(){var f=0;c.autoInit&&(f=c.init());var g=d(window);g.on("resize",e);function e(){g.off("resize",e);d("div.js_compTableFreeze").each(function(){var h=c.getInstance(d(this));h&&h.fixHeight();h._model.saveWidth=h._model.selector().width()});g.data("CTFResizeTimeout")&&clearTimeout(g.data("CTFResizeTimeout"));g.data("CTFResizeTimeout",setTimeout(function(){g.off("resize",e);g.on("resize",e)},200))}})}(jQuery));return JC.TableFreeze})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));