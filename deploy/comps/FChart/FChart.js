(function(define,_win){define("JC.FChart",["JC.BaseMVC","swfobject","plugins.json2","jquery.mousewheel"],function(){JC.use&&!window.swfobject&&JC.use("plugins.swfobject");JC.use&&!window.JSON&&JC.use("plugins.jsons");JC.use&&!jQuery.event.special.mousewheel&&JC.use("plugins.jquery.mousewheel");var _jdoc=$(document),_jwin=$(window);JC.FChart=FChart;function FChart(_selector){_selector&&(_selector=$(_selector));if(JC.BaseMVC.getInstance(_selector,FChart)){return JC.BaseMVC.getInstance(_selector,FChart)}JC.BaseMVC.getInstance(_selector,FChart,this);this._model=new FChart.Model(_selector);this._view=new FChart.View(this._model);this._init()}FChart.init=function(_selector){var _r=[];_selector=$(_selector||document);if(_selector.length){if(_selector.hasClass("js_compFChart")){_r.push(new FChart(_selector))}else{_selector.find("div.js_compFChart").each(function(){_r.push(new FChart(this))})}}return _r};JC.BaseMVC.build(FChart);JC.f.extendObject(FChart.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var _p=this;_p.on("inited",function(){var _data=_p._model.parseInitData();if(_data){_p.trigger(FChart.Model.UPDATE_CHART_DATA,[_data])}_p._model.height()&&_p.selector().css({height:_p._model.height()});if(!_p._model.chartScroll()||_p._model.type().toLowerCase()=="map"){_p.selector().on("mousewheel",function(_evt){var _swf=$("#"+_p.gid());if(_evt.deltaY&&_swf&&_swf.prop("apiReady")&&_swf.prop("updateMouseWheel")){_swf[0].updateMouseWheel(_evt.deltaY)}return false})}});_p.on(FChart.Model.UPDATE_CHART_DATA,function(_evt,_data){_p.trigger(FChart.Model.CLEAR);_p._view.update(_data);_p._model.chartSize({width:_p._model.width(),height:_p._model.height()})});_p.on(FChart.Model.CLEAR,function(_evt){_p.trigger(FChart.Model.CLEAR_STATUS);_p._view&&_p._view.clear()});_p._model.chartSize({width:_p._model.width(),height:_p._model.height()})},_inited:function(){this.trigger("inited")},update:function(_data){this.trigger(FChart.Model.UPDATE_CHART_DATA,_data);return this},gid:function(){return this._model.gid()}});FChart.Model._instanceName="JCFChart";FChart.Model.INS_COUNT=1;FChart.Model.CLEAR="clear";FChart.Model.CLEAR_STATUS="clear_status";FChart.Model.UPDATE_CHART_DATA="update_data";FChart.Model.SWF_FILE_MAP=null;FChart.Model.FLASH_PATH="{0}/swf/{1}.swf?{2}";FChart.Model.VERSION="fchart";JC.pathPostfix&&(FChart.Model.VERSION="v="+JC.pathPostfix);window.requirejs&&window.requirejs.s&&window.requirejs.s.contexts&&window.requirejs.s.contexts._&&window.requirejs.s.contexts._.config&&window.requirejs.s.contexts._.config.urlArgs&&(FChart.Model.VERSION=window.requirejs.s.contexts._.config.urlArgs);FChart.Model.TYPE_MAP={line:"CurveGram",curvegram:"CurveGram",bar:"Histogram",histogram:"Histogram",vbar:"VHistogram",hbar:"VHistogram",vhistogram:"VHistogram",column:"ZHistogram",zbar:"ZHistogram",zhistogram:"ZHistogram",hcolumn:"VZHistogram",mix:"MixChart",map:"Map",trend:"Trend",Trend:"Trend",pie:"PieGraph",piegraph:"PieGraph",dount:"Dount",ddount:"DDount",ndount:"NDount",stack:"Stack",hstack:"HStack",rate:"Rate"};JC.f.extendObject(FChart.Model.prototype,{init:function(){this._gid="jchart_gid_"+(FChart.Model.INS_COUNT++);this.afterInit&&this.afterInit()},chartScroll:function(){var _r=true;this.is("[chartScroll]")&&(_r=this.boolProp("chartScroll"));return _r},parseInitData:function(){var _p=this,_data;if(_p.selector().attr("chartScriptData")){_data=_p.selectorProp("chartScriptData").html()}else{if(_p.selector().is("[chartDataVar]")){_data=_p.windowProp("chartDataVar");_data&&(_data=JSON.stringify(_data))}}if(_data){_data=_data.replace(/^[\s]*?\/\/[\s\S]*?[\r\n]/gm,"");_data=_data.replace(/[\r\n]/g,"");_data=_data.replace(/\}[\s]*?,[\s]*?\}$/g,"}}");_data=eval("("+_data+")")}return _data},data:function(_data){typeof _data!="undefined"&&(this._data=_data);return this._data},gid:function(){return this._gid},width:function(){if(typeof this._width=="undefined"){this._width=this.selector().prop("offsetWidth");this.is("[chartWidth]")&&(this._width=this.intProp("chartWidth")||this._width)}return this._width},height:function(){if(typeof this._height=="undefined"){this._height=this.selector().prop("offsetHeight")||400;this.is("[chartHeight]")&&(this._height=this.intProp("chartHeight")||this._height)}return this._height},sourceWidth:function(){if(typeof this._sourceWidth=="undefined"){this.is("[chartWidth]")&&(this._sourceWidth=this.intProp("chartWidth")||this._sourceWidth)}return this._sourceWidth||"100%"},chartSize:function(_setter){typeof _setter!="undefined"&&(this._chartSize=_setter);return this._chartSize},stage:function(){},stageCorner:function(){return 18},clear:function(){var _p=this,_k;for(_k in _p){if(/^\_/.test(_k)){if(_k=="_selector"){continue}if(_k=="_gid"){continue}_p[_k]=undefined}}_p.afterClear&&_p.afterClear()},clearStatus:function(){},chartType:function(){var _r="";this.data()&&this.data().chart&&this.data().chart.type&&(_r=this.data().chart.type);return(_r||"").toString().toLowerCase()},typeMap:function(_type){return FChart.Model.TYPE_MAP[_type]},type:function(){return this.typeMap(this.chartType())||""},path:function(){var _path=JC.FCHART_PATH;if(!_path){if(JC.use){_path=JC.PATH+"/comps/FChart/"}else{_path=JC.PATH+"/modules/JC.FChart/0.1/"}}var _p=this,_r=JC.f.printf(_p.attrProp("chartPath")||FChart.Model.FLASH_PATH,_path,_p.type(),FChart.Model.VERSION);_r=this.checkFileMap()||_r;return _r},checkFileMap:function(){var _r="";if(window.FCHART_SWF_FILE_MAP){this.chartType() in window.FCHART_SWF_FILE_MAP&&(_r=window.FCHART_SWF_FILE_MAP[this.chartType()]);this.type() in window.FCHART_SWF_FILE_MAP&&(_r=window.FCHART_SWF_FILE_MAP[this.type()])}if(JC.FCHART_SWF_FILE_MAP){this.chartType() in JC.FCHART_SWF_FILE_MAP&&(_r=JC.FCHART_SWF_FILE_MAP[this.chartType()]);this.type() in JC.FCHART_SWF_FILE_MAP&&(_r=JC.FCHART_SWF_FILE_MAP[this.type()])}if(FChart.Model.SWF_FILE_MAP){this.chartType() in FChart.Model.SWF_FILE_MAP&&(_r=FChart.Model.SWF_FILE_MAP[this.chartType()]);this.type() in FChart.Model.SWF_FILE_MAP&&(_r=FChart.Model.SWF_FILE_MAP[this.type()])}_r&&(_r=JC.f.printf("{0}?v={1}",_r,FChart.Model.VERSION));return _r}});JC.f.extendObject(FChart.View.prototype,{init:function(){var _p=this},draw:function(_data){if(!this._model.type()){return}var _p=this,_path=_p._model.path(),_fpath=_path.replace(/([^\:]|)[\/]+/g,"$1/"),_element=$("#"+_p._model.gid()),_dataStr=JSON.stringify(_data);if(!$("#"+_p._model.gid()).length){_element=$(JC.f.printf('<span id="{0}"></span>',_p._model.gid()));_element.appendTo(_p.selector())}var _flashVar={chart:encodeURIComponent(_dataStr)},_flashParams={wmode:"transparent",allowScriptAccess:"always"},_flashAttrs={id:_p._model.gid(),name:_p._model.gid()};swfobject.embedSWF(_fpath,_p._model.gid(),_p._model.sourceWidth(),_p._model.height(),"10","",_flashVar,_flashParams,_flashAttrs)},width:function(){return this._model.width()},height:function(){return this._model.height()},stage:function(){return this._model.stage()},selector:function(){return this._model.selector()},clear:function(){var _p=this;if(!_p._model._stage){return}$(_p._model._stage.canvas).remove();_p._model._stage=undefined},clearStatus:function(){},update:function(_data){var _p=this;_p.clear();_p._model.clear();_p._model.data(_data);_p.draw(_data)}});_jdoc.ready(function(){JC.f.safeTimeout(function(){FChart.autoInit&&FChart.init()},null,"winFCHARTInit",1)});return JC.FChart})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));