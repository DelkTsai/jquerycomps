(function(b,a){b(["JC.BaseMVC"],function(){JC.Paginator=c;function c(d){d&&(d=$(d));if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.init=function(d){var e=[];d=$(d||document);if(d.length){if(d.hasClass("js_compPaginator")){e.push(new c(d))}else{d.find(".js_compPaginator").each(function(){e.push(new c(this))})}}return e};BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var d=this,e=d._model.selector();d._model.requestUrl=d._model.url();d._view.paginatedView();if(d._model.needInit()){d._model.fetch()}e.delegate(".js_page","click",function(g){g.preventDefault();var f=$(this);d.trigger("GOTOPAGE",[f.text(),f])}).delegate(".js_prevpage","click",function(f){f.preventDefault();d.trigger("PREVPAGE")}).delegate(".js_nextpage","click",function(f){f.preventDefault();d.trigger("NEXTPAGE")}).delegate(".js_perpage","change",function(f){d._model.currentPage=1;d.trigger("UPDATEVIEW",[$(this).val()])});d.on("RENDER",function(g,f){d._view.contentView(f)});d.on("RENDERSTATIC",function(f){d._view.staticContentView()});d.on("PREVPAGE",function(){d._model.prevPage()});d.on("NEXTPAGE",function(){d._model.nextPage()});d.on("GOTOPAGE",function(h,g,f){d._model.gotoPage(g)});d.on("UPDATEVIEW",function(g,f){d._view.paginatedView(f);d._model.selector().attr("perPage",f);d._model.fetch(f)});d.on("FLIPPED",function(g,f){d._model.flipped()&&d._model.flipped().call(d,d.selector(),f)})},_inited:function(){}});c.Model._instanceName="Paginator";JC.f.extendObject(c.Model.prototype,{needInit:function(){return this.boolProp("needInit")},paginatortype:function(){return this.attrProp("paginatortype")||"ajax"},paginatorUi:function(){var e=this,d=e.attrProp("paginatorui")||".page";return e.selector().find(d)},paginatorContent:function(){var e=this,d=e.attrProp("paginatorcontent")||".content";return e.selector().find(d)},paginatorContentTpl:function(){return JC.f.scriptContent(this.attrProp("paginatorContentTpl"))},paginatorUiTpl:function(){return JC.f.scriptContent(this.attrProp("paginatorUiTpl"))},url:function(){return this.attrProp("paginatorurl")},requestUrl:"",currentPage:1,perPage:function(){return(this.intProp("perPage")||10)},maxPage:function(){return(this.intProp("maxPage")||10)},totalRecords:function(){return this.intProp("totalrecords")},gotoPage:function(d){this.currentPage=parseInt(d,10);this.fetch()},prevPage:function(){var d=this;if(d.currentPage===1){return}else{d.currentPage--}d.fetch()},nextPage:function(){var e=this,d=Math.ceil(e.totalRecords()/e.perPage());if(e.currentPage===d){return}else{e.currentPage++}e.fetch()},fetch:function(){var g=this,f=g.currentPage,e=g.perPage(),d=JC.f.printf(g.requestUrl,e,f);if(g.paginatortype()==="static"){setTimeout(function(){g.trigger("RENDERSTATIC")},10)}else{$.ajax({type:"POST",url:d,success:function(h){h=$.parseJSON(h);if(!h.errorno){h.data.html&&g.trigger("RENDER",[h.data.html])}}})}},flipped:function(){var d=this,e=d.selector(),f="flipped";return d.callbackProp(e,f)}});JC.f.extendObject(c.View.prototype,{init:function(){},paginatedView:function(f){var k=this,j=k._model.paginatorUi(),e=k._model.paginatorUiTpl(),f=f||k._model.perPage(),h=Math.ceil(k._model.totalRecords()/f),d=k._model.maxPage(),l="",g;for(g=1;g<=h;g++){l+='<a href="#" class="js_page">'+g+"</a>"}e=JC.f.printf(e,h,k._model.totalRecords(),l);j.html(e).find(".js_perpage").val(f);!k._model.needInit()&&k.updateView()},contentView:function(d){var f=this,e=f._model.paginatorContent();e.html(d);f.updateView();f.trigger("FLIPPED",[d])},staticContentView:function(){var h=this,g=h._model.currentPage,d=h._model.perPage(),f=Math.ceil(h._model.totalRecords/d),e=1;h._model.paginatorContent().find("tr").each(function(i){if(i>0&&i%d===0){e++}$(this)[e===g?"show":"hide"]()});h.updateView();h.trigger("FLIPPED")},updatePaginatorView:function(e,g){var h=this,d=h._model.maxPage(),f=Math.ceil(h._model.totalRecords()/h._model.perPage()),i="";g=parseInt(g,10);if((h._model.currentPage+(d-1))>=f){return}if(g>1){i='<a href="#" class="js_page">'+(h._model.currentPage+(d-1))+"</a>"}e.next().after(i)},updateView:function(){var h=this,e=h._model.paginatorUi(),d=h._model.paginatorContent(),f=h._model.currentPage,g=Math.ceil(h._model.totalRecords()/h._model.perPage());if(f===1){e.find(".js_prevpage").prop("disabled",true).addClass("disabled")}else{e.find(".js_prevpage").prop("disabled",false).removeClass("disabled")}if(f===g){e.find(".js_nextpage").prop("disabled",true).addClass("disabled")}else{e.find(".js_nextpage").prop("disabled",false).removeClass("disabled")}e.find(".js_page").each(function(){var i=$(this);if(parseInt(i.text(),10)===f){i.addClass("cur").siblings(".js_page").removeClass("cur")}})}});$(document).ready(function(){var d=0;c.autoInit&&(d=c.init())});return JC.Paginator})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));