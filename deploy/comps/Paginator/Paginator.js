(function(b,a){b(["JC.BaseMVC"],function(){JC.Paginator=c;JC.f.addAutoInit&&JC.f.addAutoInit(c);function c(d){d&&(d=$(d));if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.init=function(d){var e=[];d=$(d||document);if(d.length){if(d.hasClass("js_compPaginator")){e.push(new c(d))}else{d.find(".js_compPaginator").each(function(){e.push(new c(this))})}}return e};BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var d=this,e=d._model.selector();if(!d._model.totalRecords()){return}d._view.paginatedView();d._view.updateContentView();e.delegate(".js_page","click",function(g){g.preventDefault();var f=$(this),h=parseInt(f.text(),10);d.trigger("GOTOPAGE",[h,f])}).delegate(".js_prevpage","click",function(f){f.preventDefault();d.trigger("PREVPAGE")}).delegate(".js_nextpage","click",function(f){f.preventDefault();d.trigger("NEXTPAGE")}).delegate(".js_perpage","change",function(f){d._model.currentPage=1;d.trigger("UPDATEVIEW",[$(this).val()])}).delegate(".js_goto","change",function(g){var f=$(this),h=f.val();if(isNaN(h)){return false}if(h>Math.ceil(d._model.totalRecords/d._model.perPage())){h=1}d.trigger("GOTOPAGE",[h,f])});d.on("RENDER",function(f){d._view.updatePaginatorView();d._view.updateContentView()});d.on("PREVPAGE",function(){d._model.prevPage()});d.on("NEXTPAGE",function(){d._model.nextPage()});d.on("GOTOPAGE",function(g,f){d._model.currentPage=f;d._view.updateContentView();d._view.updatePaginatorView()});d.on("UPDATEVIEW",function(g,f){setTimeout(function(){d._view.paginatedView(f);d._model.selector().attr("perPage",f);d._view.updateContentView()},20)});d.on("FLIPPED",function(g,f){d._model.flipped()&&d._model.flipped().call(d,d.selector(),f)})},_inited:function(){}});c.Model._instanceName="Paginator";JC.f.extendObject(c.Model.prototype,{paginatortype:function(){return this.attrProp("paginatortype")||"ajax"},paginatorUi:function(){var e=this,d=e.attrProp("paginatorui")||".page";return e.selector().find(d)},paginatorContent:function(){var e=this,d=e.attrProp("paginatorcontent")||"tbody";return e.selector().find(d)},paginatorUiTpl:function(){return'共{0}页，{1}条记录<a href="#" class="js_prevpage disabled">上一页</a>{2}<a href="#" class="js_nextpage">下一页</a>每页显示<select name="pz" class="sel sel-s js_perpage">'+this.perPageOption()+'</select>到第<input type="text" class="js_goto" style="width:60px;" />页'},currentPage:1,perPage:function(){return(this.intProp("perPage")||10)},perPageOption:function(){var e=this.attrProp("perpageitems")||"10|20|50",f,d,h="",g="";e=e.split("|");d=e.length;for(f=0;f<d;f++){g=f===this.perPage()?"selected":"";h+='<option value="'+e[f]+'"'+g+">"+e[f]+"</option>"}return h},midRange:function(){return(this.intProp("midRange")||5)},totalRecords:function(){return this.intProp("totalrecords")},prevPage:function(){var d=this;if(d.currentPage===1){return}d.currentPage--;d.trigger("RENDER")},nextPage:function(){var e=this,d=Math.ceil(e.totalRecords()/e.perPage());if(e.currentPage===d){return}e.currentPage++;e.trigger("RENDER")},flipped:function(){var d=this,e=d.selector(),f="flipped";return d.callbackProp(e,f)}});JC.f.extendObject(c.View.prototype,{init:function(){},paginatedView:function(e){var k=this,j=k._model.paginatorUi(),d=k._model.paginatorUiTpl(),e=e||k._model.perPage(),h=Math.ceil(k._model.totalRecords()/e),l="",f,g=k._model.currentPage;for(f=1;f<h;f++){l+=(f>k._model.midRange())?('<a href="javascript:;" class="js_page dn" >'+f+"</a>"):('<a href="javascript:;" class="js_page" >'+f+"</a>");if(h>k._model.midRange()){(f===1)&&(l+='<span class="dn js_firstBreak">...</span>');(f===h-1)&&(l+='<span class="js_lastBreak">...</span>')}}l+='<a href="javascript:;" class="js_page">'+h+"</a>";d=JC.f.printf(d,h,k._model.totalRecords(),l);j.html(d).find(".js_perpage").val(e);j.find(".js_page").eq(g-1).addClass("cur")},updateContentView:function(){var g=this,f=g._model.currentPage,e=g._model.perPage(),h=(f-1)*e,d=h+e;g._model.paginatorContent().find("tr").hide().slice(h,d).show();g.trigger("FLIPPED")},updatePaginatorView:function(){var f=this,n=f._model.currentPage,d=f._model.paginatorUi(),m=d.find(".js_firstBreak"),k=d.find(".js_lastBreak"),l=Math.ceil(f._model.totalRecords()/f._model.perPage()),j=f._model.midRange(),g=Math.ceil(j/2),i=l-j,e,h;e=(n-g)>0?Math.min((n-g),i):0;e=Math.max(e-1,0);h=e+j;d.find(".js_page").not(":first").not(":last").addClass("dn").slice(e,h).removeClass("dn");d.find(".js_page").eq(n-1).addClass("cur").siblings().removeClass("cur");m[n-g>1?"show":"hide"]();k[n+g>=l?"hide":"show"]();if(n===1){d.find(".js_prevpage").prop("disabled",true).addClass("disabled")}else{d.find(".js_prevpage").prop("disabled",false).removeClass("disabled")}if(n===l){d.find(".js_nextpage").prop("disabled",true).addClass("disabled")}else{d.find(".js_nextpage").prop("disabled",false).removeClass("disabled")}}});$(document).ready(function(){var d=0;c.autoInit&&(d=c.init())});return JC.Paginator})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));