(function(b,a){b(["JC.common"],function(){window.Slider=JC.Slider=e;function e(g){g&&(g=$(g));if(e.getInstance(g)){return e.getInstance(g)}e.getInstance(g,this);JC.log("Slider constructor",new Date().getTime());this._model=new f(g);switch(this._model.direction()){case"vertical":this._view=new c(this._model,this);break;default:this._view=new d(this._model,this);break}this._init()}e.prototype={_init:function(){var g=this;g._initControl();g.on("cleartinterval",function(){g._model.clearInterval();g._view.setPagePosition()});g.on("cleartimeout",function(){g._model.clearTimeout()});g._initAutoMove();g._model.initedcb()&&g.on("inited",g._model.initedcb());g.trigger("inited");return this},on:function(h,g){$(this).on(h,g);return this},trigger:function(g){$(this).trigger(g);return this},move:function(g){this._view.move(g);return this},moveTo:function(g){this._view.moveTo(g);return this},totalpage:function(){return this._model.totalpage()},pointer:function(){return this._model.pointer()},page:function(g){return this._model.page(g)},layout:function(){return this._model.layout()},find:function(g){return this._model.layout().find(g)},_initControl:function(){switch(this._model.direction()){case"vertical":this._initVerticalControl();break;default:this._initHorizontalControl();break}},_initHorizontalControl:function(){var g=this;g._model.leftbutton()&&g._model.leftbutton().on("click",function(h){g.trigger("cleartimeout");g.trigger("movetoleft");g._view.move(1)}).on("mouseenter",function(){g.trigger("controlover")}).on("mouseleave",function(){g.trigger("controlout")});g._model.rightbutton()&&g._model.rightbutton().on("click",function(h){g.trigger("cleartimeout");g.trigger("movetoright");g._view.move()}).on("mouseenter",function(){g.trigger("controlover")}).on("mouseleave",function(){g.trigger("controlout")})},_initVerticalControl:function(){var g=this},_initAutoMove:function(){var g=this;if(!g._model.automove()){return}g.on("beforemove",function(h,j,i){g.trigger("cleartimeout")});g.on("movedone",function(h,j,i){if(g._model.controlover()){return}g.trigger("automove")});g._model.layout().on("mouseenter",function(h){g.trigger("cleartimeout");g.trigger("mouseenter")});g._model.layout().on("mouseleave",function(h){g.trigger("cleartimeout");g.trigger("mouseleave");g._view.setPagePosition();g.trigger("automove")});g.on("controlover",function(){g.trigger("cleartimeout");g._model.controlover(true)});g.on("controlout",function(){g.trigger("automove");g._model.controlover(false)});g.on("movetoleft",function(){g._model.moveDirection(false)});g.on("movetoright",function(){g._model.moveDirection(true)});$(g).on("automove",function(){g._model.timeout(setTimeout(function(){g._view.moveTo(g._model.automoveNewPointer())},g._model.automovems()))});g.trigger("automove");return this}};e.autoInit=true;e.init=function(h){var g=[];h&&(h=$(h));if(h&&h.length){if(e.isSlider(h)){if(e.getInstance(h)){return[e.getInstance(h)]}g.push(new e(h))}else{h.find("div.js_autoSlider, dl.js_autoSlider, ul.js_autoSlider, ol.js_autoSlider").each(function(){if(e.isSlider(this)){if(e.getInstance($(this))){g.push(e.getInstance($(this)));return}g.push(new e($(this)))}})}}return g};e.getInstance=function(g,h){h&&g&&$(g).data("SliderIns",h);return g?$(g).data("SliderIns"):null};e.isSlider=function(g){g&&(g=$(g));return g&&(g.is("[sliderwidth]")||g.is("[sliderheight]"))};function f(g){this._layout=g;this._moveDirection=true;this._interval;this._timeout;this._init()}f.prototype={_init:function(){this.subitems();this.totalpage();JC.log(JC.f.printf("w:{0}, h:{1}, iw:{2}, ih:{3}, dr:{4}, si:{6}, hi:{5}, totalpage:{7}",this.width(),this.height(),this.itemwidth(),this.itemheight(),this.direction(),this.howmanyitem(),this.subitems().length,this.totalpage()));return this},layout:function(){return this._layout},leftbutton:function(){return this._layout.is("[sliderleft]")?$(this._layout.attr("sliderleft")):null},rightbutton:function(){return this._layout.is("[sliderright]")?$(this._layout.attr("sliderright")):null},direction:function(){return this._layout.attr("sliderdirection").toLowerCase()||"horizontal"},moveDirection:function(g){typeof g!="undefined"&&(this._moveDirection=g);JC.log("moveDirection",this._moveDirection);return this._moveDirection},howmanyitem:function(){return parseInt(this._layout.attr("sliderhowmanyitem"),10)||1},width:function(){return parseInt(this._layout.attr("sliderwidth"),10)||800},height:function(){return parseInt(this._layout.attr("sliderheight"),10)||230},itemwidth:function(){return parseInt(this._layout.attr("slideritemwidth"),10)||160},itemheight:function(){return parseInt(this._layout.attr("slideritemheight"),10)||230},loop:function(){return JC.f.parseBool(this._layout.attr("sliderloop"))},stepms:function(){return parseInt(this._layout.attr("sliderstepms"),10)||10},durationms:function(){return parseInt(this._layout.attr("sliderdurationms"),10)||300},automovems:function(){return parseInt(this._layout.attr("sliderautomovems"),10)||2000},automove:function(){return JC.f.parseBool(this._layout.attr("sliderautomove"))},defaultpage:function(){return parseInt(this._layout.attr("sliderdefaultpage"),10)||0},subitems:function(){if(this._layout.is("[slidersubitems]")){this._subitems=this._layout.find(this._layout.attr("slidersubitems"))}else{this._subitems=this._layout.children()}return this._subitems},totalpage:function(){this.subitems();if(this.howmanyitem()>1){this._totalpage=Math.ceil(this._subitems.length/this.howmanyitem())}else{this._totalpage=this._subitems.length}return this._totalpage},page:function(k){this.subitems();!k&&(k=0);k<0&&(k=0);k>=this.totalpage()&&(k=this.totalpage()-1);k*=this.howmanyitem();var j=[];for(var g=k,h=0;h<this.howmanyitem()&&g<this._subitems.length;g++,h++){j.push($(this._subitems[g]))}return j},pointer:function(g){if(typeof this._pointer=="undefined"){this._pointer=this.defaultpage()}if(typeof g!="undefined"){this._pointer=this.fixpointer(g)}return this._pointer},newpointer:function(g){var h=this.pointer();g&&h--;!g&&h++;h=this.fixpointer(h);return h},fixpointer:function(g){var h=g;if(this.loop()){h<0&&(h=this.totalpage()-1);h>=this.totalpage()&&(h=0)}else{h<0&&(h=0);h>=this.totalpage()&&(h=this.totalpage()-1)}return h},automoveNewPointer:function(){var g=this.pointer();if(this.moveDirection()){g++}else{g--}if(this.loop()){if(g>=this.totalpage()){g=0}else{if(g<0){g=this.totalpage()-1}}}else{if(g>=this.totalpage()){g=this.totalpage()-2;this.moveDirection(false)}else{if(g<0){g=1;this.moveDirection(true)}}}return g},interval:function(g){typeof g!="undefined"&&(this._interval=g);return this._interval},clearInterval:function(){this.interval()&&clearInterval(this.interval())},timeout:function(g){typeof g!="undefined"&&(this._timeout=g);return this._timeout},clearTimeout:function(){this.timeout()&&clearTimeout(this.timeout())},controlover:function(g){typeof g!="undefined"&&(this._controlover=g);return this._controlover},initedcb:function(){this._layout.is("[sliderinitedcb]")&&window[this._layout.attr("sliderinitedcb")]&&(this._initedcb=window[this._layout.attr("sliderinitedcb")]);return this._initedcb}};function d(g,h){this._model=g;this._slider=h;this._itemspace=(this._model.width()-Math.floor(this._model.width()/this._model.itemwidth())*this._model.itemwidth())/(this._model.totalpage()-1);this._itemspace=parseInt(this._itemspace);this._init()}d.prototype={_init:function(){this.setPagePosition(this._model.pointer());return this},move:function(i){var g=this;i=!!i;JC.log("HorizontalView move, is backwrad",i,this._model.pointer());var h=this._model.newpointer(i);JC.log(JC.f.printf("is backwrad: {0}, pointer:{1}, new pointer:{2}",i,this._model.pointer(),h));this.moveTo(h)},moveTo:function(j){var g=this;if(!this._model.loop()){if(j<=this._model.pointer()&&this._model.pointer()===0){$(this._slider).trigger("outmin");return}if(j>=this._model.pointer()&&this._model.pointer()>=this._model.totalpage()-1){$(this._slider).trigger("outmax");return}}j=this._model.fixpointer(j);var l=this._model.pointer();if(j===l){return}var k=this._model.page(l),i=this._model.page(j);var h=k.concat(i);this._setNewPagePosition(k,i,l,j);g._model.pointer(j)},_setNewPagePosition:function(n,j,m,l){var h=this,g,i=n.concat(j),k;$(this._slider).trigger("cleartinterval");if(m<l){g=this._model.width()+this._itemspace}else{g=-(this._model.width()+this._itemspace);k=true}m===(h._model.totalpage()-1)&&l===0&&(g=this._model.width()+this._itemspace,k=false);m===0&&l===(h._model.totalpage()-1)&&(g=-(this._model.width()+this._itemspace),k=true);$.each(j,function(q,p){var o=$(p);o.css({left:g+h._model.itemwidth()*q+h._itemspace*q+"px"});o.show()});$(h._slider).trigger("beforemove",[m,l]);$.each(i,function(p,o){o.data("TMP_LEFT",o.prop("offsetLeft"))});JC.log("zzzzzzzzzz",g,this._itemspace,this._model.moveDirection());h._model.interval(JC.f.easyEffect(function(o,p){$(i).each(function(r,q){q.css({left:q.data("TMP_LEFT")+(k?o:-o)+"px"})});if(p){$(n).each(function(r,q){q.hide()});$(h._slider).trigger("movedone",[m,l]);h._model.pointer(l);h.setPagePosition()}},this._model.width(),0,this._model.durationms(),this._model.stepms()))},setPagePosition:function(l){JC.log("view setPagePosition",new Date().getTime());typeof l=="undefined"&&(l=this._model.pointer());this._model.subitems().hide();var k=this._model.page(l);for(var h=0,g=k.length;h<g;h++){k[h].css({left:h*this._model.itemwidth()+h*this._itemspace+"px"}).show()}JC.log(k.length)}};function c(g,h){this._model=g;this._slider=h;this._itemspace=0;this._init()}c.prototype={_init:function(){this.setPagePosition(this._model.pointer());return this},move:function(h){var g=this;return this},moveTo:function(h){var g=this;return this},_setNewPagePosition:function(n,j,m,l){var h=this,g,i=n.concat(j),k;return this},setPagePosition:function(h){var g=this;JC.log("view setPagePosition",new Date().getTime());return this}};$(document).ready(function(){if(!e.autoInit){return}e.init(document.body)});return JC.Slider})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));