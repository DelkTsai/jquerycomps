(function(b,a){b(["JC.BaseMVC"],function(){var i=$(document),h=$(window),d;JC.ImageCutter=e;function e(j){j&&(j=$(j));if(JC.BaseMVC.getInstance(j,e)){return JC.BaseMVC.getInstance(j,e)}JC.BaseMVC.getInstance(j,e,this);this._model=new e.Model(j);this._view=new e.View(this._model);this._init();JC.log(e.Model._instanceName,"all inited",new Date().getTime())}e.init=function(j){var k=[];j=$(j||document);if(j.length){if(j.hasClass("js_compImageCutter")){k.push(new e(j))}else{j.find("div.js_compImageCutter").each(function(){k.push(new e(this))})}}return k};e.minRectSidelength=50;e.minImageSidelength=50;e.maxImageSidelength;e.moveStep=1;e._positionPoint=10000;e._defaultCursor="auto";e.dragInfo=function(j,l,k,m){if(j&&l&&k){e._dragInfo={ins:j,evt:l,size:j._model.size(),tmpSize:k,pageX:l.pageX,pageY:l.pageY,srcSelector:m,offset:j.selector().offset(),minDistance:j._model.minDistance(),winWidth:h.width(),winHeight:h.height(),btnSidelength:j._model.btnTl().width()}}return e._dragInfo};e.cleanInfo=function(){i.off("mouseup",e.dragMainMouseUp);i.off("mousemove",e.dragMainMouseMove);i.off("mouseup",e.dragBtnMouseUp);i.off("mousemove",e.dragBtnMouseMove);e.dragInfo(null);d.css("cursor",e._defaultCursor)};e.dragMainMouseMove=function(j){if(!(e.dragInfo()&&j)){return}var l=e.dragInfo(),k;var k=l.ins,q=l.pageX-j.pageX,o=l.pageY-j.pageY,p=l.size.dragger.left-q,m=l.size.dragger.top-o,r=l.size.maxX-l.size.dragger.srcSidelength,n=l.size.maxY-l.size.dragger.srcSidelength;p<l.size.minX&&(p=l.size.minX);p>r&&(p=r);m<l.size.minY&&(m=l.size.minY);m>n&&(m=n);l.tmpSize.dragger.left=p;l.tmpSize.dragger.top=m;k.updatePosition(l.tmpSize);k.trigger(e.Model.UPDATE_RECT,[l.tmpSize])};e.dragMainMouseUp=function(l){if(!e.dragInfo()){return}var k=e.dragInfo(),j=k.ins;d.css("cursor",e._defaultCursor);j._size(k.tmpSize);j.trigger(e.Model.UPDATE_RECT,[k.tmpSize]);j.trigger(e.Model.DRAG_DONE,[k.tmpSize]);e.cleanInfo()};e.dragBtnMouseMove=function(l){if(!(e.dragInfo()&&l)){return}var k=e.dragInfo(),j=k.ins,o=k.pageX-l.pageX,n=k.pageY-l.pageY,m=k.srcSelector.attr("diretype");switch(m){case"cic_btnTl":e.resizeTopLeft(k,o,n,l);break;case"cic_btnTc":e.resizeTopCenter(k,o,n,l);break;case"cic_btnTr":e.resizeTopRight(k,o,n,l);break;case"cic_btnMl":e.resizeMidLeft(k,o,n,l);break;case"cic_btnMr":e.resizeMidRight(k,o,n,l);break;case"cic_btnBl":e.resizeBottomLeft(k,o,n,l);break;case"cic_btnBc":e.resizeBottomCenter(k,o,n,l);break;case"cic_btnBr":e.resizeBottomRight(k,o,n,l);break}j.trigger(e.Model.UPDATE_RECT,[k.tmpSize])};e.dragBtnMouseUp=function(l){if(!e.dragInfo()){return}var k=e.dragInfo(),j=k.ins;d.css("cursor",e._defaultCursor);j._size(k.tmpSize);j.trigger(e.Model.UPDATE_RECT,[k.tmpSize]);j.trigger(e.Model.DRAG_DONE,[k.tmpSize]);e.cleanInfo()};e.defaultKeydown=function(j){if(!(j&&e._currentIns)){return}j.preventDefault();var k=j.keyCode;switch(k){case 37:e._currentIns.moveLeft();break;case 38:e._currentIns.moveUp();break;case 39:e._currentIns.moveRight();break;case 40:e._currentIns.moveDown();break}};e.defaultMouseenter=function(k){var j=$(this),l=BaseMVC.getInstance(j,e);if(!l){return}e._currentIns=l};e.defaultMouseleave=function(j){e._currentIns=null};JC.BaseMVC.build(e);JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var j=this;j.on(e.Model.INITED,function(k){j._model.coordinateSelector()&&j._model.coordinateSelector().val("");j._model.imageUrlSelector()&&j._model.imageUrlSelector().val("");j._model.imageUrl()&&j.update(j._model.imageUrl());j._model.cicInitedCb()&&j._model.cicInitedCb().call(j)});j.on(e.Model.IMAGE_LOAD,function(l,m,k,n){j.clean();j._model.imageUrl(m.attr("src"));if(j._model.maxImageSidelength()&&(k>j._model.maxImageSidelength()||n>j._model.maxImageSidelength())){j.trigger(e.Model.ERROR_SIZE,[k,n,m,true]);return}if(j._model.minImageSidelength()&&(k<j._model.minImageSidelength()||n<j._model.minImageSidelength())){j.trigger(e.Model.ERROR_SIZE,[k,n,m]);return}var o=j._model.size(k,n);if(o.preview.width<j._model.minRectSidelength()||o.preview.height<j._model.minRectSidelength()){j.trigger(e.Model.ERROR_PREVIEW,[k,n,m,o]);return}m.css({width:o.preview.width,height:o.preview.height,left:o.left,top:o.top});m.prependTo(j.selector());j._model.imageUrlSelector()&&j._model.imageUrlSelector().length&&j._model.imageUrlSelector().val(m.attr("src"));j._view.initDragger(o);j.trigger(e.Model.INIT_PREVIEW);j.trigger(e.Model.UPDATE_COORDINATE,[o]);j._model.ready(true);j._model.cicImageInitedCb()&&j._model.cicImageInitedCb().call(j,j._model.size(),m)});j.selector().on("mouseenter",e.defaultMouseenter);j.selector().on("mouseleave",e.defaultMouseleave);j.selector().delegate("div.cic_dragMain","mousedown",function(k){if(!j._model.ready()){return}k.preventDefault();k.stopPropagation();e.cleanInfo();e.dragInfo(j,k,JC.f.cloneObject(j._model.size()),$(this));d.css("cursor","move");j.trigger(e.Model.INIT_PREVIEW);i.on("mousemove",e.dragMainMouseMove);i.on("mouseup",e.dragMainMouseUp);return false});j.selector().delegate("button.cic_btn","mousedown",function(k){if(!j._model.ready()){return}k.preventDefault();e.cleanInfo();e.dragInfo(j,k,JC.f.cloneObject(j._model.size()),$(this));var m=$(this),l=m.attr("diretype");switch(l){case"cic_btnTl":d.css("cursor","nw-resize");break;case"cic_btnTc":d.css("cursor","n-resize");break;case"cic_btnTr":d.css("cursor","ne-resize");break;case"cic_btnMl":d.css("cursor","w-resize");break;case"cic_btnMr":d.css("cursor","e-resize");break;case"cic_btnBl":d.css("cursor","sw-resize");break;case"cic_btnBc":d.css("cursor","s-resize");break;case"cic_btnBr":d.css("cursor","se-resize");break}j.trigger(e.Model.INIT_PREVIEW);i.on("mousemove",e.dragBtnMouseMove);i.on("mouseup",e.dragBtnMouseUp);return false});j.on(e.Model.INIT_PREVIEW,function(k){j._view.initPreviewItems()});j.on(e.Model.UPDATE_RECT,function(l,k){j.trigger(e.Model.UPDATE_PREVIEW,[k])});j.on(e.Model.UPDATE_PREVIEW,function(l,k){if(!k){return}j._view.updatePreviewItems(k)});j.on(e.Model.DRAG_DONE,function(l,k){j.trigger(e.Model.UPDATE_COORDINATE,[k]);j._model.cicDragDoneCb()&&j._model.cicDragDoneCb().call(j,j._model.size())});j.on(e.Model.UPDATE_COORDINATE,function(n,m){var m=m||j._model.size(),k=j._model.coordinateSelector();if(!m){return}var l=j._model.realCoordinate(m);j._model.cicCoordinateUpdateCb()&&j._model.cicCoordinateUpdateCb().call(j,l,j._model.imageUrl());if(!(k&&k.length)){return}k.val(l)});j.on(e.Model.ERROR,function(l,m,k){j._model.clean();j._model.ready(false);j._model.cicErrorCb()&&j._model.cicErrorCb().call(j,m,k)});j.on(e.Model.LOAD_ERROR,function(k,l){j.clean();j._model.ready(false);j._view.imageLoadError(l);j._model.cicLoadErrorCb()&&j._model.cicLoadErrorCb().call(j,l);j.trigger(e.Model.ERROR,[e.Model.LOAD_ERROR,[l]])});j.on(e.Model.ERROR_SIZE,function(m,k,o,n,l){j._view.sizeError(k,o,n,l);j._model.cicSizeErrorCb()&&j._model.cicSizeErrorCb().call(j,k,o,n.attr("src"),l);j.trigger(e.Model.ERROR,[e.Model.ERROR_SIZE,[k,o,n,l]])});j.on(e.Model.ERROR_PREVIEW,function(l,k,n,m,o){j._view.previewError(k,n,m,o);j._model.cicPreviewSizeErrorCb()&&j._model.cicPreviewSizeErrorCb().call(j,k,n,m.attr("src"),o);j.trigger(e.Model.ERROR,[e.Model.ERROR_PREVIEW,[k,n,m,o]])})},_inited:function(){this.trigger(e.Model.INITED)},update:function(j){if(!j){return}this._view.update(j);return this},clean:function(){e.cleanInfo();this._view.clean();this._model.clean();return this},updatePosition:function(){this._view.updatePosition.apply(this._view,JC.f.sliceArgs(arguments));return this},_size:function(){this._model.size.apply(this._model,JC.f.sliceArgs(arguments))},moveLeft:function(){this._view.moveLeft.apply(this._view,JC.f.sliceArgs(arguments))},moveUp:function(){this._view.moveUp.apply(this._view,JC.f.sliceArgs(arguments))},moveRight:function(){this._view.moveRight.apply(this._view,JC.f.sliceArgs(arguments))},moveDown:function(){this._view.moveDown.apply(this._view,JC.f.sliceArgs(arguments))}});e.Model._instanceName="JCImageCutter";e.Model.INITED="ImageCutterInited";e.Model.INIT_PREVIEW="CICInitPreview";e.Model.DRAG_DONE="CICDragDone";e.Model.UPDATE_RECT="CICUpdateDragger";e.Model.UPDATE_PREVIEW="CICUpdatePreview";e.Model.UPDATE_COORDINATE="CICUpdateCoordinate";e.Model.IMAGE_LOAD="CICImageLoad";e.Model.LOAD_ERROR="CICImageLoadError";e.Model.ERROR="CICError";e.Model.ERROR_SIZE="CICSizeError";e.Model.ERROR_PREVIEW="CICPreviewError";JC.f.extendObject(e.Model.prototype,{init:function(){var j=this},ready:function(j){typeof j!="undefined"&&(this._ready=j);return this._ready},imageUrl:function(j){j&&this.selector().attr("imageUrl",j);return this.attrProp("imageUrl")},cicImageInitedCb:function(){return this.callbackProp("cicImageInitedCb")},cicInitedCb:function(){return this.callbackProp("cicInitedCb")},cicDragDoneCb:function(){return this.callbackProp("cicDragDoneCb")},cicErrorCb:function(){return this.callbackProp("cicErrorCb")},cicLoadErrorCb:function(){return this.callbackProp("cicLoadErrorCb")},cicSizeErrorCb:function(){return this.callbackProp("cicSizeErrorCb")},cicPreviewSizeErrorCb:function(){return this.callbackProp("cicPreviewSizeErrorCb")},previewSelector:function(j){if(this.is("[previewSelector]")&&(!this._previewSelector||j)){this._previewSelector=this.selectorProp("previewSelector")}return this._previewSelector},minRectSidelength:function(){return this.intProp("minRectSidelength")||e.minRectSidelength},minImageSidelength:function(){return this.intProp("minImageSidelength")||e.minImageSidelength},maxImageSidelength:function(){return this.intProp("maxImageSidelength")||e.maxImageSidelength},minDistance:function(){return g({x:0,y:0},{x:this.minRectSidelength(),y:this.minRectSidelength()})},size:function(j,k){if(j&&k){this._size.img={width:j,height:k};this._size.preview={width:j,height:k};if(j>this._size.selector.width||k>this._size.selector.height){this._size.preview=f(j,k,this._size.selector.width,this._size.selector.height)}this._size.preview.width=Math.round(this._size.preview.width);this._size.preview.height=Math.round(this._size.preview.height);this._size.left=Math.round((this._size.selector.width-this._size.preview.width)/2);this._size.top=Math.round((this._size.selector.height-this._size.preview.height)/2);this._size.width=j;this._size.height=k;this._size.minX=this._size.left;this._size.maxX=(this._size.minX+this._size.preview.width);this._size.minY=this._size.top;this._size.maxY=(this._size.minY+this._size.preview.height);this._size.dragger={srcSidelength:0,sidelength:0,halfSidelength:0,left:0,top:0}}if(j&&!k){this._size=j}return this._size},realCoordinate:function(l){var q=[];if(l){var j=this,m=l.img.width/l.preview.width,n=(l.dragger.left-l.left)*m,p=(l.dragger.top-l.top)*m,o=l.dragger.srcSidelength*m,k;n=Math.ceil(n);p=Math.ceil(p);o=Math.ceil(o);n<0&&(n=0);p<0&&(p=0);(n+o)>l.img.width&&(n=l.img.width-o);(p+o)>l.img.height&&(p=l.img.height-o);if(o>l.img.width){k=o-l.img.width;o=l.img.width;p!==0&&(p+=k);n+=k}if(o>l.img.height){k=o-l.img.height;o=l.img.height;n!==0&&(n+=k);p+=k}q.push(n,p,o,o,l.img.width,l.img.height)}return q},cicCoordinateUpdateCb:function(){return this.callbackProp("cicCoordinateUpdateCb")},clean:function(){var j=this;this._size={selector:{width:j.selector().prop("offsetWidth"),height:j.selector().prop("offsetHeight")},img:{width:0,height:0},preview:{width:0,height:0},left:0,top:0};this.previewSelector()&&this.previewSelector().each(function(){$(this).html("")});this.coordinateSelector()&&this.coordinateSelector().val("");this.imageUrlSelector()&&this.imageUrlSelector().val("");j.ready(false)},draggerList:function(){if(!this._draggerList){this._draggerList=$(JC.f.printf("{0}{1}{2}{3}{4}{5}{6}{7}{8}",'<button type="button" class="cic_btn cic_btnTl" diretype="cic_btnTl" ></button>','<button type="button" class="cic_btn cic_btnTc" diretype="cic_btnTc" ></button>','<button type="button" class="cic_btn cic_btnTr" diretype="cic_btnTr" ></button>','<button type="button" class="cic_btn cic_btnMl" diretype="cic_btnMl" ></button>','<button type="button" class="cic_btn cic_btnMr" diretype="cic_btnMr" ></button>','<button type="button" class="cic_btn cic_btnBl" diretype="cic_btnBl" ></button>','<button type="button" class="cic_btn cic_btnBc" diretype="cic_btnBc" ></button>','<button type="button" class="cic_btn cic_btnBr" diretype="cic_btnBr" ></button>'));this._draggerList.hide().appendTo(this.selector())}return this._draggerList},btnTl:function(){!this._btnTl&&(this.draggerList(),this._btnTl=this.selector().find("button.cic_btnTl"));return this._btnTl},btnTc:function(){!this._btnTc&&(this.draggerList(),this._btnTc=this.selector().find("button.cic_btnTc"));return this._btnTc},btnTr:function(){!this._btnTr&&(this.draggerList(),this._btnTr=this.selector().find("button.cic_btnTr"));return this._btnTr},btnMl:function(){!this._btnMl&&(this.draggerList(),this._btnMl=this.selector().find("button.cic_btnMl"));return this._btnMl},btnMr:function(){!this._btnMr&&(this.draggerList(),this._btnMr=this.selector().find("button.cic_btnMr"));return this._btnMr},btnBl:function(){!this._btnBl&&(this.draggerList(),this._btnBl=this.selector().find("button.cic_btnBl"));return this._btnBl},btnBc:function(){!this._btnBc&&(this.draggerList(),this._btnBc=this.selector().find("button.cic_btnBc"));return this._btnBc},btnBr:function(){!this._btnBr&&(this.draggerList(),this._btnBr=this.selector().find("button.cic_btnBr"));return this._btnBr},maskList:function(){if(!this._maskList){this._maskList=$(JC.f.printf("{0}{1}{2}{3}",'<div class="cic_mask cic_maskLeft"></div>','<div class="cic_mask cic_maskTop"></div>','<div class="cic_mask cic_maskRight"></div>','<div class="cic_mask cic_maskBottom"></div>'));this._maskList.hide().appendTo(this.selector())}return this._maskList},maskLeft:function(){!this._maskLeft&&(this.maskList(),this._maskLeft=this.selector().find("div.cic_maskLeft"));return this._maskLeft},maskTop:function(){!this._maskTop&&(this.maskList(),this._maskTop=this.selector().find("div.cic_maskTop"));return this._maskTop},maskRight:function(){!this._maskRight&&(this.maskList(),this._maskRight=this.selector().find("div.cic_maskRight"));return this._maskRight},maskBottom:function(){!this._maskBottom&&(this.maskList(),this._maskBottom=this.selector().find("div.cic_maskBottom"));return this._maskBottom},dragMain:function(){if(!this._dragMain){this._dragMain=$('<div class="cic_dragMain"></div>');this._dragMain.hide().appendTo(this.selector())}return this._dragMain},cicErrorBox:function(){if(!this._cicErrorBox){this._cicErrorBox=$('<div class="CIC_ERROR"></div>');this._cicErrorBox.appendTo(this.selector())}return this._cicErrorBox},coordinateSelector:function(){return this.selectorProp("coordinateSelector")},defaultCoordinate:function(){var j=this,l="",k=this.attrProp("defaultCoordinate");if(k){l=k.replace(/[^\d,\-]+/g,"");if(l){l=l.split(",");$.each(l,function(n,m){l[n]=parseInt(m,10)})}}return l},imageUrlSelector:function(){return this.selectorProp("imageUrlSelector")}});JC.f.extendObject(e.View.prototype,{init:function(){var j=this},clean:function(){this.selector().find("img").remove();this.selector().find("button").hide();this._model.maskList().hide();this._model.cicErrorBox().hide()},update:function(m){if(!m){return}var j=this,l=document.createElement("img"),k=$(l);j.clean();k.on("load",function(){j.trigger(e.Model.IMAGE_LOAD,[k,this.width,this.height])});k.on("error",function(){j.trigger(e.Model.LOAD_ERROR,[m])});k.on("mousedown",function(n){n.preventDefault();return false});l.src=m},initDragger:function(o){this._model.dragMain();this._model.maskList();var k=this,j=k._model.draggerList(),n=o.preview.width>o.preview.height?o.preview.height:o.preview.width,n=n/2>k._model.minRectSidelength()?n/2:k._model.minRectSidelength(),n=Math.ceil(n),n=n>k._model.minRectSidelength()?n:k._model.minRectSidelength(),m=k._model.btnTl().width(),q=n,n=n-m,l=n/2,r=o.left+(o.preview.width-n)/2-m/2,p=o.top+(o.preview.height-n)/2-m/2;o.dragger={srcSidelength:q,sidelength:n,halfSidelength:l,left:r,top:p};o=k.processDefaultCoordinate(o);k.updatePosition(o)},processDefaultCoordinate:function(o){var j=this,k=j._model.defaultCoordinate(),m=j._model.btnTl().width();if(k.length){var q=o.dragger.srcSidelength,n=o.dragger.sidelength,l=o.dragger.halfSidelength,r=o.left,p=o.top;switch(k.length){case 1:q=k[0];r=o.left+(o.preview.width-q)/2;p=o.top+(o.preview.height-q)/2;break;case 2:r=k[0];p=k[1];break;case 3:r=k[0]+o.left;p=k[1]+o.top;q=k[2];break}if(q>o.preview.width||q>o.preview.height){q=o.preview.width>o.preview.height?o.preview.height:o.preview.width;r=o.left+(o.preview.width-q)/2;p=o.top+(o.preview.height-q)/2}if(r<o.left||(r+q)>(o.left+o.preview.width)||p<o.top||(p+q)>(o.top+o.preview.height)){r=o.left+(o.preview.width-q)/2;p=o.top+(o.preview.height-q)/2}n=q-m;l=n/2;if(q<j._model.minRectSidelength()){q=j._model.minRectSidelength();n=q-m;l=n/2;r=o.left+(j.preview.width-q)/2;p=o.top+(j.preview.height-q)/2}o.dragger={srcSidelength:q,sidelength:n,halfSidelength:l,left:r,top:p}}return o},updatePosition:function(k){var j=this;j.updateDragger(k);j.updateMask(k);j.updateDragMain(k)},updateDragger:function(k){var j=this;j._model.btnTl().css({left:k.dragger.left,top:k.dragger.top});j._model.btnTc().css({left:(k.dragger.left+k.dragger.halfSidelength),top:k.dragger.top});j._model.btnTr().css({left:(k.dragger.left+k.dragger.sidelength),top:k.dragger.top});j._model.btnMl().css({left:k.dragger.left,top:(k.dragger.top+k.dragger.halfSidelength)});j._model.btnMr().css({left:k.dragger.left+k.dragger.sidelength,top:(k.dragger.top+k.dragger.halfSidelength)});j._model.btnBl().css({left:k.dragger.left,top:k.dragger.top+k.dragger.sidelength});j._model.btnBc().css({left:k.dragger.left+k.dragger.halfSidelength,top:k.dragger.top+k.dragger.sidelength});j._model.btnBr().css({left:k.dragger.left+k.dragger.sidelength,top:k.dragger.top+k.dragger.sidelength});j._model.draggerList().show()},updateMask:function(k){var j=this,l=j._model.maskList();j._model.maskLeft().css({height:k.dragger.srcSidelength,width:k.dragger.left,top:k.dragger.top,left:0});j._model.maskTop().css({height:k.dragger.top,width:k.selector.width,top:0,left:0});j._model.maskRight().css({left:k.dragger.left+k.dragger.srcSidelength,top:k.dragger.top,width:k.selector.width-k.dragger.left-k.dragger.srcSidelength,height:k.dragger.srcSidelength});j._model.maskBottom().css({height:k.selector.height-(k.dragger.top+k.dragger.srcSidelength),width:k.selector.width,top:k.dragger.top+k.dragger.srcSidelength,left:0});l.show()},updateDragMain:function(l){var j=this,k=j._model.dragMain();k.css({width:l.dragger.srcSidelength,height:l.dragger.srcSidelength,left:l.dragger.left,top:l.dragger.top});k.show()},initPreviewItems:function(){var j=this,k=j._model.previewSelector(true);if(!(k&&k.length)){return}if(!j._model.ready()){k.each(function(){var l=$(this),m=l.find("img");if(!m.length){m=$(JC.f.printf('<img src="{0}" />',j._model.imageUrl()));m.appendTo(l)}else{m.attr("src",j._model.imageUrl())}})}j.trigger(e.Model.UPDATE_RECT,[j._model.size()])},updatePreviewItems:function(k){var j=this,l=j._model.previewSelector();if(!k){return}if(!(l&&l.length)){return}l.each(function(){var o=$(this),m=o.width(),r=o.find("img");if(!(m&&r.length)){return}var m=o.width(),q=m/k.dragger.srcSidelength,t=Math.ceil(k.preview.width*q),n=Math.ceil(k.preview.height*q),p=Math.ceil((k.dragger.left-k.left)*q),s=Math.ceil((k.dragger.top-k.top)*q);r.css({width:t,height:n,left:-p,top:-s,"max-width":t,"min-width":t,"max-height":n,"min-height":n})})},moveLeft:function(){if(!this._model.ready()){return}var j=this,k=j._model.size();k.dragger.left-=e.moveStep;k.dragger.left<k.left&&(k.dragger.left=k.left);j.updatePosition(k);j.trigger(e.Model.UPDATE_RECT,[k]);j.trigger(e.Model.DRAG_DONE,[k])},moveUp:function(){if(!this._model.ready()){return}var j=this,k=j._model.size();k.dragger.top-=e.moveStep;k.dragger.top<k.top&&(k.dragger.top=k.top);j.updatePosition(k);j.trigger(e.Model.UPDATE_RECT,[k]);j.trigger(e.Model.DRAG_DONE,[k])},moveRight:function(){if(!this._model.ready()){return}var j=this,k=j._model.size();k.dragger.left+=e.moveStep;(k.dragger.left+k.dragger.srcSidelength)>(k.left+k.preview.width)&&(k.dragger.left=k.left+k.preview.width-k.dragger.srcSidelength);j.updatePosition(k);j.trigger(e.Model.UPDATE_RECT,[k]);j.trigger(e.Model.DRAG_DONE,[k])},moveDown:function(){if(!this._model.ready()){return}var j=this,k=j._model.size();k.dragger.top+=e.moveStep;(k.dragger.top+k.dragger.srcSidelength)>(k.top+k.preview.height)&&(k.dragger.top=k.top+k.preview.height-k.dragger.srcSidelength);j.updatePosition(k);j.trigger(e.Model.UPDATE_RECT,[k]);j.trigger(e.Model.DRAG_DONE,[k])},sizeError:function(j,m,l,k){var o,n;if(k){o=this._model.maxImageSidelength();n="大"}else{o=this._model.minImageSidelength();n="小"}this._model.cicErrorBox().show().html(JC.f.printf("{5}<p>图片实际宽高为: {2}, {3}</p><p>可接受的最"+n+"宽高为: {0}, {1}</p>{4}",o,o,j,m,'<a href="'+l.attr("src")+'" target="_blank">查看图片</a>',"<h3>图片尺寸错误 </h3>"))},previewError:function(j,l,k,m){this._model.cicErrorBox().show().html(JC.f.printf("{5}<p>图片实际宽高为: {2}, {3}</p><p>图片缩放后宽高为: {6}, {7}</p><p>缩放后可接受的最小宽高为: {0}, {1}</p>{4}",this._model.minRectSidelength(),this._model.minRectSidelength(),j,l,'<a href="'+k.attr("src")+'" target="_blank">查看图片</a>',"<h3>图片缩放比例错误 </h3>",m.preview.width,m.preview.height))},imageLoadError:function(j){this._model.cicErrorBox().show().html(JC.f.printf("<p>无法加载图片<br/>请检查图片路径和网络链接</p><p>{0}</p>",j))}});e.resizeTopLeft=function(m,r,p,j){if(!m){return}var k=m.ins,t=m.size.dragger.left+m.size.dragger.srcSidelength,q=m.size.dragger.top+m.size.dragger.srcSidelength,s=Math.ceil(g({x:m.pageX,y:m.pageY},{x:0,y:-e._positionPoint})),n=Math.ceil(g({x:j.pageX,y:j.pageY},{x:0,y:-e._positionPoint})),l=s-n,o=m.size.dragger.srcSidelength+l;if((q-o)<m.size.top){o=q-m.size.top}if((t-o)<m.size.left){o=t-m.size.left}o=o<k._model.minRectSidelength()?k._model.minRectSidelength():o;m.tmpSize.dragger={srcSidelength:o,sidelength:o-m.btnSidelength,halfSidelength:(o-m.btnSidelength)/2,left:t-o,top:q-o};k.updatePosition(m.tmpSize)};e.resizeTopCenter=function(m,t,q,j){if(!m){return}var k=m.ins,u=m.size.left+m.size.preview.width,r=m.size.dragger.top+m.size.dragger.srcSidelength,n=m.size.dragger.left+(m.size.dragger.srcSidelength)/2,s=Math.ceil(g({x:m.pageX,y:m.pageY},{x:m.pageX,y:-e._positionPoint})),o=Math.ceil(g({x:j.pageX,y:j.pageY},{x:m.pageX,y:-e._positionPoint})),l=(s-o),p=m.size.dragger.srcSidelength+l;if((r-p)<m.size.top){p=r-m.size.top}if((n-p/2)<m.size.left){p=(n-m.size.left)*2}if((n+p/2)>u){p=(u-n)*2}p=p<k._model.minRectSidelength()?k._model.minRectSidelength():p;m.tmpSize.dragger={srcSidelength:p,sidelength:p-m.btnSidelength,halfSidelength:(p-m.btnSidelength)/2,left:n-p/2,top:r-p};k.updatePosition(m.tmpSize)};e.resizeTopRight=function(n,s,q,k){if(!n){return}var l=n.ins,j=n.size.dragger.left,r=n.size.dragger.top+n.size.dragger.srcSidelength,t=Math.ceil(g({x:n.pageX,y:n.pageY},{x:e._positionPoint,y:0})),o=Math.ceil(g({x:k.pageX,y:k.pageY},{x:e._positionPoint,y:0})),m=(t-o),p=n.size.dragger.srcSidelength+m;if((r-p)<n.size.top){p=r-n.size.top}if((j+p)>(n.size.left+n.size.preview.width)){p=(n.size.left+n.size.preview.width)-j}p=p<l._model.minRectSidelength()?l._model.minRectSidelength():p;n.tmpSize.dragger={srcSidelength:p,sidelength:p-n.btnSidelength,halfSidelength:(p-n.btnSidelength)/2,left:j,top:r-p};l.updatePosition(n.tmpSize)};e.resizeMidLeft=function(m,r,q,j){if(!m){return}var k=m.ins,t=m.size.dragger.left+m.size.dragger.srcSidelength,n=m.size.dragger.top+m.size.dragger.srcSidelength/2,s=Math.ceil(g({x:m.pageX,y:m.pageY},{x:-e._positionPoint,y:m.pageY})),o=Math.ceil(g({x:j.pageX,y:j.pageY},{x:-e._positionPoint,y:m.pageY})),l=(s-o),p=m.size.dragger.srcSidelength+l;if((n-p/2)<m.size.top){p=(n-m.size.top)*2}if((n+p/2)>(m.size.top+m.size.preview.height)){p=(m.size.top+m.size.preview.height-n)*2}if((t-p)<m.size.left){p=t-m.size.left}p=p<k._model.minRectSidelength()?k._model.minRectSidelength():p;m.tmpSize.dragger={srcSidelength:p,sidelength:p-m.btnSidelength,halfSidelength:(p-m.btnSidelength)/2,left:t-p,top:n-p/2};k.updatePosition(m.tmpSize)};e.resizeMidRight=function(n,s,r,k){if(!n){return}var l=n.ins,j=n.size.dragger.left,o=n.size.dragger.top+n.size.dragger.srcSidelength/2,t=Math.ceil(g({x:n.pageX,y:n.pageY},{x:e._positionPoint,y:n.pageY})),p=Math.ceil(g({x:k.pageX,y:k.pageY},{x:e._positionPoint,y:n.pageY})),m=(t-p),q=n.size.dragger.srcSidelength+m;if((o-q/2)<n.size.top){q=(o-n.size.top)*2}if((o+q/2)>(n.size.top+n.size.preview.height)){q=(n.size.top+n.size.preview.height-o)*2}if((j+q)>(n.size.left+n.size.preview.width)){q=n.size.left+n.size.preview.width-j}q=q<l._model.minRectSidelength()?l._model.minRectSidelength():q;n.tmpSize.dragger={srcSidelength:q,sidelength:q-n.btnSidelength,halfSidelength:(q-n.btnSidelength)/2,left:j,top:o-q/2};l.updatePosition(n.tmpSize)};e.resizeBottomLeft=function(m,r,p,j){if(!m){return}var k=m.ins,t=m.size.dragger.left+m.size.dragger.srcSidelength,q=m.size.dragger.top,s=Math.ceil(g({x:m.pageX,y:m.pageY},{x:e._positionPoint,y:0})),n=Math.ceil(g({x:j.pageX,y:j.pageY},{x:e._positionPoint,y:0})),l=(s-n),o=m.size.dragger.srcSidelength-l;if((q+o)>(m.size.top+m.size.preview.height)){o=(m.size.top+m.size.preview.height)-q}if((t-o)<m.size.left){o=t-m.size.left}o=o<k._model.minRectSidelength()?k._model.minRectSidelength():o;m.tmpSize.dragger={srcSidelength:o,sidelength:o-m.btnSidelength,halfSidelength:(o-m.btnSidelength)/2,left:t-o,top:q};k.updatePosition(m.tmpSize)};e.resizeBottomCenter=function(m,r,q,j){if(!m){return}var k=m.ins,t=m.size.dragger.top,n=m.size.dragger.left+m.size.dragger.srcSidelength/2,s=Math.ceil(g({x:m.pageX,y:m.pageY},{x:m.pageX,y:-e._positionPoint})),o=Math.ceil(g({x:j.pageX,y:j.pageY},{x:m.pageX,y:-e._positionPoint})),l=(s-o),p=m.size.dragger.srcSidelength-l;if((t+p)>(m.size.top+m.size.preview.height)){p=(m.size.top+m.size.preview.height)-t}if((n-p/2)<m.size.left){p=(n-m.size.left)*2}if((n+p/2)>(m.size.left+m.size.preview.width)){p=(m.size.left+m.size.preview.width-n)*2}p=p<k._model.minRectSidelength()?k._model.minRectSidelength():p;m.tmpSize.dragger={srcSidelength:p,sidelength:p-m.btnSidelength,halfSidelength:(p-m.btnSidelength)/2,left:n-p/2,top:t};k.updatePosition(m.tmpSize)};e.resizeBottomRight=function(n,r,q,k){if(!n){return}var l=n.ins,j=n.size.dragger.left,t=n.size.dragger.top,s=Math.ceil(g({x:n.pageX,y:n.pageY},{x:0,y:-e._positionPoint})),o=Math.ceil(g({x:k.pageX,y:k.pageY},{x:0,y:-e._positionPoint})),m=(s-o),p=n.size.dragger.srcSidelength-m;if((j+p)>(n.size.left+n.size.preview.width)){p=(n.size.left+n.size.preview.width)-j}if((t+p)>(n.size.top+n.size.preview.height)){p=(n.size.top+n.size.preview.height)-t}p=p<l._model.minRectSidelength()?l._model.minRectSidelength():p;n.tmpSize.dragger={srcSidelength:p,sidelength:p-n.btnSidelength,halfSidelength:(p-n.btnSidelength)/2,left:j,top:t};l.updatePosition(n.tmpSize)};function f(l,o,n,k){var j,m;if(l>n&&(o<l)){j=n;m=o-(o/(l/(l-n)))}else{if(o>k&&(o>l)){j=l-(l/(o/(o-k)));m=k}else{j=n;m=k}}return{width:j,height:m}}function g(k,j){var n=j.x-k.x,l=j.y-k.y,m=Math.sqrt(n*n+l*l);return m}function c(j,l){var k=l*Math.PI/180;return{x:parseInt(Math.cos(k)*j),y:parseInt(Math.sin(k)*j)}}i.ready(function(){d=$("body");e._defaultCursor=d.css("cursor");e.autoInit&&e.init();h.on("keydown",e.defaultKeydown)});return JC.ImageCutter})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));