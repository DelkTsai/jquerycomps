(function(b,a){b(["JC.BaseMVC"],function(){JC.PopTips=c;function c(d){d&&(d=$(d));if(c.getInstance(d)){return c.getInstance(d)}c.getInstance(d,this);this._model=new c.Model(d);this._view=new c.View(this._model);this._init()}c.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=$(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(c.Model._instanceName,e);return d.data(c.Model._instanceName)};c.init=function(d){var e=[];d=$(d||document);if(d.length){if(d.hasClass("js_compPopTips")){e.push(new c(d))}else{d.find("span.js_compPopTips,a.js_compPopTips,b.js_compPopTips,em.js_compPopTips").each(function(){e.push(new c(this))})}}return e};c.update=function(){var d=$(JC.f.printf("#{0}>div",c.Model._boxId));if(!d.length){return}d.each(function(){var e=$(this),f=e.data("CPopTipsIns");if(!f){return}if(f._model.layout().is(":visible")&&f._model.layout().offset().left>=-200){f.update()}})},BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var d=this;d.on("CPopTipsUpdate",function(i){d._model.beforeShowCallback()&&d._model.beforeShowCallback().call(d,d.selector())});var h=null,e=null,f=null,g=null;if(d._model.triggerType()=="hover"){d._model.selector().on("mouseenter",function(){clearTimeout(f);clearTimeout(g);clearTimeout(h);clearTimeout(e);h=setTimeout(function(){d._view.update();d._view.show()},50)}).on("mouseleave",function(){clearTimeout(f);clearTimeout(g);clearTimeout(h);clearTimeout(e);e=setTimeout(function(){d._view.hide()},200)});d._model.layout().on("mouseenter",function(){clearTimeout(f);clearTimeout(g);clearTimeout(h);clearTimeout(e);f=setTimeout(function(){d._view.update();d._view.show()},50)}).on("mouseleave",function(){clearTimeout(f);clearTimeout(g);clearTimeout(h);clearTimeout(e);g=setTimeout(function(){d._view.hide()},200)})}d.on("update_layout",function(k,j){var i;try{i=$.parseJSON(j);if(i&&"errorno" in i&&!i.errorno&&i.data){j=i.data}}catch(l){}d._model.layout().find(".js_cpt_ajax_ph").html(j)});if(d._model.triggerType()=="click"){d._model.selector().on("click",function(i){if(d._model.layout().is(":visible")){d._view.hide()}else{d._view.update();d._view.show()}})}},_inited:function(){var d=$(this);d.trigger("CPopTipsUpdate")},update:function(){this._view.update();return this}});c.Model._instanceName="PopTips";c.Model._boxId="CPTBox";JC.f.extendObject(c.Model.prototype,{init:function(){var d=this},baseTpl:'<div class="CPT CPT_{0}" style="position:absolute;display:none;"><div class="CPT_shadow"><div class="CPT_container" style="min-width:{4}; min-height: {5}"><div class="CPT_arrow CPT_arrow_{1}"><em></em><span></span></div><div class="CPT_content"  data-role="content" {3}>{2}</div></div></div></div>',theme:function(){var d=this.stringProp("theme");!d&&(d="yellow");return d},contents:function(){var d=this.attrProp("content")||this.attrProp("title");!d&&(d=this.selector().text());return d},htmlContents:function(){var e,d=JC.f.parentSelector(this.selector(),this.attrProp("htmlContent"));e=JC.f.scriptContent(d);return e},ajaxContent:function(){var d=this;this.is("[ajaxContent]")&&$.get(this.attrProp("ajaxContent")).done(function(e){d.trigger("update_layout",[e])})},arrowPosition:function(){var d=this.stringProp("arrowPosition");!d&&(d="left");return d},arrowPositionOffset:function(){var e=this.stringProp("arrowPositionOffset"),d=this.arrowPosition();if(d==="left"||d==="right"){if(e!="top"){e=""}}if(d==="top"||d==="bottom"){if(e!="left"||e!="right"){e=""}}return e},offsetXY:function(){var f=this.attrProp("offsetXY").split(","),e=parseInt(f[0],10)||0,d=parseInt(f[1],10)||0;return{x:e,y:d}},triggerType:function(){var d=this.stringProp("triggerType");!d&&(d="hover");return d},layout:function(){var d=this,e=d.baseTpl;if(!this._layout){if(d.htmlContents()){this._layout=$(JC.f.printf(e,d.theme(),d.arrowPosition(),d.htmlContents(),'style="width:'+d.layoutWidth()+";height:"+d.layoutHeight()+';"',d.layoutMinWidth(),d.layoutMinHeight())).appendTo(this.layoutBox())}else{if(this.is("[ajaxContent]")){this._layout=$(JC.f.printf(e,d.theme(),d.arrowPosition(),'<div class="js_cpt_ajax_ph">加载中...</div>','style="width:'+d.layoutWidth()+";height:"+d.layoutHeight()+';"',d.layoutMinWidth(),d.layoutMinHeight())).appendTo(this.layoutBox());d.ajaxContent()}else{this._layout=$(JC.f.printf(e,d.theme(),d.arrowPosition(),d.contents(),'style="width:'+d.layoutWidth()+";height:"+d.layoutHeight()+';"',d.layoutMinWidth(),d.layoutMinHeight())).appendTo(this.layoutBox())}}this._layout.css({left:"-10000px"}).show()}return this._layout},layoutWidth:function(){var d=this.intProp("popTipsWidth");d&&(d=d+"px");!d&&(d="auto");return d},layoutMinWidth:function(){var d=this.intProp("popTipsMinWidth");d&&(d=d+"px");!d&&(d="auto");return d},layoutHeight:function(){var d=this.intProp("popTipsHeight");d&&(d=d+"px");!d&&(d="auto");return d},layoutMinHeight:function(){var d=this.intProp("popTipsMinHeight");d&&(d=d+"px");!d&&(d="auto");return d},layoutBox:function(){var d=$("#"+c.Model._boxId);if(!(d&&d.length)){d=$(JC.f.printf('<div id="{0}"></div>',c.Model._boxId)).appendTo(document.body)}return d},calcPosOffset:function(h,e,g,i){var j={},d=this,f=d.selector(),e={top:f.offset().top+d.offsetXY().y,left:f.offset().left+d.offsetXY().x,width:f.prop("offsetWidth"),height:f.prop("offsetHeight")},g=d.layout().outerWidth(),i=d.layout().outerHeight();switch(h){case"top":j={top:e.top+e.height+5,left:e.left+e.width/2-g/2};break;case"right":j={top:e.top+e.height/2-i/2,left:e.left-g-5};break;case"bottom":j={top:e.top-i-5,left:e.left+e.width/2-g/2};break;case"left":j={top:e.top+e.height/2-i/2,left:e.left+e.width+5};break}j.width=g;j.height=i;return j},offSet:function(d){this.layout().css({top:d.top+"px",left:d.left+"px"})},changePosition:function(f,g){var d=this,e;e=d.calcPosOffset(f);d.changeArrow(g);if((g==="top")||(g==="bottom")){d.offSet(e)}return e},changeArrow:function(e){var d=this;d.layout().find("div.CPT_arrow")[0].className="CPT_arrow CPT_arrow_"+e},setPosition:function(l,i){var u=this,o,e,h=$(window),d=h.outerHeight(),t=h.outerWidth(),j=h.scrollTop(),k=h.scrollLeft(),n=t+k,m=d+j,g=l.width+l.left,f=l.top+l.height,q=u.arrowPositionOffset(),s,r=JC.f.winSize(),p;q&&(q="_"+q);if(i==="bottom"){if(l.top<r.viewportY){o="top";e="top"+q;u.changePosition(o,e);p=true}else{u.changeArrow("bottom"+q)}}if(i==="top"){if(m<f){o="bottom";e="bottom"+q;s=u.changePosition(o,e);p=true}else{u.changeArrow("top"+q)}}if(i==="right"){if(l.left<r.viewportX){o="left";e="left"+q;s=u.changePosition(o,e);g=s.width+s.left;p=true;if(n<g){o="bottom";e="bottom";s=u.changePosition(o,e);if(s.top<r.viewportY){o="top";e="top";s=u.changePosition(o,e)}}else{u.offSet(s)}}else{u.changeArrow("right"+q)}}if(i==="left"){if(n<g){o="right";e="right"+q;s=u.changePosition(o,e);p=true;if(s.left<r.viewportX){o="bottom";e="bottom";s=u.changePosition(o,e);if(s.top<r.viewportY){o="top";e="top";s=u.changePosition(o,e)}}else{u.offSet(s)}}else{u.changeArrow("left"+q)}}!p&&u.offSet(l)},beforeShowCallback:function(){var d=this,e=d.selector(),f="beforeShowCallback";return d.callbackProp(e,f)},afterHideCallback:function(){var d=this,e=d.selector(),f="afterShowCallback";return d.callbackProp(e,f)}});JC.f.extendObject(c.View.prototype,{init:function(){var d=this},update:function(){var x=this,w=x._model.selector(),i={top:w.offset().top,left:w.offset().left,width:w.prop("offsetWidth"),height:w.prop("offsetHeight")},j=x._model.arrowPosition(),l=j,n,t;switch(j){case"left":l="right";break;case"right":l="left";break;case"top":l="bottom";break;case"bottom":l="top";break}n=x._model.calcPosOffset(j,JC.f.cloneObject(i));var q,e,h=$(window),d=h.outerHeight(),v=h.outerWidth(),k=h.scrollTop(),m=h.scrollLeft(),p=v+m,o=d+k,g=n.width+n.left,f=n.top+n.height,r=x._model.arrowPositionOffset(),u,s=JC.f.winSize();if(g>s.maxViewportX){j="right";n=x._model.calcPosOffset(j,JC.f.cloneObject(i))}if(n.left<s.viewportX){j="left";n=x._model.calcPosOffset(j,JC.f.cloneObject(i))}if(n.top<s.viewportX){j="top";n=x._model.calcPosOffset(j,JC.f.cloneObject(i))}if(f>s.maxViewportY){j="bottom";n=x._model.calcPosOffset(j,JC.f.cloneObject(i))}x._model.setPosition(n,j);x._model.layout().data("CPopTipsIns",x)},show:function(){var d=this},hide:function(){var d=this;d._model.layout().css({left:"-10000px"});d._model.afterHideCallback()&&d._model.afterHideCallback().call(d,d.selector())}});$(document).ready(function(){var d=0;c.autoInit&&(d=c.init())});$(window).on("resize",function(){JC.f.safeTimeout(function(){c.update()},null,"PopTipsResize",20)});return JC.PopTips})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));