(function(b,a){b(["JC.common"],function(){(function(c){window.JC=window.JC||{log:function(){}};window.Calendar=JC.Calendar=f;function f(g){if(f.getInstance(g)){return f.getInstance(g)}f.getInstance(g,this);var h=f.type(g);JC.log("Calendar init:",h,new Date().getTime());switch(h){case"week":this._model=new f.WeekModel(g);this._view=new f.WeekView(this._model);break;case"month":this._model=new f.MonthModel(g);this._view=new f.MonthView(this._model);break;case"season":this._model=new f.SeasonModel(g);this._view=new f.SeasonView(this._model);break;case"monthday":this._model=new f.MonthDayModel(g);this._view=new f.MonthDayView(this._model);break;default:this._model=new f.Model(g);this._view=new f.View(this._model);break}this._init()}f.prototype={_init:function(){var g=this;g._initHanlderEvent();c([g._view,g._model]).on("BindEvent",function(h,j,i){g.on(j,i)});c([g._view,g._model]).on("TriggerEvent",function(h,j){var i=JC.f.sliceArgs(arguments).slice(2);g.trigger(j,i)});g._model.init();g._view.init();return g},_initHanlderEvent:function(){var g=this;g.on(f.Model.INITED,function(h){g._model.calendarinited()&&g._model.calendarinited().call(g._model.selector(),g._model.layout(),g)});g.on(f.Model.SHOW,function(h){g._model.calendarshow()&&g._model.calendarshow().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.HIDE,function(h){g._model.calendarhide()&&g._model.calendarhide().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.UPDATE,function(h){if(!g._model.selector()){return}g._model.selector().blur();g._model.selector().trigger("change");var l=[],t=g._model.selector().val().trim(),k,o,q,r,p,s;if(t){q=t.split(",");for(var n=0,m=q.length;n<m;n++){r=q[n].replace(/[^\d]/g,"");if(r.length==16){p=JC.f.parseISODate(r.slice(0,8));s=JC.f.parseISODate(r.slice(8))}else{if(r.length==8){p=JC.f.parseISODate(r.slice(0,8));s=JC.f.cloneDate(p)}}if(n===0){k=JC.f.cloneDate(p);o=JC.f.cloneDate(s)}l.push({start:p,end:s})}}g._model.calendarupdate()&&g._model.calendarupdate().apply(g._model.selector(),[k,o]);g._model.multiselect()&&g._model.calendarupdatemultiselect()&&g._model.calendarupdatemultiselect().call(g._model.selector(),l,g)});g.on(f.Model.CLEAR,function(h){g._model.calendarclear()&&g._model.calendarclear().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.CANCEL,function(h){g._model.calendarcancel()&&g._model.calendarcancel().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.LAYOUT_CHANGE,function(h){g._model.calendarlayoutchange()&&g._model.calendarlayoutchange().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.UPDATE_MULTISELECT,function(h){g._model.multiselect()&&g._model.calendarupdatemultiselect()&&g._model.calendarupdatemultiselect().call(g._model.selector(),g._model.selector(),g)});return g},show:function(){f.hide();f.lastIpt=this._model.selector();this._view.show();this.trigger(f.Model.SHOW);return this},hide:function(){this._view.hide();this.trigger(f.Model.HIDE);this.selector()&&this.selector().blur();return this},selector:function(){return this._model.selector()},layout:function(){return this._model.layout()},on:function(h,g){c(this).on(h,g);return this},trigger:function(h,g){c(this).trigger(h,g);return this},updateLayout:function(){this._view.updateLayout();return this},updateSelector:function(g){f.lastIpt=g;this._model&&this._model.selector(g);return this},updateYear:function(g){this._view&&this._view.updateYear(g);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateMonth:function(g){this._view&&this._view.updateMonth(g);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateSelected:function(g){JC.log("JC.Calendar: updateSelector",new Date().getTime());this._view&&this._view.updateSelected(g);return this},updatePosition:function(){this._view&&this._view.updatePosition();return this},clear:function(){var g=!this._model.selector().val().trim();this._model&&this._model.selector().val("");!g&&this.trigger(f.Model.CLEAR);return this},cancel:function(){this.trigger(f.Model.CANCEL);this._view&&this._view.hide();return this},visible:function(){var h,g;this._model&&(g=this._model.layout())&&(h=g.is(":visible"));return h},defaultDate:function(g){return this._model.defaultDate(g)}};f.getInstance=function(g,i){typeof g=="string"&&!/</.test(g)&&(g=c(g));if(!(g&&g.length)||(typeof g=="string")){return}var h=f.type(g);typeof i!="undefined"&&(f._ins[h]=i);f._ins[h]&&f._ins[h].updateSelector(g);return f._ins[h]};f._ins={};f.type=function(g){g=c(g);var i,h=c.trim(g.attr("multidate")||"").toLowerCase()||c.trim(g.attr("datatype")||"").toLowerCase();switch(h){case"week":case"month":case"season":case"monthday":i=h;break;default:i="date";break}return i};f.isCalendar=function(g){g=c(g);var h=0;if(g.length){if(g.hasClass("UXCCalendar_btn")){h=1}if(g.prop("nodeName")&&g.attr("datatype")&&(g.prop("nodeName").toLowerCase()=="input"||g.prop("nodeName").toLowerCase()=="button")&&(g.attr("datatype").toLowerCase()=="date"||g.attr("datatype").toLowerCase()=="week"||g.attr("datatype").toLowerCase()=="month"||g.attr("datatype").toLowerCase()=="season"||g.attr("datatype").toLowerCase()=="year"||g.attr("datatype").toLowerCase()=="daterange"||g.attr("datatype").toLowerCase()=="monthday")){h=1}if(g.prop("nodeName")&&g.attr("multidate")&&(g.prop("nodeName").toLowerCase()=="input"||g.prop("nodeName").toLowerCase()=="button")){h=1}}return h};f.isCalendarElement=function(g){return f.isCalendar(g)};f.pickDate=function(g){g=c(g);if(!(g&&g.length)){return}var h,i=g.is("[ignoreprocess]");g.attr("ignoreprocess",true);g.blur();!i&&g.removeAttr("ignoreprocess");h=f.getInstance(g);!h&&(h=new f(g));h.show();return};f.autoInit=true;f.defaultDateSpan=20;f.lastIpt=null;f.tpl="";f.layoutInitedCallback=null;f.layoutShowCallback=null;f.layoutHideCallback=null;f.domClickFilter=null;f.hide=function(){for(var g in f._ins){f._ins[g]&&f._ins[g].visible()&&f._ins[g].hide()}};f.getDate=function(g){return f.getInstance(g).defaultDate()};f.cnWeek="日一二三四五六";f.cnUnit="十一二三四五六七八九";f.getCnNum=function(g){var h=f.cnUnit.charAt(g%10);g>10&&(h=(g%10!==0?f.cnUnit.charAt(0):"")+h);g>19&&(h=f.cnUnit.charAt(Math.floor(g/10))+h);return h};f.position=function(g){f.getInstance(g)&&f.getInstance(g).updatePosition()};f.setPosition=f.position;f.initTrigger=function(g){g.each(function(){var i=c(this),h=(i.prop("nodeName")||"").toLowerCase(),k;if(h!="input"&&h!="textarea"){f.initTrigger(g.find("input[type=text], textarea"));return}if(!(c.trim(i.attr("datatype")||"").toLowerCase()=="date"||c.trim(i.attr("multidate")||"")||c.trim(i.attr("datatype")||"").toLowerCase()=="daterange"||c.trim(i.attr("datatype")||"").toLowerCase()=="monthday")){return}var j=i.find("+ input.UXCCalendar_btn");if(!j.length){i.after(j=c('<input type="button" class="UXCCalendar_btn"  />'))}(k=i.val().trim())&&(k=JC.f.dateDetect(k))&&i.val(JC.f.formatISODate(k));(k=(i.attr("minvalue")||""))&&(k=JC.f.dateDetect(k))&&i.attr("minvalue",JC.f.formatISODate(k));(k=(i.attr("maxvalue")||""))&&(k=JC.f.dateDetect(k))&&i.attr("maxvalue",JC.f.formatISODate(k));if((i.attr("datatype")||"").toLowerCase()=="monthday"||(i.attr("multidate")||"").toLowerCase()=="monthday"){if(!i.is("[placeholder]")){var l=new Date();i.attr("defaultdate")&&(l=JC.f.parseISODate(i.attr("defaultdate"))||l);i.val().trim()&&(l=JC.f.parseISODate(i.val().replace(/[^d]/g,"").slice(0,8))||l);l&&i.attr("placeholder",JC.f.printf("{0}年 {1}月",l.getFullYear(),l.getMonth()+1))}}j.data(f.Model.INPUT,i)})};f.updateMultiYear=function(h,i){var j,g;j=h.getDate();h.setDate(1);h.setFullYear(h.getFullYear()+i);g=JC.f.maxDayOfMonth(h);j>g&&(j=g);h.setDate(j);return h};f.updateMultiMonth=function(h,i){var j,g;j=h.getDate();h.setDate(1);h.setMonth(h.getMonth()+i);g=JC.f.maxDayOfMonth(h);j>g&&(j=g);h.setDate(j);return h};f.clone=function(h,i){var g;if(h){for(g in e.prototype){h.prototype[g]=e.prototype[g]}}if(i){for(g in d.prototype){i.prototype[g]=d.prototype[g]}}};function e(g){this._selector=g}f.Model=e;f.Model.INPUT="CalendarInput";f.Model.INITED="CalendarInited";f.Model.SHOW="CalendarShow";f.Model.HIDE="CalendarHide";f.Model.UPDATE="CalendarUpdate";f.Model.CLEAR="CalendarClear";f.Model.CANCEL="CalendarCancel";f.Model.LAYOUT_CHANGE="CalendarLayoutChange";f.Model.UPDATE_MULTISELECT="CalendarUpdateMultiSelect";e.prototype={init:function(){return this},selector:function(g){typeof g!="undefined"&&(this._selector=g);return this._selector},layout:function(){var h=c("#UXCCalendar");if(!h.length){h=c(f.tpl||this.tpl).hide();h.attr("id","UXCCalendar").hide().appendTo(document.body);var g=c(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(h.find("select.UMonth"))}return h},startYear:function(h){var g=f.defaultDateSpan,i=h.date.getFullYear();this.selector().is("[calendardatespan]")&&(g=parseInt(this.selector().attr("calendardatespan"),10));return i-g},endYear:function(h){var g=f.defaultDateSpan,i=h.date.getFullYear();this.selector().is("[calendardatespan]")&&(g=parseInt(this.selector().attr("calendardatespan"),10));return i+g},currentcanselect:function(){var g=true;this.selector().is("[currentcanselect]")&&(g=JC.f.parseBool(this.selector().attr("currentcanselect")));return g},year:function(){return parseInt(this.layout().find("select.UYear").val(),10)||1},month:function(){return parseInt(this.layout().find("select.UMonth").val(),10)||0},day:function(){var h,g=new Date();h=this.layout().find("td.cur > a[date], td.cur > a[dstart]");if(h.length){g.setTime(h.attr("date")||h.attr("dstart"))}JC.log("dddddd",g.getDate());return g.getDate()},defaultDate:function(){var g=this,h={date:null,minvalue:null,maxvalue:null,enddate:null,multidate:null};g.selector()&&(h=g.multiselect()?g.defaultMultiselectDate(h):g.defaultSingleSelectDate(h));h.minvalue=JC.f.parseISODate(g.selector().attr("minvalue"));h.maxvalue=JC.f.parseISODate(g.selector().attr("maxvalue"));return h},defaultSingleSelectDate:function(j){var g=this,h=g.selector(),i;if(i=JC.f.parseISODate(h.val())){j.date=i}else{if(h.val()&&(i=h.val().replace(/[^\d]/g,"")).length==16){j.date=JC.f.parseISODate(i.slice(0,8));j.enddate=JC.f.parseISODate(i.slice(8))}else{i=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){i=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||i}j.date=new Date(i.getFullYear(),i.getMonth(),i.getDate())}}return j},defaultMultiselectDate:function(m){var g=this,h=f.lastIpt,k,i,j,l;if(h.val()){k=h.val().trim().replace(/[^\d,]/g,"").split(",");i=[];c.each(k,function(o,n){if(n.length==16){j=JC.f.parseISODate(n.slice(0,8));l=JC.f.parseISODate(n.slice(8));if(!o){m.date=JC.f.cloneDate(j);m.enddate=JC.f.cloneDate(l)}i.push({start:j,end:l})}else{if(n.length==8){j=JC.f.parseISODate(n.slice(0,8));l=JC.f.cloneDate(j);if(!o){m.date=JC.f.cloneDate(j);m.enddate=JC.f.cloneDate(l)}i.push({start:j,end:l})}}});m.multidate=i}else{k=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){k=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||k}m.date=new Date(k.getFullYear(),k.getMonth(),k.getDate());m.enddate=JC.f.cloneDate(m.date);m.enddate.setDate(JC.f.maxDayOfMonth(m.enddate));m.multidate=[];m.multidate.push({start:JC.f.cloneDate(m.date),end:JC.f.cloneDate(m.enddate)})}return m},layoutDate:function(){return this.multiselect()?this.multiLayoutDate():this.singleLayoutDate()},singleLayoutDate:function(){var g=this,j=g.defaultDate(),i=this.day(),h;j.date.setDate(1);j.date.setFullYear(this.year());j.date.setMonth(this.month());h=JC.f.maxDayOfMonth(j.date);i>h&&(i=h);j.date.setDate(i);return j},multiLayoutDate:function(){JC.log("Calendar.Model multiLayoutDate",new Date().getTime());var g=this,k=g.defaultDate(),j=g.year(),i=g.month(),h=g.layout().find("select.UMonth");k.multidate=[];g.layout().find("td.cur").each(function(){var l=c(this);var n=l.find("> a[dstart]"),m=new Date(),o=new Date();m.setTime(n.attr("dstart"));o.setTime(n.attr("dend"));k.multidate.push({start:m,end:o})});k.date.setFullYear(j);k.enddate.setFullYear(j);if(h.length){k.date.setMonth(i);k.enddate.setMonth(i)}c.each(k.multidate,function(m,l){l.start.setFullYear(j);l.end.setFullYear(j);if(h.length){l.start.setMonth(i);l.end.setMonth(i)}});return k},selectedDate:function(){var i,h,g;h=this.layout().find("td.cur");h.length&&!h.hasClass("unable")&&(g=h.find("a[date]"))&&(i=new Date(),i.setTime(g.attr("date")));return i},multiselectDate:function(){var g=[];return g},calendarinited:function(){var i=this.selector(),h=f.layoutInitedCallback,g;i&&i.attr("calendarinited")&&(g=window[i.attr("calendarinited")])&&(h=g);return h},calendarshow:function(){var i=this.selector(),h=f.layoutShowCallback,g;i&&i.attr("calendarshow")&&(g=window[i.attr("calendarshow")])&&(h=g);return h},calendarhide:function(){var i=this.selector(),h=f.layoutHideCallback,g;i&&i.attr("calendarhide")&&(g=window[i.attr("calendarhide")])&&(h=g);return h},calendarupdate:function(i){var j=this.selector(),h,g;j&&j.attr("calendarupdate")&&(g=window[j.attr("calendarupdate")])&&(h=g);return h},calendarclear:function(){var i=this.selector(),h,g;i&&i.attr("calendarclear")&&(g=window[i.attr("calendarclear")])&&(h=g);return h},calendarcancel:function(){var i=this.selector(),h,g;i&&i.attr("calendarcancel")&&(g=window[i.attr("calendarcancel")])&&(h=g);return h},calendarlayoutchange:function(){var i=this.selector(),h,g;i&&i.attr("calendarlayoutchange")&&(g=window[i.attr("calendarlayoutchange")])&&(h=g);return h},multiselect:function(){var g;this.selector().is("[multiselect]")&&(g=JC.f.parseBool(this.selector().attr("multiselect")));return g},calendarupdatemultiselect:function(i){var j=this.selector(),h,g;j&&j.attr("calendarupdatemultiselect")&&(g=window[j.attr("calendarupdatemultiselect")])&&(h=g);return h},tpl:['<div id="UXCCalendar" class="UXCCalendar">','    <div class="UHeader">','        <select class="UYear"></select>','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>','        <select class="UMonth"></select>','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>',"    </div>",'    <table class="UTable">',"        <thead>","            <tr>","                <th>一</th>","                <th>二</th>","                <th>三</th>","                <th>四</th>","                <th>五</th>","                <th>六</th>","                <th>日</th>","            </tr>","        </thead>","   </table>",'   <table class="UTable UTableBorder">',"        <tbody>","           <!--<tr>",'                <td class="cur"><a href="#">2</a></td>','                <td class="unable"><a href="#">2</a></td>','                <td class="weekend cur"><a href="#">6</a></td>','                <td class="weekend hover"><a href="#">13</a></td>','                <td class="weekend other"><a href="#">41</a></td>','                <td class="weekend other"><a href="#">42</a></td>',"            </tr>-->","        </tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function d(g){this._model=g}f.View=d;d.prototype={init:function(){return this},hide:function(){this._model.layout().hide()},show:function(){var g=this._model.defaultDate();JC.log("Calendar.View: show",new Date().getTime(),JC.f.formatISODate(g.date));this._buildLayout(g);this._buildDone()},updateLayout:function(g){typeof g=="undefined"&&(g=this._model.layoutDate());this._buildLayout(g);this._buildDone()},updateYear:function(g){if(typeof g=="undefined"||g==0){return}this._model.multiselect()?this.updateMultiYear(g):this.updateSingleYear(g)},updateSingleYear:function(h){var j=this._model.layoutDate(),i=j.date.getDate(),g;j.date.setDate(1);j.date.setFullYear(j.date.getFullYear()+h);g=JC.f.maxDayOfMonth(j.date);i>g&&(i=g);j.date.setDate(i);this._buildLayout(j);this._buildDone()},updateMultiYear:function(h){var j=this._model.layoutDate(),i,g;JC.Calendar.updateMultiYear(j.date,h);JC.Calendar.updateMultiYear(j.enddate,h);if(j.multidate){c.each(j.multidate,function(l,k){JC.Calendar.updateMultiYear(k.start,h);JC.Calendar.updateMultiYear(k.end,h)})}this._buildLayout(j);this._buildDone()},updateMonth:function(g){if(typeof g=="undefined"||g==0){return}this._model.multiselect()?this.updateMultiMonth(g):this.updateSingleMonth(g)},updateMultiMonth:function(h){var j=this._model.layoutDate(),i,g;JC.Calendar.updateMultiMonth(j.date,h);JC.Calendar.updateMultiMonth(j.enddate,h);if(j.multidate){c.each(j.multidate,function(l,k){JC.Calendar.updateMultiMonth(k.start,h);JC.Calendar.updateMultiMonth(k.end,h)})}this._buildLayout(j);this._buildDone()},updateSingleMonth:function(h){var j=this._model.layoutDate(),i=j.date.getDate(),g;j.date.setDate(1);j.date.setMonth(j.date.getMonth()+h);g=JC.f.maxDayOfMonth(j.date);i>g&&(i=g);j.date.setDate(i);this._buildLayout(j);this._buildDone()},updateSelected:function(j){var g=this,h,i;if(!j){h=this._model.selectedDate()}else{j=c(j);i=JC.f.getJqParent(j,"td");if(i&&i.hasClass("unable")){return}h=new Date();h.setTime(j.attr("date"))}if(!h){return}g._model.selector().val(JC.f.formatISODate(h));c(g).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"date",h,h]);f.hide()},updatePosition:function(){var i=this,g=i._model.selector(),s=i._model.layout();if(!(g&&s&&g.length&&s.length)){return}s.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var q=s.width(),k=s.height(),r=g.width(),l=g.height(),p=g.offset(),o,m,h=c(window).width(),n=c(window).height(),j=c(document).scrollTop();o=p.left;m=p.top+l+5;if((m+k-j)>n){JC.log("y overflow");m=p.top-k-3;if(m<j){m=j}}s.css({left:o+"px",top:m+"px"});JC.log(q,k,r,l,p.left,p.top,h,n);JC.log(j,o,m)},_buildDone:function(){this.updatePosition();c(this).trigger("TriggerEvent",[f.Model.INITED])},_buildLayout:function(g){this._model.layout();if(!(g&&g.date)){return}this._buildHeader(g);this._buildBody(g);this._buildFooter(g)},_buildHeader:function(k){var h=this,p=h._model.layout(),g=[],n,l=l=k.date.getFullYear(),m=h._model.startYear(k),o=h._model.endYear(k);JC.log(m,o);for(var j=m;j<=o;j++){g.push(JC.f.printf('<option value="{0}"{1}>{0}</option>',j,j===l?" selected":""))}c(g.join("")).appendTo(p.find("select.UYear").html(""));c(p.find("select.UMonth").val(k.date.getMonth()))},_buildBody:function(o){var j=this,w=j._model.layout();var v=JC.f.maxDayOfMonth(o.date),q=o.date.getDay()||7,u=q+v,l=6,h=[],k,g,s,n,p;var m=new Date(o.date.getFullYear(),o.date.getMonth(),1);var r=m.getDay()||7;if(r<2){m.setDate(-(r-1+6))}else{m.setDate(-(r-2))}var t=new Date();if(o.maxvalue&&!j._model.currentcanselect()){o.maxvalue.setDate(o.maxvalue.getDate()-1)}h.push("<tr>");for(n=1;n<=42;n++){p=[];if(m.getDay()===0||m.getDay()==6){p.push("weekend")}if(!JC.f.isSameMonth(o.date,m)){p.push("other")}if(o.minvalue&&m.getTime()<o.minvalue.getTime()){p.push("unable")}if(o.maxvalue&&m.getTime()>o.maxvalue.getTime()){p.push("unable")}if(JC.f.isSameDay(m,t)){p.push("today")}if(JC.f.isSameDay(o.date,m)){p.push("cur")}h.push('<td class="',p.join(" "),'">','<a href="javascript:" date="',m.getTime(),'" title="'+JC.f.formatISODate(m)+'" >',m.getDate(),"</a></td>");m.setDate(m.getDate()+1);if(n%7===0&&n!=42){h.push("</tr><tr>")}}h.push("</tr>");w.find("table.UTableBorder tbody").html(c(h.join("")))},_buildFooter:function(g){}};c(document).delegate("body > div.UXCCalendar select.UYear, body > div.UXCCalendar select.UMonth","change",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateLayout()});c(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(1)});c(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(-1)});c(document).delegate("map[name=UXCCalendar_Year] area","click",function(h){h.preventDefault();var g=c(this),i=f.getInstance(f.lastIpt);g.attr("action")&&i&&(g.attr("action").toLowerCase()=="up"&&i.updateYear(1),g.attr("action").toLowerCase()=="down"&&i.updateYear(-1))});c(document).delegate("map[name=UXCCalendar_Month] area","click",function(h){h.preventDefault();var g=c(this),i=f.getInstance(f.lastIpt);g.attr("action")&&i&&(g.attr("action").toLowerCase()=="up"&&i.updateMonth(1),g.attr("action").toLowerCase()=="down"&&i.updateMonth(-1))});c(document).delegate("body > div.UXCCalendar button.UNextMonth","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(1)});c(document).delegate("body > div.UXCCalendar button.UPreMonth","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(-1)});c(document).delegate("div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]","click",function(g){g.preventDefault();f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected(c(this))});c(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected()});c(document).delegate("body > div.UXCCalendar button.UClear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).clear()});c(document).delegate("body > div.UXCCalendar button.UCancel","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).cancel()});c(document).delegate("input.UXCCalendar_btn","click",function(h){var g=c(this),i;if(!g.data(f.Model.INPUT)){i=g.prev("input[type=text], textarea");i.length&&g.data(f.Model.INPUT,i)}g.data(f.Model.INPUT)&&!g.data(f.Model.INPUT).is("[disabled]")&&f.pickDate(g.data(f.Model.INPUT))});c(document).delegate("body > div.UXCCalendar","click",function(g){g.stopPropagation()});c(document).ready(function(g){setTimeout(function(i){if(!f.autoInit){return}f.initTrigger(c(document))},200);c(window).on("scroll resize",function(i){var j=f.getInstance(f.lastIpt);j&&j.visible()&&j.updatePosition()});var h=null;c(document).on("click",function(i){var j=i.target||i.srcElement;if(f.domClickFilter){if(f.domClickFilter(c(j))===false){return}}if(f.isCalendar(i.target||i.targetElement)){return}if(j&&(j.nodeName.toLowerCase()!="input"&&j.nodeName.toLowerCase()!="button"&&j.nodeName.toLowerCase()!="textarea")){f.hide();return}h&&clearTimeout(h);h=setTimeout(function(){if(f.lastIpt&&f.lastIpt.length&&j==f.lastIpt[0]){return}f.hide()},100)})});c(document).delegate(["input[datatype=season]","input[datatype=month]","input[datatype=week]","input[datatype=date]","input[datatype=daterange]","input[multidate], input[datatype=monthday]"].join(),"focus",function(g){f.pickDate(this)});c(document).delegate(["button[datatype=season]","button[datatype=month]","button[datatype=week]","button[datatype=date]","button[datatype=daterange]","button[multidate], button[datatype=monthday]"].join(),"click",function(g){f.pickDate(this)});c(document).delegate(["textarea[datatype=season]","textarea[datatype=month]","textarea[datatype=week]","textarea[datatype=date]","textarea[datatype=daterange]","textarea[multidate], textarea[datatype=monthday]"].join(),"click",function(g){f.pickDate(this)})}(jQuery));(function(f){JC.Calendar.weekTpl="";JC.Calendar.weekDayOffset=0;function d(g){this._selector=g}JC.Calendar.WeekModel=d;function c(g){this._model=g}JC.Calendar.WeekView=c;JC.Calendar.clone(d,c);d.prototype.layout=function(){var g=f("#UXCCalendar_week");if(!g.length){g=f(JC.Calendar.weekTpl||this.tpl).hide();g.attr("id","UXCCalendar_week").hide().appendTo(document.body)}return g};d.prototype.tpl=['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");d.prototype.month=function(){var i=0,h,g=new Date();(h=this.layout().find("td.cur a[dstart]")).length&&(g=new Date())&&(g.setTime(h.attr("dstart")));i=g.getMonth();return i};d.prototype.selectedDate=function(){var i,h,g;h=this.layout().find("td.cur");h.length&&!h.hasClass("unable")&&(g=h.find("a[dstart]"))&&(i={start:new Date(),end:new Date()},i.start.setTime(g.attr("dstart")),i.end.setTime(g.attr("dend")));return i};d.prototype.singleLayoutDate=function(){var h=this,k=h.defaultDate(),j=this.day(),i,g=h.layout().find("td.cur > a[week]");k.date.setDate(1);k.date.setFullYear(this.year());k.date.setMonth(this.month());i=JC.f.maxDayOfMonth(k.date);j>i&&(j=i);k.date.setDate(j);g.length&&(k.curweek=parseInt(g.attr("week"),10));JC.log("WeekModel.singleLayoutDate:",g.length,k.curweek);return k};c.prototype._buildBody=function(A){var C=this,q=A.date,m=C._model.layout(),y=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),n=e(q.getFullYear(),JC.Calendar.weekDayOffset),x=e(q.getFullYear()+1,JC.Calendar.weekDayOffset),o=0,z=[],k,s,r,p,w,l=q.getFullYear(),h=Math.ceil(n.length/8),u=JC.Calendar.lastIpt,g=JC.f.parseBool(u.attr("currentcanselect"));if(A.maxvalue&&g){var B=A.maxvalue.getDay();if(B>0){A.maxvalue.setDate(A.maxvalue.getDate()+(7-B))}}z.push("<tr>");for(var v=1,t=h*8;v<=t;v++){s=n[v-1];if(!s){s=x[o++];l=q.getFullYear()+1}p=new Date();w=new Date();p.setTime(s.start);w.setTime(s.end);r=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",l,JC.Calendar.getCnNum(s.week),JC.f.formatISODate(p),JC.f.formatISODate(w),JC.Calendar.cnWeek.charAt(p.getDay()%7),JC.Calendar.cnWeek.charAt(w.getDay()%7));k=[];if(A.minvalue&&p.getTime()<A.minvalue.getTime()){k.push("unable")}if(A.maxvalue&&w.getTime()>A.maxvalue.getTime()){k.push("unable")}if(A.curweek){if(s.week==A.curweek&&q.getFullYear()==p.getFullYear()){k.push("cur")}}else{if(q.getTime()>=p.getTime()&&q.getTime()<=w.getTime()){k.push("cur")}}if(y>=p.getTime()&&y<=w.getTime()){k.push("today")}z.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',k.join(" "),s.week,r,p.getTime(),w.getTime(),A.date.getTime()));if(v%8===0&&v!=t){z.push("</tr><tr>")}}z.push("</tr>");m.find("table.UTableBorder tbody").html(f(z.join("")))};c.prototype.updateSelected=function(k){var g=this,h,j,i;if(!k){i=this._model.selectedDate();i&&(h=i.start,j=i.end)}else{k=f(k);i=JC.f.getJqParent(k,"td");if(i&&i.hasClass("unable")){return}h=new Date();j=new Date();h.setTime(k.attr("dstart"));j.setTime(k.attr("dend"))}if(!(h&&j)){return}g._model.selector().val(JC.f.printf("{0} 至 {1}",JC.f.formatISODate(h),JC.f.formatISODate(j)));f(g).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",h,j]);JC.Calendar.hide()};function e(j,i){var l=[],k,h=1,i=i||0,j=parseInt(j,10),g=new Date(j,0,1);g.getDay()>1&&g.setDate(g.getDate()-g.getDay()+7);g.getDay()===0&&g.setDate(g.getDate()+1);i>0&&(i=(new Date(2000,1,2)-new Date(2000,1,1))*i);while(g.getFullYear()<=j){k={week:h++,start:null,end:null};k.start=g.getTime()+i;g.setDate(g.getDate()+6);k.end=g.getTime()+i;g.setDate(g.getDate()+1);if(g.getFullYear()>j){g=new Date(g.getFullYear(),0,1);if(g.getDay()<2){break}}l.push(k)}return l}}(jQuery));(function(d){JC.Calendar.monthTpl="";function c(f){this._selector=f}JC.Calendar.MonthModel=c;function e(f){this._model=f}JC.Calendar.MonthView=e;JC.Calendar.clone(c,e);c.prototype.layout=function(){var f=d("#UXCCalendar_month");if(!f.length){f=d(JC.Calendar.monthTpl||this.tpl).hide();f.attr("id","UXCCalendar_month").hide().appendTo(document.body)}return f};c.prototype.tpl=['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");c.prototype.month=function(){var h=0,g,f;(g=this.layout().find("td.cur a[dstart]")).length&&(f=new Date())&&(f.setTime(g.attr("dstart")),h=f.getMonth());return h};c.prototype.selectedDate=function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[dstart]"))&&(h={start:new Date(),end:new Date()},h.start.setTime(f.attr("dstart")),h.end.setTime(f.attr("dend")));return h};e.prototype._buildBody=function(z){var A=this,p=z.date,m=A._model.layout(),x=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),o=0,y=[],h,r,q,w,s,k=p.getFullYear(),g=4,u=JC.Calendar.lastIpt,f=JC.f.parseBool(u.attr("currentcanselect")),n=z.multidate?z.multidate.slice():null;if(z.maxvalue&&f){z.maxvalue.setDate(JC.f.maxDayOfMonth(z.maxvalue))}y.push("<tr>");for(var v=1,t=12;v<=t;v++){w=new Date(k,v-1,1);s=new Date(k,v-1,JC.f.maxDayOfMonth(w));q=JC.f.printf("{0}年 {1}月\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(v),JC.f.formatISODate(w),JC.f.formatISODate(s),JC.Calendar.cnWeek.charAt(w.getDay()%7),JC.Calendar.cnWeek.charAt(s.getDay()%7));h=[];if(z.minvalue&&w.getTime()<z.minvalue.getTime()){h.push("unable")}if(z.maxvalue&&s.getTime()>z.maxvalue.getTime()){h.push("unable")}if(n){d.each(n,function(j,i){if(w.getTime()>=i.start.getTime()&&w.getTime()<=i.end.getTime()){h.push("cur");n.splice(j,1);return false}})}else{if(p.getTime()>=w.getTime()&&p.getTime()<=s.getTime()){h.push("cur")}}if(x>=w.getTime()&&x<=s.getTime()){h.push("today")}var l=JC.Calendar.cnUnit.charAt(v%10);v>10&&(l="十"+l);y.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',h.join(" "),q,l,w.getTime(),s.getTime(),v));if(v%3===0&&v!=t){y.push("</tr><tr>")}}y.push("</tr>");m.find("table.UTableBorder tbody").html(d(y.join("")))};c.prototype.multiselectDate=function(){var f=this,k=[],g,i,h,j;f.layout().find("td.cur").each(function(){g=d(this);i=g.find("> a[dstart]");if(g.hasClass("unable")){return}h=new Date();j=new Date();h.setTime(i.attr("dstart"));j.setTime(i.attr("dend"));k.push({start:h,end:j})});return k};e.prototype.updateSelected=function(l){var f=this,g,k,h,j,i;if(!l){if(f._model.multiselect()){h=this._model.multiselectDate();if(!h.length){return}i=[];d.each(h,function(n,m){i.push(JC.f.printf("{0} 至 {1}",JC.f.formatISODate(m.start),JC.f.formatISODate(m.end)))});j=i.join(",")}else{h=this._model.selectedDate();h&&(g=h.start,k=h.end);g&&k&&(j=JC.f.printf("{0} 至 {1}",JC.f.formatISODate(g),JC.f.formatISODate(k)))}}else{l=d(l);h=JC.f.getJqParent(l,"td");if(h&&h.hasClass("unable")){return}if(f._model.multiselect()){h.toggleClass("cur");return}g=new Date();k=new Date();g.setTime(l.attr("dstart"));k.setTime(l.attr("dend"));j=JC.f.printf("{0} 至 {1}",JC.f.formatISODate(g),JC.f.formatISODate(k))}if(!j){return}f._model.selector().val(j);d(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"month",g,k]);JC.Calendar.hide()}}(jQuery));(function(e){JC.Calendar.seasonTpl="";function d(f){this._selector=f}JC.Calendar.SeasonModel=d;function c(f){this._model=f}JC.Calendar.SeasonView=c;JC.Calendar.clone(d,c);d.prototype.layout=function(){var f=e("#UXCCalendar_season");if(!f.length){f=e(JC.Calendar.seasonTpl||this.tpl).hide();f.attr("id","UXCCalendar_season").hide().appendTo(document.body)}return f};d.prototype.tpl=['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");d.prototype.month=function(){var h=0,g,f;(g=this.layout().find("td.cur a[dstart]")).length&&(f=new Date())&&(f.setTime(g.attr("dstart")),h=f.getMonth());return h};d.prototype.selectedDate=function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[dstart]"))&&(h={start:new Date(),end:new Date()},h.start.setTime(f.attr("dstart")),h.end.setTime(f.attr("dend")));return h};c.prototype._buildBody=function(A){var B=this,q=A.date,n=B._model.layout(),y=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),o=0,z=[],k,t,s,p,x,l=q.getFullYear(),h=4,v=JC.Calendar.lastIpt,f=JC.f.parseBool(v.attr("currentcanselect"));if(A.maxvalue&&f){var g=A.maxvalue.getMonth()+1,r;if(g%3!==0){A.maxvalue.setDate(1);A.maxvalue.setMonth(g+(3-(g%3)-1))}A.maxvalue.setDate(JC.f.maxDayOfMonth(A.maxvalue))}z.push("<tr>");for(var w=1,u=4;w<=u;w++){p=new Date(l,w*3-3,1);x=new Date(l,w*3-1,1);x.setDate(JC.f.maxDayOfMonth(x));var m=JC.Calendar.cnUnit.charAt(w%10);w>10&&(m="十"+m);s=JC.f.printf("{0}年 第{1}季度\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",l,JC.Calendar.getCnNum(w),JC.f.formatISODate(p),JC.f.formatISODate(x),JC.Calendar.cnWeek.charAt(p.getDay()%7),JC.Calendar.cnWeek.charAt(x.getDay()%7));k=[];if(A.minvalue&&p.getTime()<A.minvalue.getTime()){k.push("unable")}if(A.maxvalue&&x.getTime()>A.maxvalue.getTime()){k.push("unable")}if(q.getTime()>=p.getTime()&&q.getTime()<=x.getTime()){k.push("cur")}if(y>=p.getTime()&&y<=x.getTime()){k.push("today")}z.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',k.join(" "),s,m,p.getTime(),x.getTime(),w));if(w%2===0&&w!=u){z.push("</tr><tr>")}}z.push("</tr>");n.find("table.UTableBorder tbody").html(e(z.join("")))};c.prototype.updateSelected=function(j){var f=this,g,i,h;if(!j){h=this._model.selectedDate();h&&(g=h.start,i=h.end)}else{j=e(j);h=JC.f.getJqParent(j,"td");if(h&&h.hasClass("unable")){return}g=new Date();i=new Date();g.setTime(j.attr("dstart"));i.setTime(j.attr("dend"))}if(!(g&&i)){return}f._model.selector().val(JC.f.printf("{0} 至 {1}",JC.f.formatISODate(g),JC.f.formatISODate(i)));e(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"season",g,i]);JC.Calendar.hide()}}(jQuery));(function(f){JC.Calendar.monthdayTpl="";JC.Calendar.monthdayHeadAppendText="";function e(g){this._selector=g}JC.Calendar.MonthDayModel=e;function d(g){this._model=g}JC.Calendar.MonthDayView=d;JC.Calendar.clone(e,d);d.prototype.init=function(){var g=this;f(g).on("MonthDayToggle",function(h,i){var j=g._model.findItemByTimestamp(i.attr("dstart"));if(j.atd.hasClass("unable")){return}j.input.prop("checked",j.atd.hasClass("cur"));g._model.fixCheckall()});f(g).on("MonthDayInputToggle",function(h,i){var j=g._model.findItemByTimestamp(i.attr("dstart"));if(!j.atd){f(g).trigger("MonthDayToggleAll",[i]);return}if(j.atd.hasClass("unable")){return}j.atd[j.input.prop("checked")?"addClass":"removeClass"]("cur");g._model.fixCheckall()});f(g).on("MonthDayToggleAll",function(h,k){var j=g._model.layout().find("a[dstart]"),i=k.prop("checked");if(!j.length){return}j.each(function(){var l=f(this),m=JC.f.getJqParent(l,"td");if(m.hasClass("unable")){return}m[i?"addClass":"removeClass"]("cur");f(g).trigger("MonthDayToggle",[l])})});return this};e.prototype.fixCheckall=function(){var h=this,g,j,k=true,i;h._fixCheckAllTm&&clearTimeout(h._fixCheckAllTm);h._fixCheckAllTm=setTimeout(function(){j=h.layout().find("input.js_JCCalendarCheckbox[action=all]");g=h.layout().find("input.js_JCCalendarCheckbox[dstart]");g.each(function(){i=f(this);var l=h.findItemByTimestamp(i.attr("dstart"));if(l.atd.hasClass("unable")){return}if(!i.prop("checked")){return k=false}});j.prop("checked",k)},100)};e.prototype.findItemByTimestamp=function(h){var g=this,i={a:null,atd:null,atr:null,input:null,inputtr:null,tm:h};if(h){i.a=g.layout().find(JC.f.printf("a[dstart={0}]",h));i.atd=JC.f.getJqParent(i.a,"td");i.atr=JC.f.getJqParent(i.a,"tr");i.input=g.layout().find(JC.f.printf("input[dstart={0}]",h));i.inputtr=JC.f.getJqParent(i.input,"tr")}return i};e.prototype.layout=function(){var h=f("#UXCCalendar_monthday");if(!h.length){h=f(JC.f.printf(JC.Calendar.monthdayTpl||this.tpl,JC.Calendar.monthdayHeadAppendText)).hide();h.attr("id","UXCCalendar_monthday").hide().appendTo(document.body);var g=f(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(h.find("select.UMonth"))}return h};e.prototype.tpl=['<div id="UXCCalendar_monthday" class="UXCCalendar UXCCalendar_week UXCCalendar_monthday" >','    <div class="UHeader">','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <button type="button" class="UButton UPreMonth">&nbsp;&nbsp;&lt;&nbsp;&nbsp;</button>','        <select class="UYear" style=""></select>','        <select class="UMonth"></select>',"        {0}",'        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UNextMonth">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</button>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");e.prototype.multiselect=function(){return true};e.prototype.multiselectDate=function(){var g=this,k=[],i,j,h;g.layout().find("input.js_JCCalendarCheckbox[dstart]").each(function(){i=f(this);if(!i.prop("checked")){return}h=new Date();h.setTime(i.attr("dstart"));k.push(h)});return k};e.prototype.ccPreserveDisabled=function(){var g=true;this.selector().is("[ccPreserveDisabled]")&&(g=JC.f.parseBool(this.selector().attr("ccPreserveDisabled")));return g};e.prototype.calendarclear=function(){var g=this,k=this.selector(),i,h;k&&k.attr("calendarclear")&&(h=window[k.attr("calendarclear")])&&(i=h);if(g.ccPreserveDisabled()){var l=g.layout().find("input[date]"),j=[];l.each(function(){var n=f(this),m;if(!(n.is(":disabled")&&n.is(":checked"))){return}m=new Date();m.setTime(n.attr("date"));j.push(JC.f.formatISODate(m))});k.val(j.join(","))}return i};d.prototype.updateSelected=function(o){var g=this,j,n,k,m,l;if(!o){k=this._model.multiselectDate();if(!k.length){return}l=[];for(var h=0;h<k.length;h++){l.push(JC.f.formatISODate(k[h]))}m=l.join(",")}else{o=f(o);k=JC.f.getJqParent(o,"td");if(k&&k.hasClass("unable")){return}if(g._model.multiselect()){k.toggleClass("cur");return}_date=new Date();_date.setTime(o.attr("date"));m=o.attr("date");m=JC.f.printf("{0}",JC.f.formatISODate(_date))}if(!m){return}if(k.length){g._model.selector().attr("placeholder",JC.f.printf("{0}年 {1}",k[0].getFullYear(),k[0].getMonth()+1));g._model.selector().attr("defaultdate",JC.f.formatISODate(k[0]))}g._model.selector().val(m);f(g).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"monthday",k]);JC.Calendar.hide()};e.prototype.fixedDate=function(i){var g=this,h=JC.Calendar.lastIpt,j;h&&!h.is("[defaultdate]")&&(j=JC.f.cloneDate(i.multidate[0].start),h.attr("defaultdate",JC.f.formatISODate(j)))};d.prototype._buildBody=function(m){var j=this,v=j._model.layout();var t=JC.f.maxDayOfMonth(m.date),h=[],n,o,l,u,s=new Date();j._model.fixedDate(m);JC.log(m.date);var p=[],g=[],q=[];var k=[],r=[];p.push('<tr><td><span class="bold">星期</span></td>');g.push('<tr><td><span class="bold">日期</span></td>');q.push('<tr class="Uchkdate"><td><label><span class="bold">全选</span>&nbsp;<input type="checkbox" class="js_JCCalendarCheckbox" action="all"  /></lable></td>');for(n=0;n<t;n++){l=new Date(m.date.getFullYear(),m.date.getMonth(),n+1);u=l.getDay();k=[];r=c(m,l,s).join(" ");if(u==0||u==6){k.push("red")}p.push(JC.f.printf('<td class="{0}">{1}</td>',k.join(" "),Calendar.cnWeek.charAt(u)));g.push(JC.f.printf('<td class="{0}"><a href="javascript:;" dstart="{1}" dend="{1}" title="{3}" >{2}</a></td>',r,l.getTime(),n+1,JC.f.formatISODate(l)));q.push(JC.f.printf('<td><input type="checkbox" date="{1}" dstart="{1}" dend="{1}" class="js_JCCalendarCheckbox" action="item" {3} {4} title="{2}" /></td>',"",l.getTime(),JC.f.formatISODate(l),(!/\bunable\b/.test(r)&&(/\bcur\b/.test(r)))?"checked":"",/\bunable\b/.test(r)?"disabled":""));l.setDate(l.getDate()+1);u=l.getDay()}p.push("</tr>");g.push("</tr>");q.push("</tr>");h=h.concat(p,g,q);v.find("table.UTableBorder tbody").html(f(h.join("")));j._model.fixCheckall()};function c(m,l,n){var g=[];if(m.minvalue){if(l.getTime()<m.minvalue.getTime()){g.push("unable")}}if(m.maxvalue){if(l.getTime()>m.maxvalue.getTime()){g.push("unable")}}if(JC.f.isSameDay(l,n)){g.push("today")}for(var k=0,h=m.multidate.length;k<h;k++){if(JC.f.isSameDay(m.multidate[k].start,l)){g.push("cur");break}}return g}f(document).delegate("#UXCCalendar_monthday a[dstart]","click",function(i){var h=JC.Calendar.lastIpt,j,k,g=f(this);if(!h){return}j=JC.Calendar.type(h);k=JC.Calendar.getInstance(h);if(!k){return}f(k._view).trigger("MonthDayToggle",[g])});f(document).delegate("#UXCCalendar_monthday input.js_JCCalendarCheckbox","click",function(i){var h=JC.Calendar.lastIpt,j,k,g=f(this);if(!h){return}j=JC.Calendar.type(h);k=JC.Calendar.getInstance(h);if(!k){return}f(k._view).trigger("MonthDayInputToggle",[g])})}(jQuery));return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));