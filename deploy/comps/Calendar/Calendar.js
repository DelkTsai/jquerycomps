(function(b,a){b(["JC.common"],function(){(function(k){window.JC=window.JC||{log:function(){}};window.Calendar=JC.Calendar=f;function f(s){if(f.getInstance(s)){return f.getInstance(s)}f.getInstance(s,this);var t=f.type(s);JC.log("Calendar init:",t,new Date().getTime());switch(t){case"week":this._model=new f.WeekModel(s);this._view=new f.WeekView(this._model);break;case"month":this._model=new f.MonthModel(s);this._view=new f.MonthView(this._model);break;case"season":this._model=new f.SeasonModel(s);this._view=new f.SeasonView(this._model);break;case"year":this._model=new f.YearModel(s);this._view=new f.YearView(this._model);break;case"monthday":this._model=new f.MonthDayModel(s);this._view=new f.MonthDayView(this._model);break;default:this._model=new f.Model(s);this._view=new f.View(this._model);break}this._init()}f.prototype={_init:function(){var s=this;s._initHanlderEvent();k([s._view,s._model]).on("BindEvent",function(t,v,u){s.on(v,u)});k([s._view,s._model]).on("TriggerEvent",function(t,v){var u=JC.f.sliceArgs(arguments).slice(2);s.trigger(v,u)});s._model.init();s._view.init();return s},_initHanlderEvent:function(){var s=this;s.on(f.Model.INITED,function(t){s._model.calendarinited()&&s._model.calendarinited().call(s._model.selector(),s._model.layout(),s)});s.on(f.Model.SHOW,function(t){s._model.calendarshow()&&s._model.calendarshow().call(s._model.selector(),s._model.selector(),s)});s.on(f.Model.HIDE,function(t){s._model.calendarhide()&&s._model.calendarhide().call(s._model.selector(),s._model.selector(),s)});s.on(f.Model.UPDATE,function(t){if(!s._model.selector()){return}s._model.selector().blur();s._model.selector().trigger("change");var v=[],E=s._model.selector().val().trim(),u,y,B,C,A,D;if(E){B=E.split(",");for(var x=0,w=B.length;x<w;x++){if(s._model.dateParse(s._model.selector())){var z=s._model.dateParse(s._model.selector())(B[x]);u=z.start;y=z.end;!y&&(y=u)}else{C=B[x].replace(/[^\d]/g,"");if(C.length==16){A=JC.f.parseISODate(C.slice(0,8));D=JC.f.parseISODate(C.slice(8))}else{if(C.length==8){A=JC.f.parseISODate(C.slice(0,8));D=JC.f.cloneDate(A)}}if(x===0){u=JC.f.cloneDate(A);y=JC.f.cloneDate(D)}}v.push({start:A,end:D})}}s._model.calendarupdate()&&s._model.calendarupdate().apply(s._model.selector(),[u,y,s]);s._model.multiselect()&&s._model.calendarupdatemultiselect()&&s._model.calendarupdatemultiselect().call(s._model.selector(),v,s)});s.on(f.Model.CLEAR,function(t){s._model.calendarclear()&&s._model.calendarclear().call(s._model.selector(),s._model.selector(),s)});s.on(f.Model.CANCEL,function(t){s._model.calendarcancel()&&s._model.calendarcancel().call(s._model.selector(),s._model.selector(),s)});s.on(f.Model.LAYOUT_CHANGE,function(t){s._model.calendarlayoutchange()&&s._model.calendarlayoutchange().call(s._model.selector(),s._model.selector(),s)});s.on(f.Model.UPDATE_MULTISELECT,function(t){s._model.multiselect()&&s._model.calendarupdatemultiselect()&&s._model.calendarupdatemultiselect().call(s._model.selector(),s._model.selector(),s)});return s},show:function(){f.hide();f.lastIpt=this._model.selector();this._view.show();this.trigger(f.Model.SHOW);return this},hide:function(){this._view.hide();this.trigger(f.Model.HIDE);this.selector()&&this.selector().blur();return this},selector:function(){return this._model.selector()},layout:function(){return this._model.layout()},on:function(t,s){k(this).on(t,s);return this},trigger:function(t,s){k(this).trigger(t,s);return this},updateLayout:function(){this._view.updateLayout();return this},updateSelector:function(s){f.lastIpt=s;this._model&&this._model.selector(s);return this},updateYear:function(s){this._view&&this._view.updateYear(s);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateMonth:function(s){this._view&&this._view.updateMonth(s);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateSelected:function(s){JC.log("JC.Calendar: updateSelector",new Date().getTime());this._view&&this._view.updateSelected(s);return this},updatePosition:function(){this._view&&this._view.updatePosition();return this},clear:function(){var s=!this._model.selector().val().trim();this._model&&this._model.selector().val("");!s&&this.trigger(f.Model.CLEAR);return this},cancel:function(){this.trigger(f.Model.CANCEL);this._view&&this._view.hide();return this},visible:function(){var t,s;this._model&&(s=this._model.layout())&&(t=s.is(":visible"));return t},defaultDate:function(s){return this._model.defaultDate(s)}};f.getInstance=function(s,u){typeof s=="string"&&!/</.test(s)&&(s=k(s));if(!(s&&s.length)||(typeof s=="string")){return}var t=f.type(s);typeof u!="undefined"&&(f._ins[t]=u);f._ins[t]&&f._ins[t].updateSelector(s);return f._ins[t]};f._ins={};f.type=function(s){s=k(s);var u,t=k.trim(s.attr("multidate")||"").toLowerCase()||k.trim(s.attr("datatype")||"").toLowerCase();switch(t){case"week":case"month":case"season":case"year":case"monthday":u=t;break;default:u="date";break}return u};f.isCalendar=function(s){s=k(s);var t=0;if(s.length){if(s.hasClass("UXCCalendar_btn")){t=1}if(s.prop("nodeName")&&s.attr("datatype")&&(s.prop("nodeName").toLowerCase()=="input"||s.prop("nodeName").toLowerCase()=="button")&&(s.attr("datatype").toLowerCase()=="date"||s.attr("datatype").toLowerCase()=="week"||s.attr("datatype").toLowerCase()=="month"||s.attr("datatype").toLowerCase()=="season"||s.attr("datatype").toLowerCase()=="year"||s.attr("datatype").toLowerCase()=="daterange"||s.attr("datatype").toLowerCase()=="monthday")){t=1}if(s.prop("nodeName")&&s.attr("multidate")&&(s.prop("nodeName").toLowerCase()=="input"||s.prop("nodeName").toLowerCase()=="button")){t=1}}return t};f.isCalendarElement=function(s){return f.isCalendar(s)};f.pickDate=function(s){s=k(s);if(!(s&&s.length)){return}var t,u=s.is("[ignoreprocess]");s.attr("ignoreprocess",true);s.blur();!u&&s.removeAttr("ignoreprocess");t=f.getInstance(s);!t&&(t=new f(s));t.show();return};f.autoInit=true;f.defaultDateSpan=20;f.lastIpt=null;f.tpl="";f.layoutInitedCallback=null;f.layoutShowCallback=null;f.layoutHideCallback=null;f.domClickFilter=null;f.hide=function(){for(var s in f._ins){f._ins[s]&&f._ins[s].visible()&&f._ins[s].hide()}};f.getDate=function(s){return f.getInstance(s).defaultDate()};f.cnWeek="日一二三四五六";f.cnUnit="十一二三四五六七八九";f.getCnNum=function(s){var t=f.cnUnit.charAt(s%10);s>10&&(t=(s%10!==0?f.cnUnit.charAt(0):"")+t);s>19&&(t=f.cnUnit.charAt(Math.floor(s/10))+t);return t};f.position=function(s){f.getInstance(s)&&f.getInstance(s).updatePosition()};f.setPosition=f.position;f.initTrigger=function(s){s.each(function(){var v=k(this),u=(v.prop("nodeName")||"").toLowerCase(),x,t;if(u!="input"&&u!="textarea"){f.initTrigger(s.find("input[type=text], textarea"));return}t=k.trim(v.attr("datatype")||"").toLowerCase();if(!(t=="date"||t=="week"||t=="month"||t=="season"||t=="year"||t=="daterange"||t=="monthday"||k.trim(v.attr("multidate")||""))){return}var w=v.find("+ input.UXCCalendar_btn");if(!w.length){v.after(w=k('<input type="button" class="UXCCalendar_btn"  />'))}!v.is("[dateFormat]")&&(x=v.val().trim())&&(x=JC.f.dateDetect(x))&&v.val(JC.f.formatISODate(x));(x=(v.attr("minvalue")||""))&&(x=JC.f.dateDetect(x))&&v.attr("minvalue",JC.f.formatISODate(x));(x=(v.attr("maxvalue")||""))&&(x=JC.f.dateDetect(x))&&v.attr("maxvalue",JC.f.formatISODate(x));if((v.attr("datatype")||"").toLowerCase()=="monthday"||(v.attr("multidate")||"").toLowerCase()=="monthday"){if(!v.is("[placeholder]")){var y=new Date();v.attr("defaultdate")&&(y=JC.f.parseISODate(v.attr("defaultdate"))||y);v.val().trim()&&(y=JC.f.parseISODate(v.val().replace(/[^d]/g,"").slice(0,8))||y);y&&v.attr("placeholder",JC.f.printf("{0}年 {1}月",y.getFullYear(),y.getMonth()+1))}}w.data(f.Model.INPUT,v)})};f.updateMultiYear=function(t,u){var v,s;v=t.getDate();t.setDate(1);t.setFullYear(t.getFullYear()+u);s=JC.f.maxDayOfMonth(t);v>s&&(v=s);t.setDate(v);return t};f.updateMultiMonth=function(t,u){var v,s;v=t.getDate();t.setDate(1);t.setMonth(t.getMonth()+u);s=JC.f.maxDayOfMonth(t);v>s&&(v=s);t.setDate(v);return t};f.clone=function(t,u){var s;if(t){for(s in g.prototype){t.prototype[s]=g.prototype[s]}}if(u){for(s in c.prototype){u.prototype[s]=c.prototype[s]}}};function g(s){this._selector=s}f.Model=g;f.Model.INPUT="CalendarInput";f.Model.INITED="CalendarInited";f.Model.SHOW="CalendarShow";f.Model.HIDE="CalendarHide";f.Model.UPDATE="CalendarUpdate";f.Model.CLEAR="CalendarClear";f.Model.CANCEL="CalendarCancel";f.Model.LAYOUT_CHANGE="CalendarLayoutChange";f.Model.UPDATE_MULTISELECT="CalendarUpdateMultiSelect";g.prototype={init:function(){return this},selector:function(s){typeof s!="undefined"&&(this._selector=s);return this._selector},layout:function(){var t=k("#UXCCalendar");if(!t.length){t=k(f.tpl||this.tpl).hide();t.attr("id","UXCCalendar").hide().appendTo(document.body);var s=k(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(t.find("select.UMonth"))}return t},startYear:function(t){var s=f.defaultDateSpan,u=t.date.getFullYear();this.selector().is("[calendardatespan]")&&(s=parseInt(this.selector().attr("calendardatespan"),10));return u-s},endYear:function(t){var s=f.defaultDateSpan,u=t.date.getFullYear();this.selector().is("[calendardatespan]")&&(s=parseInt(this.selector().attr("calendardatespan"),10));return u+s},currentcanselect:function(){var s=true;this.selector().is("[currentcanselect]")&&(s=JC.f.parseBool(this.selector().attr("currentcanselect")));return s},year:function(){return parseInt(this.layout().find("select.UYear").val(),10)||1},month:function(){return parseInt(this.layout().find("select.UMonth").val(),10)||0},day:function(){var t,s=new Date();t=this.layout().find("td.cur > a[date], td.cur > a[dstart]");if(t.length){s.setTime(t.attr("date")||t.attr("dstart"))}JC.log("dddddd",s.getDate());return s.getDate()},defaultDate:function(){var s=this,t={date:null,minvalue:null,maxvalue:null,enddate:null,multidate:null};s.selector()&&(t=s.multiselect()?s.defaultMultiselectDate(t):s.defaultSingleSelectDate(t));if(s.dateParse(s.selector())){s.selector().is("[minvalue]")&&(t.minvalue=(s.dateParse(s.selector())(s.selector().attr("minvalue"))).start);s.selector().is("[maxvalue]")&&(t.maxvalue=(s.dateParse(s.selector())(s.selector().attr("maxvalue"))).start)}else{s.selector().is("[minvalue]")&&(t.minvalue=JC.f.parseISODate(s.selector().attr("minvalue")));s.selector().is("[maxvalue]")&&(t.maxvalue=JC.f.parseISODate(s.selector().attr("maxvalue")))}return t},defaultSingleSelectDate:function(x){var s=this,t=s.selector(),v,u=t.val().trim();if(!u){x.date=new Date();x.enddate=JC.f.cloneDate(x.date);return x}if(s.dateParse(s.selector())){var w=s.dateParse(s.selector())(s.selector().val().trim());x.date=w.start;x.enddate=w.end;!x.enddate&&(x.enddate=x.date)}else{if(v=JC.f.parseISODate(t.val())){x.date=v}else{if(t.val()&&(v=t.val().replace(/[^\d]/g,"")).length==16){x.date=JC.f.parseISODate(v.slice(0,8));x.enddate=JC.f.parseISODate(v.slice(8))}else{v=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){v=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||v}x.date=new Date(v.getFullYear(),v.getMonth(),v.getDate())}}}return x},defaultMultiselectDate:function(y){var s=this,t=f.lastIpt,w,u,v,x;if(t.val()){w=t.val().trim().replace(/[^\d,]/g,"").split(",");u=[];k.each(w,function(A,z){if(s.dateParse(t)){var B=s.dateParse(t)(z);v=B.start;x=B.end;!x&&(x=v);u.push({start:v,end:x})}else{if(z.length==16){v=JC.f.parseISODate(z.slice(0,8));x=JC.f.parseISODate(z.slice(8));if(!A){y.date=JC.f.cloneDate(v);y.enddate=JC.f.cloneDate(x)}u.push({start:v,end:x})}else{if(z.length==8){v=JC.f.parseISODate(z.slice(0,8));x=JC.f.cloneDate(v);if(!A){y.date=JC.f.cloneDate(v);y.enddate=JC.f.cloneDate(x)}u.push({start:v,end:x})}}}});y.multidate=u}else{w=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){w=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||w}y.date=new Date(w.getFullYear(),w.getMonth(),w.getDate());y.enddate=JC.f.cloneDate(y.date);y.enddate.setDate(JC.f.maxDayOfMonth(y.enddate));y.multidate=[];y.multidate.push({start:JC.f.cloneDate(y.date),end:JC.f.cloneDate(y.enddate)})}return y},layoutDate:function(){return this.multiselect()?this.multiLayoutDate():this.singleLayoutDate()},singleLayoutDate:function(){var s=this,v=s.defaultDate(),u=this.day(),t;v.date.setDate(1);v.date.setFullYear(this.year());v.date.setMonth(this.month());t=JC.f.maxDayOfMonth(v.date);u>t&&(u=t);v.date.setDate(u);return v},multiLayoutDate:function(){JC.log("Calendar.Model multiLayoutDate",new Date().getTime());var s=this,w=s.defaultDate(),v=s.year(),u=s.month(),t=s.layout().find("select.UMonth");w.multidate=[];s.layout().find("td.cur").each(function(){var x=k(this);var z=x.find("> a[dstart]"),y=new Date(),A=new Date();y.setTime(z.attr("dstart"));A.setTime(z.attr("dend"));w.multidate.push({start:y,end:A})});w.date.setFullYear(v);w.enddate.setFullYear(v);if(t.length){w.date.setMonth(u);w.enddate.setMonth(u)}k.each(w.multidate,function(y,x){x.start.setFullYear(v);x.end.setFullYear(v);if(t.length){x.start.setMonth(u);x.end.setMonth(u)}});return w},selectedDate:function(){var u,t,s;t=this.layout().find("td.cur");t.length&&!t.hasClass("unable")&&(s=t.find("a[date]"))&&(u=new Date(),u.setTime(s.attr("date")));return u},multiselectDate:function(){var s=[];return s},calendarinited:function(){var u=this.selector(),t=f.layoutInitedCallback,s;u&&u.attr("calendarinited")&&(s=window[u.attr("calendarinited")])&&(t=s);return t},calendarshow:function(){var u=this.selector(),t=f.layoutShowCallback,s;u&&u.attr("calendarshow")&&(s=window[u.attr("calendarshow")])&&(t=s);return t},calendarhide:function(){var u=this.selector(),t=f.layoutHideCallback,s;u&&u.attr("calendarhide")&&(s=window[u.attr("calendarhide")])&&(t=s);return t},calendarupdate:function(u){var v=this.selector(),t,s;v&&v.attr("calendarupdate")&&(s=window[v.attr("calendarupdate")])&&(t=s);return t},calendarclear:function(){var u=this.selector(),t,s;u&&u.attr("calendarclear")&&(s=window[u.attr("calendarclear")])&&(t=s);return t},calendarcancel:function(){var u=this.selector(),t,s;u&&u.attr("calendarcancel")&&(s=window[u.attr("calendarcancel")])&&(t=s);return t},calendarlayoutchange:function(){var u=this.selector(),t,s;u&&u.attr("calendarlayoutchange")&&(s=window[u.attr("calendarlayoutchange")])&&(t=s);return t},multiselect:function(){var s;this.selector().is("[multiselect]")&&(s=JC.f.parseBool(this.selector().attr("multiselect")));return s},calendarupdatemultiselect:function(u){var v=this.selector(),t,s;v&&v.attr("calendarupdatemultiselect")&&(s=window[v.attr("calendarupdatemultiselect")])&&(t=s);return t},dateFormat:function(t){var u="",s=this.selector().attr("dateFormat")||"YY-MM-DD";t&&(u=JC.f.dateFormat(t,s));return u},fullFormat:function(s,t){var v="",u=this.selector().attr("fullDateFormat")||"{0} 至 {1}";if(s&&t){v=JC.f.printf(u,this.dateFormat(s),this.dateFormat(t))}else{if(s){v=JC.f.printf(u,this.dateFormat(s))}else{if(t){v=JC.f.printf(u,this.dateFormat(t))}}}return v},dateParse:function(s){var t;s&&s.attr("dateParse")&&(t=window[s.attr("dateParse")]);return t},tpl:['<div id="UXCCalendar" class="UXCCalendar">','    <div class="UHeader">','        <select class="UYear"></select>','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>','        <select class="UMonth"></select>','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>',"    </div>",'    <table class="UTable">',"        <thead>","            <tr>","                <th>一</th>","                <th>二</th>","                <th>三</th>","                <th>四</th>","                <th>五</th>","                <th>六</th>","                <th>日</th>","            </tr>","        </thead>","   </table>",'   <table class="UTable UTableBorder">',"        <tbody>","           <!--<tr>",'                <td class="cur"><a href="#">2</a></td>','                <td class="unable"><a href="#">2</a></td>','                <td class="weekend cur"><a href="#">6</a></td>','                <td class="weekend hover"><a href="#">13</a></td>','                <td class="weekend other"><a href="#">41</a></td>','                <td class="weekend other"><a href="#">42</a></td>',"            </tr>-->","        </tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function c(s){this._model=s}f.View=c;c.prototype={init:function(){return this},hide:function(){this._model.layout().hide()},show:function(){var s=this._model.defaultDate();JC.log("Calendar.View: show",new Date().getTime(),JC.f.formatISODate(s.date));this._buildLayout(s);this._buildDone()},updateLayout:function(s){typeof s=="undefined"&&(s=this._model.layoutDate());this._buildLayout(s);this._buildDone()},updateYear:function(s){if(typeof s=="undefined"||s==0){return}this._model.multiselect()?this.updateMultiYear(s):this.updateSingleYear(s)},updateSingleYear:function(t){var v=this._model.layoutDate(),u=v.date.getDate(),s;v.date.setDate(1);v.date.setFullYear(v.date.getFullYear()+t);s=JC.f.maxDayOfMonth(v.date);u>s&&(u=s);v.date.setDate(u);this._buildLayout(v);this._buildDone()},updateMultiYear:function(t){var v=this._model.layoutDate(),u,s;JC.Calendar.updateMultiYear(v.date,t);JC.Calendar.updateMultiYear(v.enddate,t);if(v.multidate){k.each(v.multidate,function(x,w){JC.Calendar.updateMultiYear(w.start,t);JC.Calendar.updateMultiYear(w.end,t)})}this._buildLayout(v);this._buildDone()},updateMonth:function(s){if(typeof s=="undefined"||s==0){return}this._model.multiselect()?this.updateMultiMonth(s):this.updateSingleMonth(s)},updateMultiMonth:function(t){var v=this._model.layoutDate(),u,s;JC.Calendar.updateMultiMonth(v.date,t);JC.Calendar.updateMultiMonth(v.enddate,t);if(v.multidate){k.each(v.multidate,function(x,w){JC.Calendar.updateMultiMonth(w.start,t);JC.Calendar.updateMultiMonth(w.end,t)})}this._buildLayout(v);this._buildDone()},updateSingleMonth:function(t){var v=this._model.layoutDate(),u=v.date.getDate(),s;v.date.setDate(1);v.date.setMonth(v.date.getMonth()+t);s=JC.f.maxDayOfMonth(v.date);u>s&&(u=s);v.date.setDate(u);this._buildLayout(v);this._buildDone()},updateSelected:function(v){var s=this,t,u;if(!v){t=this._model.selectedDate()}else{v=k(v);u=JC.f.getJqParent(v,"td");if(u&&u.hasClass("unable")){return}t=new Date();t.setTime(v.attr("date"))}if(!t){return}s._model.selector().val(s._model.dateFormat(t));k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"date",t,t]);f.hide()},updatePosition:function(){var u=this,s=u._model.selector(),F=u._model.layout();if(!(s&&F&&s.length&&F.length)){return}F.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var D=F.width(),w=F.height(),E=s.width(),x=s.height(),C=s.offset(),A,y,t=k(window).width(),z=k(window).height(),B=k(document).scrollLeft(),v=k(document).scrollTop();A=C.left;y=C.top+x+5;if((y+w-v)>z){JC.log("y overflow");y=C.top-w-3;y<v&&(y=v)}if((A+D-B)>t){A=t-D+B-5}A<B&&(A=B+0);F.css({left:A+"px",top:y+"px"});JC.log(D,w,E,x,C.left,C.top,t,z);JC.log(v,A,y)},_buildDone:function(){this.updatePosition();k(this).trigger("TriggerEvent",[f.Model.INITED])},_buildLayout:function(s){this._model.layout();if(!(s&&s.date)){return}this._buildHeader(s);this._buildBody(s);this._buildFooter(s)},_buildHeader:function(v){var t=this,A=t._model.layout(),s=[],y,w=w=v.date.getFullYear(),x=t._model.startYear(v),z=t._model.endYear(v);JC.log(x,z);for(var u=x;u<=z;u++){s.push(JC.f.printf('<option value="{0}"{1}>{0}</option>',u,u===w?" selected":""))}k(s.join("")).appendTo(A.find("select.UYear").html(""));k(A.find("select.UMonth").val(v.date.getMonth()))},_buildBody:function(z){var u=this,H=u._model.layout();var G=JC.f.maxDayOfMonth(z.date),B=z.date.getDay()||7,F=B+G,w=6,t=[],v,s,D,y,A;var x=new Date(z.date.getFullYear(),z.date.getMonth(),1);var C=x.getDay()||7;if(C<2){x.setDate(-(C-1+6))}else{x.setDate(-(C-2))}var E=new Date();if(z.maxvalue&&!u._model.currentcanselect()){z.maxvalue.setDate(z.maxvalue.getDate()-1)}t.push("<tr>");for(y=1;y<=42;y++){A=[];if(x.getDay()===0||x.getDay()==6){A.push("weekend")}if(!JC.f.isSameMonth(z.date,x)){A.push("other")}if(z.minvalue&&x.getTime()<z.minvalue.getTime()){A.push("unable")}if(z.maxvalue&&x.getTime()>z.maxvalue.getTime()){A.push("unable")}if(JC.f.isSameDay(x,E)){A.push("today")}if(JC.f.isSameDay(z.date,x)){A.push("cur")}t.push('<td class="',A.join(" "),'">','<a href="javascript:" date="',x.getTime(),'" title="'+JC.f.formatISODate(x)+'" >',x.getDate(),"</a></td>");x.setDate(x.getDate()+1);if(y%7===0&&y!=42){t.push("</tr><tr>")}}t.push("</tr>");H.find("table.UTableBorder tbody").html(k(t.join("")))},_buildFooter:function(s){}};k(document).delegate("body > div.UXCCalendar select.UYear, body > div.UXCCalendar select.UMonth","change",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateLayout()});k(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(1)});k(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(-1)});k(document).delegate("map[name=UXCCalendar_Year] area","click",function(t){t.preventDefault();var s=k(this),u=f.getInstance(f.lastIpt);s.attr("action")&&u&&(s.attr("action").toLowerCase()=="up"&&u.updateYear(1),s.attr("action").toLowerCase()=="down"&&u.updateYear(-1))});k(document).delegate("map[name=UXCCalendar_Month] area","click",function(t){t.preventDefault();var s=k(this),u=f.getInstance(f.lastIpt);s.attr("action")&&u&&(s.attr("action").toLowerCase()=="up"&&u.updateMonth(1),s.attr("action").toLowerCase()=="down"&&u.updateMonth(-1))});k(document).delegate("body > div.UXCCalendar button.UNextMonth","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(1)});k(document).delegate("body > div.UXCCalendar button.UPreMonth","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(-1)});k(document).delegate("div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]","click",function(s){s.preventDefault();f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected(k(this))});k(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected()});k(document).delegate("body > div.UXCCalendar button.UClear","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).clear()});k(document).delegate("body > div.UXCCalendar button.UCancel","click",function(s){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).cancel()});k(document).delegate("input.UXCCalendar_btn","click",function(t){var s=k(this),u;if(!s.data(f.Model.INPUT)){u=s.prev("input[type=text], textarea");u.length&&s.data(f.Model.INPUT,u)}s.data(f.Model.INPUT)&&!s.data(f.Model.INPUT).is("[disabled]")&&f.pickDate(s.data(f.Model.INPUT))});k(document).delegate("body > div.UXCCalendar","click",function(s){s.stopPropagation()});k(document).ready(function(s){setTimeout(function(u){if(!f.autoInit){return}f.initTrigger(k(document))},200);k(window).on("scroll resize",function(u){var v=f.getInstance(f.lastIpt);v&&v.visible()&&v.updatePosition()});var t=null;k(document).on("click",function(u){var v=u.target||u.srcElement;if(f.domClickFilter){if(f.domClickFilter(k(v))===false){return}}if(f.isCalendar(u.target||u.targetElement)){return}if(v&&(v.nodeName.toLowerCase()!="input"&&v.nodeName.toLowerCase()!="button"&&v.nodeName.toLowerCase()!="textarea")){f.hide();return}t&&clearTimeout(t);t=setTimeout(function(){if(f.lastIpt&&f.lastIpt.length&&v==f.lastIpt[0]){return}f.hide()},100)})});k(document).delegate(["input[datatype=year]","input[datatype=season]","input[datatype=month]","input[datatype=week]","input[datatype=date]","input[datatype=daterange]","input[multidate], input[datatype=monthday]"].join(),"focus",function(s){f.pickDate(this)});k(document).delegate(["button[datatype=year]","button[datatype=season]","button[datatype=month]","button[datatype=week]","button[datatype=date]","button[datatype=daterange]","button[multidate], button[datatype=monthday]"].join(),"click",function(s){f.pickDate(this)});k(document).delegate(["textarea[datatype=year]","textarea[datatype=season]","textarea[datatype=month]","textarea[datatype=week]","textarea[datatype=date]","textarea[datatype=daterange]","textarea[multidate], textarea[datatype=monthday]"].join(),"click",function(s){f.pickDate(this)});JC.Calendar.weekTpl="";JC.Calendar.weekDayOffset=0;function h(s){this._selector=s}JC.Calendar.WeekModel=h;function o(s){this._model=s}JC.Calendar.WeekView=o;JC.Calendar.clone(h,o);JC.f.extendObject(h.prototype,{layout:function(){var s=k("#UXCCalendar_week");if(!s.length){s=k(JC.Calendar.weekTpl||this.tpl).hide();s.attr("id","UXCCalendar_week").hide().appendTo(document.body)}return s},tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var u=0,t,s=new Date();(t=this.layout().find("td.cur a[dstart]")).length&&(s=new Date())&&(s.setTime(t.attr("dstart")));u=s.getMonth();return u},selectedDate:function(){var u,t,s;t=this.layout().find("td.cur");t.length&&!t.hasClass("unable")&&(s=t.find("a[dstart]"))&&(u={start:new Date(),end:new Date()},u.start.setTime(s.attr("dstart")),u.end.setTime(s.attr("dend")));return u},singleLayoutDate:function(){var t=this,w=t.defaultDate(),v=this.day(),u,s=t.layout().find("td.cur > a[week]");w.date.setDate(1);w.date.setFullYear(this.year());w.date.setMonth(this.month());u=JC.f.maxDayOfMonth(w.date);v>u&&(v=u);w.date.setDate(v);s.length&&(w.curweek=parseInt(s.attr("week"),10));JC.log("WeekModel.singleLayoutDate:",s.length,w.curweek);return w}});JC.f.extendObject(o.prototype,{_buildBody:function(K){var M=this,A=K.date,w=M._model.layout(),I=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),x=r(A.getFullYear(),JC.Calendar.weekDayOffset),H=r(A.getFullYear()+1,JC.Calendar.weekDayOffset),y=0,J=[],u,C,B,z,G,v=A.getFullYear(),t=Math.ceil(x.length/8),E=JC.Calendar.lastIpt,s=JC.f.parseBool(E.attr("currentcanselect"));if(K.maxvalue&&s){var L=K.maxvalue.getDay();if(L>0){K.maxvalue.setDate(K.maxvalue.getDate()+(7-L))}}J.push("<tr>");for(var F=1,D=t*8;F<=D;F++){C=x[F-1];if(!C){C=H[y++];v=A.getFullYear()+1}z=new Date();G=new Date();z.setTime(C.start);G.setTime(C.end);B=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",v,JC.Calendar.getCnNum(C.week),JC.f.formatISODate(z),JC.f.formatISODate(G),JC.Calendar.cnWeek.charAt(z.getDay()%7),JC.Calendar.cnWeek.charAt(G.getDay()%7));u=[];if(K.minvalue&&z.getTime()<K.minvalue.getTime()){u.push("unable")}if(K.maxvalue&&G.getTime()>K.maxvalue.getTime()){u.push("unable")}if(K.curweek){if(C.week==K.curweek&&A.getFullYear()==z.getFullYear()){u.push("cur")}}else{if(A.getTime()>=z.getTime()&&A.getTime()<=G.getTime()){u.push("cur")}}if(I>=z.getTime()&&I<=G.getTime()){u.push("today")}J.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',u.join(" "),C.week,B,z.getTime(),G.getTime(),K.date.getTime()));if(F%8===0&&F!=D){J.push("</tr><tr>")}}J.push("</tr>");w.find("table.UTableBorder tbody").html(k(J.join("")))},updateSelected:function(w){var s=this,t,v,u;if(!w){u=this._model.selectedDate();u&&(t=u.start,v=u.end)}else{w=k(w);u=JC.f.getJqParent(w,"td");if(u&&u.hasClass("unable")){return}t=new Date();v=new Date();t.setTime(w.attr("dstart"));v.setTime(w.attr("dend"))}if(!(t&&v)){return}s._model.selector().val(s._model.fullFormat(s._model.dateFormat(t),s._model.dateFormat(v)));k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",t,v]);JC.Calendar.hide()}});function r(v,u){var x=[],w,t=1,u=u||0,v=parseInt(v,10),s=new Date(v,0,1);s.getDay()>1&&s.setDate(s.getDate()-s.getDay()+7);s.getDay()===0&&s.setDate(s.getDate()+1);u>0&&(u=(new Date(2000,1,2)-new Date(2000,1,1))*u);while(s.getFullYear()<=v){w={week:t++,start:null,end:null};w.start=s.getTime()+u;s.setDate(s.getDate()+6);w.end=s.getTime()+u;s.setDate(s.getDate()+1);if(s.getFullYear()>v){s=new Date(s.getFullYear(),0,1);if(s.getDay()<2){break}}x.push(w)}return x}JC.Calendar.monthTpl="";function d(s){this._selector=s}JC.Calendar.MonthModel=d;function l(s){this._model=s}JC.Calendar.MonthView=l;JC.Calendar.clone(d,l);JC.f.extendObject(d.prototype,{layout:function(){var s=k("#UXCCalendar_month");if(!s.length){s=k(JC.Calendar.monthTpl||this.tpl).hide();s.attr("id","UXCCalendar_month").hide().appendTo(document.body)}return s},tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var u=0,t,s;(t=this.layout().find("td.cur a[dstart]")).length&&(s=new Date())&&(s.setTime(t.attr("dstart")),u=s.getMonth());return u},selectedDate:function(){var u,t,s;t=this.layout().find("td.cur");t.length&&!t.hasClass("unable")&&(s=t.find("a[dstart]"))&&(u={start:new Date(),end:new Date()},u.start.setTime(s.attr("dstart")),u.end.setTime(s.attr("dend")));return u},multiselectDate:function(){var s=this,x=[],t,v,u,w;s.layout().find("td.cur").each(function(){t=k(this);v=t.find("> a[dstart]");if(t.hasClass("unable")){return}u=new Date();w=new Date();u.setTime(v.attr("dstart"));w.setTime(v.attr("dend"));x.push({start:u,end:w})});return x}});JC.f.extendObject(l.prototype,{_buildBody:function(K){var L=this,A=K.date,x=L._model.layout(),I=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),z=0,J=[],u,C,B,H,D,v=A.getFullYear(),t=4,F=JC.Calendar.lastIpt,s=JC.f.parseBool(F.attr("currentcanselect")),y=K.multidate?K.multidate.slice():null;if(K.maxvalue&&s){K.maxvalue.setDate(JC.f.maxDayOfMonth(K.maxvalue))}J.push("<tr>");for(var G=1,E=12;G<=E;G++){H=new Date(v,G-1,1);D=new Date(v,G-1,JC.f.maxDayOfMonth(H));B=JC.f.printf("{0}年 {1}月\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",v,JC.Calendar.getCnNum(G),JC.f.formatISODate(H),JC.f.formatISODate(D),JC.Calendar.cnWeek.charAt(H.getDay()%7),JC.Calendar.cnWeek.charAt(D.getDay()%7));u=[];if(K.minvalue&&H.getTime()<K.minvalue.getTime()){u.push("unable")}if(K.maxvalue&&D.getTime()>K.maxvalue.getTime()){u.push("unable")}if(y){k.each(y,function(N,M){if(H.getTime()>=M.start.getTime()&&H.getTime()<=M.end.getTime()){u.push("cur");y.splice(N,1);return false}})}else{if(A.getTime()>=H.getTime()&&A.getTime()<=D.getTime()){u.push("cur")}}if(I>=H.getTime()&&I<=D.getTime()){u.push("today")}var w=JC.Calendar.cnUnit.charAt(G%10);G>10&&(w="十"+w);J.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',u.join(" "),B,w,H.getTime(),D.getTime(),G));if(G%3===0&&G!=E){J.push("</tr><tr>")}}J.push("</tr>");x.find("table.UTableBorder tbody").html(k(J.join("")))},updateSelected:function(y){var s=this,t,x,u,w,v;if(!y){if(s._model.multiselect()){u=this._model.multiselectDate();if(!u.length){return}v=[];k.each(u,function(A,z){v.push(w=s._model.fullFormat(s._model.dateFormat(z.start),s._model.dateFormat(z.end)))});w=v.join(",")}else{u=this._model.selectedDate();u&&(t=u.start,x=u.end);t&&x&&(w=s._model.fullFormat(s._model.dateFormat(t),s._model.dateFormat(x)))}}else{y=k(y);u=JC.f.getJqParent(y,"td");if(u&&u.hasClass("unable")){return}if(s._model.multiselect()){u.toggleClass("cur");return}t=new Date();x=new Date();t.setTime(y.attr("dstart"));x.setTime(y.attr("dend"));w=s._model.fullFormat(s._model.dateFormat(t),s._model.dateFormat(x))}if(!w){return}s._model.selector().val(w);k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"month",t,x]);JC.Calendar.hide()}});JC.Calendar.seasonTpl="";function i(s){this._selector=s}JC.Calendar.SeasonModel=i;function j(s){this._model=s}JC.Calendar.SeasonView=j;JC.Calendar.clone(i,j);JC.f.extendObject(i.prototype,{layout:function(){var s=k("#UXCCalendar_season");if(!s.length){s=k(JC.Calendar.seasonTpl||this.tpl).hide();s.attr("id","UXCCalendar_season").hide().appendTo(document.body)}return s},tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var u=0,t,s;(t=this.layout().find("td.cur a[dstart]")).length&&(s=new Date())&&(s.setTime(t.attr("dstart")),u=s.getMonth());return u},selectedDate:function(){var u,t,s;t=this.layout().find("td.cur");t.length&&!t.hasClass("unable")&&(s=t.find("a[dstart]"))&&(u={start:new Date(),end:new Date()},u.start.setTime(s.attr("dstart")),u.end.setTime(s.attr("dend")));return u}});JC.f.extendObject(j.prototype,{_buildBody:function(L){var M=this,B=L.date,y=M._model.layout(),J=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),z=0,K=[],v,E,D,A,I,w=B.getFullYear(),u=4,G=JC.Calendar.lastIpt,s=JC.f.parseBool(G.attr("currentcanselect"));if(L.maxvalue&&s){var t=L.maxvalue.getMonth()+1,C;if(t%3!==0){L.maxvalue.setDate(1);L.maxvalue.setMonth(t+(3-(t%3)-1))}L.maxvalue.setDate(JC.f.maxDayOfMonth(L.maxvalue))}K.push("<tr>");for(var H=1,F=4;H<=F;H++){A=new Date(w,H*3-3,1);I=new Date(w,H*3-1,1);I.setDate(JC.f.maxDayOfMonth(I));var x=JC.Calendar.cnUnit.charAt(H%10);H>10&&(x="十"+x);D=JC.f.printf("{0}年 第{1}季度\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",w,JC.Calendar.getCnNum(H),JC.f.formatISODate(A),JC.f.formatISODate(I),JC.Calendar.cnWeek.charAt(A.getDay()%7),JC.Calendar.cnWeek.charAt(I.getDay()%7));v=[];if(L.minvalue&&A.getTime()<L.minvalue.getTime()){v.push("unable")}if(L.maxvalue&&I.getTime()>L.maxvalue.getTime()){v.push("unable")}if(B.getTime()>=A.getTime()&&B.getTime()<=I.getTime()){v.push("cur")}if(J>=A.getTime()&&J<=I.getTime()){v.push("today")}K.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',v.join(" "),D,x,A.getTime(),I.getTime(),H));if(H%2===0&&H!=F){K.push("</tr><tr>")}}K.push("</tr>");y.find("table.UTableBorder tbody").html(k(K.join("")))},updateSelected:function(w){var s=this,t,v,u;if(!w){u=this._model.selectedDate();u&&(t=u.start,v=u.end)}else{w=k(w);u=JC.f.getJqParent(w,"td");if(u&&u.hasClass("unable")){return}t=new Date();v=new Date();t.setTime(w.attr("dstart"));v.setTime(w.attr("dend"))}if(!(t&&v)){return}s._model.selector().val(s._model.fullFormat(s._model.dateFormat(t),s._model.dateFormat(v)));k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"season",t,v]);JC.Calendar.hide()}});JC.Calendar.yearTpl="";function e(s){this._selector=s}JC.Calendar.YearModel=e;function m(s){this._model=s}JC.Calendar.YearView=m;JC.Calendar.clone(e,m);JC.f.extendObject(e.prototype,{layout:function(){var s=k("#UXCCalendar_year");if(!s.length){s=k(JC.Calendar.yearTpl||this.tpl).hide();s.attr("id","UXCCalendar_year").hide().appendTo(document.body)}return s},tpl:['<div id="UXCCalendar_year" class="UXCCalendar UXCCalendar_week UXCCalendar_year">\n','    <table class="UTable UTableBorder">\n',"        <tbody>\n","            <tr>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>\n',"                </td>\n","                <td></td><td></td><td></td><td></td>\n","            </tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr>\n","                <td></td><td></td><td></td><td></td>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>\n',"                </td>\n","            </tr>\n","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join(""),selectedDate:function(){var u,t,s;t=this.layout().find("td.cur");t.length&&!t.hasClass("unable")&&(s=t.find("a[dstart]"))&&(u={start:new Date(),end:new Date()},u.start.setTime(s.attr("dstart")),u.end.setTime(s.attr("dend")));return u}});JC.f.extendObject(m.prototype,{_buildBody:function(F){var I=this,H=I._model.selector(),B=H.val().trim(),J=B.replace(/[^\d]+/g,""),v=F.date,D=new Date().getFullYear(),w=I._model.layout(),E=w.find("tbody > tr > td"),G=E.length-1,A,x,u,s=JC.f.parseBool(H.attr("currentcanselect")),y,t,C,z;J&&(J=J.slice(0,4));!J&&(J=D);u=v.getFullYear();A=u-Math.floor(G/2);if(F.minvalue&&s){F.minvalue.setFullYear(F.minvalue.getFullYear()-1)}if(F.maxvalue&&s){F.maxvalue.setFullYear(F.maxvalue.getFullYear()+1)}E.each(function(L,K){K=k(K);if(L==0||L==G){}else{y=JC.f.printf("{0}年",A);t=[];C=new Date(A,0,1);z=new Date(A,11,31);if(F.minvalue&&C.getFullYear()<=F.minvalue.getFullYear()){t.push("unable")}if(F.maxvalue&&z.getFullYear()>=F.maxvalue.getFullYear()){t.push("unable")}J&&J==A&&t.push("cur");D==A&&t.push("today");K.html(JC.f.printf('<a href="javascript:" title="{0}" dstart="{1}" dend="{2}" " >{3}</a></td>',y,C.getTime(),z.getTime(),A));K.prop("className",t.join(" "))}A++})},updateSelected:function(w){var s=this,t,v,u;if(!w){u=this._model.selectedDate();u&&(t=u.start,v=u.end)}else{w=k(w);u=JC.f.getJqParent(w,"td");if(u&&u.hasClass("unable")){return}t=new Date();v=new Date();t.setTime(w.attr("dstart"));v.setTime(w.attr("dend"))}if(!(t&&v)){return}s._model.selector().val(s._model.fullFormat(s._model.dateFormat(t),s._model.dateFormat(v)));k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"year",t,v]);JC.Calendar.hide()},updateSingleYear:function(t){var y=this._model.layoutDate(),w=this._model.layout().find("a[dstart]"),z=w.first(),u=w.last(),v=new Date(),x=new Date(),s=17;if(t>0){v.setTime(u.attr("dstart"));x.setTime(u.attr("dend"));y.date=v;y.enddate=x;y.date.setFullYear(y.date.getFullYear()+s);y.enddate.setFullYear(y.enddate.getFullYear()+s)}else{v.setTime(z.attr("dstart"));x.setTime(z.attr("dend"));y.date=v;y.enddate=x;y.date.setFullYear(y.date.getFullYear()-s);y.enddate.setFullYear(y.enddate.getFullYear()-s)}this._buildLayout(y);this._buildDone()}});JC.Calendar.monthdayTpl="";JC.Calendar.monthdayHeadAppendText="";function q(s){this._selector=s}JC.Calendar.MonthDayModel=q;function p(s){this._model=s}JC.Calendar.MonthDayView=p;JC.Calendar.clone(q,p);JC.f.extendObject(q.prototype,{fixCheckall:function(){var t=this,s,v,w=true,u;t._fixCheckAllTm&&clearTimeout(t._fixCheckAllTm);t._fixCheckAllTm=setTimeout(function(){v=t.layout().find("input.js_JCCalendarCheckbox[action=all]");s=t.layout().find("input.js_JCCalendarCheckbox[dstart]");s.each(function(){u=k(this);var x=t.findItemByTimestamp(u.attr("dstart"));if(x.atd.hasClass("unable")){return}if(!u.prop("checked")){return w=false}});v.prop("checked",w)},100)},findItemByTimestamp:function(t){var s=this,u={a:null,atd:null,atr:null,input:null,inputtr:null,tm:t};if(t){u.a=s.layout().find(JC.f.printf("a[dstart={0}]",t));u.atd=JC.f.getJqParent(u.a,"td");u.atr=JC.f.getJqParent(u.a,"tr");u.input=s.layout().find(JC.f.printf("input[dstart={0}]",t));u.inputtr=JC.f.getJqParent(u.input,"tr")}return u},layout:function(){var t=k("#UXCCalendar_monthday");if(!t.length){t=k(JC.f.printf(JC.Calendar.monthdayTpl||this.tpl,JC.Calendar.monthdayHeadAppendText)).hide();t.attr("id","UXCCalendar_monthday").hide().appendTo(document.body);var s=k(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(t.find("select.UMonth"))}return t},tpl:['<div id="UXCCalendar_monthday" class="UXCCalendar UXCCalendar_week UXCCalendar_monthday" >','    <div class="UHeader">','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <button type="button" class="UButton UPreMonth">&nbsp;&nbsp;&lt;&nbsp;&nbsp;</button>','        <select class="UYear" style=""></select>','        <select class="UMonth"></select>',"        {0}",'        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UNextMonth">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</button>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),multiselect:function(){return true},multiselectDate:function(){var s=this,w=[],u,v,t;s.layout().find("input.js_JCCalendarCheckbox[dstart]").each(function(){u=k(this);if(!u.prop("checked")){return}t=new Date();t.setTime(u.attr("dstart"));w.push(t)});return w},ccPreserveDisabled:function(){var s=true;this.selector().is("[ccPreserveDisabled]")&&(s=JC.f.parseBool(this.selector().attr("ccPreserveDisabled")));return s},calendarclear:function(){var s=this,w=this.selector(),u,t;w&&w.attr("calendarclear")&&(t=window[w.attr("calendarclear")])&&(u=t);if(s.ccPreserveDisabled()){var x=s.layout().find("input[date]"),v=[];x.each(function(){var z=k(this),y;if(!(z.is(":disabled")&&z.is(":checked"))){return}y=new Date();y.setTime(z.attr("date"));v.push(JC.f.formatISODate(y))});w.val(v.join(","))}return u},fixedDate:function(u){var s=this,t=JC.Calendar.lastIpt,v;t&&!t.is("[defaultdate]")&&(v=JC.f.cloneDate(u.multidate[0].start),t.attr("defaultdate",JC.f.formatISODate(v)))}});JC.f.extendObject(p.prototype,{init:function(){var s=this;k(s).on("MonthDayToggle",function(t,u){var v=s._model.findItemByTimestamp(u.attr("dstart"));if(v.atd.hasClass("unable")){return}v.input.prop("checked",v.atd.hasClass("cur"));s._model.fixCheckall()});k(s).on("MonthDayInputToggle",function(t,u){var v=s._model.findItemByTimestamp(u.attr("dstart"));if(!v.atd){k(s).trigger("MonthDayToggleAll",[u]);return}if(v.atd.hasClass("unable")){return}v.atd[v.input.prop("checked")?"addClass":"removeClass"]("cur");s._model.fixCheckall()});k(s).on("MonthDayToggleAll",function(t,w){var v=s._model.layout().find("a[dstart]"),u=w.prop("checked");if(!v.length){return}v.each(function(){var x=k(this),y=JC.f.getJqParent(x,"td");if(y.hasClass("unable")){return}y[u?"addClass":"removeClass"]("cur");k(s).trigger("MonthDayToggle",[x])})});return this},updateSelected:function(z){var s=this,u,y,v,x,w;if(!z){v=this._model.multiselectDate();if(!v.length){return}w=[];for(var t=0;t<v.length;t++){w.push(JC.f.formatISODate(v[t]))}x=w.join(",")}else{z=k(z);v=JC.f.getJqParent(z,"td");if(v&&v.hasClass("unable")){return}if(s._model.multiselect()){v.toggleClass("cur");return}_date=new Date();_date.setTime(z.attr("date"));x=z.attr("date");x=JC.f.printf("{0}",JC.f.formatISODate(_date))}if(!x){return}if(v.length){s._model.selector().attr("placeholder",JC.f.printf("{0}年 {1}",v[0].getFullYear(),v[0].getMonth()+1));s._model.selector().attr("defaultdate",JC.f.formatISODate(v[0]))}s._model.selector().val(x);k(s).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"monthday",v]);JC.Calendar.hide()},_buildBody:function(x){var u=this,G=u._model.layout();var E=JC.f.maxDayOfMonth(x.date),t=[],y,z,w,F,D=new Date();u._model.fixedDate(x);JC.log(x.date);var A=[],s=[],B=[];var v=[],C=[];A.push('<tr><td><span class="bold">星期</span></td>');s.push('<tr><td><span class="bold">日期</span></td>');B.push('<tr class="Uchkdate"><td><label><span class="bold">全选</span>&nbsp;<input type="checkbox" class="js_JCCalendarCheckbox" action="all"  /></lable></td>');for(y=0;y<E;y++){w=new Date(x.date.getFullYear(),x.date.getMonth(),y+1);F=w.getDay();v=[];C=n(x,w,D).join(" ");if(F==0||F==6){v.push("red")}A.push(JC.f.printf('<td class="{0}">{1}</td>',v.join(" "),f.cnWeek.charAt(F)));s.push(JC.f.printf('<td class="{0}"><a href="javascript:;" dstart="{1}" dend="{1}" title="{3}" >{2}</a></td>',C,w.getTime(),y+1,JC.f.formatISODate(w)));B.push(JC.f.printf('<td><input type="checkbox" date="{1}" dstart="{1}" dend="{1}" class="js_JCCalendarCheckbox" action="item" {3} {4} title="{2}" /></td>',"",w.getTime(),JC.f.formatISODate(w),(!/\bunable\b/.test(C)&&(/\bcur\b/.test(C)))?"checked":"",/\bunable\b/.test(C)?"disabled":""));w.setDate(w.getDate()+1);F=w.getDay()}A.push("</tr>");s.push("</tr>");B.push("</tr>");t=t.concat(A,s,B);G.find("table.UTableBorder tbody").html(k(t.join("")));u._model.fixCheckall()}});function n(w,v,x){var s=[];if(w.minvalue){if(v.getTime()<w.minvalue.getTime()){s.push("unable")}}if(w.maxvalue){if(v.getTime()>w.maxvalue.getTime()){s.push("unable")}}if(JC.f.isSameDay(v,x)){s.push("today")}for(var u=0,t=w.multidate.length;u<t;u++){if(JC.f.isSameDay(w.multidate[u].start,v)){s.push("cur");break}}return s}k(document).delegate("#UXCCalendar_monthday a[dstart]","click",function(u){var t=JC.Calendar.lastIpt,v,w,s=k(this);if(!t){return}v=JC.Calendar.type(t);w=JC.Calendar.getInstance(t);if(!w){return}k(w._view).trigger("MonthDayToggle",[s])});k(document).delegate("#UXCCalendar_monthday input.js_JCCalendarCheckbox","click",function(u){var t=JC.Calendar.lastIpt,v,w,s=k(this);if(!t){return}v=JC.Calendar.type(t);w=JC.Calendar.getInstance(t);if(!w){return}k(w._view).trigger("MonthDayInputToggle",[s])})}(jQuery));return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));