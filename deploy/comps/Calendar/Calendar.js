(function(b,a){b(["JC.common"],function(){(function(c){window.JC=window.JC||{log:function(){}};window.Calendar=JC.Calendar=f;function f(g){if(f.getInstance(g)){return f.getInstance(g)}f.getInstance(g,this);var h=f.type(g);JC.log("Calendar init:",h,new Date().getTime());switch(h){case"week":this._model=new f.WeekModel(g);this._view=new f.WeekView(this._model);break;case"month":this._model=new f.MonthModel(g);this._view=new f.MonthView(this._model);break;case"season":this._model=new f.SeasonModel(g);this._view=new f.SeasonView(this._model);break;case"year":this._model=new f.YearModel(g);this._view=new f.YearView(this._model);break;case"monthday":this._model=new f.MonthDayModel(g);this._view=new f.MonthDayView(this._model);break;default:this._model=new f.Model(g);this._view=new f.View(this._model);break}this._init()}f.prototype={_init:function(){var g=this;g._initHanlderEvent();c([g._view,g._model]).on("BindEvent",function(h,j,i){g.on(j,i)});c([g._view,g._model]).on("TriggerEvent",function(h,j){var i=JC.f.sliceArgs(arguments).slice(2);g.trigger(j,i)});g._model.init();g._view.init();return g},_initHanlderEvent:function(){var g=this;g.on(f.Model.INITED,function(h){g._model.calendarinited()&&g._model.calendarinited().call(g._model.selector(),g._model.layout(),g)});g.on(f.Model.SHOW,function(h){g._model.calendarshow()&&g._model.calendarshow().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.HIDE,function(h){g._model.calendarhide()&&g._model.calendarhide().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.UPDATE,function(h){if(!g._model.selector()){return}g._model.selector().blur();g._model.selector().trigger("change");var l=[],u=g._model.selector().val().trim(),k,o,r,s,q,t;if(u){r=u.split(",");for(var n=0,m=r.length;n<m;n++){if(g._model.dateParse(g._model.selector())){var p=g._model.dateParse(g._model.selector())(r[n]);k=p.start;o=p.end;!o&&(o=k)}else{s=r[n].replace(/[^\d]/g,"");if(s.length==16){q=JC.f.parseISODate(s.slice(0,8));t=JC.f.parseISODate(s.slice(8))}else{if(s.length==8){q=JC.f.parseISODate(s.slice(0,8));t=JC.f.cloneDate(q)}}if(n===0){k=JC.f.cloneDate(q);o=JC.f.cloneDate(t)}}l.push({start:q,end:t})}}g._model.calendarupdate()&&g._model.calendarupdate().apply(g._model.selector(),[k,o,g]);g._model.multiselect()&&g._model.calendarupdatemultiselect()&&g._model.calendarupdatemultiselect().call(g._model.selector(),l,g)});g.on(f.Model.CLEAR,function(h){g._model.calendarclear()&&g._model.calendarclear().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.CANCEL,function(h){g._model.calendarcancel()&&g._model.calendarcancel().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.LAYOUT_CHANGE,function(h){g._model.calendarlayoutchange()&&g._model.calendarlayoutchange().call(g._model.selector(),g._model.selector(),g)});g.on(f.Model.UPDATE_MULTISELECT,function(h){g._model.multiselect()&&g._model.calendarupdatemultiselect()&&g._model.calendarupdatemultiselect().call(g._model.selector(),g._model.selector(),g)});return g},show:function(){f.hide();f.lastIpt=this._model.selector();this._view.show();this.trigger(f.Model.SHOW);return this},hide:function(){this._view.hide();this.trigger(f.Model.HIDE);this.selector()&&this.selector().blur();return this},selector:function(){return this._model.selector()},layout:function(){return this._model.layout()},on:function(h,g){c(this).on(h,g);return this},trigger:function(h,g){c(this).trigger(h,g);return this},updateLayout:function(){this._view.updateLayout();return this},updateSelector:function(g){f.lastIpt=g;this._model&&this._model.selector(g);return this},updateYear:function(g){this._view&&this._view.updateYear(g);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateMonth:function(g){this._view&&this._view.updateMonth(g);this.trigger(f.Model.LAYOUT_CHANGE);return this},updateSelected:function(g){JC.log("JC.Calendar: updateSelector",new Date().getTime());this._view&&this._view.updateSelected(g);return this},updatePosition:function(){this._view&&this._view.updatePosition();return this},clear:function(){var g=!this._model.selector().val().trim();this._model&&this._model.selector().val("");!g&&this.trigger(f.Model.CLEAR);return this},cancel:function(){this.trigger(f.Model.CANCEL);this._view&&this._view.hide();return this},visible:function(){var h,g;this._model&&(g=this._model.layout())&&(h=g.is(":visible"));return h},defaultDate:function(g){return this._model.defaultDate(g)},updateFormat:function(g){this._model.updateFormat(g)}};f.getInstance=function(g,i){typeof g=="string"&&!/</.test(g)&&(g=c(g));if(!(g&&g.length)||(typeof g=="string")){return}var h=f.type(g);typeof i!="undefined"&&(f._ins[h]=i);f._ins[h]&&f._ins[h].updateSelector(g);return f._ins[h]};f._ins={};f.type=function(g){g=c(g);var i,h=c.trim(g.attr("multidate")||"").toLowerCase()||c.trim(g.attr("datatype")||"").toLowerCase();switch(h){case"week":case"month":case"season":case"year":case"monthday":i=h;break;default:i="date";break}return i};f.isCalendar=function(g){g=c(g);var h=0;if(g.length){if(g.hasClass("UXCCalendar_btn")){h=1}if(g.prop("nodeName")&&g.attr("datatype")&&(g.prop("nodeName").toLowerCase()=="input"||g.prop("nodeName").toLowerCase()=="button")&&(g.attr("datatype").toLowerCase()=="date"||g.attr("datatype").toLowerCase()=="week"||g.attr("datatype").toLowerCase()=="month"||g.attr("datatype").toLowerCase()=="season"||g.attr("datatype").toLowerCase()=="year"||g.attr("datatype").toLowerCase()=="daterange"||g.attr("datatype").toLowerCase()=="monthday")){h=1}if(g.prop("nodeName")&&g.attr("multidate")&&(g.prop("nodeName").toLowerCase()=="input"||g.prop("nodeName").toLowerCase()=="button")){h=1}}return h};f.isCalendarElement=function(g){return f.isCalendar(g)};f.pickDate=function(g){g=c(g);if(!(g&&g.length)){return}var h,i=g.is("[ignoreprocess]");g.attr("ignoreprocess",true);g.blur();!i&&g.removeAttr("ignoreprocess");h=f.getInstance(g);!h&&(h=new f(g));h.show();return};f.autoInit=true;f.defaultDateSpan=20;f.lastIpt=null;f.tpl="";f.layoutInitedCallback=null;f.layoutShowCallback=null;f.layoutHideCallback=null;f.domClickFilter=null;f.hide=function(){for(var g in f._ins){f._ins[g]&&f._ins[g].visible()&&f._ins[g].hide()}};f.getDate=function(g){return f.getInstance(g).defaultDate()};f.cnWeek="日一二三四五六";f.cnUnit="十一二三四五六七八九";f.getCnNum=function(g){var h=f.cnUnit.charAt(g%10);g>10&&(h=(g%10!==0?f.cnUnit.charAt(0):"")+h);g>19&&(h=f.cnUnit.charAt(Math.floor(g/10))+h);return h};f.position=function(g){f.getInstance(g)&&f.getInstance(g).updatePosition()};f.setPosition=f.position;f.initTrigger=function(g){g.each(function(){var j=c(this),i=(j.prop("nodeName")||"").toLowerCase(),m,h;if(i!="input"&&i!="textarea"){f.initTrigger(g.find("input[type=text], textarea"));return}h=c.trim(j.attr("datatype")||"").toLowerCase();if(!(h=="date"||h=="week"||h=="month"||h=="season"||h=="year"||h=="daterange"||h=="monthday"||c.trim(j.attr("multidate")||""))){return}var l=j.find("+ input.UXCCalendar_btn");if(!l.length){j.after(l=c('<input type="button" class="UXCCalendar_btn"  />'))}(m=j.val().trim())&&(m=JC.f.dateDetect(m))&&j.val(JC.f.formatISODate(m));(m=(j.attr("minvalue")||""))&&(m=JC.f.dateDetect(m))&&j.attr("minvalue",JC.f.formatISODate(m));(m=(j.attr("maxvalue")||""))&&(m=JC.f.dateDetect(m))&&j.attr("maxvalue",JC.f.formatISODate(m));if(j.is("[dateFormat]")||j.is("[fullDateFormat]")){var k=f.getInstance(g);!k&&(k=new f(g));k.updateSelector(g);k.updateFormat(j)}if((j.attr("datatype")||"").toLowerCase()=="monthday"||(j.attr("multidate")||"").toLowerCase()=="monthday"){if(!j.is("[placeholder]")){var n=new Date();j.attr("defaultdate")&&(n=JC.f.parseISODate(j.attr("defaultdate"))||n);j.val().trim()&&(n=JC.f.parseISODate(j.val().replace(/[^d]/g,"").slice(0,8))||n);n&&j.attr("placeholder",JC.f.printf("{0}年 {1}月",n.getFullYear(),n.getMonth()+1))}}l.data(f.Model.INPUT,j)})};f.updateMultiYear=function(h,i){var j,g;j=h.getDate();h.setDate(1);h.setFullYear(h.getFullYear()+i);g=JC.f.maxDayOfMonth(h);j>g&&(j=g);h.setDate(j);return h};f.updateMultiMonth=function(h,i){var j,g;j=h.getDate();h.setDate(1);h.setMonth(h.getMonth()+i);g=JC.f.maxDayOfMonth(h);j>g&&(j=g);h.setDate(j);return h};f.clone=function(h,i){var g;if(h){for(g in e.prototype){h.prototype[g]=e.prototype[g]}}if(i){for(g in d.prototype){i.prototype[g]=d.prototype[g]}}};function e(g){this._selector=g}f.Model=e;f.Model.INPUT="CalendarInput";f.Model.INITED="CalendarInited";f.Model.SHOW="CalendarShow";f.Model.HIDE="CalendarHide";f.Model.UPDATE="CalendarUpdate";f.Model.CLEAR="CalendarClear";f.Model.CANCEL="CalendarCancel";f.Model.LAYOUT_CHANGE="CalendarLayoutChange";f.Model.UPDATE_MULTISELECT="CalendarUpdateMultiSelect";e.prototype={init:function(){return this},selector:function(g){typeof g!="undefined"&&(this._selector=g);return this._selector},layout:function(){var h=c("#UXCCalendar");if(!h.length){h=c(f.tpl||this.tpl).hide();h.attr("id","UXCCalendar").hide().appendTo(document.body);var g=c(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(h.find("select.UMonth"))}return h},startYear:function(h){var g=f.defaultDateSpan,i=h.date.getFullYear();this.selector().is("[calendardatespan]")&&(g=parseInt(this.selector().attr("calendardatespan"),10));return i-g},endYear:function(h){var g=f.defaultDateSpan,i=h.date.getFullYear();this.selector().is("[calendardatespan]")&&(g=parseInt(this.selector().attr("calendardatespan"),10));return i+g},currentcanselect:function(){var g=true;this.selector().is("[currentcanselect]")&&(g=JC.f.parseBool(this.selector().attr("currentcanselect")));return g},year:function(){return parseInt(this.layout().find("select.UYear").val(),10)||1},month:function(){return parseInt(this.layout().find("select.UMonth").val(),10)||0},day:function(){var h,g=new Date();h=this.layout().find("td.cur > a[date], td.cur > a[dstart]");if(h.length){g.setTime(h.attr("date")||h.attr("dstart"))}JC.log("dddddd",g.getDate());return g.getDate()},defaultDate:function(){var g=this,h={date:null,minvalue:null,maxvalue:null,enddate:null,multidate:null};g.selector()&&(h=g.multiselect()?g.defaultMultiselectDate(h):g.defaultSingleSelectDate(h));if(g.dateParse(g.selector())){g.selector().is("[minvalue]")&&(h.minvalue=(g.dateParse(g.selector())(g.selector().attr("minvalue"))).start);g.selector().is("[maxvalue]")&&(h.maxvalue=(g.dateParse(g.selector())(g.selector().attr("maxvalue"))).start)}else{g.selector().is("[minvalue]")&&(h.minvalue=JC.f.parseISODate(g.selector().attr("minvalue")));g.selector().is("[maxvalue]")&&(h.maxvalue=JC.f.parseISODate(g.selector().attr("maxvalue")))}return h},defaultSingleSelectDate:function(l){var g=this,h=g.selector(),j,i=h.val().trim();if(!i){l.date=new Date();l.enddate=JC.f.cloneDate(l.date);return l}if(g.dateParse(g.selector())){var k=g.dateParse(g.selector())(g.selector().val().trim());l.date=k.start;l.enddate=k.end;!l.enddate&&(l.enddate=l.date)}else{if(j=JC.f.parseISODate(h.val())){l.date=j}else{if(h.val()&&(j=h.val().replace(/[^\d]/g,"")).length==16){l.date=JC.f.parseISODate(j.slice(0,8));l.enddate=JC.f.parseISODate(j.slice(8))}else{j=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){j=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||j}l.date=new Date(j.getFullYear(),j.getMonth(),j.getDate())}}}return l},defaultMultiselectDate:function(m){var g=this,h=f.lastIpt,k,i,j,l;if(h.val()){k=h.val().trim().replace(/[^\d,]/g,"").split(",");i=[];c.each(k,function(o,n){if(g.dateParse(h)){var p=g.dateParse(h)(n);j=p.start;l=p.end;!l&&(l=j);i.push({start:j,end:l})}else{if(n.length==16){j=JC.f.parseISODate(n.slice(0,8));l=JC.f.parseISODate(n.slice(8));if(!o){m.date=JC.f.cloneDate(j);m.enddate=JC.f.cloneDate(l)}i.push({start:j,end:l})}else{if(n.length==8){j=JC.f.parseISODate(n.slice(0,8));l=JC.f.cloneDate(j);if(!o){m.date=JC.f.cloneDate(j);m.enddate=JC.f.cloneDate(l)}i.push({start:j,end:l})}}}});m.multidate=i}else{k=new Date();if(f.lastIpt&&f.lastIpt.is("[defaultdate]")){k=JC.f.parseISODate(f.lastIpt.attr("defaultdate"))||k}m.date=new Date(k.getFullYear(),k.getMonth(),k.getDate());m.enddate=JC.f.cloneDate(m.date);m.enddate.setDate(JC.f.maxDayOfMonth(m.enddate));m.multidate=[];m.multidate.push({start:JC.f.cloneDate(m.date),end:JC.f.cloneDate(m.enddate)})}return m},layoutDate:function(){return this.multiselect()?this.multiLayoutDate():this.singleLayoutDate()},singleLayoutDate:function(){var g=this,j=g.defaultDate(),i=this.day(),h;j.date.setDate(1);j.date.setFullYear(this.year());j.date.setMonth(this.month());h=JC.f.maxDayOfMonth(j.date);i>h&&(i=h);j.date.setDate(i);return j},multiLayoutDate:function(){JC.log("Calendar.Model multiLayoutDate",new Date().getTime());var g=this,k=g.defaultDate(),j=g.year(),i=g.month(),h=g.layout().find("select.UMonth");k.multidate=[];g.layout().find("td.cur").each(function(){var l=c(this);var n=l.find("> a[dstart]"),m=new Date(),o=new Date();m.setTime(n.attr("dstart"));o.setTime(n.attr("dend"));k.multidate.push({start:m,end:o})});k.date.setFullYear(j);k.enddate.setFullYear(j);if(h.length){k.date.setMonth(i);k.enddate.setMonth(i)}c.each(k.multidate,function(m,l){l.start.setFullYear(j);l.end.setFullYear(j);if(h.length){l.start.setMonth(i);l.end.setMonth(i)}});return k},selectedDate:function(){var i,h,g;h=this.layout().find("td.cur");h.length&&!h.hasClass("unable")&&(g=h.find("a[date]"))&&(i=new Date(),i.setTime(g.attr("date")));return i},multiselectDate:function(){var g=[];return g},calendarinited:function(){var i=this.selector(),h=f.layoutInitedCallback,g;i&&i.attr("calendarinited")&&(g=window[i.attr("calendarinited")])&&(h=g);return h},calendarshow:function(){var i=this.selector(),h=f.layoutShowCallback,g;i&&i.attr("calendarshow")&&(g=window[i.attr("calendarshow")])&&(h=g);return h},calendarhide:function(){var i=this.selector(),h=f.layoutHideCallback,g;i&&i.attr("calendarhide")&&(g=window[i.attr("calendarhide")])&&(h=g);return h},calendarupdate:function(i){var j=this.selector(),h,g;j&&j.attr("calendarupdate")&&(g=window[j.attr("calendarupdate")])&&(h=g);return h},calendarclear:function(){var i=this.selector(),h,g;i&&i.attr("calendarclear")&&(g=window[i.attr("calendarclear")])&&(h=g);return h},calendarcancel:function(){var i=this.selector(),h,g;i&&i.attr("calendarcancel")&&(g=window[i.attr("calendarcancel")])&&(h=g);return h},calendarlayoutchange:function(){var i=this.selector(),h,g;i&&i.attr("calendarlayoutchange")&&(g=window[i.attr("calendarlayoutchange")])&&(h=g);return h},multiselect:function(){var g;this.selector().is("[multiselect]")&&(g=JC.f.parseBool(this.selector().attr("multiselect")));return g},calendarupdatemultiselect:function(i){var j=this.selector(),h,g;j&&j.attr("calendarupdatemultiselect")&&(g=window[j.attr("calendarupdatemultiselect")])&&(h=g);return h},updateFormat:function(h){h&&(h=c(h));if(!(h&&h.length)){return}var g=this,i=(h.attr("datetype")||h.attr("multidate")||"").toLowerCase().trim(),m=h.val().trim(),k=g.dateParse(h),j,n,l;if(!m){return}if(i=="date"&&!h.attr("fullDateFormat")){h.attr("fullDateFormat","{0}")}if(k){switch(i){case"date":break;case"week":case"month":case"season":case"year":l=k(m);h.val(g.fullFormat(g.dateFormat(l.start,h),g.dateFormat(l.end,h),h));break}}else{switch(i){case"date":j=JC.f.parseISODate(m);h.val(g.dateFormat(j,h)||m);break}}},dateFormat:function(i,h){h=h||this.selector();var j="",g=h.attr("dateFormat")||"YY-MM-DD";i&&(j=JC.f.dateFormat(i,g));return j},fullFormat:function(h,i,g){g=g||this.selector();var k="",j=g.attr("fullDateFormat")||"{0} 至 {1}";if(h&&i){k=JC.f.printf(j,this.dateFormat(h,g),this.dateFormat(i,g))}else{if(h){k=JC.f.printf(j,this.dateFormat(h,g))}else{if(i){k=JC.f.printf(j,this.dateFormat(i,g))}}}return k},dateParse:function(g){var h;g&&g.attr("dateParse")&&(h=window[g.attr("dateParse")]);return h},tpl:['<div id="UXCCalendar" class="UXCCalendar">','    <div class="UHeader">','        <select class="UYear"></select>','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>','        <select class="UMonth"></select>','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>',"    </div>",'    <table class="UTable">',"        <thead>","            <tr>","                <th>一</th>","                <th>二</th>","                <th>三</th>","                <th>四</th>","                <th>五</th>","                <th>六</th>","                <th>日</th>","            </tr>","        </thead>","   </table>",'   <table class="UTable UTableBorder">',"        <tbody>","           <!--<tr>",'                <td class="cur"><a href="#">2</a></td>','                <td class="unable"><a href="#">2</a></td>','                <td class="weekend cur"><a href="#">6</a></td>','                <td class="weekend hover"><a href="#">13</a></td>','                <td class="weekend other"><a href="#">41</a></td>','                <td class="weekend other"><a href="#">42</a></td>',"            </tr>-->","        </tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function d(g){this._model=g}f.View=d;d.prototype={init:function(){return this},hide:function(){this._model.layout().hide()},show:function(){var g=this._model.defaultDate();JC.log("Calendar.View: show",new Date().getTime(),JC.f.formatISODate(g.date));this._buildLayout(g);this._buildDone()},updateLayout:function(g){typeof g=="undefined"&&(g=this._model.layoutDate());this._buildLayout(g);this._buildDone()},updateYear:function(g){if(typeof g=="undefined"||g==0){return}this._model.multiselect()?this.updateMultiYear(g):this.updateSingleYear(g)},updateSingleYear:function(h){var j=this._model.layoutDate(),i=j.date.getDate(),g;j.date.setDate(1);j.date.setFullYear(j.date.getFullYear()+h);g=JC.f.maxDayOfMonth(j.date);i>g&&(i=g);j.date.setDate(i);this._buildLayout(j);this._buildDone()},updateMultiYear:function(h){var j=this._model.layoutDate(),i,g;JC.Calendar.updateMultiYear(j.date,h);JC.Calendar.updateMultiYear(j.enddate,h);if(j.multidate){c.each(j.multidate,function(l,k){JC.Calendar.updateMultiYear(k.start,h);JC.Calendar.updateMultiYear(k.end,h)})}this._buildLayout(j);this._buildDone()},updateMonth:function(g){if(typeof g=="undefined"||g==0){return}this._model.multiselect()?this.updateMultiMonth(g):this.updateSingleMonth(g)},updateMultiMonth:function(h){var j=this._model.layoutDate(),i,g;JC.Calendar.updateMultiMonth(j.date,h);JC.Calendar.updateMultiMonth(j.enddate,h);if(j.multidate){c.each(j.multidate,function(l,k){JC.Calendar.updateMultiMonth(k.start,h);JC.Calendar.updateMultiMonth(k.end,h)})}this._buildLayout(j);this._buildDone()},updateSingleMonth:function(h){var j=this._model.layoutDate(),i=j.date.getDate(),g;j.date.setDate(1);j.date.setMonth(j.date.getMonth()+h);g=JC.f.maxDayOfMonth(j.date);i>g&&(i=g);j.date.setDate(i);this._buildLayout(j);this._buildDone()},updateSelected:function(j){var g=this,h,i;if(!j){h=this._model.selectedDate()}else{j=c(j);i=JC.f.getJqParent(j,"td");if(i&&i.hasClass("unable")){return}h=new Date();h.setTime(j.attr("date"))}if(!h){return}g._model.selector().val(g._model.dateFormat(h));c(g).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"date",h,h]);f.hide()},updatePosition:function(){var i=this,g=i._model.selector(),t=i._model.layout();if(!(g&&t&&g.length&&t.length)){return}t.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var r=t.width(),k=t.height(),s=g.width(),l=g.height(),q=g.offset(),o,m,h=c(window).width(),n=c(window).height(),p=c(document).scrollLeft(),j=c(document).scrollTop();o=q.left;m=q.top+l+5;if((m+k-j)>n){JC.log("y overflow");m=q.top-k-3;m<j&&(m=j)}if((o+r-p)>h){o=h-r+p-5}o<p&&(o=p+0);t.css({left:o+"px",top:m+"px"});JC.log(r,k,s,l,q.left,q.top,h,n);JC.log(j,o,m)},_buildDone:function(){this.updatePosition();c(this).trigger("TriggerEvent",[f.Model.INITED])},_buildLayout:function(g){this._model.layout();if(!(g&&g.date)){return}this._buildHeader(g);this._buildBody(g);this._buildFooter(g)},_buildHeader:function(k){var h=this,p=h._model.layout(),g=[],n,l=l=k.date.getFullYear(),m=h._model.startYear(k),o=h._model.endYear(k);JC.log(m,o);for(var j=m;j<=o;j++){g.push(JC.f.printf('<option value="{0}"{1}>{0}</option>',j,j===l?" selected":""))}c(g.join("")).appendTo(p.find("select.UYear").html(""));c(p.find("select.UMonth").val(k.date.getMonth()))},_buildBody:function(o){var j=this,w=j._model.layout();var v=JC.f.maxDayOfMonth(o.date),q=o.date.getDay()||7,u=q+v,l=6,h=[],k,g,s,n,p;var m=new Date(o.date.getFullYear(),o.date.getMonth(),1);var r=m.getDay()||7;if(r<2){m.setDate(-(r-1+6))}else{m.setDate(-(r-2))}var t=new Date();if(o.maxvalue&&!j._model.currentcanselect()){o.maxvalue.setDate(o.maxvalue.getDate()-1)}h.push("<tr>");for(n=1;n<=42;n++){p=[];if(m.getDay()===0||m.getDay()==6){p.push("weekend")}if(!JC.f.isSameMonth(o.date,m)){p.push("other")}if(o.minvalue&&m.getTime()<o.minvalue.getTime()){p.push("unable")}if(o.maxvalue&&m.getTime()>o.maxvalue.getTime()){p.push("unable")}if(JC.f.isSameDay(m,t)){p.push("today")}if(JC.f.isSameDay(o.date,m)){p.push("cur")}h.push('<td class="',p.join(" "),'">','<a href="javascript:" date="',m.getTime(),'" title="'+JC.f.formatISODate(m)+'" >',m.getDate(),"</a></td>");m.setDate(m.getDate()+1);if(n%7===0&&n!=42){h.push("</tr><tr>")}}h.push("</tr>");w.find("table.UTableBorder tbody").html(c(h.join("")))},_buildFooter:function(g){}};c(document).delegate("body > div.UXCCalendar select.UYear, body > div.UXCCalendar select.UMonth","change",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateLayout()});c(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(1)});c(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateYear(-1)});c(document).delegate("map[name=UXCCalendar_Year] area","click",function(h){h.preventDefault();var g=c(this),i=f.getInstance(f.lastIpt);g.attr("action")&&i&&(g.attr("action").toLowerCase()=="up"&&i.updateYear(1),g.attr("action").toLowerCase()=="down"&&i.updateYear(-1))});c(document).delegate("map[name=UXCCalendar_Month] area","click",function(h){h.preventDefault();var g=c(this),i=f.getInstance(f.lastIpt);g.attr("action")&&i&&(g.attr("action").toLowerCase()=="up"&&i.updateMonth(1),g.attr("action").toLowerCase()=="down"&&i.updateMonth(-1))});c(document).delegate("body > div.UXCCalendar button.UNextMonth","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(1)});c(document).delegate("body > div.UXCCalendar button.UPreMonth","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateMonth(-1)});c(document).delegate("div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]","click",function(g){g.preventDefault();f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected(c(this))});c(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).updateSelected()});c(document).delegate("body > div.UXCCalendar button.UClear","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).clear()});c(document).delegate("body > div.UXCCalendar button.UCancel","click",function(g){f.getInstance(f.lastIpt)&&f.getInstance(f.lastIpt).cancel()});c(document).delegate("input.UXCCalendar_btn","click",function(h){var g=c(this),i;if(!g.data(f.Model.INPUT)){i=g.prev("input[type=text], textarea");i.length&&g.data(f.Model.INPUT,i)}g.data(f.Model.INPUT)&&!g.data(f.Model.INPUT).is("[disabled]")&&f.pickDate(g.data(f.Model.INPUT))});c(document).delegate("body > div.UXCCalendar","click",function(g){g.stopPropagation()});c(document).ready(function(g){JC.f.safeTimeout(function(h){if(!f.autoInit){return}f.initTrigger(c(document))},null,"CalendarInitTrigger",200);c(window).on("scroll resize",function(h){var i=f.getInstance(f.lastIpt);i&&i.visible()&&i.updatePosition()});c(document).on("click",function(h){var i=h.target||h.srcElement;if(f.domClickFilter){if(f.domClickFilter(c(i))===false){return}}if(f.isCalendar(h.target||h.targetElement)){return}if(i&&(i.nodeName.toLowerCase()!="input"&&i.nodeName.toLowerCase()!="button"&&i.nodeName.toLowerCase()!="textarea")){f.hide();return}JC.f.safeTimeout(function(){if(f.lastIpt&&f.lastIpt.length&&i==f.lastIpt[0]){return}f.hide()},null,"CalendarClickHide",100)})});c(document).delegate(["input[datatype=date]","input[datatype=daterange]","input[multidate=date]","input[multidate=daterange]"].join(),"focus",function(g){f.pickDate(this)});c(document).delegate(["button[datatype=date]","button[datatype=daterange]","button[multidate=date]","button[multidate=daterange]"].join(),"click",function(g){f.pickDate(this)});c(document).delegate(["textarea[datatype=date]","textarea[datatype=daterange]","textarea[multidate=date]","textarea[multidate=daterange]"].join(),"click",function(g){f.pickDate(this)})}(jQuery));return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.weekTpl="";JC.Calendar.weekDayOffset=0;function d(f){this._selector=f}JC.Calendar.WeekModel=d;function c(f){this._model=f}JC.Calendar.WeekView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var f=$("#UXCCalendar_week");if(!f.length){f=$(JC.Calendar.weekTpl||this.tpl).hide();f.attr("id","UXCCalendar_week").hide().appendTo(document.body)}return f},tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var h=0,g,f=new Date();(g=this.layout().find("td.cur a[dstart]")).length&&(f=new Date())&&(f.setTime(g.attr("dstart")));h=f.getMonth();return h},selectedDate:function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[dstart]"))&&(h={start:new Date(),end:new Date()},h.start.setTime(f.attr("dstart")),h.end.setTime(f.attr("dend")));return h},singleLayoutDate:function(){var g=this,j=g.defaultDate(),i=this.day(),h,f=g.layout().find("td.cur > a[week]");j.date.setDate(1);j.date.setFullYear(this.year());j.date.setMonth(this.month());h=JC.f.maxDayOfMonth(j.date);i>h&&(i=h);j.date.setDate(i);f.length&&(j.curweek=parseInt(f.attr("week"),10));JC.log("WeekModel.singleLayoutDate:",f.length,j.curweek);return j}});JC.f.extendObject(c.prototype,{_buildBody:function(z){var B=this,p=z.date,l=B._model.layout(),x=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),m=e(p.getFullYear(),JC.Calendar.weekDayOffset),w=e(p.getFullYear()+1,JC.Calendar.weekDayOffset),n=0,y=[],h,r,q,o,v,k=p.getFullYear(),g=Math.ceil(m.length/8),t=JC.Calendar.lastIpt,f=JC.f.parseBool(t.attr("currentcanselect"));if(z.maxvalue&&f){var A=z.maxvalue.getDay();if(A>0){z.maxvalue.setDate(z.maxvalue.getDate()+(7-A))}}y.push("<tr>");for(var u=1,s=g*8;u<=s;u++){r=m[u-1];if(!r){r=w[n++];k=p.getFullYear()+1}o=new Date();v=new Date();o.setTime(r.start);v.setTime(r.end);q=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(r.week),JC.f.formatISODate(o),JC.f.formatISODate(v),JC.Calendar.cnWeek.charAt(o.getDay()%7),JC.Calendar.cnWeek.charAt(v.getDay()%7));h=[];if(z.minvalue&&o.getTime()<z.minvalue.getTime()){h.push("unable")}if(z.maxvalue&&v.getTime()>z.maxvalue.getTime()){h.push("unable")}if(z.curweek){if(r.week==z.curweek&&p.getFullYear()==o.getFullYear()){h.push("cur")}}else{if(p.getTime()>=o.getTime()&&p.getTime()<=v.getTime()){h.push("cur")}}if(x>=o.getTime()&&x<=v.getTime()){h.push("today")}y.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',h.join(" "),r.week,q,o.getTime(),v.getTime(),z.date.getTime()));if(u%8===0&&u!=s){y.push("</tr><tr>")}}y.push("</tr>");l.find("table.UTableBorder tbody").html($(y.join("")))},updateSelected:function(j){var f=this,g,i,h;if(!j){h=this._model.selectedDate();h&&(g=h.start,i=h.end)}else{j=$(j);h=JC.f.getJqParent(j,"td");if(h&&h.hasClass("unable")){return}g=new Date();i=new Date();g.setTime(j.attr("dstart"));i.setTime(j.attr("dend"))}if(!(g&&i)){return}f._model.selector().val(f._model.fullFormat(f._model.dateFormat(g),f._model.dateFormat(i)));$(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",g,i]);JC.Calendar.hide()}});function e(i,h){var k=[],j,g=1,h=h||0,i=parseInt(i,10),f=new Date(i,0,1);f.getDay()>1&&f.setDate(f.getDate()-f.getDay()+7);f.getDay()===0&&f.setDate(f.getDate()+1);h>0&&(h=(new Date(2000,1,2)-new Date(2000,1,1))*h);while(f.getFullYear()<=i){j={week:g++,start:null,end:null};j.start=f.getTime()+h;f.setDate(f.getDate()+6);j.end=f.getTime()+h;f.setDate(f.getDate()+1);if(f.getFullYear()>i){f=new Date(f.getFullYear(),0,1);if(f.getDay()<2){break}}k.push(j)}return k}$(document).delegate(["input[datatype=week]","input[multidate=week]"].join(),"focus",function(f){Calendar.pickDate(this)});$(document).delegate(["button[datatype=week]","button[multidate=week]"].join(),"click",function(f){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=week]","textarea[multidate=week]"].join(),"click",function(f){Calendar.pickDate(this)})})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.monthTpl="";function c(e){this._selector=e}JC.Calendar.MonthModel=c;function d(e){this._model=e}JC.Calendar.MonthView=d;JC.Calendar.clone(c,d);JC.f.extendObject(c.prototype,{layout:function(){var e=$("#UXCCalendar_month");if(!e.length){e=$(JC.Calendar.monthTpl||this.tpl).hide();e.attr("id","UXCCalendar_month").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var g=0,f,e;(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")),g=e.getMonth());return g},selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g},multiselectDate:function(){var e=this,j=[],f,h,g,i;e.layout().find("td.cur").each(function(){f=$(this);h=f.find("> a[dstart]");if(f.hasClass("unable")){return}g=new Date();i=new Date();g.setTime(h.attr("dstart"));i.setTime(h.attr("dend"));j.push({start:g,end:i})});return j}});JC.f.extendObject(d.prototype,{_buildBody:function(y){var z=this,o=y.date,l=z._model.layout(),w=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),n=0,x=[],g,q,p,v,r,h=o.getFullYear(),f=4,t=JC.Calendar.lastIpt,e=JC.f.parseBool(t.attr("currentcanselect")),m=y.multidate?y.multidate.slice():null;if(y.maxvalue&&e){y.maxvalue.setDate(JC.f.maxDayOfMonth(y.maxvalue))}x.push("<tr>");for(var u=1,s=12;u<=s;u++){v=new Date(h,u-1,1);r=new Date(h,u-1,JC.f.maxDayOfMonth(v));p=JC.f.printf("{0}年 {1}月\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",h,JC.Calendar.getCnNum(u),JC.f.formatISODate(v),JC.f.formatISODate(r),JC.Calendar.cnWeek.charAt(v.getDay()%7),JC.Calendar.cnWeek.charAt(r.getDay()%7));g=[];if(y.minvalue&&v.getTime()<y.minvalue.getTime()){g.push("unable")}if(y.maxvalue&&r.getTime()>y.maxvalue.getTime()){g.push("unable")}if(m){$.each(m,function(j,i){if(v.getTime()>=i.start.getTime()&&v.getTime()<=i.end.getTime()){g.push("cur");m.splice(j,1);return false}})}else{if(o.getTime()>=v.getTime()&&o.getTime()<=r.getTime()){g.push("cur")}}if(w>=v.getTime()&&w<=r.getTime()){g.push("today")}var k=JC.Calendar.cnUnit.charAt(u%10);u>10&&(k="十"+k);x.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',g.join(" "),p,k,v.getTime(),r.getTime(),u));if(u%3===0&&u!=s){x.push("</tr><tr>")}}x.push("</tr>");l.find("table.UTableBorder tbody").html($(x.join("")))},updateSelected:function(k){var e=this,f,j,g,i,h;if(!k){if(e._model.multiselect()){g=this._model.multiselectDate();if(!g.length){return}h=[];$.each(g,function(m,l){h.push(i=e._model.fullFormat(e._model.dateFormat(l.start),e._model.dateFormat(l.end)))});i=h.join(",")}else{g=this._model.selectedDate();g&&(f=g.start,j=g.end);f&&j&&(i=e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(j)))}}else{k=$(k);g=JC.f.getJqParent(k,"td");if(g&&g.hasClass("unable")){return}if(e._model.multiselect()){g.toggleClass("cur");return}f=new Date();j=new Date();f.setTime(k.attr("dstart"));j.setTime(k.attr("dend"));i=e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(j))}if(!i){return}e._model.selector().val(i);$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"month",f,j]);JC.Calendar.hide()}});$(document).delegate(["input[datatype=month]","input[multidate=month]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=month]","button[multidate=month]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=month]","textarea[multidate=month]"].join(),"click",function(e){Calendar.pickDate(this)})})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.seasonTpl="";function d(e){this._selector=e}JC.Calendar.SeasonModel=d;function c(e){this._model=e}JC.Calendar.SeasonView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var e=$("#UXCCalendar_season");if(!e.length){e=$(JC.Calendar.seasonTpl||this.tpl).hide();e.attr("id","UXCCalendar_season").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var g=0,f,e;(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")),g=e.getMonth());return g},selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g}});JC.f.extendObject(c.prototype,{_buildBody:function(z){var A=this,p=z.date,m=A._model.layout(),x=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),n=0,y=[],h,s,r,o,w,k=p.getFullYear(),g=4,u=JC.Calendar.lastIpt,e=JC.f.parseBool(u.attr("currentcanselect"));if(z.maxvalue&&e){var f=z.maxvalue.getMonth()+1,q;if(f%3!==0){z.maxvalue.setDate(1);z.maxvalue.setMonth(f+(3-(f%3)-1))}z.maxvalue.setDate(JC.f.maxDayOfMonth(z.maxvalue))}y.push("<tr>");for(var v=1,t=4;v<=t;v++){o=new Date(k,v*3-3,1);w=new Date(k,v*3-1,1);w.setDate(JC.f.maxDayOfMonth(w));var l=JC.Calendar.cnUnit.charAt(v%10);v>10&&(l="十"+l);r=JC.f.printf("{0}年 第{1}季度\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(v),JC.f.formatISODate(o),JC.f.formatISODate(w),JC.Calendar.cnWeek.charAt(o.getDay()%7),JC.Calendar.cnWeek.charAt(w.getDay()%7));h=[];if(z.minvalue&&o.getTime()<z.minvalue.getTime()){h.push("unable")}if(z.maxvalue&&w.getTime()>z.maxvalue.getTime()){h.push("unable")}if(p.getTime()>=o.getTime()&&p.getTime()<=w.getTime()){h.push("cur")}if(x>=o.getTime()&&x<=w.getTime()){h.push("today")}y.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',h.join(" "),r,l,o.getTime(),w.getTime(),v));if(v%2===0&&v!=t){y.push("</tr><tr>")}}y.push("</tr>");m.find("table.UTableBorder tbody").html($(y.join("")))},updateSelected:function(i){var e=this,f,h,g;if(!i){g=this._model.selectedDate();g&&(f=g.start,h=g.end)}else{i=$(i);g=JC.f.getJqParent(i,"td");if(g&&g.hasClass("unable")){return}f=new Date();h=new Date();f.setTime(i.attr("dstart"));h.setTime(i.attr("dend"))}if(!(f&&h)){return}e._model.selector().val(e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(h)));$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"season",f,h]);JC.Calendar.hide()}});$(document).delegate(["input[datatype=season]","input[multidate=season]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=season]","button[multidate=season]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=season]","textarea[multidate=season]"].join(),"click",function(e){Calendar.pickDate(this)})})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.yearTpl="";function d(e){this._selector=e}JC.Calendar.YearModel=d;function c(e){this._model=e}JC.Calendar.YearView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var e=$("#UXCCalendar_year");if(!e.length){e=$(JC.Calendar.yearTpl||this.tpl).hide();e.attr("id","UXCCalendar_year").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_year" class="UXCCalendar UXCCalendar_week UXCCalendar_year">\n','    <table class="UTable UTableBorder">\n',"        <tbody>\n","            <tr>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>\n',"                </td>\n","                <td></td><td></td><td></td><td></td>\n","            </tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr>\n","                <td></td><td></td><td></td><td></td>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>\n',"                </td>\n","            </tr>\n","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join(""),selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g}});JC.f.extendObject(c.prototype,{_buildBody:function(r){var u=this,t=u._model.selector(),n=t.val().trim(),v=n.replace(/[^\d]+/g,""),h=r.date,p=new Date().getFullYear(),i=u._model.layout(),q=i.find("tbody > tr > td"),s=q.length-1,m,j,g,e=JC.f.parseBool(t.attr("currentcanselect")),k,f,o,l;v&&(v=v.slice(0,4));!v&&(v=p);g=h.getFullYear();m=g-Math.floor(s/2);if(r.minvalue&&e){r.minvalue.setFullYear(r.minvalue.getFullYear()-1)}if(r.maxvalue&&e){r.maxvalue.setFullYear(r.maxvalue.getFullYear()+1)}q.each(function(x,w){w=$(w);if(x==0||x==s){}else{k=JC.f.printf("{0}年",m);f=[];o=new Date(m,0,1);l=new Date(m,11,31);if(r.minvalue&&o.getFullYear()<=r.minvalue.getFullYear()){f.push("unable")}if(r.maxvalue&&l.getFullYear()>=r.maxvalue.getFullYear()){f.push("unable")}v&&v==m&&f.push("cur");p==m&&f.push("today");w.html(JC.f.printf('<a href="javascript:" title="{0}" dstart="{1}" dend="{2}" " >{3}</a></td>',k,o.getTime(),l.getTime(),m));w.prop("className",f.join(" "))}m++})},updateSelected:function(i){var e=this,f,h,g;if(!i){g=this._model.selectedDate();g&&(f=g.start,h=g.end)}else{i=$(i);g=JC.f.getJqParent(i,"td");if(g&&g.hasClass("unable")){return}f=new Date();h=new Date();f.setTime(i.attr("dstart"));h.setTime(i.attr("dend"))}if(!(f&&h)){return}e._model.selector().val(e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(h)));$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"year",f,h]);JC.Calendar.hide()},updateSingleYear:function(f){var k=this._model.layoutDate(),i=this._model.layout().find("a[dstart]"),l=i.first(),g=i.last(),h=new Date(),j=new Date(),e=17;if(f>0){h.setTime(g.attr("dstart"));j.setTime(g.attr("dend"));k.date=h;k.enddate=j;k.date.setFullYear(k.date.getFullYear()+e);k.enddate.setFullYear(k.enddate.getFullYear()+e)}else{h.setTime(l.attr("dstart"));j.setTime(l.attr("dend"));k.date=h;k.enddate=j;k.date.setFullYear(k.date.getFullYear()-e);k.enddate.setFullYear(k.enddate.getFullYear()-e)}this._buildLayout(k);this._buildDone()}});$(document).delegate(["input[datatype=year]","input[multidate=year]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=year]","button[multidate=year]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=year]","textarea[multidate=year]"].join(),"click",function(e){Calendar.pickDate(this)})})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.monthdayTpl="";JC.Calendar.monthdayHeadAppendText="";function e(f){this._selector=f}JC.Calendar.MonthDayModel=e;function d(f){this._model=f}JC.Calendar.MonthDayView=d;JC.Calendar.clone(e,d);JC.f.extendObject(e.prototype,{fixCheckall:function(){var g=this,f,i,j=true,h;g._fixCheckAllTm&&clearTimeout(g._fixCheckAllTm);g._fixCheckAllTm=setTimeout(function(){i=g.layout().find("input.js_JCCalendarCheckbox[action=all]");f=g.layout().find("input.js_JCCalendarCheckbox[dstart]");f.each(function(){h=$(this);var k=g.findItemByTimestamp(h.attr("dstart"));if(k.atd.hasClass("unable")){return}if(!h.prop("checked")){return j=false}});i.prop("checked",j)},100)},findItemByTimestamp:function(g){var f=this,h={a:null,atd:null,atr:null,input:null,inputtr:null,tm:g};if(g){h.a=f.layout().find(JC.f.printf("a[dstart={0}]",g));h.atd=JC.f.getJqParent(h.a,"td");h.atr=JC.f.getJqParent(h.a,"tr");h.input=f.layout().find(JC.f.printf("input[dstart={0}]",g));h.inputtr=JC.f.getJqParent(h.input,"tr")}return h},layout:function(){var g=$("#UXCCalendar_monthday");if(!g.length){g=$(JC.f.printf(JC.Calendar.monthdayTpl||this.tpl,JC.Calendar.monthdayHeadAppendText)).hide();g.attr("id","UXCCalendar_monthday").hide().appendTo(document.body);var f=$(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(g.find("select.UMonth"))}return g},tpl:['<div id="UXCCalendar_monthday" class="UXCCalendar UXCCalendar_week UXCCalendar_monthday" >','    <div class="UHeader">','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <button type="button" class="UButton UPreMonth">&nbsp;&nbsp;&lt;&nbsp;&nbsp;</button>','        <select class="UYear" style=""></select>','        <select class="UMonth"></select>',"        {0}",'        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UNextMonth">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</button>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),multiselect:function(){return true},multiselectDate:function(){var f=this,j=[],h,i,g;f.layout().find("input.js_JCCalendarCheckbox[dstart]").each(function(){h=$(this);if(!h.prop("checked")){return}g=new Date();g.setTime(h.attr("dstart"));j.push(g)});return j},ccPreserveDisabled:function(){var f=true;this.selector().is("[ccPreserveDisabled]")&&(f=JC.f.parseBool(this.selector().attr("ccPreserveDisabled")));return f},calendarclear:function(){var f=this,j=this.selector(),h,g;j&&j.attr("calendarclear")&&(g=window[j.attr("calendarclear")])&&(h=g);if(f.ccPreserveDisabled()){var k=f.layout().find("input[date]"),i=[];k.each(function(){var m=$(this),l;if(!(m.is(":disabled")&&m.is(":checked"))){return}l=new Date();l.setTime(m.attr("date"));i.push(JC.f.formatISODate(l))});j.val(i.join(","))}return h},fixedDate:function(h){var f=this,g=JC.Calendar.lastIpt,i;g&&!g.is("[defaultdate]")&&(i=JC.f.cloneDate(h.multidate[0].start),g.attr("defaultdate",JC.f.formatISODate(i)))}});JC.f.extendObject(d.prototype,{init:function(){var f=this;$(f).on("MonthDayToggle",function(g,h){var i=f._model.findItemByTimestamp(h.attr("dstart"));if(i.atd.hasClass("unable")){return}i.input.prop("checked",i.atd.hasClass("cur"));f._model.fixCheckall()});$(f).on("MonthDayInputToggle",function(g,h){var i=f._model.findItemByTimestamp(h.attr("dstart"));if(!i.atd){$(f).trigger("MonthDayToggleAll",[h]);return}if(i.atd.hasClass("unable")){return}i.atd[i.input.prop("checked")?"addClass":"removeClass"]("cur");f._model.fixCheckall()});$(f).on("MonthDayToggleAll",function(g,j){var i=f._model.layout().find("a[dstart]"),h=j.prop("checked");if(!i.length){return}i.each(function(){var k=$(this),l=JC.f.getJqParent(k,"td");if(l.hasClass("unable")){return}l[h?"addClass":"removeClass"]("cur");$(f).trigger("MonthDayToggle",[k])})});return this},updateSelected:function(n){var f=this,h,m,j,l,k;if(!n){j=this._model.multiselectDate();if(!j.length){return}k=[];for(var g=0;g<j.length;g++){k.push(JC.f.formatISODate(j[g]))}l=k.join(",")}else{n=$(n);j=JC.f.getJqParent(n,"td");if(j&&j.hasClass("unable")){return}if(f._model.multiselect()){j.toggleClass("cur");return}_date=new Date();_date.setTime(n.attr("date"));l=n.attr("date");l=JC.f.printf("{0}",JC.f.formatISODate(_date))}if(!l){return}if(j.length){f._model.selector().attr("placeholder",JC.f.printf("{0}年 {1}",j[0].getFullYear(),j[0].getMonth()+1));f._model.selector().attr("defaultdate",JC.f.formatISODate(j[0]))}f._model.selector().val(l);$(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"monthday",j]);JC.Calendar.hide()},_buildBody:function(l){var h=this,u=h._model.layout();var s=JC.f.maxDayOfMonth(l.date),g=[],m,n,k,t,r=new Date();h._model.fixedDate(l);JC.log(l.date);var o=[],f=[],p=[];var j=[],q=[];o.push('<tr><td><span class="bold">星期</span></td>');f.push('<tr><td><span class="bold">日期</span></td>');p.push('<tr class="Uchkdate"><td><label><span class="bold">全选</span>&nbsp;<input type="checkbox" class="js_JCCalendarCheckbox" action="all"  /></lable></td>');for(m=0;m<s;m++){k=new Date(l.date.getFullYear(),l.date.getMonth(),m+1);t=k.getDay();j=[];q=c(l,k,r).join(" ");if(t==0||t==6){j.push("red")}o.push(JC.f.printf('<td class="{0}">{1}</td>',j.join(" "),Calendar.cnWeek.charAt(t)));f.push(JC.f.printf('<td class="{0}"><a href="javascript:;" dstart="{1}" dend="{1}" title="{3}" >{2}</a></td>',q,k.getTime(),m+1,JC.f.formatISODate(k)));p.push(JC.f.printf('<td><input type="checkbox" date="{1}" dstart="{1}" dend="{1}" class="js_JCCalendarCheckbox" action="item" {3} {4} title="{2}" /></td>',"",k.getTime(),JC.f.formatISODate(k),(!/\bunable\b/.test(q)&&(/\bcur\b/.test(q)))?"checked":"",/\bunable\b/.test(q)?"disabled":""));k.setDate(k.getDate()+1);t=k.getDay()}o.push("</tr>");f.push("</tr>");p.push("</tr>");g=g.concat(o,f,p);u.find("table.UTableBorder tbody").html($(g.join("")));h._model.fixCheckall()}});function c(l,k,m){var f=[];if(l.minvalue){if(k.getTime()<l.minvalue.getTime()){f.push("unable")}}if(l.maxvalue){if(k.getTime()>l.maxvalue.getTime()){f.push("unable")}}if(JC.f.isSameDay(k,m)){f.push("today")}for(var h=0,g=l.multidate.length;h<g;h++){if(JC.f.isSameDay(l.multidate[h].start,k)){f.push("cur");break}}return f}$(document).delegate("#UXCCalendar_monthday a[dstart]","click",function(h){var g=JC.Calendar.lastIpt,i,j,f=$(this);if(!g){return}i=JC.Calendar.type(g);j=JC.Calendar.getInstance(g);if(!j){return}$(j._view).trigger("MonthDayToggle",[f])});$(document).delegate("#UXCCalendar_monthday input.js_JCCalendarCheckbox","click",function(h){var g=JC.Calendar.lastIpt,i,j,f=$(this);if(!g){return}i=JC.Calendar.type(g);j=JC.Calendar.getInstance(g);if(!j){return}$(j._view).trigger("MonthDayInputToggle",[f])});$(document).delegate(["input[datatype=monthday]","input[multidate=monthday]"].join(),"focus",function(f){Calendar.pickDate(this)});$(document).delegate(["button[datatype=monthday]","button[multidate=monthday]"].join(),"click",function(f){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=monthday]","textarea[multidate=monthday]"].join(),"click",function(f){Calendar.pickDate(this)})})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));