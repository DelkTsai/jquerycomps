(function(b,a){b(["JC.common"],function(){window.Calendar=JC.Calendar=e;function e(f){if(e.getInstance(f)){return e.getInstance(f)}e.getInstance(f,this);var g=e.type(f);switch(g){case"week":this._model=new e.WeekModel(f);this._view=new e.WeekView(this._model);break;case"month":this._model=new e.MonthModel(f);this._view=new e.MonthView(this._model);break;case"season":this._model=new e.SeasonModel(f);this._view=new e.SeasonView(this._model);break;case"year":this._model=new e.YearModel(f);this._view=new e.YearView(this._model);break;case"monthday":this._model=new e.MonthDayModel(f);this._view=new e.MonthDayView(this._model);break;default:this._model=new e.Model(f);this._view=new e.View(this._model);break}this._init()}e.prototype={_init:function(){var f=this;f._initHanlderEvent();$([f._view,f._model]).on("BindEvent",function(g,i,h){f.on(i,h)});$([f._view,f._model]).on("TriggerEvent",function(g,i){var h=JC.f.sliceArgs(arguments).slice(2);f.trigger(i,h)});f._model.init();f._view.init();return f},_initHanlderEvent:function(){var f=this;f.on(e.Model.INITED,function(g){f._model.calendarinited()&&f._model.calendarinited().call(f._model.selector(),f._model.layout(),f)});f.on(e.Model.SHOW,function(g){f._model.calendarshow()&&f._model.calendarshow().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.HIDE,function(g){f._model.calendarhide()&&f._model.calendarhide().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.UPDATE,function(g){if(!f._model.selector()){return}f._model.selector().blur();f._model.selector().trigger("change");var k=[],t=f._model.selector().val().trim(),h,n,q,r,p,s;if(t){q=t.split(",");for(var m=0,l=q.length;m<l;m++){if(f._model.dateParse(f._model.selector())){var o=f._model.dateParse(f._model.selector())(q[m]);h=o.start;n=o.end;!n&&(n=h)}else{r=q[m].replace(/[^\d]/g,"");if(r.length==16){p=JC.f.parseISODate(r.slice(0,8));s=JC.f.parseISODate(r.slice(8))}else{if(r.length==8){p=JC.f.parseISODate(r.slice(0,8));s=JC.f.cloneDate(p)}}if(m===0){h=JC.f.cloneDate(p);n=JC.f.cloneDate(s)}}k.push({start:p,end:s})}}f._model.calendarupdate()&&f._model.calendarupdate().apply(f._model.selector(),[h,n,f]);f._model.multiselect()&&f._model.calendarupdatemultiselect()&&f._model.calendarupdatemultiselect().call(f._model.selector(),k,f)});f.on(e.Model.CLEAR,function(g){f._model.calendarclear()&&f._model.calendarclear().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.CANCEL,function(g){f._model.calendarcancel()&&f._model.calendarcancel().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.LAYOUT_CHANGE,function(g){f._model.calendarlayoutchange()&&f._model.calendarlayoutchange().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.UPDATE_MULTISELECT,function(g){f._model.multiselect()&&f._model.calendarupdatemultiselect()&&f._model.calendarupdatemultiselect().call(f._model.selector(),f._model.selector(),f)});return f},show:function(){e.hide();e.lastIpt=this._model.selector();this._view.show();this.trigger(e.Model.SHOW);return this},hide:function(){this._view.hide();this.trigger(e.Model.HIDE);this.selector()&&this.selector().blur();return this},selector:function(){return this._model.selector()},layout:function(){return this._model.layout()},on:function(g,f){$(this).on(g,f);return this},trigger:function(g,f){$(this).trigger(g,f);return this},updateLayout:function(){this._view.updateLayout();return this},updateSelector:function(f){e.lastIpt=f;this._model&&this._model.selector(f);return this},updateYear:function(f){this._view&&this._view.updateYear(f);this.trigger(e.Model.LAYOUT_CHANGE);return this},updateMonth:function(f){this._view&&this._view.updateMonth(f);this.trigger(e.Model.LAYOUT_CHANGE);return this},updateSelected:function(f){this._view&&this._view.updateSelected(f);return this},updatePosition:function(){this._view&&this._view.updatePosition();return this},clear:function(){var f=!this._model.selector().val().trim();this._model&&this._model.selector().val("");!f&&this.trigger(e.Model.CLEAR);return this},cancel:function(){this.trigger(e.Model.CANCEL);this._view&&this._view.hide();return this},visible:function(){var g,f;this._model&&(f=this._model.layout())&&(g=f.is(":visible"));return g},defaultDate:function(f){return this._model.defaultDate(f)},updateFormat:function(f){this._model.updateFormat(f)}};e.getInstance=function(f,h){typeof f=="string"&&!/</.test(f)&&(f=$(f));if(!(f&&f.length)||(typeof f=="string")){return}var g=e.type(f);typeof h!="undefined"&&(e._ins[g]=h);e._ins[g]&&e._ins[g].updateSelector(f);return e._ins[g]};e._ins={};e.type=function(f){f=$(f);var h,g=$.trim(f.attr("multidate")||"").toLowerCase()||$.trim(f.attr("datatype")||"").toLowerCase();switch(g){case"week":case"month":case"season":case"year":case"monthday":h=g;break;default:h="date";break}return h};e.isCalendar=function(f){f=$(f);var g=0;if(f.length){if(f.hasClass("UXCCalendar_btn")){g=1}if(f.prop("nodeName")&&f.attr("datatype")&&(f.prop("nodeName").toLowerCase()=="input"||f.prop("nodeName").toLowerCase()=="button")&&(f.attr("datatype").toLowerCase()=="date"||f.attr("datatype").toLowerCase()=="week"||f.attr("datatype").toLowerCase()=="month"||f.attr("datatype").toLowerCase()=="season"||f.attr("datatype").toLowerCase()=="year"||f.attr("datatype").toLowerCase()=="daterange"||f.attr("datatype").toLowerCase()=="monthday")){g=1}if(f.prop("nodeName")&&f.attr("multidate")&&(f.prop("nodeName").toLowerCase()=="input"||f.prop("nodeName").toLowerCase()=="button")){g=1}}return g};e.isCalendarElement=function(f){return e.isCalendar(f)};e.pickDate=function(f){f=$(f);if(!(f&&f.length)){return}var g,h=f.is("[ignoreprocess]");f.attr("ignoreprocess",true);f.blur();!h&&f.removeAttr("ignoreprocess");g=e.getInstance(f);!g&&(g=new e(f));g.show();return};e.autoInit=true;e.defaultDateSpan=20;e.lastIpt=null;e.tpl="";e.layoutInitedCallback=null;e.layoutShowCallback=null;e.layoutHideCallback=null;e.domClickFilter=null;e.hide=function(){for(var f in e._ins){e._ins[f]&&e._ins[f].visible()&&e._ins[f].hide()}};e.getDate=function(f){return e.getInstance(f).defaultDate()};e.cnWeek="日一二三四五六";e.cnUnit="十一二三四五六七八九";e.getCnNum=function(f){var g=e.cnUnit.charAt(f%10);f>10&&(g=(f%10!==0?e.cnUnit.charAt(0):"")+g);f>19&&(g=e.cnUnit.charAt(Math.floor(f/10))+g);return g};e.position=function(f){e.getInstance(f)&&e.getInstance(f).updatePosition()};e.setPosition=e.position;e.initTrigger=function(f){f.each(function(){var i=$(this),h=(i.prop("nodeName")||"").toLowerCase(),l,g;if(h!="input"&&h!="textarea"){e.initTrigger(f.find("input[type=text], textarea"));return}g=$.trim(i.attr("datatype")||"").toLowerCase();if(!(g=="date"||g=="week"||g=="month"||g=="season"||g=="year"||g=="daterange"||g=="monthday"||$.trim(i.attr("multidate")||""))){return}var k=i.find("+ input.UXCCalendar_btn");if(!k.length){i.after(k=$('<input type="button" class="UXCCalendar_btn"  />'))}(l=i.val().trim())&&(l=JC.f.dateDetect(l))&&i.val(JC.f.formatISODate(l));(l=(i.attr("minvalue")||""))&&(l=JC.f.dateDetect(l))&&i.attr("minvalue",JC.f.formatISODate(l));(l=(i.attr("maxvalue")||""))&&(l=JC.f.dateDetect(l))&&i.attr("maxvalue",JC.f.formatISODate(l));if(i.is("[dateFormat]")||i.is("[fullDateFormat]")){var j=e.getInstance(f);!j&&(j=new e(f));j.updateSelector(f);j.updateFormat(i)}if((i.attr("datatype")||"").toLowerCase()=="monthday"||(i.attr("multidate")||"").toLowerCase()=="monthday"){if(!i.is("[placeholder]")){var m=new Date();i.attr("defaultdate")&&(m=JC.f.parseISODate(i.attr("defaultdate"))||m);i.val().trim()&&(m=JC.f.parseISODate(i.val().replace(/[^d]/g,"").slice(0,8))||m);m&&i.attr("placeholder",JC.f.printf("{0}年 {1}月",m.getFullYear(),m.getMonth()+1))}}k.data(e.Model.INPUT,i)})};e.updateMultiYear=function(g,h){var i,f;i=g.getDate();g.setDate(1);g.setFullYear(g.getFullYear()+h);f=JC.f.maxDayOfMonth(g);i>f&&(i=f);g.setDate(i);return g};e.updateMultiMonth=function(g,h){var i,f;i=g.getDate();g.setDate(1);g.setMonth(g.getMonth()+h);f=JC.f.maxDayOfMonth(g);i>f&&(i=f);g.setDate(i);return g};e.clone=function(g,h){var f;if(g){for(f in d.prototype){g.prototype[f]=d.prototype[f]}}if(h){for(f in c.prototype){h.prototype[f]=c.prototype[f]}}};function d(f){this._selector=f}e.Model=d;e.Model.INPUT="CalendarInput";e.Model.INITED="CalendarInited";e.Model.SHOW="CalendarShow";e.Model.HIDE="CalendarHide";e.Model.UPDATE="CalendarUpdate";e.Model.CLEAR="CalendarClear";e.Model.CANCEL="CalendarCancel";e.Model.LAYOUT_CHANGE="CalendarLayoutChange";e.Model.UPDATE_MULTISELECT="CalendarUpdateMultiSelect";d.prototype={init:function(){return this},selector:function(f){typeof f!="undefined"&&(this._selector=f);return this._selector},layout:function(){var g=$("#UXCCalendar");if(!g.length){g=$(e.tpl||this.tpl).hide();g.attr("id","UXCCalendar").hide().appendTo(document.body);var f=$(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(g.find("select.UMonth"))}return g},startYear:function(g){var f=e.defaultDateSpan,h=g.date.getFullYear();this.selector().is("[calendardatespan]")&&(f=parseInt(this.selector().attr("calendardatespan"),10));return h-f},endYear:function(g){var f=e.defaultDateSpan,h=g.date.getFullYear();this.selector().is("[calendardatespan]")&&(f=parseInt(this.selector().attr("calendardatespan"),10));return h+f},currentcanselect:function(){var f=true;this.selector().is("[currentcanselect]")&&(f=JC.f.parseBool(this.selector().attr("currentcanselect")));return f},year:function(){return parseInt(this.layout().find("select.UYear").val(),10)||1},month:function(){return parseInt(this.layout().find("select.UMonth").val(),10)||0},day:function(){var g,f=new Date();g=this.layout().find("td.cur > a[date], td.cur > a[dstart]");if(g.length){f.setTime(g.attr("date")||g.attr("dstart"))}return f.getDate()},defaultDate:function(){var f=this,g={date:null,minvalue:null,maxvalue:null,enddate:null,multidate:null};f.selector()&&(g=f.multiselect()?f.defaultMultiselectDate(g):f.defaultSingleSelectDate(g));if(f.dateParse(f.selector())){f.selector().is("[minvalue]")&&(g.minvalue=(f.dateParse(f.selector())(f.selector().attr("minvalue"))).start);f.selector().is("[maxvalue]")&&(g.maxvalue=(f.dateParse(f.selector())(f.selector().attr("maxvalue"))).start)}else{f.selector().is("[minvalue]")&&(g.minvalue=JC.f.parseISODate(f.selector().attr("minvalue")));f.selector().is("[maxvalue]")&&(g.maxvalue=JC.f.parseISODate(f.selector().attr("maxvalue")))}g.minvalue&&(g.minvalue=JC.f.pureDate(g.minvalue));g.maxvalue&&(g.maxvalue=JC.f.pureDate(g.maxvalue));return g},defaultSingleSelectDate:function(k){var f=this,g=f.selector(),i,h=g.val().trim();if(!h){k.date=new Date();k.enddate=JC.f.cloneDate(k.date);return k}if(f.dateParse(f.selector())){var j=f.dateParse(f.selector())(f.selector().val().trim());k.date=j.start;k.enddate=j.end;!k.enddate&&(k.enddate=k.date)}else{if(i=JC.f.parseISODate(g.val())){k.date=i}else{if(g.val()&&(i=g.val().replace(/[^\d]/g,"")).length==16){k.date=JC.f.parseISODate(i.slice(0,8));k.enddate=JC.f.parseISODate(i.slice(8))}else{i=new Date();if(e.lastIpt&&e.lastIpt.is("[defaultdate]")){i=JC.f.parseISODate(e.lastIpt.attr("defaultdate"))||i}k.date=new Date(i.getFullYear(),i.getMonth(),i.getDate())}}}return k},defaultMultiselectDate:function(l){var f=this,g=e.lastIpt,j,h,i,k;if(g.val()){j=g.val().trim().replace(/[^\d,]/g,"").split(",");h=[];$.each(j,function(n,m){if(f.dateParse(g)){var o=f.dateParse(g)(m);i=o.start;k=o.end;!k&&(k=i);h.push({start:i,end:k})}else{if(m.length==16){i=JC.f.parseISODate(m.slice(0,8));k=JC.f.parseISODate(m.slice(8));if(!n){l.date=JC.f.cloneDate(i);l.enddate=JC.f.cloneDate(k)}h.push({start:i,end:k})}else{if(m.length==8){i=JC.f.parseISODate(m.slice(0,8));k=JC.f.cloneDate(i);if(!n){l.date=JC.f.cloneDate(i);l.enddate=JC.f.cloneDate(k)}h.push({start:i,end:k})}}}});l.multidate=h}else{j=new Date();if(e.lastIpt&&e.lastIpt.is("[defaultdate]")){j=JC.f.parseISODate(e.lastIpt.attr("defaultdate"))||j}l.date=new Date(j.getFullYear(),j.getMonth(),j.getDate());l.enddate=JC.f.cloneDate(l.date);l.enddate.setDate(JC.f.maxDayOfMonth(l.enddate));l.multidate=[];l.multidate.push({start:JC.f.cloneDate(l.date),end:JC.f.cloneDate(l.enddate)})}return l},layoutDate:function(){return this.multiselect()?this.multiLayoutDate():this.singleLayoutDate()},singleLayoutDate:function(){var f=this,i=f.defaultDate(),h=this.day(),g;i.date.setDate(1);i.date.setFullYear(this.year());i.date.setMonth(this.month());g=JC.f.maxDayOfMonth(i.date);h>g&&(h=g);i.date.setDate(h);return i},multiLayoutDate:function(){var f=this,l=f.defaultDate(),k=f.year(),j=f.month(),i=f.day(),m=new Date(k,j,1),g=JC.f.maxDayOfMonth(m),h=f.layout().find("select.UMonth");l.multidate=[];f.layout().find("td.cur").each(function(){var n=$(this);var p=n.find("> a[dstart]"),o=new Date(),q=new Date();o.setTime(p.attr("dstart"));q.setTime(p.attr("dend"));l.multidate.push({start:o,end:q})});l.date=new Date(k,j,1);l.date.enddate=new Date(k,j,g);if(h.length){l.date.setMonth(j);l.enddate.setMonth(j)}$.each(l.multidate,function(o,n){n.start.setFullYear(k);n.end.setFullYear(k);if(h.length){n.start.setMonth(j);n.end.setMonth(j)}});return l},selectedDate:function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[date]"))&&(h=new Date(),h.setTime(f.attr("date")));return h},multiselectDate:function(){var f=[];return f},calendarinited:function(){var h=this.selector(),g=e.layoutInitedCallback,f;h&&h.attr("calendarinited")&&(f=window[h.attr("calendarinited")])&&(g=f);return g},calendarshow:function(){var h=this.selector(),g=e.layoutShowCallback,f;h&&h.attr("calendarshow")&&(f=window[h.attr("calendarshow")])&&(g=f);return g},calendarhide:function(){var h=this.selector(),g=e.layoutHideCallback,f;h&&h.attr("calendarhide")&&(f=window[h.attr("calendarhide")])&&(g=f);return g},calendarupdate:function(h){var i=this.selector(),g,f;i&&i.attr("calendarupdate")&&(f=window[i.attr("calendarupdate")])&&(g=f);return g},calendarclear:function(){var h=this.selector(),g,f;h&&h.attr("calendarclear")&&(f=window[h.attr("calendarclear")])&&(g=f);return g},calendarcancel:function(){var h=this.selector(),g,f;h&&h.attr("calendarcancel")&&(f=window[h.attr("calendarcancel")])&&(g=f);return g},calendarlayoutchange:function(){var h=this.selector(),g,f;h&&h.attr("calendarlayoutchange")&&(f=window[h.attr("calendarlayoutchange")])&&(g=f);return g},multiselect:function(){var f;this.selector().is("[multiselect]")&&(f=JC.f.parseBool(this.selector().attr("multiselect")));return f},calendarupdatemultiselect:function(h){var i=this.selector(),g,f;i&&i.attr("calendarupdatemultiselect")&&(f=window[i.attr("calendarupdatemultiselect")])&&(g=f);return g},updateFormat:function(g){g&&(g=$(g));if(!(g&&g.length)){return}var f=this,h=(g.attr("datetype")||g.attr("multidate")||"").toLowerCase().trim(),l=g.val().trim(),j=f.dateParse(g),i,m,k;if(!l){return}if(h=="date"&&!g.attr("fullDateFormat")){g.attr("fullDateFormat","{0}")}if(j){switch(h){case"date":break;case"week":case"month":case"season":case"year":k=j(l);g.val(f.fullFormat(f.dateFormat(k.start,g),f.dateFormat(k.end,g),g));break}}else{switch(h){case"date":i=JC.f.parseISODate(l);g.val(f.dateFormat(i,g)||l);break}}},dateFormat:function(h,g){g=g||this.selector();var i="",f=g.attr("dateFormat")||"YY-MM-DD";h&&(i=JC.f.dateFormat(h,f));return i},fullFormat:function(g,h,f){f=f||this.selector();var j="",i=f.attr("fullDateFormat")||"{0} 至 {1}";if(g&&h){j=JC.f.printf(i,this.dateFormat(g,f),this.dateFormat(h,f))}else{if(g){j=JC.f.printf(i,this.dateFormat(g,f))}else{if(h){j=JC.f.printf(i,this.dateFormat(h,f))}}}return j},dateParse:function(f){var g;f&&f.attr("dateParse")&&(g=window[f.attr("dateParse")]);return g},tpl:['<div id="UXCCalendar" class="UXCCalendar">','    <div class="UHeader">','        <select class="UYear"></select>','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>','        <select class="UMonth"></select>','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>',"    </div>",'    <table class="UTable">',"        <thead>","            <tr>","                <th>一</th>","                <th>二</th>","                <th>三</th>","                <th>四</th>","                <th>五</th>","                <th>六</th>","                <th>日</th>","            </tr>","        </thead>","   </table>",'   <table class="UTable UTableBorder">',"        <tbody>","           <!--<tr>",'                <td class="cur"><a href="#">2</a></td>','                <td class="unable"><a href="#">2</a></td>','                <td class="weekend cur"><a href="#">6</a></td>','                <td class="weekend hover"><a href="#">13</a></td>','                <td class="weekend other"><a href="#">41</a></td>','                <td class="weekend other"><a href="#">42</a></td>',"            </tr>-->","        </tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function c(f){this._model=f}e.View=c;c.prototype={init:function(){return this},hide:function(){this._model.layout().hide()},show:function(){var f=this._model.defaultDate();this._buildLayout(f);this._buildDone()},updateLayout:function(f){typeof f=="undefined"&&(f=this._model.layoutDate());if(f.minvalue||f.maxvalue){if(f.minvalue&&f.date.getTime()<f.minvalue.getTime()){f.date=JC.f.cloneDate(f.minvalue)}if(f.maxvalue&&f.date.getTime()>f.maxvalue.getTime()){f.date=JC.f.cloneDate(f.maxvalue)}}this._buildLayout(f);this._buildDone()},updateYear:function(h){if(typeof h=="undefined"||h==0){return}var i=this._model.layoutDate(),f;if(i.minvalue||i.maxvalue){var g;f=JC.f.cloneDate(i.date);f.setFullYear(f.getFullYear()+h);if(i.minvalue){if(f.getFullYear()<i.minvalue.getFullYear()){f=JC.f.cloneDate(i.minvalue);h=0;g=true}else{if(new Date(f.getFullYear(),f.getMonth(),1).getTime()<new Date(i.minvalue.getFullYear(),i.minvalue.getMonth(),1).getTime()){h=0;f=JC.f.cloneDate(i.minvalue);g=true}}}if(i.maxvalue){if(f.getFullYear()>i.maxvalue.getFullYear()){h=0;f=JC.f.cloneDate(i.maxvalue);g=true}else{if(new Date(f.getFullYear(),f.getMonth(),1).getTime()>new Date(i.maxvalue.getFullYear(),i.maxvalue.getMonth(),1).getTime()){h=0;f=JC.f.cloneDate(i.maxvalue);g=true}}}if(!g){f=null}else{}}this._model.multiselect()?this.updateMultiYear(h,f):this.updateSingleYear(h,f)},updateSingleYear:function(h,g){var j=this._model.layoutDate();if(g){j.date=g}else{var i=j.date.getDate(),f;j.date.setDate(1);j.date.setFullYear(j.date.getFullYear()+h);f=JC.f.maxDayOfMonth(j.date);i>f&&(i=f);j.date.setDate(i)}this._buildLayout(j);this._buildDone()},updateMultiYear:function(h,g){var j=this._model.layoutDate();j.date=g||j.date;var i,f;JC.Calendar.updateMultiYear(j.date,h);JC.Calendar.updateMultiYear(j.enddate,h);if(j.multidate){$.each(j.multidate,function(l,k){JC.Calendar.updateMultiYear(k.start,h);JC.Calendar.updateMultiYear(k.end,h)})}this._buildLayout(j);this._buildDone()},updateMonth:function(j){if(typeof j=="undefined"||j==0){return}var m=this._model.layoutDate(),h;if(m.minvalue||m.maxvalue){h=JC.f.cloneDate(m.date);h.setDate(1);h.setMonth(h.getMonth()+j);var i=m.minvalue?JC.f.cloneDate(m.minvalue):null,k=m.maxvalue?JC.f.cloneDate(m.maxvalue):null,f;i&&i.setDate(1);k&&k.setDate(1);if(i){if(h.getTime()<i.getTime()){j=0;h=JC.f.cloneDate(m.minvalue);f=true}if(new Date(h.getFullYear(),h.getMonth(),1).getTime()<new Date(m.minvalue.getFullYear(),m.minvalue.getMonth(),1).getTime()){j=0;h=JC.f.cloneDate(m.minvalue);f=true}}if(k){if(h.getTime()>k.getTime()){j=0;h=JC.f.cloneDate(m.maxvalue);f=true}if(new Date(h.getFullYear(),h.getMonth(),1).getTime()>new Date(m.maxvalue.getFullYear(),m.maxvalue.getMonth(),1).getTime()){j=0;h=JC.f.cloneDate(m.maxvalue);f=true}}if(!f){h=null}else{var g=JC.f.maxDayOfMonth(h),l=m.date.getDate();l>g&&(l=g);h.setDate(l)}}this._model.multiselect()?this.updateMultiMonth(j,h):this.updateSingleMonth(j,h)},updateMultiMonth:function(h,g){var j=this._model.layoutDate(),i,f;if(g){j.date=g;h=0}else{JC.Calendar.updateMultiMonth(j.date,h);JC.Calendar.updateMultiMonth(j.enddate,h);if(j.multidate){$.each(j.multidate,function(l,k){JC.Calendar.updateMultiMonth(k.start,h);JC.Calendar.updateMultiMonth(k.end,h)})}}this._buildLayout(j);this._buildDone()},updateSingleMonth:function(h,g){var j=this._model.layoutDate();if(g){j.date=g}else{var i=j.date.getDate(),f;j.date.setDate(1);j.date.setMonth(j.date.getMonth()+h);f=JC.f.maxDayOfMonth(j.date);i>f&&(i=f);j.date.setDate(i)}this._buildLayout(j);this._buildDone()},updateSelected:function(i){var f=this,g,h;if(!i){g=this._model.selectedDate()}else{i=$(i);h=JC.f.getJqParent(i,"td");if(h&&h.hasClass("unable")){return}g=new Date();g.setTime(i.attr("date"))}if(!g){return}f._model.selector().val(f._model.dateFormat(g));$(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"date",g,g]);e.hide()},updatePosition:function(){var h=this,f=h._model.selector(),s=h._model.layout();if(!(f&&s&&f.length&&s.length)){return}s.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var q=s.width(),j=s.height(),r=f.width(),k=f.height(),p=f.offset(),n,l,g=$(window).width(),m=$(window).height(),o=$(document).scrollLeft(),i=$(document).scrollTop();n=p.left;l=p.top+k+5;if((l+j-i)>m){l=p.top-j-3;l<i&&(l=i)}if((n+q-o)>g){n=g-q+o-5}n<o&&(n=o+0);s.css({left:n+"px",top:l+"px"})},_buildDone:function(){this.updatePosition();$(this).trigger("TriggerEvent",[e.Model.INITED])},_buildLayout:function(f){this._model.layout();if(!(f&&f.date)){return}this._buildHeader(f);this._buildBody(f);this._buildFooter(f)},_buildHeader:function(z){var A=this,k=A._model.layout(),y=[],g,x=z.date.getFullYear(),n=z.date.getMonth(),h=A._model.startYear(z),w=A._model.endYear(z),B=z.date.getFullYear(),q=new Date(z.date.getFullYear(),z.date.getMonth(),1),m=z.minvalue?z.minvalue.getFullYear():0,o=z.maxvalue?z.maxvalue.getFullYear():0,r=z.minvalue?new Date(z.minvalue.getFullYear(),z.minvalue.getMonth(),1):0,l=z.maxvalue?new Date(z.maxvalue.getFullYear(),z.maxvalue.getMonth(),1):0,u,t,v,f,p,s;for(u=h;u<=w;u++){if(o&&B>o){s=true}if(o&&u>o){break}if(m&&u<m){continue}if(m&&B<m){s=true}y.push(JC.f.printf('<option value="{0}"{1}>{0}</option>',u,u===x?" selected":""))}if(s){y.unshift(JC.f.printf('<option value="{0}"{1}>{0}</option>',B," selected"))}$(y.join("")).appendTo(k.find("select.UYear").html(""));y=[];for(u=0;u<12;u++){v=e.getCnNum(u+1);f=new Date(B,u,1);if(l&&f.getTime()>l.getTime()){break}if(r&&f.getTime()<r.getTime()){continue}y.push(JC.f.printf('<option value="{0}"{1}>{2}月</option>',u,u===n?" selected":"",v))}if(!y.length){v=e.getCnNum(z.date.getMonth()+1);y.push(JC.f.printf('<option value="{0}"{1}>{2}月</option>',z.date.getMonth()," selected",v))}$(y.join("")).appendTo(k.find("select.UMonth").html(""))},_buildBody:function(n){var h=this,v=h._model.layout();var u=JC.f.maxDayOfMonth(n.date),p=n.date.getDay()||7,t=p+u,k=6,g=[],j,f,r,m,o;var l=new Date(n.date.getFullYear(),n.date.getMonth(),1);var q=l.getDay()||7;if(q<2){l.setDate(-(q-1+6))}else{l.setDate(-(q-2))}var s=new Date();if(n.maxvalue&&!h._model.currentcanselect()){n.maxvalue.setDate(n.maxvalue.getDate()-1)}g.push("<tr>");for(m=1;m<=42;m++){o=[];if(l.getDay()===0||l.getDay()==6){o.push("weekend")}if(!JC.f.isSameMonth(n.date,l)){o.push("other")}if(n.minvalue&&l.getTime()<n.minvalue.getTime()){o.push("unable")}if(n.maxvalue&&l.getTime()>n.maxvalue.getTime()){o.push("unable")}if(JC.f.isSameDay(l,s)){o.push("today")}if(JC.f.isSameDay(n.date,l)){o.push("cur")}g.push('<td class="',o.join(" "),'">','<a href="javascript:" date="',l.getTime(),'" title="'+JC.f.formatISODate(l)+'" >',l.getDate(),"</a></td>");l.setDate(l.getDate()+1);if(m%7===0&&m!=42){g.push("</tr><tr>")}}g.push("</tr>");v.find("table.UTableBorder tbody").html($(g.join("")))},_buildFooter:function(f){}};$(document).delegate("body > div.UXCCalendar select.UYear, body > div.UXCCalendar select.UMonth","change",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateLayout()});$(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateYear(1)});$(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateYear(-1)});$(document).delegate("map[name=UXCCalendar_Year] area","click",function(g){g.preventDefault();var f=$(this),h=e.getInstance(e.lastIpt);f.attr("action")&&h&&(f.attr("action").toLowerCase()=="up"&&h.updateYear(1),f.attr("action").toLowerCase()=="down"&&h.updateYear(-1))});$(document).delegate("map[name=UXCCalendar_Month] area","click",function(g){g.preventDefault();var f=$(this),h=e.getInstance(e.lastIpt);f.attr("action")&&h&&(f.attr("action").toLowerCase()=="up"&&h.updateMonth(1),f.attr("action").toLowerCase()=="down"&&h.updateMonth(-1))});$(document).delegate("body > div.UXCCalendar button.UNextMonth","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateMonth(1)});$(document).delegate("body > div.UXCCalendar button.UPreMonth","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateMonth(-1)});$(document).delegate("div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]","click",function(f){f.preventDefault();e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateSelected($(this))});$(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateSelected()});$(document).delegate("body > div.UXCCalendar button.UClear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).clear()});$(document).delegate("body > div.UXCCalendar button.UCancel","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).cancel()});$(document).delegate("input.UXCCalendar_btn","click",function(g){var f=$(this),h;if(!f.data(e.Model.INPUT)){h=f.prev("input[type=text], textarea");h.length&&f.data(e.Model.INPUT,h)}f.data(e.Model.INPUT)&&!f.data(e.Model.INPUT).is("[disabled]")&&e.pickDate(f.data(e.Model.INPUT))});$(document).delegate("body > div.UXCCalendar","click",function(f){f.stopPropagation()});$(document).ready(function(f){JC.f.safeTimeout(function(g){if(!e.autoInit){return}e.initTrigger($(document))},null,"CalendarInitTrigger",200);$(window).on("scroll resize",function(g){var h=e.getInstance(e.lastIpt);h&&h.visible()&&h.updatePosition()});$(document).on("click",function(g){var h=g.target||g.srcElement;if(e.domClickFilter){if(e.domClickFilter($(h))===false){return}}if(e.isCalendar(g.target||g.targetElement)){return}if(h&&(h.nodeName.toLowerCase()!="input"&&h.nodeName.toLowerCase()!="button"&&h.nodeName.toLowerCase()!="textarea")){e.hide();return}JC.f.safeTimeout(function(){if(e.lastIpt&&e.lastIpt.length&&h==e.lastIpt[0]){return}e.hide()},null,"CalendarClickHide",100)})});$(document).delegate(["input[datatype=date]","input[datatype=daterange]","input[multidate=date]","input[multidate=daterange]"].join(),"focus",function(f){e.pickDate(this)});$(document).delegate(["button[datatype=date]","button[datatype=daterange]","button[multidate=date]","button[multidate=daterange]"].join(),"click",function(f){e.pickDate(this)});$(document).delegate(["textarea[datatype=date]","textarea[datatype=daterange]","textarea[multidate=date]","textarea[multidate=daterange]"].join(),"click",function(f){e.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.weekTpl="";JC.Calendar.weekDayOffset=0;function d(f){this._selector=f}JC.Calendar.WeekModel=d;function c(f){this._model=f}JC.Calendar.WeekView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var f=$("#UXCCalendar_week");if(!f.length){f=$(JC.Calendar.weekTpl||this.tpl).hide();f.attr("id","UXCCalendar_week").hide().appendTo(document.body)}return f},tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var h=0,g,f=new Date();(g=this.layout().find("td.cur a[dstart]")).length&&(f=new Date())&&(f.setTime(g.attr("dstart")));h=f.getMonth();return h},selectedDate:function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[dstart]"))&&(h={start:new Date(),end:new Date()},h.start.setTime(f.attr("dstart")),h.end.setTime(f.attr("dend")));return h},singleLayoutDate:function(){var g=this,j=g.defaultDate(),i=this.day(),h,f=g.layout().find("td.cur > a[week]");j.date.setDate(1);j.date.setFullYear(this.year());j.date.setMonth(this.month());h=JC.f.maxDayOfMonth(j.date);i>h&&(i=h);j.date.setDate(i);f.length&&(j.curweek=parseInt(f.attr("week"),10));return j}});JC.f.extendObject(c.prototype,{_buildBody:function(B){var D=this,q=B.date,l=D._model.layout(),z=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),m=e(q.getFullYear(),JC.Calendar.weekDayOffset),y=e(q.getFullYear()+1,JC.Calendar.weekDayOffset),n=0,A=[],h,s,r,o,x,k=q.getFullYear(),g=Math.ceil(m.length/8),u=JC.Calendar.lastIpt,f=JC.f.parseBool(u.attr("currentcanselect")),C,p=B.minvalue?JC.f.cloneDate(B.minvalue):null,w=B.maxvalue?JC.f.cloneDate(B.maxvalue):null;if(w&&f){C=w.getDay();if(C>0){w.setDate(w.getDate()+(7-C))}else{}}if(p&&f){C=p.getDay();if(C>0){p.setDate(p.getDate()-C+1)}else{p.setDate(p.getDate()-6)}}A.push("<tr>");for(var v=1,t=g*8;v<=t;v++){s=m[v-1];if(!s){s=y[n++];k=q.getFullYear()+1}o=JC.f.pureDate(new Date());x=JC.f.pureDate(new Date());o.setTime(s.start);x.setTime(s.end);r=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(s.week),JC.f.formatISODate(o),JC.f.formatISODate(x),JC.Calendar.cnWeek.charAt(o.getDay()%7),JC.Calendar.cnWeek.charAt(x.getDay()%7));h=[];if(p&&o.getTime()<p.getTime()){h.push("unable")}if(w&&x.getTime()>w.getTime()){h.push("unable")}if(B.curweek){if(s.week==B.curweek&&q.getFullYear()==o.getFullYear()){h.push("cur")}}else{if(q.getTime()>=o.getTime()&&q.getTime()<=x.getTime()){h.push("cur")}}if(z>=o.getTime()&&z<=x.getTime()){h.push("today")}A.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',h.join(" "),s.week,r,o.getTime(),x.getTime(),B.date.getTime()));if(v%8===0&&v!=t){A.push("</tr><tr>")}}A.push("</tr>");l.find("table.UTableBorder tbody").html($(A.join("")))},updateSelected:function(j){var f=this,g,i,h;if(!j){h=this._model.selectedDate();h&&(g=h.start,i=h.end)}else{j=$(j);h=JC.f.getJqParent(j,"td");if(h&&h.hasClass("unable")){return}g=new Date();i=new Date();g.setTime(j.attr("dstart"));i.setTime(j.attr("dend"))}if(!(g&&i)){return}f._model.selector().val(f._model.fullFormat(f._model.dateFormat(g),f._model.dateFormat(i)));$(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",g,i]);JC.Calendar.hide()}});function e(i,h){var k=[],j,g=1,h=h||0,i=parseInt(i,10),f=new Date(i,0,1);f.getDay()>1&&f.setDate(f.getDate()-f.getDay()+7);f.getDay()===0&&f.setDate(f.getDate()+1);h>0&&(h=(new Date(2000,1,2)-new Date(2000,1,1))*h);while(f.getFullYear()<=i){j={week:g++,start:null,end:null};j.start=f.getTime()+h;f.setDate(f.getDate()+6);j.end=f.getTime()+h;f.setDate(f.getDate()+1);if(f.getFullYear()>i){f=new Date(f.getFullYear(),0,1);if(f.getDay()<2){break}}k.push(j)}return k}$(document).delegate(["input[datatype=week]","input[multidate=week]"].join(),"focus",function(f){Calendar.pickDate(this)});$(document).delegate(["button[datatype=week]","button[multidate=week]"].join(),"click",function(f){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=week]","textarea[multidate=week]"].join(),"click",function(f){Calendar.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.monthTpl="";function c(e){this._selector=e}JC.Calendar.MonthModel=c;function d(e){this._model=e}JC.Calendar.MonthView=d;JC.Calendar.clone(c,d);JC.f.extendObject(c.prototype,{layout:function(){var e=$("#UXCCalendar_month");if(!e.length){e=$(JC.Calendar.monthTpl||this.tpl).hide();e.attr("id","UXCCalendar_month").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var g=0,f,e;(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")),g=e.getMonth());return g},selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g},multiselectDate:function(){var e=this,j=[],f,h,g,i;e.layout().find("td.cur").each(function(){f=$(this);h=f.find("> a[dstart]");if(f.hasClass("unable")){return}g=new Date();i=new Date();g.setTime(h.attr("dstart"));i.setTime(h.attr("dend"));j.push({start:g,end:i})});return j}});JC.f.extendObject(d.prototype,{_buildBody:function(A){var B=this,p=A.date,l=B._model.layout(),y=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),n=0,z=[],g,r,q,x,s,h=p.getFullYear(),f=4,u=JC.Calendar.lastIpt,e=JC.f.parseBool(u.attr("currentcanselect")),m=A.multidate?A.multidate.slice():null,o=A.minvalue?JC.f.cloneDate(A.minvalue):null,w=A.maxvalue?JC.f.cloneDate(A.maxvalue):null;if(w&&e){w.setDate(JC.f.maxDayOfMonth(w))}if(o&&e){o.setDate(1)}z.push("<tr>");for(var v=1,t=12;v<=t;v++){x=new Date(h,v-1,1);s=new Date(h,v-1,JC.f.maxDayOfMonth(x));q=JC.f.printf("{0}年 {1}月\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",h,JC.Calendar.getCnNum(v),JC.f.formatISODate(x),JC.f.formatISODate(s),JC.Calendar.cnWeek.charAt(x.getDay()%7),JC.Calendar.cnWeek.charAt(s.getDay()%7));g=[];if(o&&x.getTime()<o.getTime()){g.push("unable")}if(w&&s.getTime()>w.getTime()){g.push("unable")}if(m){$.each(m,function(j,i){if(x.getTime()>=i.start.getTime()&&x.getTime()<=i.end.getTime()){g.push("cur");m.splice(j,1);return false}})}else{if(p.getTime()>=x.getTime()&&p.getTime()<=s.getTime()){g.push("cur")}}if(y>=x.getTime()&&y<=s.getTime()){g.push("today")}var k=JC.Calendar.cnUnit.charAt(v%10);v>10&&(k="十"+k);z.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',g.join(" "),q,k,x.getTime(),s.getTime(),v));if(v%3===0&&v!=t){z.push("</tr><tr>")}}z.push("</tr>");l.find("table.UTableBorder tbody").html($(z.join("")))},updateSelected:function(k){var e=this,f,j,g,i,h;if(!k){if(e._model.multiselect()){g=this._model.multiselectDate();if(!g.length){return}h=[];$.each(g,function(m,l){h.push(i=e._model.fullFormat(e._model.dateFormat(l.start),e._model.dateFormat(l.end)))});i=h.join(",")}else{g=this._model.selectedDate();g&&(f=g.start,j=g.end);f&&j&&(i=e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(j)))}}else{k=$(k);g=JC.f.getJqParent(k,"td");if(g&&g.hasClass("unable")){return}if(e._model.multiselect()){g.toggleClass("cur");return}f=new Date();j=new Date();f.setTime(k.attr("dstart"));j.setTime(k.attr("dend"));i=e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(j))}if(!i){return}e._model.selector().val(i);$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"month",f,j]);JC.Calendar.hide()}});$(document).delegate(["input[datatype=month]","input[multidate=month]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=month]","button[multidate=month]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=month]","textarea[multidate=month]"].join(),"click",function(e){Calendar.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.seasonTpl="";function d(e){this._selector=e}JC.Calendar.SeasonModel=d;function c(e){this._model=e}JC.Calendar.SeasonView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var e=$("#UXCCalendar_season");if(!e.length){e=$(JC.Calendar.seasonTpl||this.tpl).hide();e.attr("id","UXCCalendar_season").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var g=0,f,e;(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")),g=e.getMonth());return g},selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g}});JC.f.extendObject(c.prototype,{_buildBody:function(B){var C=this,p=B.date,m=C._model.layout(),z=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),n=0,A=[],h,t,s,o,y,k=p.getFullYear(),g=4,v=JC.Calendar.lastIpt,f=JC.f.parseBool(v.attr("currentcanselect")),q=B.minvalue?JC.f.cloneDate(B.minvalue):null,x=B.maxvalue?JC.f.cloneDate(B.maxvalue):null,e;if(x&&f){var e=x.getMonth()+1,r;if(e%3!==0){x.setDate(1);x.setMonth(e+(3-(e%3)-1))}x.setDate(JC.f.maxDayOfMonth(x))}if(q&&f){e=q.getMonth()+1,r;q.setDate(1);q.setMonth(q.getMonth()-(3-e%3))}A.push("<tr>");for(var w=1,u=4;w<=u;w++){o=new Date(k,w*3-3,1);y=new Date(k,w*3-1,1);y.setDate(JC.f.maxDayOfMonth(y));var l=JC.Calendar.cnUnit.charAt(w%10);w>10&&(l="十"+l);s=JC.f.printf("{0}年 第{1}季度\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(w),JC.f.formatISODate(o),JC.f.formatISODate(y),JC.Calendar.cnWeek.charAt(o.getDay()%7),JC.Calendar.cnWeek.charAt(y.getDay()%7));h=[];if(q&&o.getTime()<q.getTime()){h.push("unable")}if(x&&y.getTime()>x.getTime()){h.push("unable")}if(p.getTime()>=o.getTime()&&p.getTime()<=y.getTime()){h.push("cur")}if(z>=o.getTime()&&z<=y.getTime()){h.push("today")}A.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',h.join(" "),s,l,o.getTime(),y.getTime(),w));if(w%2===0&&w!=u){A.push("</tr><tr>")}}A.push("</tr>");m.find("table.UTableBorder tbody").html($(A.join("")))},updateSelected:function(i){var e=this,f,h,g;if(!i){g=this._model.selectedDate();g&&(f=g.start,h=g.end)}else{i=$(i);g=JC.f.getJqParent(i,"td");if(g&&g.hasClass("unable")){return}f=new Date();h=new Date();f.setTime(i.attr("dstart"));h.setTime(i.attr("dend"))}if(!(f&&h)){return}e._model.selector().val(e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(h)));$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"season",f,h]);JC.Calendar.hide()}});$(document).delegate(["input[datatype=season]","input[multidate=season]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=season]","button[multidate=season]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=season]","textarea[multidate=season]"].join(),"click",function(e){Calendar.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.yearTpl="";function d(e){this._selector=e}JC.Calendar.YearModel=d;function c(e){this._model=e}JC.Calendar.YearView=c;JC.Calendar.clone(d,c);JC.f.extendObject(d.prototype,{layout:function(){var e=$("#UXCCalendar_year");if(!e.length){e=$(JC.Calendar.yearTpl||this.tpl).hide();e.attr("id","UXCCalendar_year").hide().appendTo(document.body)}return e},tpl:['<div id="UXCCalendar_year" class="UXCCalendar UXCCalendar_week UXCCalendar_year">\n','    <table class="UTable UTableBorder">\n',"        <tbody>\n","            <tr>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>\n',"                </td>\n","                <td></td><td></td><td></td><td></td>\n","            </tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr><td></td><td></td><td></td><td></td><td></td></tr>\n","            <tr>\n","                <td></td><td></td><td></td><td></td>\n",'                <td class="UYearBox">\n','                    <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>\n',"                </td>\n","            </tr>\n","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join(""),selectedDate:function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g}});JC.f.extendObject(c.prototype,{_buildBody:function(r){var u=this,t=u._model.selector(),n=t.val().trim(),v=n.replace(/[^\d]+/g,""),h=r.date,p=new Date().getFullYear(),i=u._model.layout(),q=i.find("tbody > tr > td"),s=q.length-1,m,j,g,e=JC.f.parseBool(t.attr("currentcanselect")),k,f,o,l;v&&(v=v.slice(0,4));!v&&(v=p);g=h.getFullYear();m=g-Math.floor(s/2);if(r.minvalue&&e){r.minvalue.setFullYear(r.minvalue.getFullYear()-1)}if(r.maxvalue&&e){r.maxvalue.setFullYear(r.maxvalue.getFullYear()+1)}q.each(function(x,w){w=$(w);if(x==0||x==s){}else{k=JC.f.printf("{0}年",m);f=[];o=new Date(m,0,1);l=new Date(m,11,31);if(r.minvalue&&o.getFullYear()<=r.minvalue.getFullYear()){f.push("unable")}if(r.maxvalue&&l.getFullYear()>=r.maxvalue.getFullYear()){f.push("unable")}v&&v==m&&f.push("cur");p==m&&f.push("today");w.html(JC.f.printf('<a href="javascript:" title="{0}" dstart="{1}" dend="{2}" " >{3}</a></td>',k,o.getTime(),l.getTime(),m));w.prop("className",f.join(" "))}m++})},updateSelected:function(i){var e=this,f,h,g;if(!i){g=this._model.selectedDate();g&&(f=g.start,h=g.end)}else{i=$(i);g=JC.f.getJqParent(i,"td");if(g&&g.hasClass("unable")){return}f=new Date();h=new Date();f.setTime(i.attr("dstart"));h.setTime(i.attr("dend"))}if(!(f&&h)){return}e._model.selector().val(e._model.fullFormat(e._model.dateFormat(f),e._model.dateFormat(h)));$(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"year",f,h]);JC.Calendar.hide()},updateYear:function(f){if(typeof f=="undefined"||f==0){return}var g=this._model.layoutDate(),e;this._model.multiselect()?this.updateMultiYear(f):this.updateSingleYear(f)},updateSingleYear:function(l){if(!l){return}var g=this._model.layoutDate(),k=this._model.layout().find("a[dstart]"),j=k.first(),f=k.last(),e=new Date(),o=new Date(),n=17,i;if(l>0){e.setTime(f.attr("dstart"));o.setTime(f.attr("dend"));g.date=e;g.enddate=o;g.date.setFullYear(g.date.getFullYear()+n);g.enddate.setFullYear(g.enddate.getFullYear()+n)}else{e.setTime(j.attr("dstart"));o.setTime(j.attr("dend"));g.date=e;g.enddate=o;g.date.setFullYear(g.date.getFullYear()-n);g.enddate.setFullYear(g.enddate.getFullYear()-n)}var h=g.date.getFullYear()-n+1,m=g.date.getFullYear()+n-1;if(g.minvalue&&g.minvalue.getFullYear()>m){return}if(g.maxvalue&&g.maxvalue.getFullYear()<h){return}this._buildLayout(g);this._buildDone()}});$(document).delegate(["input[datatype=year]","input[multidate=year]"].join(),"focus",function(e){Calendar.pickDate(this)});$(document).delegate(["button[datatype=year]","button[multidate=year]"].join(),"click",function(e){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=year]","textarea[multidate=year]"].join(),"click",function(e){Calendar.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));(function(b,a){b(["JC.Calendar.date"],function(){JC.Calendar.monthdayTpl="";JC.Calendar.monthdayHeadAppendText="";function e(f){this._selector=f}JC.Calendar.MonthDayModel=e;function d(f){this._model=f}JC.Calendar.MonthDayView=d;JC.Calendar.clone(e,d);JC.f.extendObject(e.prototype,{fixCheckall:function(){var g=this,f,i,j=true,h;g._fixCheckAllTm&&clearTimeout(g._fixCheckAllTm);g._fixCheckAllTm=setTimeout(function(){i=g.layout().find("input.js_JCCalendarCheckbox[action=all]");f=g.layout().find("input.js_JCCalendarCheckbox[dstart]");f.each(function(){h=$(this);var k=g.findItemByTimestamp(h.attr("dstart"));if(k.atd.hasClass("unable")){return}if(!h.prop("checked")){return j=false}});i.prop("checked",j)},100)},findItemByTimestamp:function(g){var f=this,h={a:null,atd:null,atr:null,input:null,inputtr:null,tm:g};if(g){h.a=f.layout().find(JC.f.printf("a[dstart={0}]",g));h.atd=JC.f.getJqParent(h.a,"td");h.atr=JC.f.getJqParent(h.a,"tr");h.input=f.layout().find(JC.f.printf("input[dstart={0}]",g));h.inputtr=JC.f.getJqParent(h.input,"tr")}return h},layout:function(){var g=$("#UXCCalendar_monthday");if(!g.length){g=$(JC.f.printf(JC.Calendar.monthdayTpl||this.tpl,JC.Calendar.monthdayHeadAppendText)).hide();g.attr("id","UXCCalendar_monthday").hide().appendTo(document.body);var f=$(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(g.find("select.UMonth"))}return g},tpl:['<div id="UXCCalendar_monthday" class="UXCCalendar UXCCalendar_week UXCCalendar_monthday" >','    <div class="UHeader">','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <button type="button" class="UButton UPreMonth">&nbsp;&nbsp;&lt;&nbsp;&nbsp;</button>','        <select class="UYear" style=""></select>','        <select class="UMonth"></select>',"        {0}",'        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UNextMonth">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</button>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),multiselect:function(){return true},multiselectDate:function(){var f=this,j=[],h,i,g;f.layout().find("input.js_JCCalendarCheckbox[dstart]").each(function(){h=$(this);if(!h.prop("checked")){return}g=new Date();g.setTime(h.attr("dstart"));j.push(g)});return j},ccPreserveDisabled:function(){var f=true;this.selector().is("[ccPreserveDisabled]")&&(f=JC.f.parseBool(this.selector().attr("ccPreserveDisabled")));return f},calendarclear:function(){var f=this,j=this.selector(),h,g;j&&j.attr("calendarclear")&&(g=window[j.attr("calendarclear")])&&(h=g);if(f.ccPreserveDisabled()){var k=f.layout().find("input[date]"),i=[];k.each(function(){var m=$(this),l;if(!(m.is(":disabled")&&m.is(":checked"))){return}l=new Date();l.setTime(m.attr("date"));i.push(JC.f.formatISODate(l))});j.val(i.join(","))}return h},fixedDate:function(h){var f=this,g=JC.Calendar.lastIpt,i;g&&!g.is("[defaultdate]")&&(i=JC.f.cloneDate(h.multidate[0].start),g.attr("defaultdate",JC.f.formatISODate(i)))}});JC.f.extendObject(d.prototype,{init:function(){var f=this;$(f).on("MonthDayToggle",function(g,h){var i=f._model.findItemByTimestamp(h.attr("dstart"));if(i.atd.hasClass("unable")){return}i.input.prop("checked",i.atd.hasClass("cur"));f._model.fixCheckall()});$(f).on("MonthDayInputToggle",function(g,h){var i=f._model.findItemByTimestamp(h.attr("dstart"));if(!i.atd){$(f).trigger("MonthDayToggleAll",[h]);return}if(i.atd.hasClass("unable")){return}i.atd[i.input.prop("checked")?"addClass":"removeClass"]("cur");f._model.fixCheckall()});$(f).on("MonthDayToggleAll",function(g,j){var i=f._model.layout().find("a[dstart]"),h=j.prop("checked");if(!i.length){return}i.each(function(){var k=$(this),l=JC.f.getJqParent(k,"td");if(l.hasClass("unable")){return}l[h?"addClass":"removeClass"]("cur");$(f).trigger("MonthDayToggle",[k])})});return this},updateSelected:function(n){var f=this,h,m,j,l,k;if(!n){j=this._model.multiselectDate();if(!j.length){return}k=[];for(var g=0;g<j.length;g++){k.push(JC.f.formatISODate(j[g]))}l=k.join(",")}else{n=$(n);j=JC.f.getJqParent(n,"td");if(j&&j.hasClass("unable")){return}if(f._model.multiselect()){j.toggleClass("cur");return}_date=new Date();_date.setTime(n.attr("date"));l=n.attr("date");l=JC.f.printf("{0}",JC.f.formatISODate(_date))}if(!l){return}if(j.length){f._model.selector().attr("placeholder",JC.f.printf("{0}年 {1}",j[0].getFullYear(),j[0].getMonth()+1));f._model.selector().attr("defaultdate",JC.f.formatISODate(j[0]))}f._model.selector().val(l);$(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"monthday",j]);JC.Calendar.hide()},_buildBody:function(l){var h=this,u=h._model.layout();var s=JC.f.maxDayOfMonth(l.date),g=[],m,n,k,t,r=new Date();h._model.fixedDate(l);var o=[],f=[],p=[];var j=[],q=[];o.push('<tr><td><span class="bold">星期</span></td>');f.push('<tr><td><span class="bold">日期</span></td>');p.push('<tr class="Uchkdate"><td><label><span class="bold">全选</span>&nbsp;<input type="checkbox" class="js_JCCalendarCheckbox" action="all"  /></lable></td>');for(m=0;m<s;m++){k=new Date(l.date.getFullYear(),l.date.getMonth(),m+1);t=k.getDay();j=[];q=c(l,k,r).join(" ");if(t==0||t==6){j.push("red")}o.push(JC.f.printf('<td class="{0}">{1}</td>',j.join(" "),Calendar.cnWeek.charAt(t)));f.push(JC.f.printf('<td class="{0}"><a href="javascript:;" dstart="{1}" dend="{1}" title="{3}" >{2}</a></td>',q,k.getTime(),m+1,JC.f.formatISODate(k)));p.push(JC.f.printf('<td><input type="checkbox" date="{1}" dstart="{1}" dend="{1}" class="js_JCCalendarCheckbox" action="item" {3} {4} title="{2}" /></td>',"",k.getTime(),JC.f.formatISODate(k),(!/\bunable\b/.test(q)&&(/\bcur\b/.test(q)))?"checked":"",/\bunable\b/.test(q)?"disabled":""));k.setDate(k.getDate()+1);t=k.getDay()}o.push("</tr>");f.push("</tr>");p.push("</tr>");g=g.concat(o,f,p);u.find("table.UTableBorder tbody").html($(g.join("")));h._model.fixCheckall()}});function c(l,k,m){var f=[];if(l.minvalue){if(k.getTime()<l.minvalue.getTime()){f.push("unable")}}if(l.maxvalue){if(k.getTime()>l.maxvalue.getTime()){f.push("unable")}}if(JC.f.isSameDay(k,m)){f.push("today")}for(var h=0,g=l.multidate.length;h<g;h++){if(JC.f.isSameDay(l.multidate[h].start,k)){f.push("cur");break}}return f}$(document).delegate("#UXCCalendar_monthday a[dstart]","click",function(h){var g=JC.Calendar.lastIpt,i,j,f=$(this);if(!g){return}i=JC.Calendar.type(g);j=JC.Calendar.getInstance(g);if(!j){return}$(j._view).trigger("MonthDayToggle",[f])});$(document).delegate("#UXCCalendar_monthday input.js_JCCalendarCheckbox","click",function(h){var g=JC.Calendar.lastIpt,i,j,f=$(this);if(!g){return}i=JC.Calendar.type(g);j=JC.Calendar.getInstance(g);if(!j){return}$(j._view).trigger("MonthDayInputToggle",[f])});$(document).delegate(["input[datatype=monthday]","input[multidate=monthday]"].join(),"focus",function(f){Calendar.pickDate(this)});$(document).delegate(["button[datatype=monthday]","button[multidate=monthday]"].join(),"click",function(f){Calendar.pickDate(this)});$(document).delegate(["textarea[datatype=monthday]","textarea[multidate=monthday]"].join(),"click",function(f){Calendar.pickDate(this)});return JC.Calendar})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));