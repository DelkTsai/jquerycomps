(function(define,_win){define(["JC.BaseMVC"],function(){window.Tab=JC.Tab=Tab;function Tab(_selector,_triggerTarget){_selector&&(_selector=$(_selector));_triggerTarget&&(_triggerTarget=$(_triggerTarget));if(Tab.getInstance(_selector)){return Tab.getInstance(_selector)}Tab.getInstance(_selector,this);this._model=new Tab.Model(_selector,_triggerTarget);this._view=new Tab.View(this._model);this._init()}Tab.autoInit=true;Tab.activeClass="cur";Tab.activeEvent="click";Tab.getInstance=function(_selector,_setter){return JC.BaseMVC.getInstance(_selector,Tab,_setter)};Tab.triggerDefault=function(_ins){if(!(_ins&&_ins._model&&_ins._model.tablabels)){return _ins}_ins._model.tablabels().each(function(){var _sp=$(this);if(_sp.parent().hasClass(_ins._model.activeClass(_ins._model.tablabelparent(_sp)))){_sp.trigger(_ins._model.activeEvent());return false}});return _ins};Tab.init=function(_selector){var _r=[],_tmp;_selector=$(_selector||document);if(_selector&&_selector.length){if(_selector.hasClass("js_autoTab")||_selector.hasClass("js_compTab")){_r.push(Tab.triggerDefault(new Tab(_selector)))}else{_selector.find("div.js_autoTab, div.js_compTab").each(function(){_r.push(Tab.triggerDefault(new Tab(this)))})}}return _r};Tab.selectorIsTab=function(_selector){var _r;_selector&&(_selector=$(_selector))&&_selector.length&&(_selector.attr("tablabels")&&_selector.attr("tabcontainers"))&&(_r=true);return _r};Tab.ajaxCallback=null;Tab.ajaxRandom=true;Tab.isAjax=function(_label){return $(_label).attr("tabAjaxUrl")};Tab.isAjaxInited=function(_label,_setter){_setter!="undefined"&&($(_label).data("TabAjaxInited",_setter));return $(_label).data("TabAjaxInited")};Tab.isIframe=function(_label){return $(_label).attr("tabIframeUrl")};Tab.isIframeInited=function(_label,_setter){_setter!="undefined"&&($(_label).data("TabIframeInited",_setter));return $(_label).data("TabIframeInited")};Tab.Model=function(_selector,_triggerTarget){this._selector=_selector;this._triggerTarget=_triggerTarget;this._tablabels;this._tabcontainers;this.currentIndex};JC.BaseMVC.build(Tab);JC.f.extendObject(Tab.prototype,{_initHanlderEvent:function(){var _p=this;_p.on("inited",function(){var _triggerTarget=$(this._model.triggerTarget());_triggerTarget&&_triggerTarget.length&&this._model.tablabel(_triggerTarget)&&_triggerTarget.trigger(_p._model.activeEvent())})},active:function(_label){var _ix;if(typeof _label=="number"){_ix=_label}else{_label&&$(_label).length&&(_ix=this._model.tabindex(_label))}typeof _ix!="undefined"&&(this._view.active(_ix));return this},_inited:function(){this.trigger("inited")}});Tab.Model._instanceName="TabInstance";JC.f.extendObject(Tab.Model.prototype,{init:function(){var _p=this,_re=/^\~[\s]+/g;if(_p.isFromChild(_p.selector().attr("tablabels"))){this._tablabels=_p.selector().find(_p.selector().attr("tablabels").replace(_re,""))}else{this._tablabels=JC.f.parentSelector(_p.selector(),_p.selector().attr("tablabels"))}if(_p.isFromChild(_p.selector().attr("tabcontainers"))){this._tabcontainers=_p.selector().find(_p.selector().attr("tabcontainers").replace(_re,""))}else{this._tabcontainers=JC.f.parentSelector(_p.selector(),_p.selector().attr("tabcontainers"))}this._tablabels.each(function(){_p.tablabel(this,1)});this._tabcontainers.each(function(){_p.tabcontent(this,1)});this._tablabels.each(function(_ix){_p.tabindex(this,_ix)});return this},isFromChild:function(_selector){return/^\~/.test($.trim(_selector))},tablabels:function(_ix){if(typeof _ix!="undefined"){return $(this._tablabels[_ix])}return this._tablabels},tabcontainers:function(_ix){if(typeof _ix!="undefined"){return $(this._tabcontainers[_ix])}return this._tabcontainers},triggerTarget:function(){return this._triggerTarget},activeClass:function(){return this.selector().attr("tabactiveclass")||Tab.activeClass},activeEvent:function(){return this.selector().attr("tabactiveevent")||Tab.activeEvent},tablabel:function(_label,_setter){_label&&(_label=$(_label));if(!(_label&&_label.length)){return}typeof _setter!="undefined"&&_label.data("TabLabel",_setter);return _label.data("TabLabel")},tabcontent:function(_content,_setter){_content&&(_content=$(_content));if(!(_content&&_content.length)){return}typeof _setter!="undefined"&&_content.data("TabContent",_setter);return _content.data("TabContent")},tabindex:function(_label,_setter){_label&&(_label=$(_label));if(!(_label&&_label.length)){return}typeof _setter!="undefined"&&_label.data("TabIndex",_setter);return _label.data("TabIndex")},tabactivecallback:function(){var _r;this.selector().attr("tabactivecallback")&&(_r=window[this.selector().attr("tabactivecallback")]);return _r},tabchangecallback:function(){var _r;this.selector().attr("tabchangecallback")&&(_r=window[this.selector().attr("tabchangecallback")]);return _r},tablabelparent:function(_label){var _tmp;this.selector().attr("tablabelparent")&&(_tmp=_label.parent(this.selector().attr("tablabelparent")))&&_tmp.length&&(_label=_tmp);return _label},tabAjaxUrl:function(_label){return _label.attr("tabAjaxUrl")},tabIframeUrl:function(_label){return _label.attr("tabIframeUrl")},tabajaxmethod:function(_label){return(_label.attr("tabajaxmethod")||"get").toLowerCase()},tabajaxdata:function(_label){var _r;_label.attr("tabajaxdata")&&(eval("(_r = "+_label.attr("tabajaxdata")+")"));_r=_r||{};Tab.ajaxRandom&&(_r.rnd=new Date().getTime());return _r},tabajaxcallback:function(_label){var _r=Tab.ajaxCallback,_tmp;_label.attr("tabajaxcallback")&&(_tmp=window[_label.attr("tabajaxcallback")])&&(_r=_tmp);return _r}});JC.f.extendObject(Tab.View.prototype,{init:function(){var _p=this;JC.log(_p._model.activeEvent(),JC.f.ts());this._model.tablabels().on(_p._model.activeEvent(),function(_evt){var _sp=$(this),_r;if(typeof _p._model.currentIndex!=="undefined"&&_p._model.currentIndex===_p._model.tabindex(_sp)){return}_p._model.currentIndex=_p._model.tabindex(_sp);_p._model.tabactivecallback()&&(_r=_p._model.tabactivecallback().call(this,_evt,_p._model.tabcontainers(_p._model.currentIndex),_p));if(_r===false){return}_p.active(_p._model.tabindex(_sp))});return this},active:function(_ix){if(typeof _ix=="undefined"){return}var _p=this,_r,_activeClass=_p._model.activeClass(),_activeItem=_p._model.tablabels(_ix);_p._model.tablabels().each(function(){_p._model.tablabelparent($(this)).removeClass(_activeClass)});_activeItem=_p._model.tablabelparent(_activeItem);_activeItem.addClass(_activeClass);_p._model.tabcontainers().hide();_p._model.tabcontainers(_ix).show();_p._model.tabchangecallback()&&(_r=_p._model.tabchangecallback().call(_p._model.tablabels(_ix),_p._model.tabcontainers(_ix),_p));if(_r===false){return}_p.activeAjax(_ix);_p.activeIframe(_ix)},activeAjax:function(_ix){var _p=this,_label=_p._model.tablabels(_ix);if(!Tab.isAjax(_label)){return}if(Tab.isAjaxInited(_label)){return}var _url=_p._model.tabAjaxUrl(_label);if(!_url){return}Tab.isAjaxInited(_label,1);$[_p._model.tabajaxmethod(_label)](_url,_p._model.tabajaxdata(_label),function(_r,_textStatus,_jqXHR){_p._model.tabajaxcallback(_label)&&_p._model.tabajaxcallback(_label)(_r,_label,_p._model.tabcontainers(_ix),_p,_textStatus,_jqXHR);!_p._model.tabajaxcallback(_label)&&_p._model.tabcontainers(_ix).html(_r)})},activeIframe:function(_ix){var _p=this,_label=_p._model.tablabels(_ix);if(!Tab.isIframe(_label)){return}if(Tab.isIframeInited(_label)){return}var _url=_p._model.tabIframeUrl(_label);if(!_url){return}Tab.isIframeInited(_label,1);_p._model.tabcontainers(_ix).attr("src",_url)}});$(document).delegate(".js_autoTab, .js_compTab","mouseover",function(_evt){if(!Tab.autoInit){return}var _p=$(this),_tab,_src=_evt.target||_evt.srcElement;if(Tab.getInstance(_p)){return}_src&&(_src=$(_src));_tab=new Tab(_p,_src)});$(document).ready(function(){$("div.js_autoTab[tabTriggerDefault], div.js_compTab[tabTriggerDefault]").each(function(){var _p=$(this),_ins=JC.BaseMVC.getInstance(_p,JC.Tab);if(!_ins){Tab.triggerDefault(new Tab(_p))}})});return JC.Tab})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));