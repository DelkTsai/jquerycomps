(function(b,a){b(["JC.common"],function(){(function(c){window.JC=window.JC||{log:function(){}};window.Tree=JC.Tree=d;function d(g,h){if(g&&c(g).length){g=c(g);if(d.getInstance(g)){return d.getInstance(g)}g.data("TreeIns",this)}this._model=new f(g,h);this._view=new e(this._model)}d.getInstance=function(g){g=c(g);return g.data("TreeIns")};d.dataFilter;d.prototype={init:function(){this._view.init();this._view.treeRoot().data("TreeIns",this);return this},open:function(g){if(typeof g=="undefined"){this._view.openAll();return this}this._view.open(g);return this},close:function(g){if(typeof g=="undefined"){this._view.closeAll();return this}this._view.close(g);return this},idPrefix:function(){return this._model.idPrefix()},getItem:function(g){var h;g&&(h=c("#"+this._model.id(g)));return h},on:function(h,g){if(!(h&&g)){return this}this._model.addEvent(h,g);return this},event:function(g){if(!g){return}return this._model.event(g)},highlight:function(g){return this._model.highlight(g)}};function f(g,h){this._container=g;this._data=h;this._id="tree_"+new Date().getTime()+"_";this._highlight;this._events={};this._init()}f.prototype={_init:function(){d.dataFilter&&(this._data=d.dataFilter(this._data));return this},container:function(){return this._container},id:function(g){return this._id+g},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(g){return this._data.data[g]},hasChild:function(g){return g in this._data.data},event:function(g){g=g.toLowerCase();return this._events[g]},addEvent:function(h,g){h=h.toLowerCase();if(!(h in this._events)){this._events[h]=[]}this._events[h].unshift(g)},highlight:function(g){g&&(this._highlight=g);return this._highlight}};function e(g){this._model=g;this._treeRoot}e.prototype={init:function(){if(!(this._model.data()&&this._model.root())){return}this._process(this._model.child(this._model.root()[0]),this._initRoot());return this},treeRoot:function(g){g&&(this._treeRoot=g);return this._treeRoot},_process:function(m,n){for(var l=0,h=m.length,k,g;l<h;l++){k=m[l];g=l===h-1;if(this._model.hasChild(k[0])){this._initFolder(n,k,g)}else{this._initFile(n,k,g)}}},_initRoot:function(){var g=this;if(!g._model.data().root){return}var i=g._model.data().root;var l=c('<ul class="tree_wrap"></ul>');var k=this._initLabel(i);var h=c('<li class="folder_open"></li>');h.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>');k.appendTo(h);h.appendTo(l);l.appendTo(g._model.container());this.treeRoot(l);var j=c('<ul style="" class="tree_wrap_inner"></ul>');j.appendTo(h);return j},_initFolder:function(n,j,g){var i="",k="";g&&(i="folder_span_lst ",k="folder_last");var m=this._initLabel(j);var h=c(JC.f.printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',j[1],i));h.addClass(JC.f.printf("folder_closed {0} folder",k));m.appendTo(h);var l=c('<ul style="display:none;" class="folder_ul_lst" ></ul>');l.appendTo(h);h.appendTo(n);this._process(this._model.child(j[0]),l)},_initFile:function(m,j,g){var i="folder_img_bottom ",k="";g&&(i="folder_img_last ",k="");var l=this._initLabel(j);var h=c(JC.f.printf('<li><span class="{1}file">&nbsp;</span></li>',j[1],i));h.addClass("folder_closed file");l.appendTo(h);h.appendTo(m)},_initLabel:function(g){var h=c('<div class="node_ctn"></div>');h.attr("id",this._model.id(g[0])).attr("dataid",g[0]).attr("dataname",g[1]).data("nodeData",g);if(this._model.event("RenderLabel")){c.each(this._model.event("RenderLabel"),function(j,i){if(i.call(h,g,h)===false){return false}})}else{h.html(g[1]||"没有标签")}return h},openAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_closed").each(function(){c(this).trigger("click")})},closeAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if(c(this).hasClass("folder_img_closed")){return}c(this).trigger("click")})},open:function(h){if(!h){return}var g=c("#"+this._model.id(h));if(!g.length){return}var i=g.parents("li");if(this._model.highlight()){this._model.highlight().removeClass("highlight")}g.addClass("highlight");this._model.highlight(g);i.each(function(){var j=c(this),k=j.find("> span.folderRoot, > span.folder");if(k.length){if(k.hasClass("folder_img_open")){return}k.trigger("click")}})},close:function(h){if(!h){return}var g=c("#"+this._model.id(h));if(!g.length){return}var i=g.parent("li").find("> span.folderRoot, > span.folder");if(i.length){if(i.hasClass("folder_img_closed")){return}i.trigger("click")}}};d.lastHover=null;c(document).delegate("ul.tree_wrap div.node_ctn","mouseenter",function(){if(d.lastHover){d.lastHover.removeClass("ms_over")}c(this).addClass("ms_over");d.lastHover=c(this)});c(document).delegate("ul.tree_wrap div.node_ctn","mouseleave",function(){if(d.lastHover){d.lastHover.removeClass("ms_over")}});c(document).delegate("ul.tree_wrap div.node_ctn","click",function(h){var g=c(this),j=g.parents("ul.tree_wrap"),k=j.data("TreeIns");if(!k){return}var i=k.event("click");if(i&&i.length){c.each(i,function(m,l){if(l.call(g,h)===false){return false}})}if(k.highlight()){k.highlight().removeClass("highlight")}g.addClass("highlight");k.highlight(g);var i=k.event("change");if(i&&i.length){c.each(i,function(m,l){if(l.call(g,h)===false){return false}})}});c(document).delegate("ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(h){var g=c(this),i=g.parent("li"),m=i.find("> ul");var k=g.parents("ul.tree_wrap"),l=k.data("TreeIns");var j=l.event("FolderClick");if(j&&j.length){c.each(j,function(o,n){if(n.call(g,h)===false){return false}})}if(g.hasClass("folder_img_open")){g.removeClass("folder_img_open").addClass("folder_img_closed");m.hide()}else{if(g.hasClass("folder_img_closed")){g.addClass("folder_img_open").removeClass("folder_img_closed");m.show()}}if(i.hasClass("folder_closed")){i.addClass("folder_open").removeClass("folder_closed")}else{if(i.hasClass("folder_open")){i.removeClass("folder_open").addClass("folder_closed")}}})}(jQuery));return JC.Tree})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));