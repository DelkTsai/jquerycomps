(function(b,a){b(["JC.common"],function(){window.Tree=JC.Tree=c;function c(f,g){if(f&&$(f).length){f=$(f);if(c.getInstance(f)){return c.getInstance(f)}f.data(c.Model._instanceName,this)}this._model=new e(f,g);this._view=new d(this._model)}c.getInstance=function(f){f=$(f);return f.data(c.Model._instanceName)};c.dataFilter;c.prototype={init:function(){this._view.init();this._view.treeRoot().data(c.Model._instanceName,this);return this},open:function(f){if(typeof f=="undefined"){this._view.openAll();return this}this._view.open(f);return this},close:function(f){if(typeof f=="undefined"){this._view.closeAll();return this}this._view.close(f);return this},idPrefix:function(){return this._model.idPrefix()},getItem:function(f){var g;f&&(g=$("#"+this._model.id(f)));return g},on:function(g,f){if(!(g&&f)){return this}this._model.addEvent(g,f);return this},event:function(f){if(!f){return}return this._model.event(f)},selectedItem:function(f){return this._view.selectedItem(f)},highlight:function(){return this.selectedItem.apply(this,JC.f.sliceArgs(arguments))}};c.Model=e;c.View=d;c.Model._instanceName="TreeIns";function e(f,g){this._container=f;this._data=g;this._id=JC.f.printf("tree_{0}_{1}_",new Date().getTime(),e._insCount++);this._highlight;this._events={};this._init()}e._insCount=1;e.prototype={_init:function(){c.dataFilter&&(this._data=c.dataFilter(this._data));return this},container:function(){return this._container},id:function(f){return this._id+f},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(f){var g=this._data.data[f];!(g&&g.length)&&(g=[]);return g},hasChild:function(f){return f in this._data.data},event:function(f){f=f.toLowerCase();return this._events[f]},addEvent:function(g,f){g=g.toLowerCase();if(!(g in this._events)){this._events[g]=[]}this._events[g].unshift(f)},highlight:function(f){f&&(this._highlight=$(f));return this._highlight}};function d(f){this._model=f;this._treeRoot}d.prototype={init:function(){if(!(this._model.data()&&this._model.root())){return}this._model.container().addClass("js_compTree");this._process(this._model.child(this._model.root()[0]),this._initRoot());return this},treeRoot:function(f){f&&(this._treeRoot=f);return this._treeRoot},_process:function(l,m){for(var k=0,g=l.length,h,f;k<g;k++){h=l[k];f=k===g-1;if(this._model.hasChild(h[0])){this._initFolder(m,h,f)}else{this._initFile(m,h,f)}}},_initRoot:function(){var f=this;if(!f._model.data().root){return}var h=f._model.data().root;var k=$('<ul class="tree_wrap"></ul>');var j=this._initLabel(h);var g=$('<li class="folder_open"></li>');g.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>');j.appendTo(g);g.appendTo(k);k.appendTo(f._model.container());this.treeRoot(k);var i=$('<ul style="" class="tree_wrap_inner"></ul>');i.appendTo(g);return i},_initFolder:function(m,i,f){var h="",j="";f&&(h="folder_span_lst ",j="folder_last");var l=this._initLabel(i);var g=$(JC.f.printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',i[1],h));g.addClass(JC.f.printf("folder_closed {0} folder",j));l.appendTo(g);var k=$('<ul style="display:none;" class="folder_ul_lst" ></ul>');k.appendTo(g);g.appendTo(m);this._process(this._model.child(i[0]),k)},_initFile:function(l,i,f){var h="folder_img_bottom ",j="";f&&(h="folder_img_last ",j="");var k=this._initLabel(i);var g=$(JC.f.printf('<li><span class="{1}file">&nbsp;</span></li>',i[1],h));g.addClass("folder_closed file");k.appendTo(g);g.appendTo(l)},_initLabel:function(f){var g=$('<div class="node_ctn"></div>');g.attr("id",this._model.id(f[0])).attr("dataid",f[0]).attr("dataname",f[1]).data("nodeData",f);if(this._model.event("RenderLabel")){$.each(this._model.event("RenderLabel"),function(i,h){if(h.call(g,f,g)===false){return false}})}else{g.html(f[1]||"没有标签")}return g},openAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_closed").each(function(){$(this).trigger("click")})},closeAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if($(this).hasClass("folder_img_closed")){return}$(this).trigger("click")})},open:function(g){if(!g){return}var f=$("#"+this._model.id(g));if(!f.length){return}var h=f.parents("li");this.selectedItem(f);h.each(function(){var i=$(this),j=i.find("> span.folderRoot, > span.folder");if(j.length){if(j.hasClass("folder_img_open")){return}j.trigger("click")}})},selectedItem:function(f){f&&(f=$(f));if(!(f&&f.length)){return this._model.highlight()}if(this._model.highlight()){this._model.highlight().removeClass("highlight").removeClass("selectedTreeNode")}f.addClass("highlight").addClass("selectedTreeNode");this._model.highlight(f);return f},close:function(g){if(!g){return}var f=$("#"+this._model.id(g));if(!f.length){return}var h=f.parent("li").find("> span.folderRoot, > span.folder");if(h.length){if(h.hasClass("folder_img_closed")){return}h.trigger("click")}}};c.lastHover=null;$(document).delegate(".js_compTree ul.tree_wrap div.node_ctn","mouseenter",function(){if(c.lastHover){c.lastHover.removeClass("ms_over")}$(this).addClass("ms_over");c.lastHover=$(this)});$(document).delegate(".js_compTree ul.tree_wrap div.node_ctn","mouseleave",function(){if(c.lastHover){c.lastHover.removeClass("ms_over")}});$(document).delegate(".js_compTree ul.tree_wrap div.node_ctn","click",function(g){var f=$(this),i=f.parents("ul.tree_wrap"),j=i.data(c.Model._instanceName);if(!j){return}var h=j.event("click");if(h&&h.length){$.each(h,function(l,k){if(k.call(f,g)===false){return false}})}j.selectedItem(f);var h=j.event("change");if(h&&h.length){$.each(h,function(l,k){if(k.call(f,g)===false){return false}})}});$(document).delegate(".js_compTree ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(g){var f=$(this),h=f.parent("li"),l=h.find("> ul");var j=f.parents("ul.tree_wrap"),k=j.data(c.Model._instanceName);var i=k.event("FolderClick");if(i&&i.length){$.each(i,function(n,m){if(m.call(f,g)===false){return false}})}if(f.hasClass("folder_img_open")){f.removeClass("folder_img_open").addClass("folder_img_closed");l.hide()}else{if(f.hasClass("folder_img_closed")){f.addClass("folder_img_open").removeClass("folder_img_closed");l.show()}}if(h.hasClass("folder_closed")){h.addClass("folder_open").removeClass("folder_closed")}else{if(h.hasClass("folder_open")){h.removeClass("folder_open").addClass("folder_closed")}}});return JC.Tree})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));