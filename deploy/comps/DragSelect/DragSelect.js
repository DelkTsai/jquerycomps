(function(b,a){b(["JC.BaseMVC"],function(){var e=$(document),d=$(window);JC.DragSelect=c;function c(f){f&&(f=$(f));if(JC.BaseMVC.getInstance(f,c)){return JC.BaseMVC.getInstance(f,c)}JC.BaseMVC.getInstance(f,c,this);this._model=new c.Model(f);this._view=new c.View(this._model);this._init();JC.log(c.Model._instanceName,"all inited",new Date().getTime())}c.init=function(f){var g=[];f=$(f||document);if(f.length){if(f.hasClass("js_compDragSelect")){g.push(new c(f))}else{f.find("div.js_compDragSelect").each(function(){g.push(new c(this))})}}return g};c.AR_IX=function(g,f,h){return g[f]||g[0]||h||""};JC.BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var f=this;f.on("inited",function(){});$.each(f._model.itemsClassAr(),function(h,i){var k=c.AR_IX(f._model.selectClassAr(),h),g=c.AR_IX(f._model.unselectClassAr(),h);f.selector().delegate(i,"click",function(l){});f.selector().delegate(i,"mousedown",function(m){var l=$(this);d.off("mouseup",j);f._model.clearCache();f._model.selectReady(h,true);f.trigger("item_find",[l,h,i,k,g]);d.on("mouseup",j);JC.log("mousedown",h,i,JC.f.ts())});f.selector().delegate(i,"mouseover",function(m){if(!f._model.selectReady(h)){return}var l=$(this);f.trigger("item_find",[l,h,i,k,g])});function j(l){f._model.selectReady(h,false);d.off("mouseup",j);f.trigger("select_done",[h,i,k,g])}});f.on("init_count",function(j,i,k,l,m,h){i=$(i);var g;if(!i.data(f._model.countKey())){i.data(f._model.countKey(),c.Model.UNI_COUNT++)}else{g=i.data(f._model.countKey());if((c.Model.UNI_COUNT-2)==g&&f._model.prevItem()){f._model.prevItem().data(f._model.countKey(),0);f.trigger("unselect_item",[f._model.prevItem(),k,l,m,h])}}});f.on("item_find",function(i,h,j,k,l,g){h=$(h);f.trigger("init_count",[h,j]);if(h.hasClass(l)){f.trigger("unselect_item",[h,j,k,l,g])}else{f.trigger("select_item",[h,j,k,l,g])}});f.on("select_item",function(i,h,j,k,l,g){h=$(h);l&&h.addClass(l);g&&h.removeClass(g);f._model.findedItems(h,k)});f.on("unselect_item",function(i,h,j,k,l,g){h=$(h);l&&h.removeClass(l);g&&h.addClass(g);f._model.findedItems(h,k)});f.on("select_done",function(h,i,k,l,g){JC.log("select_done",JC.f.ts());var j=f._model.fixFindedItems(k,l,g);f.trigger("process_select",[j,i,k,l,g])});f.on("process_select",function(h,k,i,j,l,g){JC.log("process_select",JC.f.ts());JC.dir(k)})},_inited:function(){this.trigger("inited")}});c.Model._instanceName="JCDragSelect";c.Model.UNI_COUNT=1;c.Model.BEFORE_FIND_PREFIX="beforeSelected";JC.f.extendObject(c.Model.prototype,{init:function(){},findedItems:function(i,h,g){var f=this;if(i&&h){!f._findedItems&&(f._findedItems={},f._findedItems[h]={});!f._findedItems[h]&&(f._findedItems[h]={});var j=i.data(f.countKey());f._findedItems[h][j]=i}if(!g&&h){return f._findedItems[h]}else{return f._findedItems}},fixFindedItems:function(h,j,g){var f=this,i=f.findedItems(null,h);$.each(i,function(l,k){if(!k.hasClass(j)){delete i.select[l]}});return i},clearFindedItems:function(){this._findedItems={}},prevItem:function(f){typeof f!="undefined"&&(this._prevItem=f);return this._prevItem},countKey:function(g){var f=this;(!f._countKey||g)&&(f._countKey="CDS_"+new Date().getTime());return f._countKey},selectReady:function(g,f){!this._selectReady&&(this._selectReady={});typeof f!="undefined"&&(this._selectReady[g]=f);return this._selectReady[g]},items:function(){return this.selectorProp("cdsItems")},itemsClass:function(){return this.attrProp("cdsItems")},selectClass:function(){return this.attrProp("cdsSelectClass")},unselectClass:function(){return this.attrProp("cdsUnselectClass")},processAr:function(g,h){var f=this;!f[g]&&(f[g]=h.split(f.itemDelimiter()),$.each(f[g],function(j,i){f[g][j]=$.trim(i)}));return f[g]},itemsAr:function(){return this.processAr("_itemsAr",this.items())},itemsClassAr:function(){return this.processAr("_itemsClassAr",this.itemsClass())},selectClassAr:function(){return this.processAr("_selectClassAr",this.selectClass())},unselectClassAr:function(){return this.processAr("_unselectClassAr",this.unselectClass())},itemDelimiter:function(){return this.attrProp("cdsItemDelimiter")||"||"},clearCache:function(){var f=this;f.prevItem(null);f._relativeParent=null;f.clearFindedItems();f.countKey(true)}});JC.f.extendObject(c.View.prototype,{init:function(){}});e.ready(function(){c.autoInit&&c.init()});return JC.DragSelect})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));