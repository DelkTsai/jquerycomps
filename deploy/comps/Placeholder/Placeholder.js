(function(b,a){b(["JC.common","JC.BaseMVC"],function(){(function(h){window.JC=window.JC||{log:function(){}};JC.Placeholder=d;function d(i){i&&(i=h(i));if(d.isSupport){i&&i.is("[xplaceholder]")&&i.attr("placeholder",i.attr("xplaceholder"));return}if(d.getInstance(i)){return d.getInstance(i)}d.getInstance(i,this);this._model=new d.Model(i);this._view=new d.View(this._model);this._init();JC.log("Placeholder:",new Date().getTime())}d.getInstance=function(i,j){if(typeof i=="string"&&!/</.test(i)){i=h(i)}if(!(i&&i.length)||(typeof i=="string")){return}typeof j!="undefined"&&i.data(d.Model._instanceName,j);return i.data(d.Model._instanceName)};d.init=function(j){var k=[],i;d.update();j=h(j||document);if(j&&j.length&&(i=j.prop("nodeName").toLowerCase())){if(i=="text"||i=="textarea"){if(d.isSupport){j.is("[xplaceholder]")&&j.attr("placeholder",j.attr("xplaceholder"))}else{j.is("[placeholder]")&&k.push(new d(j))}}else{j.find(["input[type=text][placeholder]","textarea[placeholder]","input[type=text][xplaceholder]","textarea[xplaceholder]"].join(",")).each(function(){var l=h(this);if(d.isSupport){l.is("[xplaceholder]")&&l.attr("placeholder",l.attr("xplaceholder"))}else{k.push(new d(l))}})}}return k};d.update=function(){var i=h(JC.f.printf("#{0} > div",d.Model._boxId));if(!i.length){return}i.each(function(){var j=h(this),k=j.data("CPHIns");if(!k){return}k.update()})};d.className="xplaceholder";d.isSupport="placeholder" in h('<input type="text" />')[0];d.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var i=this;i._model.selector().on("focus",function(j){i._view.hide()});i._model.selector().on("blur",function(j){i._view.show()});i._model.selector().on("placeholder_remove",function(j){i._model.placeholder().remove();d.Model._removeTm&&clearTimeout(d.Model._removeTm);d.Model._removeTm=setTimeout(function(){d.update()},1)});i.on("CPHUpdate",function(j){i._view.update()});i.on("CPHInitedPlaceholder",function(j){var k=i._model.placeholder();k.on("click",function(l){i._model.selector().trigger("focus");g(i._model.selector()[0],i._model.selector().val().length)});k.data("CPHIns",i)})},_inited:function(){var i=h(this);i.trigger("CPHUpdate")},update:function(){this._view.update()}};BaseMVC.buildModel(d);d.Model._instanceName="Placeholder";d.Model._boxId="XPlaceHolderBox";d.Model.prototype={init:function(){},className:function(){var i=this.attrProp("cphClassName")||d.className;return i},text:function(){var i=this.attrProp("xplaceholder")||this.attrProp("placeholder")||"";return i},placeholder:function(){if(!this._placeholder){this._placeholder=h(JC.f.printf('<div class="{0}"></div>',this.className())).appendTo(this.placeholderBox());h(this).trigger("TriggerEvent",["CPHInitedPlaceholder"])}this._placeholder.html(this.text());return this._placeholder},placeholderBox:function(){var i=h("#"+d.Model._boxId);if(!(i&&i.length)){i=h(JC.f.printf('<div id="{0}"></div>',d.Model._boxId)).appendTo(document.body)}return i}};BaseMVC.buildView(d);d.View.prototype={init:function(){},update:function(){var i=this,k=i._model.selector().val().trim(),m=i._model.placeholder();if(k){m.hide();return}var j=i._model.selector().offset(),l=i._model.selector().prop("offsetHeight"),n=m.prop("offsetHeight");m.css({left:j.left+"px",top:j.top+1+"px","line-height":l+"px"});m.show()},hide:function(){var i=this;i._model.placeholder().hide()},show:function(){var i=this,j=i._model.selector().val().trim();if(j){return}this.update();i._model.placeholder().show()}};BaseMVC.build(d);h.event.special.placeholder_remove={remove:function(i){if(i.handler){i.handler()}}};h(window).on("resize",function(){d.update()});function g(j,q){if(j.setSelectionRange){j.focus();j.setSelectionRange(q,q)}else{if(j.createTextRange){var r=j.createTextRange();var l=q;var o=q;var k=0;var m=0;var s=j.value;for(var n=0;n<s.length&&n<l;n++){var p=s.charAt(n);if(p!="\n"){k++}}for(var n=s.length-1;n>=o&&n>=0;n--){var p=s.charAt(n);if(p!="\n"){m++}}r.moveStart("character",k);r.moveEnd("character",-m);r.select();j.focus()}}}var c=h.fn.show,e=h.fn.hide,f=h({});h.fn.show=function(){var j=c.apply(this,arguments),i=this;setTimeout(function(){f.trigger("show")},1);return j};h.fn.hide=function(){var j=e.apply(this,arguments),i=this;setTimeout(function(){f.trigger("hide")},1);return j};f.on("show hide",function(){f.data("timer")&&clearTimeout(f.data("timer"));f.data("timer",setTimeout(function(){d.update()},100))});h(document).ready(function(){var i=0;d.autoInit&&(i=d.init())})}(jQuery));return JC.Placeholder})}(typeof define==="function"&&define.amd?define:function(a,b){b&&b()},this));