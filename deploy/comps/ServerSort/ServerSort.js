(function(b,a){b(["JC.BaseMVC"],function(){var e=$(document),d=$(window);JC.ServerSort=c;function c(f){f&&(f=$(f));if(JC.BaseMVC.getInstance(f,c)){return JC.BaseMVC.getInstance(f,c)}JC.BaseMVC.getInstance(f,c,this);this._model=new c.Model(f);this._view=new c.View(this._model);this._init()}c.init=function(f){var g=[];f=$(f||document);if(f.length){if(f.hasClass("js_compServerSort")){g.push(new c(f))}else{f.find("div.js_compServerSort, tr.js_compServerSort").each(function(){g.push(new c(this))})}}return g};JC.BaseMVC.build(c);JC.f.extendObject(c.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var f=this;if(!(f._model.items()&&f._model.items().length)){return}f.on("inited",function(){f.trigger("UPDATE_LAYOUT")});f._model.items().on("click",function(i){i.preventDefault();var h=$(this),j=JC.f.getUrlParam(f._model.sortName()),k=JC.f.getUrlParam(f._model.typeName()),l=h.attr("sortName"),m=h.attr("sortType"),g;g=k;if(l==f._model.defaultSortName()){if(g){m=f._model.otherSortType(g)}else{m=f._model.otherSortType(f._model.defaultType())}}else{m=f._model.defaultType()}f.trigger("UPDATE",[l,m,j,k])});f.on("UPDATE",function(g,n,k,o,l){var j=f._model.url(),m={},i=f._model.resetUrlParams(),h;m[f._model.sortName()]=n;m[f._model.typeName()]=k;j=JC.f.addUrlParams(j,m);if(i&&i.length){$.each(i,function(q,p){if(!p){return}if(JC.f.hasUrlParam(j,p)){h={};h[p]=1;j=JC.f.addUrlParams(j,h)}})}f._model.urlFilter()&&(j=f._model.urlFilter()(j));location.href=j});f.on("UPDATE_LAYOUT",function(h){var k=f._model.defaultSortName(),i=f._model.defaultType(),g=JC.f.getUrlParam(f._model.typeName())||i,j=f._model.items();if(!(j&&j.length)){return}$.each(j,function(n,m){m=$(m);var o=m.attr("sortName"),l;if(o==k){l=[f._model.classEnum()[f._model.typeIndexAt(f._model.otherSortType(g))],f._model.curClassEnum()[f._model.typeIndexAt(f._model.otherSortType(g))]].join(" ")}else{l=f._model.classEnum()[f._model.typeIndexAt(i)]}if(l){m.removeClass(f._model.classEnum().concat(f._model.curClassEnum()).join(" "));m.addClass(l)}})})},_inited:function(){this.trigger("inited")}});c.Model._instanceName="JCServerSort";JC.f.extendObject(c.Model.prototype,{init:function(){},urlFilter:function(){return this.callbackProp("cssUrlFilter")},typeIndexAt:function(f){var g=0;$.each(this.typeEnum(),function(i,h){if(h===f){g=i;return false}});return g},resetUrlParams:function(){if(!this._resetUrlParams){this._resetUrlParams=(this.attrProp("cssResetUrlParams")||"page").replace(/[\s]+/g,"");this._resetUrlParams&&(this._resetUrlParams=this._resetUrlParams.split(","))}return this._resetUrlParams},defaultType:function(){return this.attrProp("cssDefaultType")||this.typeEnum()[0]},otherSortType:function(f){var g;if(f){$.each(this.typeEnum(),function(i,h){if(f!=h){g=h;return false}})}g=g||this.typeEnum()[0];return g},defaultSortName:function(){if(typeof this._defalutSortName=="undefined"){this._defalutSortName=this.items().first().attr("sortName");this.is("[cssDefaultSortName]")&&(this._defalutSortName=this.attrProp("cssDefaultSortName")||this._defalutSortName);this._defalutSortName=JC.f.getUrlParam(this.sortName())||this._defalutSortName}return this._defalutSortName},items:function(){if(typeof this._items=="undefined"){var f=this.attrProp("cssItems")||"|a[sortName]";this._items=JC.f.parentSelector(this.selector(),f)||null}return this._items},url:function(){return JC.f.urlDetect(this.attrProp("cssUrl")||"URL")},sortName:function(){return this.attrProp("cssSortName")||"sortby"},typeName:function(){return this.attrProp("cssTypeName")||"sorttype"},typeEnum:function(){if(!this._typeEnum){this._typeEnum=(this.attrProp("cssTypeEnum")||"desc,asc").replace(/[\s]+/g,"").split(",")}return this._typeEnum},classEnum:function(){if(!this._classEnum){this._classEnum=(this.attrProp("cssClassEnum")||"js_cssDesc,js_cssAsc").replace(/[\s]+/g,"").split(",")}return this._classEnum},curClassEnum:function(){if(!this._curClassEnum){this._curClassEnum=(this.attrProp("cssCurClassEnum")||"js_cssDesc_cur,js_cssAsc_cur").replace(/[\s]+/g,"").split(",")}return this._curClassEnum}});JC.f.extendObject(c.View.prototype,{init:function(){}});e.ready(function(){c.autoInit&&c.init()});return JC.ServerSort})}(typeof define==="function"&&define.amd?define:function(b,a,c){typeof b=="function"&&(c=b);typeof a=="function"&&(c=a);c&&c()},window));